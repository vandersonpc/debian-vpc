(()=>{"use strict";function e(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,c=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw c}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(){function t(e){var t=document.createElement("button"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.documentElement.classList.contains("dark");t.className="navigation-button ".concat("up"===e?"up":"down"," ").concat(r?"dark":""," btn relative btn-small m-auto mb-2"),t.title="up"===e?"Scroll to previous keyword":"Scroll to next keyword",n.setAttribute("stroke",r?"white":"rgb(0, 180, 138)"),n.setAttribute("fill","none"),n.setAttribute("stroke-width","2"),n.setAttribute("viewBox","0 0 24 24"),n.setAttribute("stroke-linecap","round"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("class","h-4 w-4 m-1"),n.setAttribute("height","1em"),n.setAttribute("width","1em"),n.setAttribute("xmlns","http://www.w3.org/2000/svg");var o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1","12"),o.setAttribute("y1","5"),o.setAttribute("x2","12"),o.setAttribute("y2","19");var a=document.createElementNS("http://www.w3.org/2000/svg","polyline");return a.setAttribute("points","up"===e?"5 12 12 5 19 12":"19 12 12 19 5 12"),n.appendChild(o),n.appendChild(a),t.appendChild(n),t}function n(n,r,a,c){var i=document.documentElement.classList.contains("dark"),l=document.createElement("div");l.className="search-container ".concat(i?"dark":"");var u=document.createElement("h3");u.textContent="Search Menu",l.appendChild(u);var s=document.createElement("div");s.className="navigation-buttons-container";var d=t("up"),h=t("down");d.addEventListener("click",(function(){o("up")})),h.addEventListener("click",(function(){o("down")})),s.appendChild(d),s.appendChild(h),l.appendChild(s);var m=function(t,n,r,o){var a=document.createElement("div");a.className="occurrences-text";var c=document.documentElement.classList.contains("dark");c&&a.classList.add("dark");var i=function(t,n){var r=t.mapping,o=new RegExp(n,"i");function a(e){var t=r[e];return t.parent?a(t.parent):e}function c(e){var t=r[e];if(t.parent){var n=r[t.parent];return n.children.length>1?n:c(t.parent)}return null}function i(t){var n,o=0,a=null,c=e(t.children);try{for(c.s();!(n=c.n()).done;){var i=n.value,l=r[i];l.message&&l.message.create_time>o&&(o=l.message.create_time,a=l)}}catch(e){c.e(e)}finally{c.f()}return a}function l(t){var n=r[t];if(n.message&&o.test(n.message.content.parts.join(" ")))return n;var a,c=e(n.children);try{for(c.s();!(a=c.n()).done;){var i=l(a.value);if(i)return i}}catch(e){c.e(e)}finally{c.f()}return null}var u=l(a(Object.keys(r)[0]));if(!u)return null;var s=c(u.id);if(!s)return null;return i(s)}(r,o),l="Found ".concat(t," occurrence").concat(1!==t?"s":""," in current conversation thread.");if(n!==t){var u=n-t;if(u>0)if(l+=" There ".concat(1!==u?"are":"is"," ").concat(u," occurrence").concat(1!==u?"s":""," in a different thread in this conversation."),i){var s=document.createElement("button");s.innerHTML='<span class="btn btn-dark btn-small">Scroll to thread</span>',s.className="scroll-to-group-button",s.addEventListener("click",(function(){var t=function(t){var n,r=e(document.querySelectorAll(".group"));try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.textContent.includes(t))return o}}catch(e){r.e(e)}finally{r.f()}return null}(i.message.content.parts.join(" "));t&&t.scrollIntoView({behavior:"smooth",block:"center"})})),l+=" (Scroll to Thread is experimental)",a.appendChild(document.createTextNode(l)),a.appendChild(s)}else a.textContent=l}else a.textContent=l;return a}(n,r,a,c);l.appendChild(m);var v=document.createElement("button");v.innerHTML='<span class="btn btn-dark btn-small">Exit Search</span>',v.className="exit-button",v.addEventListener("click",(function(){document.querySelectorAll(".highlight-keyword, .highlight-keyword-current").forEach((function(e){return e.classList.remove("highlight-keyword","highlight-keyword-current")})),l.remove(),d.remove(),h.remove()})),l.appendChild(v),document.body.appendChild(l)}var r=0;function o(e){var t=document.querySelectorAll(".highlight-keyword");0!==t.length&&(t.forEach((function(e){return e.classList.remove("highlight-keyword-current")})),"up"===e?--r<0&&(r=t.length-1):"down"===e&&++r>=t.length&&(r=0),t[r].classList.add("highlight-keyword-current"),t[r].scrollIntoView({behavior:"smooth",block:"center"}))}chrome.runtime.onMessage.addListener((function(e,t,r){e.searchQuery&&e.selector&&e.count&&e.conversationId&&chrome.runtime.sendMessage({action:"fetchConversationContent",conversationId:e.conversationId},(function(t){var r,o,a=t.conversationContent,c=e.count;(r=e.searchQuery,o=e.selector,new Promise((function(e){var t=null,n=document.querySelectorAll(o),a=new RegExp("(".concat(r,")"),"gi"),c=function(e){if(e.nodeType===Node.TEXT_NODE){for(var n=e.textContent.replace("The previous model used in this conversation is unavailable. We've switched you to the latest default model",""),r=document.createElement("span"),o=n.split(a),c=0;c<o.length;c++)if(c%2==0)r.appendChild(document.createTextNode(o[c]));else{var i=document.createElement("span");i.classList.add("highlight-keyword"),i.textContent=o[c],r.appendChild(i),t=i}e.parentNode.replaceChild(r,e)}};n.forEach((function(e){for(var t,n=[],r=document.createNodeIterator(e,NodeFilter.SHOW_TEXT);t=r.nextNode();)n.push(t);n.forEach(c)})),e(t)}))).then((function(t){t&&t.scrollIntoView({behavior:"smooth",block:"center"}),n(document.querySelectorAll(".highlight-keyword").length,c,a,e.searchQuery)}))}))})),document.addEventListener("click",(function(e){if(e.target.closest(".cursor-pointer")){var t=e.target.closest(".cursor-pointer");o("124px"===t.style.bottom||"120px"===t.style.bottom?"up":"down")}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();