!function(){function e(e){return new Promise((t=>setTimeout(t,e)))}function t(){let e,t;return{promise:new Promise(((n,o)=>{e=n,t=o})),resolve:e,reject:t}}class n extends Error{}function o(e){return new Promise(((t,o)=>setTimeout((()=>o(new n("Promise timed out."))),e)))}class r extends Error{constructor(e){super(`Matching not exhaustive: unexpected value ${JSON.stringify(e)}`)}}async function s(t,n,o){const r=o();if(!(t>0))return r;try{return await r}catch(r){return await e(n),s(t-1,n,o)}}var i;!function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}e.create=function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}(i||(i={}));void 0!==self.requestIdleCallback&&self.requestIdleCallback;var a,l,c,u,g,f;!function(n){class o extends Error{constructor(e,t=1e3){super(`SafePromiseError: ${e}`),this.stack=(super.stack||"").slice(t)}}function r(e){return e.catch((e=>e instanceof Error&&!e.stack?Promise.reject(new o(e.message)):Promise.reject(e)))}n.fromPromise=r,n.fromAsync=function(e){return(...t)=>r(e(...t))},n.noop=n.fromPromise(Promise.resolve()),n.create=function(e){return r(new Promise(e))},n.sync=function(e){return r(new Promise(((t,n)=>t(e()))))},n.createCompletionSource=t,n.delay=e}(a||(a={}));class d{constructor(e,t){this._transport=e,this._log=t,this._calls=new Map,this._sub=this._transport.inbound.subscribe((e=>{var t;const n=this._calls.get(e.id);if(n)try{"err"in e?n.reject(e.err):n.resolve(e.res)}finally{this._calls.delete(e.id)}else null===(t=this._log)||void 0===t||t.warn(`received rpc call response for unregistered call ${e.id}`)})),this.api=new Proxy({},{get:(e,t)=>"then"===t?void 0:(...e)=>this._handleCall(t,e)})}_handleCall(e,t){let n=i.create();for(;this._calls.has(n);)n=i.create();const o=a.createCompletionSource();return this._calls.set(n,o),this._transport.outbound({id:n,method:e,args:t}),o.promise}dispose(){this._sub.unsubscribe()}}function p(e){return e.nodeType===Node.ELEMENT_NODE}!function(e){e[e.Escape=27]="Escape",e[e.Return=13]="Return",e[e.Tab=9]="Tab",e[e.RightArrow=39]="RightArrow",e[e.UpArrow=38]="UpArrow",e[e.DownArrow=40]="DownArrow"}(l||(l={})),function(e){e.editorElementClass="kix-appview-editor",e.layoutRootClass="kix-zoomdocumentplugin-outer",e.contentRootClass="kix-paginateddocumentplugin",e.wordNodeClass="kix-wordhtmlgenerator-word-node",e.commentContainerClass="docos-input",e.eventsIFrameSelector=".docs-texteventtarget-iframe",e.selectionOverlaySelector=".kix-selection-overlay",e.cursor=".kix-cursor",e.cursor_rectangle=".kix-cursor-caret",e.cursor_active="docs-text-ui-cursor-blink",e.versionHistorySidebarSelector="#docs-revisions-sidebar",e.viewModeMenuSelector='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',e.modeMenuSwitcherSelector="#docs-toolbar-mode-switcher",e.editModeClass="edit-mode",e.suggestModeClass="suggest-mode",e.requestEditAccessButtonSelector="#titlebar-mode-indicator-container .titlebar-request-access-button",e.legacyRequestEditAccessButtonSelector="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",e.lineViewDecorationsSelector=".kix-lineview-decorations",e.suggestionNewTextSelector='[class*="suggestion-text"]',e.suggestionOverlaySelector=".suggest-changes-top-colorbar",e.smartComposeSelector=".docs-smartcompose-suggestion",e.canvasSelector="canvas.kix-canvas-tile-content",e.canvasLayoutRootClass="kix-rotatingtilemanager",e.canvasLayoutContentSelector=".kix-rotatingtilemanager-content",e.canvasPageSVGSelector="div.kix-canvas-tile-content svg",e.canvasPageSVGSelectionSelector="div.kix-canvas-tile-content.kix-canvas-tile-selection svg",e.canvasPageSelector=".kix-page-paginated",e.canvasFirstPageSelector=".kix-page-paginated.canvas-first-page",e.canvasCompactLayoutClass="kix-page-canvas-compact-mode",e.horizontalRulerSelector=".docs-horizontal-ruler",e.verticalRulerSelector=".docs-vertical-ruler",e.fontSizeInputSelector="#fontSizeSelect input",e.rulerBackgroundSelector=".docs-ruler-background",e.rulerBackgroundInnerSelector=".docs-ruler-background-inner",e.firstLineIndentSelector=".docs-ruler-indent-first-line",e.linkDialogSelector=".docs-linkbubble-bubble",e.menuSelector=".goog-menu"}(c||(c={})),function(e){e.gdocsPageClass="kix-page",e.gdocsColumnClass="kix-page-column",e.gdocsColumnBottomClass="kix-page-column-bottom",e.gdocsFootNoteClass="kix-paginated-footnoteview",e.gdocsParagraphClass="kix-paragraphrenderer",e.gdocsTableClass="kix-tablerenderer",e.gdocsTableCellClass="kix-cellrenderer",e.lineTextClass="kix-lineview-text-block",e.wordNodeClass="kix-wordhtmlgenerator-word-node",e.inlineBlockClass="goog-inline-block",e.personEntityViewClass="kix-person-entity-view",e.personEntityNameClass="kix-person-entity-name",e.gdocsContentParagraphSelector=`.${e.gdocsColumnClass} .${e.gdocsParagraphClass}`,e.isContinuationParagraphContent=e=>{if(e){const t=e.closest(".kix-paragraphrenderer");return t&&!t.hasAttribute("id")}return null},e.isSplitTailParagraph=e=>p(e)&&!e.hasAttribute("id")}(u||(u={})),function(e){e.lineViewSelector="div.kix-lineview",e.spellingOverlaySelector="div.kix-spelling-error-overlay-container.kix-htmloverlay.docs-ui-unprintable",e.spellingUnderlineSelector="svg.kix-spelling-error-overlay",e.spellingBubbleSelector="div.kix-spell-bubble",e.spellingHighlightSelectors=["div.kix-spelling-error-highlighted-overlay","div.kix-spelling-error-highlighted-overlay-non-critical"],e.sellingUnderlinePromoBubbleSelector="div.jfk-bubble.jfk-bubble-promo.docs-promo-bubble"}(g||(g={})),function(e){function t(e){return p(e)&&e.classList.contains(u.gdocsParagraphClass)}function n(e){return p(e)&&e.classList.contains(u.gdocsTableClass)}e.isPage=function(e){return p(e)&&e.classList.contains(u.gdocsPageClass)},e.isPageLoaded=function(e){return e.querySelectorAll(u.gdocsContentParagraphSelector).length>0},e.isColumn=function(e){return p(e)&&e.classList.contains(u.gdocsColumnClass)},e.isColumnBottom=function(e){return p(e)&&e.classList.contains(u.gdocsColumnBottomClass)},e.isFootNote=function(e){return p(e)&&e.classList.contains(u.gdocsFootNoteClass)},e.isParagraph=t,e.isTable=n,e.isTableRow=function(e){return p(e)&&"tr"===e.tagName.toLowerCase()},e.isTableCellHolder=function(e){return p(e)&&"td"===e.tagName.toLocaleLowerCase()},e.isTableCellContent=function(e){return p(e)&&e.classList.contains(u.gdocsTableCellClass)},e.isContent=function(e){return t(e)||n(e)},e.isParagraphLine=function(e){return p(e)&&e.classList.contains(u.lineTextClass)},e.isWordNode=function(e){return p(e)&&e.classList.contains(u.wordNodeClass)},e.isTextNode=function(e){return e.nodeType===Node.TEXT_NODE},e.isNBSPNode=function(e){return p(e)&&e.classList.contains(u.inlineBlockClass)&&e.textContent===String.fromCharCode(160)},e.isPersonEntityView=function(e){return p(e)&&e.classList.contains(u.personEntityViewClass)},e.isPersonEntityName=function(e){return p(e)&&e.classList.contains(u.personEntityNameClass)}}(f||(f={}));class h{constructor(e,t,n,o){this._customInboundEventName=t,this._customOutboundEventName=n,this._wrapOutboundMessage=o,this.inbound={subscribe:e=>{const t=({detail:t})=>{const n=t;e&&("function"==typeof e?e(n):e.next&&e.next(n))};return this._target.addEventListener(this._customInboundEventName,t,!1),{unsubscribe:()=>this._target.removeEventListener(this._customInboundEventName,t,!1)}}},this.outbound=e=>{const t=this._wrapOutboundMessage?this._wrapOutboundMessage(e):e,n=new CustomEvent(this._customOutboundEventName,{bubbles:!0,cancelable:!0,detail:t});this._target.dispatchEvent(n)},this._target=e.defaultView||e}}const m=(e,t)=>e<t?-1:e>t?1:0;function v(e,t){const n=e.left<=t.left?e:t,o=n===e?t:e,r=e.top<=t.top?e:t,s=r===e?t:e;return n.left+n.width>o.left&&r.top+r.height>s.top}const b=(e,t)=>e.top===t.top?m(e.left,t.left):m(e.top,t.top),y=(new Set(["version","title","lang","translate","dir","dataset","hidden","tabIndex","accessKey","draggable","spellcheck","contentEditable","isContentEditable","offsetParent","offsetTop","offsetLeft","offsetWidth","offsetHeight","style","innerText","outerText","onabort","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextmenu","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onseeked","onseeking","onselect","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onwheel","ongotpointercapture","onlostpointercapture","onpointerdown","onpointermove","onpointerup","onpointercancel","onpointerover","onpointerout","onpointerenter","onpointerleave","click","focus","blur","onauxclick","nonce","namespaceURI","prefix","localName","tagName","id","className","classList","slot","attributes","shadowRoot","assignedSlot","innerHTML","outerHTML","scrollTop","scrollLeft","scrollWidth","scrollHeight","clientTop","clientLeft","clientWidth","clientHeight","onbeforecopy","onbeforecut","onbeforepaste","oncopy","oncut","onpaste","onsearch","onselectstart","previousElementSibling","nextElementSibling","children","firstElementChild","lastElementChild","childElementCount","onwebkitfullscreenchange","onwebkitfullscreenerror","setPointerCapture","releasePointerCapture","hasPointerCapture","hasAttributes","getAttributeNames","getAttribute","getAttributeNS","setAttribute","setAttributeNS","removeAttribute","removeAttributeNS","hasAttribute","hasAttributeNS","getAttributeNode","getAttributeNodeNS","setAttributeNode","setAttributeNodeNS","removeAttributeNode","closest","matches","webkitMatchesSelector","attachShadow","getElementsByTagName","getElementsByTagNameNS","getElementsByClassName","insertAdjacentElement","insertAdjacentText","insertAdjacentHTML","requestPointerLock","getClientRects","getBoundingClientRect","scrollIntoView","scrollIntoViewIfNeeded","createShadowRoot","getDestinationInsertionPoints","animate","remove","querySelector","querySelectorAll","webkitRequestFullScreen","webkitRequestFullscreen","scroll","scrollTo","scrollBy","before","after","replaceWith","prepend","append","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","nodeType","nodeName","baseURI","isConnected","ownerDocument","parentNode","parentElement","childNodes","firstChild","lastChild","previousSibling","nextSibling","nodeValue","textContent","hasChildNodes","getRootNode","normalize","cloneNode","isEqualNode","isSameNode","compareDocumentPosition","contains","lookupPrefix","lookupNamespaceURI","isDefaultNamespace","insertBefore","appendChild","replaceChild","removeChild","addEventListener","removeEventListener","dispatchEvent"]),["autocorrect","comment","composing_decoration","composing_region","draft_comment","ignore_spellcheck","ignore_word","import_warnings","link","named_range","revision_diff","smart_todo","spellcheck","suppress_feature","text","voice_corrections","voice_dotted_span","autogen","cell","citation_sources","column_sector","date_time","document","equation","equation_function","footnote","headings","horizontal_rule","language","list","paragraph","row","tbl"]),S=[61439,61438,59651,26,30,59649,3,59653,59652,16,17],x=[47,91,61439,61438,59651,26,30,59649,3,59653,59652,16,17,93,47],w=[x,[...x,103],[47,91,61439,61438,59651,26,30,59649,3,59653,59652,16,17,60417,60416,60419,60418,93,47]].map((e=>e.map((e=>String.fromCharCode(e))).join(""))),C=[[47,91,28,3,60419,59651,26,25,31,92,110,18,59653,16,93,47,103],[47,91,28,3,59653,60419,59651,26,25,31,92,110,18,16,93,47,103],[47,91,28,3,59653,59651,26,25,31,92,110,18,16,93,47,103]].map((e=>e.map((e=>String.fromCharCode(e))).join(""))),T=["rgba(118, 167, 250, 0.501960784313726)","rgba(118, 167, 250, 0.5)","rgba(143, 143, 143, 0.34)","rgba(0, 0, 0, 0.15)"].map((e=>e.replace(/\s+/g,"")));function E(e,t){let n=0,o=e.length-1;for(;n<=o;){const r=n+o>>1,s=t(e[r]);if(s>0)n=r+1;else{if(!(s<0))return{kind:"found",index:r};o=r-1}}return{kind:"notFound",lastSearchRange:[Math.min(n,o),Math.max(n,o)]}}function k(e,t,n=.001){return e===t||Math.abs(e-t)<=n}var M,A,_;function N(){let e,t,n,o,r=M.INIT;const s=()=>{e=void 0,t=void 0,r=M.INIT,n=void 0,o=void 0};let i=0;return{hasEquations:()=>i>0,getEquationState:()=>({level:e,stage:r,seqIndex:n,fragmentStartIndex:o,equations:i}),onTranslate:(a,l,c,u,g)=>{if(l&&void 0!==o&&((o,s,i,a)=>o===e&&!(!t||t.x!==-i||t.y!==-a)&&n===s-1&&M.RESTORE===r)(a,c,u,g)){const e=l.fragments,t=o,n=e.length-t;if(n>0)return e.splice(t,n),s(),i++,!0}return e=a,t={x:u,y:g},o=null==l?void 0:l.fragments.length,r=M.TRANSLATE,n=c,!1},onBeforeSave:(t,o)=>{if(t===e){if(M.TRANSLATE!==r)return void s();if(void 0===n||o!==n+1)return void s();n=o,r=M.SAVE}},onAfterRestore:(t,o)=>{if(t===e){if(M.SAVE!==r)return void s();n=o,r=M.RESTORE}},onClip:()=>{s()},reset:()=>{i=0,s()}}}function P(e){return e.type===A.text}!function(e){e[e.INIT=-1]="INIT",e[e.TRANSLATE=0]="TRANSLATE",e[e.SAVE=1]="SAVE",e[e.RESTORE=2]="RESTORE"}(M||(M={})),function(e){e.text="text",e.space="space",e.lineBreak="lineBreak",e.footnoteLink="footnoteLink",e.mention="mention"}(A||(A={})),function(e){e.ordinary="ordinary",e.special="special"}(_||(_={}));function R(e,t,n){let o=0;return{call(r,s,i,a){var l;const c=a(i),u=null===(l=t.postFn)||void 0===l?void 0:l[s];if(u)try{u(r,e,i,c,o++)}catch(e){n.logException(`proxy.call.${String(s)}`,e)}return c},set(r,s,i,a){var l;o++;const c=null===(l=t.overrideSet)||void 0===l?void 0:l[s];if(c)try{const t=c(r,e,i);if(void 0!==t)return a(t)}catch(e){n.logException(`proxy.set.${String(s)}`,e)}return a(i)}}}const I="M",O=" ";function D(e){const t=/^(?:([\d\w]+) )?(?:(\w+) )?([\d.]+)px (?:['"])?([\w -]+)(?:['"])?$/.exec(e);if(t){const[e,n,o,r,s]=t;let i="400",a="normal";return n&&(isNaN(parseInt(n,10))?"italic"===n?(a="italic",i=isNaN(parseInt(o,10))?"bold"===o?"700":"400":o):i="bold"===n?"700":"400":(i=n,a=o||a)),`${i} ${a} ${parseFloat(r).toFixed(4)}px "${s}"`}return e}function L(e,t,n){const o=new DOMPoint(e,t).matrixTransform(n);return{left:o.x,top:o.y}}function F(e,t,n){return{width:n.a*e+n.c*t,height:n.b*e+n.d*t}}function j(e,t){return t.a*e}function G(e,t){return t.d*e}const B=e=>{if("moveTo"in e)return e.moveTo},z=e=>{if("lineTo"in e)return e.lineTo},$=e=>{if("bezierCurveTo"in e)return e.bezierCurveTo};function q(e,t,n,o,r=!1){const s=(e,t,n,o=!1)=>{e.beginPath(),e.strokeStyle=`rgba(0,0,255,${o?.05:.2})`,e.lineWidth=2,e.moveTo(t,n),e.lineTo(t,n-20),e.stroke()};e.save(),e.resetTransform(),s(e,t,n,r),o.forEach((o=>s(e,t+o,n,r))),e.restore()}const W=(e,t,n,o,r,s=0,i=!1)=>{e.save(),e.resetTransform(),e.fillStyle=`rgba(221,0,0,${i?.05:.1})`,e.fillRect(t,n,o,10),e.fillStyle=`rgba(221,0,0,${i?.4:.8})`,e.font="10px Arial",e.fillText(`${s}`,t,n+10),e.fillStyle=`rgba(0,128,221,${i?.4:.8})`,q(e,t,n,r,i),e.restore()},K=(e,t,n,o,r,s=!1)=>{e.save(),e.resetTransform(),e.fillStyle=`rgba(0,221,0,${s?.05:.1})`,e.fillRect(t,n+10,o,10),e.restore(),q(e,t,n,r,s)},V=(e,t,n,o=!1)=>{e.save(),e.resetTransform(),e.beginPath(),e.strokeStyle=`rgba(0,221,0,${o?.05:.1})`,e.lineWidth=5,e.moveTo(t+2.5,n),e.lineTo(t+2.5,n+10),e.lineTo(t-10,n+10),e.stroke(),e.restore()};const U=["#ffffff","rgba(255,255,255,1)"],H=["#f1f3f4","rgba(241,243,244,1)"];function Y(e){if(e.compact)return 0;const{clips:t}=e.savableState;if(1===t.length){if(!e.currentPageMap)return 0;return J(t[0],{...e.currentPageMap.pageAttrs.canvasBitmapSize,left:0,top:0})}if(2===t.length){const[e,n]=t;return J(n,e)}return 0}function J(e,t){return e.left!==t.left||e.width!==t.width?0:0===e.top&&e.height<.6666666666666666*t.height?1:e.top>t.top&&e.top>.6666666666666666*t.height?2:0}function Q(e){const t=e.getCurrentPageAttrs();if(e.matchingBroken=!1,e.hasSuggestions=!1,e.footnote={footnoteLineDetected:!1},e.compact=t.isCompactLayout,e.clearedRect&&function(e,t){const{left:n,top:o,width:r,height:s}=t,i=e;return!(n<=0&&o<=0&&n+r>=i.width&&o+s>=i.height)}(t.canvasBitmapSize,e.clearedRect)){e.currentPageMap=null;const n={rect:null,fragments:[],wordCount:0};e.currentPartialMap={pageAttrs:t,rect:e.clearedRect,sections:{main:n}},e.savableState.renderContainer=e.currentPageFragment={type:"page",pageAttrs:t,partialRect:e.clearedRect,fragments:[]}}else e.currentPartialMap=null,e.currentPageMap=(n=t,{pageAttrs:{...n},sections:{main:{rect:null,fragments:[],wordCount:0},header:{rect:null,fragments:[],wordCount:0},footer:{rect:null,fragments:[],wordCount:0},footnotes:{rect:null,fragments:[],wordCount:0}}}),e.savableState.renderContainer=e.currentPageFragment={type:"page",pageAttrs:t,fragments:[]};var n}function X(e,t,n,o){const r=n.metricsMap.getMetrics(t,I),s=n.metricsMap.getMetrics(t,O);if(!r||!s)return null;return{spaceMetrics:s,top:e.top-G(r.chunk.actualBoundingBoxAscent,o),height:G(r.chunk.actualBoundingBoxAscent+r.chunk.actualBoundingBoxDescent,o)}}function Z(e,t,n,{top:o,height:r},s,i){const a=i.metricsMap.getMetrics(t,e);if(!a)return null;const l=j(a.chunk.width,s);return{baseline:n.top,top:o,left:n.left,text:e,width:l,height:r,charShifts:a.charShifts.map((e=>j(e.width,s)))}}function ee(e,t,n,o,r,s,i,a){const l=/^\d+$/.test(ce(e)),c=!a&&!l,u=X(n,t,r,s);if(c)return!0;if(l){const a=ce(e);if(i&&u&&P(i)){let e=i,l=o.fragments.length-1;for(let t=o.fragments.length-1;t>0;t--){const r=o.fragments[t];if(r.type===A.lineBreak)break;if(!(r.left>n.left)){e=r,l=t;break}}const c=Math.abs(e.height*ne-u.height)<oe*u.height,g=Math.abs(e.top-u.top)<u.height*oe;if(c&&g){const i=Z(a,t,n,u,s,r);if(i){const t={...i,height:e.height,baseline:e.baseline,type:A.footnoteLink,class:_.ordinary,linkText:a,text:"#"};if(function(e){return e.type===A.space}(e)&&k(e.left,n.left,re))return!function(e,t,n=.001){return function(e,t,n=.001){return e>=t||e+n>=t}(t,e,n)}(e.width,i.width,re)?o.fragments.splice(l,1,t,{...e,left:e.left+i.width,width:e.width-i.width}):o.fragments.splice(l,1,t),!0;if(Math.abs(i.left-e.left-e.width)<.5*u.spaceMetrics.chunk.width)return o.fragments.splice(l+1,0,t),!0}}}}else if(a&&i&&u&&P(i)){const a=Math.abs(i.height*ne-u.height)<oe*u.height,l=Math.abs(i.top-u.top)<u.height*oe;if(a&&l){const a=Z(ce(e),t,n,u,s,r);if(a){if(Math.abs(a.left-i.left-i.width)<.5*u.spaceMetrics.chunk.width)return o.fragments.push({...a,height:i.height,baseline:i.baseline,type:A.text,class:_.ordinary}),!0}}}return!1}const te=1,ne=.6,oe=.1,re=.001,se=192,ie=["rgba(0,0,0,1)"],ae=[String.fromCharCode(8204),"‭","‬"],le=new RegExp(`[${ae.join("")}]`,"g");function ce(e){return e.replace(le,"")}function ue(e){return"rgba(19,115,51,0.7)"===e}function ge(e,t,n,o,r,s){var i,a;const l=s.getTransform(),c=L(t,n,l),u=D(null!==(i=r.savableState.font)&&void 0!==i?i:s.font),g=ce(e),f=(d=e).startsWith("‭")&&d.endsWith("‬");var d;r.savableState.renderContainer&&g&&r.savableState.renderContainer.fragments.push({type:"text",style:u,text:g,special:!f,baseline:c.top,left:c.left,scaleX:l.a,scaleY:l.d});const p=o.fragments.length>0?o.fragments[o.fragments.length-1]:null;if(ee(e,u,c,o,r,l,p,f))return;if(h=r.savableState.font,m=r.savableState.strokeStyle,v=s.fillStyle,'400 14px "Google Sans"'===h&&"rgba(240,244,249,1)"===m&&"string"==typeof v&&["#1f1f1f","rgba(31,31,31,1)"].includes(v))return;var h,m,v;const b=p&&((y=p).type===A.text||y.type===A.footnoteLink)?p:null;var y,S;if(b){const e={top:b.baseline,left:b.left},t=c.left-e.left-b.width,n=r.lastTextClipsId!==r.savableState.clipsId||c.top-e.top>.2*b.height;!n&&t>te&&(o.fragments.push({type:A.space,class:_.ordinary,baseline:c.top,left:e.left+b.width,top:b.top,width:t,height:b.height}),r.debugVizualize&&K(s,e.left+b.width,c.top,t,[])),n&&(o.fragments.push((S={baseline:b.baseline,left:b.left+b.width,top:b.top,height:b.height,width:r.lastTextWhitespaceWidth},{...S,type:A.lineBreak,class:_.ordinary})),r.debugVizualize&&V(s,b.left+b.width,b.top))}r.lastTextClipsId=r.savableState.clipsId;const x=X(c,u,r,l);if(!x)return;r.lastTextWhitespaceWidth=x.spaceMetrics.chunk.width;const w=null!==(a=g.match(/[^\s]+|\s+/g))&&void 0!==a?a:[];for(const e of w){const t=Z(e,u,c,x,l,r);if(null==t)continue;const n={type:A.text,class:_.ordinary,...t};o.fragments.push(n),r.debugVizualize&&(e.match(/^\s+$/)?K(s,c.left,c.top,n.width,n.charShifts):W(s,c.left,c.top,t.width,t.charShifts," "===e?void 0:o.wordCount++)),c.left+=n.width}}const fe={postFn:{fillText(e,t,[n,o,r,s]){const i=function(e,t){if(e.currentPartialMap)return e.currentPartialMap.sections.main;if(!e.currentPageMap)return null;const n=e.currentPageMap.sections,o=e.footnote.footnoteLineDetected&&t>e.footnote.footnoteLinePosition.top?e.currentPageMap.sections.footnotes:e.currentPageMap.sections.main;if(e.compact)return o;switch(Y(e)){case 1:return n.header;case 2:return n.footer;default:return o}}(t,r);if(!i)return void function(e,t){!e.currentPageMap&&!e.currentPartialMap&&e.api.log(t,"Current page map expected")}(t,"proxy.fillText");const a=i.fragments.length>0;ge(n,o,r,i,t,e),!a&&i.fragments.length>0&&(i.rect=ve(t))},drawImage(e,t,n){const o=t.savableState.renderContainer;if(o){const[t,r,s,i,a,l,c,u,g]=n,f=e.getTransform(),d=L(null!=l?l:r,null!=c?c:s,f),p=null!=u?u:i,h=null!=g?g:a,m=void 0===p||void 0===h?void 0:{width:p,height:h},v=void 0===m?{...d,width:void 0,height:void 0}:{...d,...F(m.width,m.height,f)};o.fragments.push({type:"image",rect:v})}},fillRect(e,t,[n,o,r,s]){if("string"==typeof e.fillStyle&&T.includes(e.fillStyle.replace(/\s+/g,""))){const i=e.getTransform(),a={...L(n,o,i),...F(r,s,i)},l=ve(t);if(!l||v(a,l)){const e=function(e,t,n){const o=E(e,(e=>{const o=n(t,e);return 0===o?-1:o}));return"found"===o.kind?o.index:o.lastSearchRange[0]<0?null:o.lastSearchRange[0]}(t.currentSelection,a,b);null===e?t.currentSelection.unshift(a):t.currentSelection.splice(e+1,0,a)}}1===t.saveCount&&null===t.currentPageFragment&&"string"==typeof e.fillStyle&&U.includes(e.fillStyle)&&!t.savableState.clips.length&&be(t,e,[n,o,r,s])},clearRect(e,t,n){t.savableState.clips.length||be(t,e,n)},scale(e,t){1===t.saveCount&&null===t.currentPageFragment&&null!==t.clearedRect&&Q(t)},translate(e,t,[n,o],r,s){t.equations.onTranslate(t.saveCount,t.savableState.renderContainer,s,n,o)},save(e,t,n,o,r){t.equations.onBeforeSave(t.saveCount,r),t.saveCount++,t.savedState.push({...t.savableState})},restore(e,t,n,o,r){const s=t.savedState.pop();if(s&&(t.savableState=s),t.saveCount--,0===t.saveCount){if(t.hasSuggestions&&t.onChangeMode("suggest"),t.currentPageMap&&t.currentPageFragment){const e=t.currentPageMap.pageAttrs,n=t.currentPageMap.sections,o=n.footer.rect?Math.min(e.canvasBitmapSize.height,n.footer.rect.top):e.canvasBitmapSize.height,r=t.footnote.footnoteLineDetected?t.footnote.footnoteLinePosition.top:o;n.footnotes.rect={top:r,left:0,width:e.canvasBitmapSize.width,height:o-r};const s=n.header.rect?Math.max(0,n.header.rect.top+n.header.rect.height):0;n.main.rect={top:s,left:0,width:e.canvasBitmapSize.width,height:r-s},t.onRender({pageMap:(a=t.currentPageMap,{pageAttrs:a.pageAttrs,sections:{main:me(a.sections.main),footnotes:me(a.sections.footnotes),header:me(a.sections.header),footer:me(a.sections.footer)}}),pageAttrs:e,selection:t.currentSelection,hasSuggestions:t.hasSuggestions,hasEquations:t.equations.hasEquations(),pageFragment:t.currentPageFragment}),t.currentPageFragment=null,t.currentPageMap=null,t.currentSelection=[],t.clearedRect=null,t.strikethroughLines=[]}else t.currentPartialMap&&t.currentPageFragment&&(t.onRender({partialPageMap:(i=t.currentPartialMap,{pageAttrs:i.pageAttrs,rect:i.rect,sections:{main:me(i.sections.main)}}),pageAttrs:t.currentPartialMap.pageAttrs,selection:t.currentSelection,hasSuggestions:t.hasSuggestions,hasEquations:t.equations.hasEquations(),pageFragment:t.currentPageFragment}),t.currentPageFragment=null,t.currentPartialMap=null,t.clearedRect=null,t.strikethroughLines=[]);t.equations.reset()}var i,a;t.equations.onAfterRestore(t.saveCount,r)},moveTo(e,t,[n,o]){t.footnote.footnoteLineDetected||(t.footnote.lastPosition={left:n,top:o}),t.path.push({moveTo:he(e,[n,o])})},lineTo(e,t,[n,o]){!function(e,t,n,o){var r;if(!e.footnote.footnoteLineDetected){const s=e.footnote.lastPosition;if(s){const i=t-s.left;if(n>0&&Math.abs(s.top-n)<te&&i===se&&(null===(r=null==e?void 0:e.savableState)||void 0===r?void 0:r.strokeStyle)&&ie.includes(e.savableState.strokeStyle)&&(e.footnote={footnoteLineDetected:!0,footnoteLinePosition:s},e.savableState.renderContainer)){const r=L(t,n,o.getTransform());e.savableState.renderContainer.fragments.push({type:"footnote_line",y:r.top})}}}e.footnote.footnoteLineDetected||(e.footnote.lastPosition={left:t,top:n})}(t,n,o,e),t.path.push({lineTo:he(e,[n,o])})},beginPath(e,t){t.path=[]},clip(e,t,n){var o,r;if(t.equations.onClip(),n[0])t.api.logError("proxy.clip:unexpectedArguments","clip with parameters is not supported");else if(1!==t.path.length)t.api.logError("proxy.clip:unsupportedPath","clip with multiple paths is not supported",{pathSize:t.path.length});else if("rect"in t.path[0]){if(t.savableState.clips=[...t.savableState.clips,t.path[0].rect],t.savableState.renderContainer){const e={type:"clip",rect:t.path[0].rect,fragments:[]};t.savableState.renderContainer.fragments.push(e),t.savableState.renderContainer=e}if(t.currentPageMap){const e=(null!==(o=t.currentPageMap.sections.header.fragments.length)&&void 0!==o?o:0)>0,n=(null!==(r=t.currentPageMap.sections.footer.fragments.length)&&void 0!==r?r:0)>0;if(!e||!n)switch(Y(t)){case 1:e||(t.currentPageMap.sections.header.rect=ve(t));break;case 2:n||(t.currentPageMap.sections.footer.rect=ve(t))}}}else t.api.logError("proxy.clip:unsupportedPath","clip only supports rect paths");t.savableState.clipsId=++t.lastClipsId},rect(e,t,n){t.path.push({rect:pe(e,n)})},stroke(e,t,n){n[0]||t.savableState.strokeStyle&&2===t.path.length&&"moveTo"in t.path[0]&&"lineTo"in t.path[1]&&t.path[0].moveTo.top===t.path[1].lineTo.top&&(t.strikethroughLines.push({y:t.path[0].moveTo.top,left:t.path[0].moveTo.left,width:t.path[1].lineTo.left-t.path[0].moveTo.left}),t.savableState.renderContainer&&t.savableState.renderContainer.fragments.push({type:"strikethrough",y:t.path[0].moveTo.top,left:t.path[0].moveTo.left,width:t.path[1].lineTo.left-t.path[0].moveTo.left,unidentifiedUserColor:!ue(t.savableState.strokeStyle)}))},bezierCurveTo(e,t,[n,o,r,s,i,a]){t.path.push({bezierCurveTo:he(e,[i,a])})},fill(e,t){if("string"==typeof(n=e.fillStyle)&&H.includes(n)&&t.savableState.renderContainer){const e=function(e){if(9!==e.length)return;let t=1/0,n=1/0,o=-1/0,r=-1/0;for(let s=0;s<e.length;s++){let i;if(i=0===s?B(e[0]):s%2==1?z(e[s]):$(e[s]),!i)return;t=Math.min(i.left,t),n=Math.min(i.top,n),r=Math.max(i.left,r),o=Math.max(i.top,o)}return{left:t,top:n,width:r-t,height:o-n}}(t.path);if(e){const n={type:"code_block",rect:e};t.savableState.renderContainer.fragments.push(n)}}var n}},overrideSet:{strokeStyle(e,t,n){let o;return"string"==typeof n?("rgba(221,0,0,1)"===n||"rgba(66,133,244,1)"===n?o="rgba(0,0,0,0)":ue(n)&&(t.hasSuggestions=!0),t.savableState.strokeStyle=null!=o?o:n):t.savableState.strokeStyle=void 0,o},fillStyle:(e,t,n)=>"rgba(252,232,230,1)"===n||"rgba(232,240,254,1)"===n?"rgba(0,0,0,0)":void("rgba(31,161,93,1)"===n&&(t.hasSuggestions=!0)),font(e,t,n){t.savableState.font=n}}},de={overrideSet:{strokeStyle:(e,t,n)=>"rgba(221,0,0,1)"===n||"rgba(66,133,244,1)"===n?"rgba(0,0,0,0)":void 0}};function pe(e,[t,n,o,r]){const s=e.getTransform();return{...L(t,n,s),...F(o,r,s)}}function he(e,[t,n]){return L(t,n,e.getTransform())}function me(e){const{wordCount:t,...n}=e;return n}function ve(e){return e.savableState.clips.reduce(((e,t)=>e?function(e,t){const n=Math.max(e.left,t.left),o=Math.max(e.top,t.top),r=Math.min(e.left+e.width,t.left+t.width),s=Math.min(e.top+e.height,t.top+t.height);return{left:n,top:o,width:n>r?0:r-n,height:o>s?0:s-o}}(e,t):t),null)}function be(e,t,[n,o,r,s]){const i=pe(t,[n,o,r,s]);e.clearedRect=i,e.currentSelection=e.currentSelection.filter((e=>!v(e,i)))}function ye(e,t,n){let o;function r(r,s){const i=(void 0===o&&(o=null!==(a=t())&&void 0!==a?a:null,o||n.logError("createMeasuringFallbackMetricsMap","Can't create self-measuring canvas")),o);var a;if(!i)return;n.log("createMeasuringFallbackMetricsMap","No metrics for text"),i.font=r,i.measureText(s);const l=e.getMetrics(r,s);return l||n.logError("createMeasuringFallbackMetricsMap","Self-measuring failed for text"),l}return{get size(){return e.size},getMetrics(t,n){var o;return null!==(o=e.getMetrics(t,n))&&void 0!==o?o:r(t,n)},getFontMetrics(t){const n=e.getFontMetrics(t);return{fontStyle:t,get size(){return n.size},getMetrics(e){var o;return null!==(o=n.getMetrics(e))&&void 0!==o?o:r(t,e)}}},toJSON:()=>e.toJSON()}}class Se{constructor(e,t){this._transport=e,this._api=t,this._disposed=!1,this._sub=this._transport.inbound.subscribe((async e=>{try{const t=this._api[e.data.method];if("function"!=typeof t)throw{message:`invalid method name ${String(e.data.method)}`};{const n={clientId:e.clientId},o=await t.call(this._api,n,...e.data.args);this._transport.outbound({clientId:e.clientId,data:{id:e.data.id,res:o}})}}catch(t){this._transport.outbound({clientId:e.clientId,data:{id:e.data.id,err:t}})}}))}dispose(){this._disposed||(this._disposed=!0,this._sub.unsubscribe())}}class xe extends Error{constructor(e){super(`Assertion failed: ${e?"string"==typeof e?e:e():"(unnamed)"}`)}}function we(e,t){if(!e)throw new xe(t)}function Ce(e,t){if(null==e)throw new xe((()=>t?`Expected ${t} to be non-null`:"Expected non-null"));return e}function Te(e){return!("object"!=typeof e||!e)&&("number"==typeof e.start&&"number"==typeof e.end)}function Ee(e){return Array.isArray(e)&&e.length>0&&void 0!==e[0]&&e.every(Te)}function ke(e,t){return{get:()=>t.reduce(((e,t)=>null==e?void 0:e[t]),e.get()),parent(){if(0!==t.length)return ke(e,t.slice(0,-1))},getPath:()=>[e,t]}}function Me(e){return{get(t){let n=t;for(const t of e){if(null==n)return;n=n[t]}return null!=n?n:void 0},getPath:()=>e}}function Ae(e){let t;function n(t){return e(Ne.extractingIndexLookupMapKeys),function(e){const t=ze(e);if(t)return{indexes:Me([t.indexKey]),data:Me([t.dataKey])}}(t)}return{getIndexes:e=>(void 0===t&&(t=n(e)),t&&t.indexes.get(e)||[]),getData:e=>(void 0===t&&(t=n(e)),t&&t.data.get(e)||[])}}function*_e(e,t){const n=t.getIndexes(e),o=t.getData(e);for(const e of n){const t=o[e];void 0!==t&&(yield[e,t])}}const Ne={extractingSuggestionSets:"start to extract extractedSuggestionSets",extractingOpenEndRangesMapPath:"start to extract openEndRangesMapPath",noDeleteSuggestionCannotExtractOpenEndRangesMapPath:"can not extract openEndRangesMapPath, there is no suggestions in the document yet",extractingIndexLookupMapPaths:"extracting IndexLookupMapPaths",extractingDeletionIndexLookupMapPath:"extracting DeletionSuggestionIndexLookupMapPath",extractingIndexLookupMapKeys:"extracting suggestion index lookup map keys",extractContainerByAdditionLookupMap:"extract addition lookup map path by addition lookup map path",pickDeletionIndexLookupMapFromTwoMaps:"pick deletion lookup map from two lookup maps"},Pe={canNotGetGDocsDocument:"can not get extracted gdocs document object",suggestionMustHaveSameStart:"suggestion range must have same start",suggestionCountNotMatch:"two SuggestionMaps must contains same amount of suggestions",canNotFindSuggestionSetContainer:"can not find suggestion sets container",canNotGetSuggestionRangeFromLookupMap:"can not get suggestion range from lookup map",canNotExtractSuggestionRange:"can not extract suggestion range from suggestion",canNotGetFirstSuggestionId:"can not get first suggestion id, suggestionMapAll is wrong",suggestionSetsAreNotSameType:"suggestion sets do not have same type",suggestionLookupMapArrayNotValid:"we can not find the relationship between two arrays",canNotGetAdditionLookupMapContainer:"additionLookupMapContainer getter is wrong",canNotGetSuggestionMapAdd:"can not find suggestionMapAdd by the same path for suggestionMapAll"},Re=e=>`find ${e} suggestions set(s)`,Ie=e=>`find ${e} suggestion Map(s) in suggestion set`,Oe=e=>`find ${e} deletion suggestion lookup map container(s)`,De=e=>`find ${e} suggestion lookup map(s)`,Le=e=>`find ${e} deletion suggestion lookup map(s)`,Fe=e=>`find more ${e} array keys`;function je(e,t,n){if(!(t in e))return!1;const o=e[t];return"function"==typeof o&&o.length===n}const Ge=(e,t,n)=>{let o;for(const[r,s]of _e(e,t))if(void 0===o)s.includes(n)&&(o=r);else if(0==s.length)return{start:o,end:r}};function Be(e){const t=new Set;return e.map((e=>{for(const n of e)t.add(n)})),t.size}function ze(e){const t=e,n=Object.keys(e).filter((e=>Array.isArray(t[e])));if(2!==n.length)throw new Error(Fe(n.length));const o=t[n[0]],r=t[n[1]];if(!1!==$e(o,r)){if(!1!==$e(r,o))return;return{indexKey:n[0],dataKey:n[1]}}if(!1!==$e(r,o))return{indexKey:n[1],dataKey:n[0]};throw new Error(Pe.suggestionLookupMapArrayNotValid)}function $e(e,t){if(0!==e.length||0!==t.length){if(e.length>0&&t.length>0&&e.every((e=>"number"==typeof e&&void 0!==t[e]))){return function(e,t=3){const n=[];let o=0;for(const r of e){for(;o<r;){if(n.push(o),n.length===t)return n;o++}o=r+1}for(;n.length<t;)n.push(o++);return n}(e).every((e=>void 0===t[e]))}return!1}}function qe(e,t){if("object"==typeof t&&t&&je(t,"constructor",5))for(const[e,n]of Object.entries(t))if(We(e,n))return!0;return!1}function We(e,t){return"object"==typeof t&&!!t&&"constructor"in t&&"clear"in t&&"contains"in t&&"add"in t&&"function"==typeof t.add&&4===t.add.length}function Ke(e,t){return nt(e,((e,n)=>function(e,t){let n=!1;return He(e,(e=>{if(!Array.isArray(e))return!1;for(const o of e){if(!Ve(o))return!1;o===t&&(n=!0)}return!0}))&&n}(n,t)),2).results}function Ve(e){return"string"==typeof e&&e.startsWith("suggest.")}function Ue(e){return Array.isArray(e)&&e.every(Ve)}function He(e,t){if(!function(e){if("object"!=typeof e||!e)return!1;if(![{name:"clear",length:0},{name:"get",length:1},{name:"size",length:0},{name:"map",length:1}].every((({name:t,length:n})=>je(e,t,n))))return!1;try{return ze(e),!0}catch(e){return!1}}(e))return!1;for(const n of Object.values(e))if(Array.isArray(n)&&0!=n.length&&n.every((e=>void 0===e||t(e))))return!0;return!1}function Ye(e,t){return He(t,Ue)}function Je(e,t,n,o){o(Ne.pickDeletionIndexLookupMapFromTwoMaps);const r=function(e){const t=Be(e[0]),n=Be(e[1]);if(t!==n)return t<n?0:1;return}(t);return void 0!==r?r:function([e,t],n,o){const r=Object.keys(o)[0],s=Ge(e,n,r),i=Ge(t,n,r);if(!s||!i)throw new Error(Pe.canNotGetSuggestionRangeFromLookupMap);const a=o[r],l=a.contains(s.start,s.end),c=a.contains(i.start,i.end);if(!l||!c)return l?1:0;return s.start>i.start?0:1}(t,e,n)}function Qe(e,t,n,o,r,s){const i=r.getSuggestionMap(t);if(!i)return;const a=r.getSuggestionMap(n);if(!a)throw new Error(Pe.canNotGetSuggestionMapAdd);const l=function(e,t){const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length){for(const e of n)if(!t[e])return e;if(n.length<o.length)throw new Error(Pe.canNotGetFirstSuggestionId)}}(i,a);return l?function(e,t,n){n(Ne.extractingDeletionIndexLookupMapPath);const o=Ke(e,t);if(1==o.length)return Xe(o[0].path);throw new Error(Le(o.length))}(e,l,s):function(e,t,n,o){o(Ne.extractingIndexLookupMapPaths);const r=function(e){return nt(e,Ye,2).results}(e);if(1==r.length){const[e,...t]=r[0].path;return function(e,t,n){let o;return{getDeletionLookupMap(r){if(void 0===o){const s=e.get(r);if(!s)throw new Error(Pe.canNotGetAdditionLookupMapContainer);const i=function(e,t,n){n(Ne.extractContainerByAdditionLookupMap);const o=[];for(const[n,i]of Object.entries(t))(r=i)!==(s=e)&&"object"==typeof r&&r&&r.constructor===s.constructor&&o.push(n);var r,s;if(1===o.length)return Me([o[0]]);if(o.length>1)throw new Error(Oe(o.length))}(s,r,n);if(!i)return;o=Me([...i.getPath(),...t.getPath()])}return o.get(r)}}}(Me([e]),Me(t),o)}if(2==r.length){return Xe(r[Je(n,[r[0].value,r[1].value],t,o)].path)}throw new Error(De(r.length))}(e,a,o,s)}function Xe(e){const t=Me(e);return{getDeletionLookupMap:e=>t.get(e)}}function Ze(e,t){const n=Object.entries(e).map((([e,t])=>{if("object"!=typeof t||!t)return null;const n=Object.keys(t);if(0===n.length||!n.every((e=>e.startsWith("suggest."))))return null;return{openEndRangesMapPath:e,suggestionMap:t,suggestionIds:n,range:function(e){const t=nt(e,((e,t)=>Ee(t)),0);if(1!==t.results.length)throw new Error(Pe.canNotExtractSuggestionRange);return t.results[0].value[0]}(t[n[0]])}})).filter(Boolean);if(0===n.length)return void t(Ne.noDeleteSuggestionCannotExtractOpenEndRangesMapPath);if(2!=n.length)throw new Error(Ie(n.length));const[o,r]=n;if(o.suggestionIds.length!==r.suggestionIds.length||o.suggestionIds.some((e=>!r.suggestionMap[e])))throw new Error(Pe.suggestionCountNotMatch);if(o.range.start!==r.range.start)throw new Error(Pe.suggestionMustHaveSameStart);return o.range.end>r.range.end?Me([o.openEndRangesMapPath]):Me([r.openEndRangesMapPath])}function et(e,t,n,o){try{const r=function(e,t){t(Ne.extractingSuggestionSets);const n=nt(e,qe,1);if(1!==n.results.length)throw new Error(Pe.canNotFindSuggestionSetContainer);const o=nt(n.results[0].value,We,1);if(2!==o.results.length)throw new Error(Re(o.results.length));const r=o.results[0].value,s=o.results[1].value;if(s.constructor!==r.constructor)throw new Error(Pe.suggestionSetsAreNotSameType);return{suggestionSetAll:r,suggestionSetAdd:s}}(e,o),s=Ae(o),i=function(e){let t;return{getSuggestionMap:n=>(void 0===t&&(e(Ne.extractingOpenEndRangesMapPath),t=Ze(n,e)),null==t?void 0:t.get(n))}}(o);let a,l;return{getDeleteSuggestionRanges(){try{return void 0===l&&(void 0===a&&(a=Qe(t,r.suggestionSetAll,r.suggestionSetAdd,s,i,o)),a&&(l=a.getDeletionLookupMap(t))),l?((e,t)=>{const n=[];let o=-1;for(const[r,s]of _e(e,t))-1===o?s.length>0&&(o=r):0==s.length&&(n.push({start:o,end:r}),o=-1);return n})(l,s):[]}catch(e){return l=null,n(e.message),[]}}}}catch(e){return n(e.message),{getDeleteSuggestionRanges:()=>[]}}}function tt(e,t,n){const o=e.get();if(!o)return[void 0,void 0,void 0];const r=nt(o,t,n);if(!r.results.length)return[void 0,void 0,void 0];const s=r.results.map((t=>ke(e,t.path)));return[s[0],r.results[0].value,s]}function nt(e,t,n,o=Object.getOwnPropertyNames(e),r=0,s){var i;const a=new Set,l=[];let c=0;const u=performance.now();let g,f;const d=(e,t,n,o)=>{if(null==e)return;if(a.has(e))return;if(a.add(e),s&&!s(e,t))return;const r={next:void 0,value:e,key:t,parent:n,depth:o};f?f.next=r:g=r,f=r},p=()=>{const e=g;return e&&(g=e.next,g||(f=void 0)),e},h=e=>{const t=[];let n=e;for(;n;)t.push(n.key),n=n.parent;return t.reverse()};for(const t of o)"prototype"!==t&&d(e[t],t,void 0,0);for(;g;){const e=p();if(!e)break;c++;const{key:o,value:s,depth:a}=e;if(!(s instanceof Window)&&!(s instanceof Node)){try{const e=null===(i=null==s?void 0:s.constructor)||void 0===i?void 0:i.name;if("Window"===e||"HTMLDocument"===e)continue}catch(e){}if(!(a>n)){try{if(t(o,s)){const t=h(e);l.push({path:t,value:s,depth:a,iterations:c,performance:performance.now()-u});continue}}catch(e){}if(null!=s)if(Array.isArray(s))for(let t=0;t<s.length&&t<r;t++)try{d(s[t],`${t}`,e,a+1)}catch(e){}else if("function"==typeof s);else if(s instanceof Object)if(s instanceof Node);else for(const t of Object.getOwnPropertyNames(s))if("prototype"!==t)try{d(s[t],t,e,a+1)}catch(e){}}}}return{results:l,iterations:c,performance:performance.now()-u}}function ot(e){let t,n=0;const o=()=>{n++,t=e()};return{get calcCount(){return n},refresh:o,get:()=>(0===n&&o(),t)}}function rt(e){const t=Ce(Object.getOwnPropertyNames(e).find((e=>-1!==e.toString().indexOf("_kixApp")))),n=Ce(e[t],"kixApp"),o=function(e,t){const n=new Set;return e.filter((e=>{const o=t(e);return!n.has(o)&&(n.add(o),!0)}))}(nt(n,((e,t)=>"string"==typeof t&&""===t.charAt(0)),5).results,(e=>e.value)).filter((e=>isNaN(parseInt(e.path[e.path.length-1],10)))).reduce(((e,o)=>{const r=o.path.slice(0,o.path.length-1).reduce(((e,t)=>e[t]),n),s=nt(r,((e,t)=>t instanceof RegExp),2);let i=!1,a=!1;if(1===s.results.length){const e=s.results[0].value.toString();i=C.includes(e),a=w.includes(e)}else{const e=nt(r,((e,t)=>Array.isArray(t)&&t.length===S.length&&t.every(((e,t)=>e.charCodeAt(0)===S[t]))),2);1===e.results.length&&(a=!0)}return i?{...e,headersAndFooters:[t].concat(o.path)}:a?{...e,text:[t].concat(o.path)}:e}),{text:[],headersAndFooters:[]});return 0===o.text.length?null:o}function st(e){try{const t=e.get();if(!t)return null;const n=nt(t,((e,t)=>function(e){return at(e)&&Boolean(e.length>0&&void 0!==e[0])}(t)),3,void 0,void 0,((e,t)=>!(e&&"object"==typeof e&&(t.length>4&&/^[0-9a-f]+$/.test(t)||"docs-text-overlay-selection"in e||"docs-text-overlay-bookmark"in e||"cell-grid"in e))));return n.results.length>0?ke(e,n.results[0].path):null}catch(e){return null}}function it(e){return Boolean(e&&"object"==typeof e&&"start"in e&&"number"==typeof e.start&&"end"in e&&"number"==typeof e.end)}function at(e){return Boolean(e&&Array.isArray(e)&&e.every(it))}function lt(e,t,n){return e.push(Array.isArray(t)||isNaN(t)?n:t),e}class ct{constructor(e,t,n){this._win=e,this._logError=t,this._logInfo=n,this._result=null,this._resizer=void 0,this._kixApp=function(e){const t=Ce(Object.getOwnPropertyNames(e).find((e=>-1!==e.toString().indexOf("_kixApp"))));return ke((n=e,{get:()=>n}),[t]);var n}(this._win),this._images=ot((()=>function(e){const t="inline",n="positioned";try{const[o]=tt(e,((e,o)=>(e===t||e===n)&&"object"==typeof o),5);we(!!o);const r=o.parent();we(!!r);const[s,i]=tt(o,((e,t)=>"object"==typeof t&&!!t&&2===Object.keys(t).length),5);we(!!s&&!!i);const a=Ce(Object.keys(i)[0]),[l,c]=Ce(s.getPath());return{inline:ke(r,[t,...c,a]),positioned:ke(r,[n,...c,a])}}catch(e){return{inline:null,positioned:null,error:e}}}(this._kixApp))),this._textSelection=ot((()=>st(this._kixApp)))}_attemptTextExtraction(){try{const e=rt(this._win),t=Boolean(null==e?void 0:e.headersAndFooters.length),n=function(e){const t=Ce(Object.getOwnPropertyNames(e).find((e=>-1!==e.toString().indexOf("_kixApp")))),n=nt(Ce(e[t],"kixApp"),((e,t)=>"horizontal_rule"===e&&"object"==typeof t&&null!==t&&2===Object.keys(t).length),6);return 0===n.results.length?null:[t].concat(Ce(n.results[0]).path,Object.keys(n.results[0].value)[0])}(this._win);let o=!1;this._images.refresh();const r=(null==e?void 0:e.text)||[],s=r.pop(),i=r.reduce(((e,t)=>e[t]),this._win),a=(null==e?void 0:e.headersAndFooters)||[],l=a.pop(),c=a.reduce(((e,t)=>e[t]),this._win),u=null==n?void 0:n.pop(),g=n?null==n?void 0:n.reduce(((e,t)=>e[t]),this._win):{};if(r.length>0){const e=!this._useSuggestionInternalsWrapper&&function(e,t){try{const n=Ce(Object.getOwnPropertyNames(e).find((e=>-1!==e.toString().indexOf("_kixApp")))),o=nt(Ce(e[n],"kixApp"),((e,t)=>Array.isArray(t)&&t.some((e=>Array.isArray(e)&&-1!==e.toString().indexOf("suggest.")))),10).results.filter((e=>e.path[0]===t[1])).filter((e=>!y.some((t=>e.path.includes(t))))).map((e=>{const t=[...e.path];return t.pop(),t})).reduce(((t,o)=>{const r=[n].concat(o).reduce(((e,t)=>e[t]),e);return t?r[t.idProp]>t.id?{...t,id:r[t.idProp],path:o}:t:Object.getOwnPropertyNames(r).reduce(((e,t)=>Array.isArray(r[t])||isNaN(parseInt(r[t],10))?Array.isArray(r[t][0])?{...e,fullArrayProp:t}:{...e,compactArrayProp:t}:{...e,idProp:t,id:r[t]}),{path:o})}),null);return{suggestionsFullArrayPath:o?[n].concat(o.path,o.fullArrayProp):null}}catch(e){return{suggestionsFullArrayPath:null}}}(this._win,r).suggestionsFullArrayPath,n=Array.isArray(e)&&e.pop(),a=e&&e.reduce(((e,t)=>e[t]),this._win);let f;if(this._useSuggestionInternalsWrapper){const e=this.getKixApp(),t=r.slice(0,-1).reduce(((e,t)=>e[t]),this._win);f=et(e,t,(e=>this._logError("ExtractSuggestionInternals",e)),(e=>this._logInfo("ExtractSuggestionInternals",e)))}const d=e=>{const t=null==e?void 0:e.get();return Array.isArray(t)?t.reduce(lt,[]):[]};return{getText:()=>{const e=i[s];if("string"!=typeof e)throw this._logError("ExtractFullText","unexpected text value type"),new Error("unexpected text value type");const r=t?c[l]:"",p=g[u],h=Array.isArray(p)?p.reduce(lt,[]).sort(((e,t)=>e-t)):[],m=d(this._images.get().positioned);let v=d(this._images.get().inline);o||(v.length>0?o=!0:this._images.calcCount<10&&"string"==typeof e&&e.indexOf("*")>=0&&(this._images.refresh(),v=d(this._images.get().inline),o=v.length>0));const b=a&&n&&a[n];return{fullText:e,headersAndFootersText:r,ignoredRanges:b?[...b].reduce(((e,t)=>(e.push(Array.isArray(t)?!!t[0]:!!e.length&&e[e.length-1]),e)),[]):[],deleteSuggestionRanges:null==f?void 0:f.getDeleteSuggestionRanges(),nonTextEntities:{horizontal_rule:{startsAt:h,textRepresentation:"-"},inline_image:{startsAt:v,textRepresentation:"*"},positioned_image:{startsAt:m,textRepresentation:""}}}},gotIgnoredRanges:!!a,gotDeleteRanges:!!f}}return{error:"notFound"}}catch(e){return{error:"exception",message:e.message}}}_attemptResizerExtraction(){const e=function(e){try{return[Ce(Object.getOwnPropertyNames(e).find((e=>-1!==e.toString().indexOf("_kixApp"))))].concat("resize")}catch(e){return null}}(this._win);try{return e?e.reduce(((e,t)=>e[t]),this._win):null}catch(e){return null}}_tryGetTextSelectionRanges(e){const t=()=>{const e=this._textSelection.get();if(e){const t=e.get();if(at(t))return t}return null},n=t();return n||(e&&this._textSelection.calcCount<10&&this._textSelection.refresh(),t())}_getText(e){try{if(this._result||(this._result=this._attemptTextExtraction()),e.reQueryForIgnoredRanges&&"getText"in this._result&&((this._useSuggestionInternalsWrapper?this._result.gotDeleteRanges:this._result.gotIgnoredRanges)||(this._result=this._attemptTextExtraction())),"getText"in this._result){return{...this._result.getText(),textSelectionRanges:this._tryGetTextSelectionRanges(e.expectTextSelection)}}return null}catch(e){return null}}enableDeleteSuggestionRanges(e){this._useSuggestionInternalsWrapper=e}getKixApp(){return this._kixApp.get()}getText(e){return this._getText(e)}triggerRender(){try{return void 0===this._resizer&&(this._resizer=this._attemptResizerExtraction()),this._resizer?(this._resizer(),!0):!1}catch(e){return!1}}}function ut(e,t){const n=function(e,t){const n=nt(e,((e,t)=>function(e){if("object"==typeof e&&null!==e&&"function"==typeof e.getSelection&&"function"==typeof e.constructor&&3===e.constructor.length){const t=e.getSelection();return null!=t&&"object"==typeof t&&"function"==typeof t.constructor&&6===t.constructor.length}return!1}(t)),1);if(1!==n.results.length)return t("extractSelectionController",gt(n.results,"selection controller")),null;const o=n.results[0].value,r=o.getSelection();if(!r)return null;const s=nt(o,ft,0,Object.getOwnPropertyNames(Object.getPrototypeOf(o)));if(1!==s.results.length)return t("extractSetSelectionResult",gt(s.results,"setSelection"),s.results),null;const i=s.results[0].value;return{selectionController:o,selectionControllerAccessors:{setSelection(e,t,n){i.call(e,t,n)}},currentSelection:r}}(e,t),o={GDocsTextRange:null,GDocsCursor:null,GDocsSelectionCursor:null,GDocsSelection:null,selectionController:null,selectionControllerAccessors:null};if(!n)return o;const{selectionController:r,selectionControllerAccessors:s,currentSelection:i}=n;o.selectionController=r;const{GDocsSelection:a,GDocsCursor:l,GDocsTextRange:c,selectionAccessors:u,currentCursor:g}=function(e){const t=e.constructor,n=function(e){const t=nt(e,((e,t)=>function(e){if("object"!=typeof e||!e)return!1;const t=e.constructor;return 3===(null==t?void 0:t.length)&&"function"==typeof e.shift&&1===e.shift.length}(t)),0);if(1!==t.results.length)return null;const n=t.results[0].value,o=n.constructor,r=t.results[0].path[0];return{GDocsCursor:o,currentCursor:n,cursorPropName:r}}(e);if(!n)return{GDocsSelection:t,GDocsCursor:null,GDocsTextRange:null,currentCursor:null,selectionAccessors:null,wrapSelection:null};const{GDocsCursor:o,currentCursor:r,cursorPropName:s}=n,i=nt(e,((e,t)=>Ee(t)),0),a=nt(e,l,0,Object.getOwnPropertyNames(Object.getPrototypeOf(e)));function l(t,n){return"function"==typeof n&&1===n.length&&!1===n.call(e,{})&&!0===n.call(e,e)}if(1===i.results.length&&1===a.results.length){const e=i.results[0].path[0],n=a.results[0].value,l={getCursor:e=>e[s],getRanges:t=>t[e],equals:(e,t)=>n.call(e,t)};return{GDocsSelection:t,GDocsCursor:o,GDocsTextRange:i.results[0].value[0].constructor,currentCursor:r,selectionAccessors:l}}return{GDocsSelection:t,GDocsCursor:o,GDocsTextRange:null,currentCursor:r,selectionAccessors:null}}(i);if(o.GDocsSelection=a,o.GDocsCursor=l,o.GDocsTextRange=c,o.selectionControllerAccessors=s,o.selectionAccessors=u,!g)return o;const f=function(e,t){const n=nt(e,((e,n)=>n!==t&&function(e){return!("object"!=typeof e||!e)&&3===e.constructor.length}(n)),0);if(2!==n.results.length)return null;const o=n.results[0].value;return o.constructor}(i,g);return o.GDocsSelectionCursor=f,o}const gt=(e,t)=>`Failed to extract ${t}, found ${e.length<5?e.length:">5"} candidates`;function ft(e,t){return"function"==typeof t&&2===t.length}var dt;!function(e){e.PagedMode="kix-document",e.PagelessMode="docstext-simple"}(dt||(dt={}));const pt=(e,t)=>{const{results:n}=nt(e,((e,t)=>(e=>{const t=[dt.PagedMode,dt.PagelessMode];return"object"==typeof e&&null!==e&&"function"==typeof e.isRoot&&e.isRoot()&&"function"==typeof e.getType&&t.includes(e.getType())})(t)),5);if(1!==n.length)return t("extractGDocsInternalsLayoutTree",`Failed to extract GDocsInternalsLayoutTree, found ${n.length} instances.`),{status:"fail",failReason:0===n.length?"noInstances":"multipleInstances"};return{status:"success",rootNodeType:n[0].value.getType()}};function ht(e){return function(e){return e&&"wrappedJSObject"in e}(e)?e.wrappedJSObject:e}function mt(e){e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:46,key:"Delete"}))}function vt(e,t){const n=void 0===t.html?void 0:function(e,t){try{return e()}catch(e){return t(e)}}((()=>new DataTransfer),(()=>{})),o=new InputEvent("beforeinput",{inputType:"insertReplacementText",data:t.plain,dataTransfer:n,cancelable:!0,bubbles:!0});o.dataTransfer&&(void 0!==t.plain&&ht(o.dataTransfer).setData("text/plain",t.plain),void 0!==t.html&&ht(o.dataTransfer).setData("text/html",t.html)),e.dispatchEvent(o)}function bt(e,t){e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight",shiftKey:!0})),t(),function(e){e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft",shiftKey:!0}))}(e)}var yt,St,xt,wt,Ct,Tt;!function(e){e.equals=function(e,t){return k(e.left,t.left)&&k(e.top,t.top)},e.fromCartesian=function({x:e,y:t}){return{top:t,left:e}},e.toCartesian=function({top:e,left:t}){return{x:t,y:e}},e.zero={top:0,left:0},e.minus=function(e,t){return{top:e.top-t.top,left:e.left-t.left}},e.plus=function(e,t){return{top:e.top+t.top,left:e.left+t.left}},e.ceil=function(e){return{left:Math.ceil(e.left),top:Math.ceil(e.top)}},e.floor=function(e){return{left:Math.floor(e.left),top:Math.floor(e.top)}},e.create=function(e){return{top:e.top,left:e.left}},e.l1Distance=function(e,t){return Math.abs(e.top-t.top)+Math.abs(e.left-t.left)}}(yt||(yt={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromClientPoint=function(e,n,o){return t({top:e.top-n.top+o.top,left:e.left-n.left+o.left})},e.zero={top:0,left:0}}(St||(St={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromOffsetPoint=function(e,n,o){return t({top:e.top+n.top-o.top,left:e.left+n.left-o.left})},e.fromPage=function(e,n){return t({top:e.top-n.top,left:e.left-n.left})}}(xt||(xt={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.getHighlightsPosition=function(e,n,o,r={top:0,left:0}){return t({top:e.top+n.top+o.top+r.top,left:e.left+n.left+o.left+r.left})},e.fromClient=function(e,n){return t({top:e.top+n.top,left:e.left+n.left})},e.fromOffset=function(e,t,n){return{top:e.top+t.top-n.top,left:e.left+t.left-n.left}}}(wt||(wt={})),function(e){e.editorElementSelector="div.kix-appview-editor",e.textEventsTargetIframeSelector="iframe.docs-texteventtarget-iframe",e.textEventsTargetElementSelector='[contenteditable="true"]'}(Ct||(Ct={})),function(e){e.spellingBubbleSelector="div.kix-spell-bubble",e.sellingUnderlinePromoBubbleSelector="div.jfk-bubble.jfk-bubble-promo.docs-promo-bubble",e.pageLessModeTableMaskInner="kix-domviewscroller-inner",e.pageLessModeTableMaskOuter="kix-domviewscroller-outer"}(Tt||(Tt={}));const Et={success:!1,textChanged:!1,failReason:"noFullText"},kt={success:!1,textChanged:!1,failReason:"fullTextMismatch"},Mt={success:!1,textChanged:!1,failReason:"noInternals"},At={success:!1,textChanged:!1,failReason:"noEventTarget"},_t={success:!1,textChanged:!1,failReason:"wrongRange"},Nt={success:!1,textChanged:!0,failReason:"noFullTextAfter"},Pt={success:!1,textChanged:!0,failReason:"resultTextMismatch"},Rt={success:!0,textChanged:!0,failReason:null},It={...Rt,withIgnoreRanges:!0};function Ot(e,t){vt(e,{plain:t})}class Dt{constructor(e,t,n,o,r){this._getInternals=e,this._getFullTextInfo=t,this._getKeyboardEventTarget=n,this._getDocumentViewElement=o,this._getEditorViewElement=r}_resetSelectionNoScroll(){var e,t;const n=this._getDocumentViewElement();if(!n)return!1;const o=this._getEditorViewElement();if(!o)return!1;const r=null===(e=n.getClientRects())||void 0===e?void 0:e.item(0);if(!r||r.width<=0||r.height<=0)return!1;const s=null===(t=o.getClientRects())||void 0===t?void 0:t.item(0);if(!s||s.width<=0||s.height<=0)return!1;const i=Math.max(r.left,s.left),a=Math.min(r.right,s.right),l=Math.max(r.top,s.top),c=Math.min(r.bottom,s.bottom);if(i>a||l>c)return!1;const u=Math.floor((i+a)/2),g=Math.floor(l+c)/2;return function(e,t=xt.create({left:0,top:0}),n=!1){const o={clientX:t.left,clientY:t.top,bubbles:!0,shiftKey:n};e.dispatchEvent(new MouseEvent("mousedown",o)),e.dispatchEvent(new MouseEvent("mouseup",o))}(n,xt.create({left:u,top:g})),!0}replaceText({start:e,end:t},n,o,r=!1){const s=this._getFullTextInfo();if(null===s)return Et;const i=s.fullText;if(void 0!==o&&i!==o)return kt;const a=this._getInternals();if(!a)return Mt;const l=this._getKeyboardEventTarget();if(!l)return At;if(e>t||e<0||t>i.length)return _t;const c=()=>{const e=a.selectionController.getSelection();l.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight"}));const t=a.selectionController.getSelection();(e===t||a.selectionAccessors.equals(e,t))&&function(e){e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft"}))}(l)},u=()=>{const e=a.selectionController.getSelection();return a.selectionAccessors.getRanges(e).length>0};u()&&(this._resetSelectionNoScroll()&&!u()||c());const g=function(e,t,n){const o=new e.GDocsCursor(n);if(n>t){const r=new e.GDocsCursor(t),s=new e.GDocsSelectionCursor(t,n-1,r),i=new e.GDocsSelectionCursor(t,n-1,o);return new e.GDocsSelection(o,i,s)}return new e.GDocsSelection(o,null,null)}(a,e,t);a.selectionControllerAccessors.setSelection(a.selectionController,g,!0),e===t?""!==n&&Ot(l,n):""===n?mt(l):Ot(l,n);const f=function({getFullTextInfo:e,fullTextBefore:t,newText:n,start:o,end:r,validationRetryWithIgnoreRanges:s}){const i=e(),a=t.slice(0,o)+n+t.slice(r);if((null==i?void 0:i.fullText)===a)return Rt;const l=s&&e(!0);if(l){const e=l.fullText===t.slice(0,o)+n+t.slice(o),s=o+n.length,i=r+n.length;if(e&&function(e,t,n){const{deleteSuggestionRanges:o,ignoredRanges:r}=e;if(o){for(const{start:e,end:r}of o)if(e<=t&&n<=r)return!0;return!1}for(let e=t;e<n;e++)if(!r[e])return!1;return!0}(l,s,i))return It}if(!i&&!l)return Nt;return Pt}({getFullTextInfo:this._getFullTextInfo,fullTextBefore:i,newText:n,start:e,end:t,validationRetryWithIgnoreRanges:r});return f!==Et&&u()&&c(),f}}function Lt(e){let t=!0;const n=new Set;return{onRender(o,r){t?n.add([o,r]):e(o,r)},pause(){t=!0},resume(){t=!1,(()=>{const t=[...n.values()];n.clear();for(const[n,o]of t)e(n,o)})()}}}function Ft(t,n,o=1){const r=new Set;let s=!1;return{onRender(i){if(i.pageFragment.partialRect)r.add(i),(async()=>{if(s)return;if(await e(0),s)return;if(!r.size)return;s=!0,n(),await e(o),s=!1;const i=[...r.values()];r.clear();for(const e of i)t.onRender(e,!0)})();else{let e=!1;if(s=!1,r.size){const t=i.pageFragment.pageAttrs.pageOffsetRect,n=[...r.values()];for(const o of n){v(o.pageFragment.pageAttrs.pageOffsetRect,t)&&(r.delete(o),e=!0)}}t.onRender(i,e)}},pause(){t.pause()},resume(){t.resume()}}}const jt=(t,n,r,i)=>(a,l,u)=>{const g=()=>document.querySelector(`.${c.canvasLayoutRootClass}`);!async function(){var f;try{const d=null!==(f=g())&&void 0!==f?f:await async function(){let t=120;const n=250;for(;t;){await e(n);const o=g();if(o)return o;t--}return null}();if(!d)return void t.api.logError("injected.startFail","Injected init failed: Cannot find rotating tile manager in 30 seconds");const p=()=>function(e){var t,n,o;try{return null!==(o=null===(n=null===(t=e.querySelector(Ct.textEventsTargetIframeSelector))||void 0===t?void 0:t.contentDocument)||void 0===n?void 0:n.querySelector(Ct.textEventsTargetElementSelector))&&void 0!==o?o:null}catch(e){return null}}(document),h=()=>{var e;return null!==(e=document.querySelector(`.${c.editorElementClass}`))&&void 0!==e?e:null},m=function(e,t,n){const o=new ct(self,t,n);let r=o.getKixApp(),s=null,i=null,a=0,l=0;function c(){a>=10||(a++,r=o.getKixApp(),s=r?ut(r,t):null,i=s&&s.GDocsCursor&&s.GDocsSelection&&s.GDocsTextRange&&s.GDocsSelectionCursor&&s.selectionController&&s.selectionControllerAccessors&&s.selectionAccessors?s:null)}return{fullTextExtractor:o,get gdocsApp(){return o.getKixApp()},get selection(){return s||c(),s},getSelectionFull(){if(s||c(),!i){if(!s)return null;e((()=>{c()}))}return i},getLayoutTreeAvailability:()=>l>=2?null:(l++,r=o.getKixApp(),r?pt(r,t):{status:"fail",failReason:"noInstances"})}}((e=>{const t=p();t&&bt(t,e)}),t.api.logError,t.api.log),v=new Dt((()=>m.getSelectionFull()),((e=!1)=>m.fullTextExtractor.getText({reQueryForIgnoredRanges:e,expectTextSelection:!1})),p,(()=>d),h),b=function(t,n,o){let r,s=!1,i=!1;let a=Lt(((e,r=!1)=>{const a={fullText:i||!s?null:o.getText({reQueryForIgnoredRanges:e.hasSuggestions,expectTextSelection:e.selection.length>0}),renderResult:e,forcedFullRender:r};t.pageRendered(a,n)}));return a.pause(),{onChangeMode(e){r!==e&&(r=e,"suggest"===r&&(s=!1,i=!1,l(e)))},onRender(e){a.onRender(e)},init:e=>{e.forceFullRender&&(a=Ft(a,(()=>o.triggerRender()))),o.enableDeleteSuggestionRanges(e.useDeleteSuggestionRanges),l(void 0)}};async function l(n){if(await e(0),s||i)return;if(r!==n)return;null===o.getText({reQueryForIgnoredRanges:!0,expectTextSelection:!1})?(i=!0,t.logError("FullTextExtractor","Cannot get full document text")):s=!0,a.resume()}}(t.api,n,m.fullTextExtractor),y=ye(l.metricsMap,(()=>document.createElement("canvas").getContext("2d")),t.api);a((e=>{if(function(e){return Boolean(e.className)}(e)){const n=function(e){return{...e,matchingBroken:!1,currentSelection:[],currentPageFragment:null,currentPageMap:null,currentPartialMap:null,saveCount:0,savedState:[],savableState:{clips:[],clipsId:0,font:void 0,strokeStyle:void 0,renderContainer:null},path:[],lastClipsId:0,lastTextClipsId:0,lastTextWhitespaceWidth:0,clearedRect:null,hasSuggestions:!1,footnote:{footnoteLineDetected:!1},compact:!1,strikethroughLines:[],equations:N()}}({api:t.api,metricsMap:y,getCurrentPageAttrs(){var t;const n=d.getBoundingClientRect(),{left:o,top:r,width:s,height:i}=e.getBoundingClientRect(),a={left:o-n.left,top:r-n.top,width:s,height:i};return{canvasBitmapSize:{width:e.width,height:e.height},pageOffsetRect:a,isCompactLayout:Boolean(null===(t=e.parentElement)||void 0===t?void 0:t.classList.contains("kix-page-canvas-compact-mode"))}},onChangeMode:b.onChangeMode,onRender:b.onRender});return r?function({api:e,state:t}){return R(t,de,e)}({api:t.api,state:n}):function({api:e,state:t}){return R(t,fe,e)}({api:t.api,state:n})}})),i({replaceText:v.replaceText.bind(v),getLayoutTreeAvailability:()=>m.getLayoutTreeAvailability()});const S=await s(10,0,(()=>{return e=400,n=t.api.init(),Promise.race([o(e),n]);var e,n}));S&&b.init(S),r||(await e(1e3),l.metricsMap.size||await t.api.logError("init.textMeasuringCheck","No text measuring events received")),await async function(t,n){for(let o=0;o<60;o++){const o=document.querySelectorAll("canvas");if(o.length){const e=n();return void([...o].every((t=>e.includes(t)))||await t.api.logError("init.patchedCanvasesCheck","Not all the document canvases have been patched"))}await e(1e3)}await t.api.logError("init.patchedCanvasesCheck","No document canvases found after 60 seconds")}(t,u)}catch(e){try{await t.api.logException("init",e)}catch(e){}}}()};!async function(){var e,t;let n;try{const o=document.documentElement.dataset.grGdcConnId||(document.documentElement.dataset.grGdcConnId=`${Date.now()}-${Math.random()}`),r=function(e){return{request:`gr-cs-request-${e}`,response:`gr-cs-response-${e}`}}(o);n=new d(new h(document,r.response,r.request)),n.api.log("injected.starting","Injected script initialization");const s=self[`GR_GDEI_${o}`];if(!s){console.error("Could not start grammarly integration","no early injected data found");const e={message:document.documentElement.dataset.grGdcErrorMsg,stack:document.documentElement.dataset.grGdcErrorStack};return void n.api.logError("injected.starting","No early injected data found",e)}const a=(null===(e=document.currentScript)||void 0===e?void 0:e.getAttribute("data-ext-version"))||"unknown",l=Boolean(null===(t=document.currentScript)||void 0===t?void 0:t.getAttribute("data-ext-minimal"))||!1,c=function(e){return{request:`gr-ics-request-${e}`,response:`gr-ics-response-${e}`}}(o);jt(n,a,l,(e=>{new Se(function(e,t=i.create()){return{inbound:{subscribe:n=>e.inbound.subscribe({next(e){var o;if(n){const r={clientId:t,data:e};"function"==typeof n?n(r):null===(o=n.next)||void 0===o||o.call(n,r)}}})},outbound(n){n.clientId===t&&e.outbound(n.data)}}}(new h(document,c.request,c.response)),{replaceText:(t,...n)=>e.replaceText(...n),getLayoutTreeAvailability:()=>e.getLayoutTreeAvailability()})}))(s.addMiddleware,s.textMeasuringState,s.getPatchedCanvases)}catch(e){console.error("Could not start grammarly integration","module not loaded",e),n&&n.api.logError("injected.startFail",`Injected init failed: ${String(e)}`)}}()}();