import{b as _t,y as gn,r as i,e as De,a as s,j as d,f as R,F as ne,R as Cn,c as qn,q as Qn}from"./index-f8bdaf1e.js";import{b as A}from"./browser-polyfill-6188a4ed.js";import{e as $}from"./index-e08f5af8.js";import{f as Q,N as ee}from"./index-af6339a2.js";import{b as Hn,i as Yn,u as Xn,a as Jn,s as Kn,c as ye,g as Zn,d as Ie,e as zt,f as qt,h as $n}from"./index-58ca6142.js";import{C as L,S as Oe,i as er,a as tr,u as nr}from"./pin-userbrain-e12868a2.js";import{h as Qt,S as Ht,u as ie,D as Fe,a as Yt,b as rr}from"./icon-play-68b689a8.js";import{P as sr,u as bn,w as ir,a as or}from"./useGlobal-d308c45a.js";import{T as j}from"./index-40632cd6.js";import"./_commonjsHelpers-725317a4.js";const ar="_button_zed9b_1",cr="_button_fullWidth_zed9b_15",Xt={button:ar,button_fullWidth:cr},lr={button:Xt.button,button_fullWidth:Xt.button_fullWidth};function ur(e){return _t.jsx(gn,{...e,styles:lr})}const dr="_button_1wvf7_1",fr="_button_big_1wvf7_19",hr="_button_fullWidth_1wvf7_44",et={button:dr,button_big:fr,button_fullWidth:hr},pr={button:et.button,button_fullWidth:et.button_fullWidth,button_big:et.button_big};function Jt(e){return _t.jsx(gn,{...e,styles:pr})}const mr="_card_fuhpf_1",gr={card:mr},tt=i.forwardRef((e,t)=>{const{children:n,className:r,...o}=e;return _t.jsx("div",{className:De(r,gr.card),ref:t,...o,children:n})});var yn=Symbol.for("immer-nothing"),Kt=Symbol.for("immer-draftable"),V=Symbol.for("immer-state");function J(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var ve=Object.getPrototypeOf;function we(e){return!!e&&!!e[V]}function he(e){var t;return e?vn(e)||Array.isArray(e)||!!e[Kt]||!!((t=e.constructor)!=null&&t[Kt])||Qe(e)||He(e):!1}var Cr=Object.prototype.constructor.toString();function vn(e){if(!e||typeof e!="object")return!1;const t=ve(e);if(t===null)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===Cr}function Pe(e,t){qe(e)===0?Object.entries(e).forEach(([n,r])=>{t(n,r,e)}):e.forEach((n,r)=>t(r,n,e))}function qe(e){const t=e[V];return t?t.type_:Array.isArray(e)?1:Qe(e)?2:He(e)?3:0}function ut(e,t){return qe(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function wn(e,t,n){const r=qe(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function br(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Qe(e){return e instanceof Map}function He(e){return e instanceof Set}function fe(e){return e.copy_||e.base_}function dt(e,t){if(Qe(e))return new Map(e);if(He(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&vn(e))return ve(e)?{...e}:Object.assign(Object.create(null),e);const n=Object.getOwnPropertyDescriptors(e);delete n[V];let r=Reflect.ownKeys(n);for(let o=0;o<r.length;o++){const a=r[o],u=n[a];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[a]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[a]})}return Object.create(ve(e),n)}function St(e,t=!1){return Ye(e)||we(e)||!he(e)||(qe(e)>1&&(e.set=e.add=e.clear=e.delete=yr),Object.freeze(e),t&&Pe(e,(n,r)=>St(r,!0))),e}function yr(){J(2)}function Ye(e){return Object.isFrozen(e)}var vr={};function pe(e){const t=vr[e];return t||J(0,e),t}var xe;function _n(){return xe}function wr(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Zt(e,t){t&&(pe("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ft(e){ht(e),e.drafts_.forEach(_r),e.drafts_=null}function ht(e){e===xe&&(xe=e.parent_)}function $t(e){return xe=wr(xe,e)}function _r(e){const t=e[V];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function en(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[V].modified_&&(ft(t),J(4)),he(e)&&(e=je(t,e),t.parent_||Ue(t,e)),t.patches_&&pe("Patches").generateReplacementPatches_(n[V].base_,e,t.patches_,t.inversePatches_)):e=je(t,n,[]),ft(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==yn?e:void 0}function je(e,t,n){if(Ye(t))return t;const r=t[V];if(!r)return Pe(t,(o,a)=>tn(e,r,t,o,a,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return Ue(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const o=r.copy_;let a=o,u=!1;r.type_===3&&(a=new Set(o),o.clear(),u=!0),Pe(a,(l,h)=>tn(e,r,o,l,h,n,u)),Ue(e,o,!1),n&&e.patches_&&pe("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function tn(e,t,n,r,o,a,u){if(we(o)){const l=a&&t&&t.type_!==3&&!ut(t.assigned_,r)?a.concat(r):void 0,h=je(e,o,l);if(wn(n,r,h),we(h))e.canAutoFreeze_=!1;else return}else u&&n.add(o);if(he(o)&&!Ye(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;je(e,o),(!t||!t.scope_.parent_)&&Ue(e,o)}}function Ue(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&St(t,n)}function Sr(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:_n(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=r,a=kt;n&&(o=[r],a=Ee);const{revoke:u,proxy:l}=Proxy.revocable(o,a);return r.draft_=l,r.revoke_=u,l}var kt={get(e,t){if(t===V)return e;const n=fe(e);if(!ut(n,t))return kr(e,n,t);const r=n[t];return e.finalized_||!he(r)?r:r===nt(e.base_,t)?(rt(e),e.copy_[t]=mt(r,e)):r},has(e,t){return t in fe(e)},ownKeys(e){return Reflect.ownKeys(fe(e))},set(e,t,n){const r=Sn(fe(e),t);if(r!=null&&r.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const o=nt(fe(e),t),a=o==null?void 0:o[V];if(a&&a.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(br(n,o)&&(n!==void 0||ut(e.base_,t)))return!0;rt(e),pt(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return nt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,rt(e),pt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=fe(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){J(11)},getPrototypeOf(e){return ve(e.base_)},setPrototypeOf(){J(12)}},Ee={};Pe(kt,(e,t)=>{Ee[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ee.deleteProperty=function(e,t){return Ee.set.call(this,e,t,void 0)};Ee.set=function(e,t,n){return kt.set.call(this,e[0],t,n,e[0])};function nt(e,t){const n=e[V];return(n?fe(n):e)[t]}function kr(e,t,n){var o;const r=Sn(t,n);return r?"value"in r?r.value:(o=r.get)==null?void 0:o.call(e.draft_):void 0}function Sn(e,t){if(!(t in e))return;let n=ve(e);for(;n;){const r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=ve(n)}}function pt(e){e.modified_||(e.modified_=!0,e.parent_&&pt(e.parent_))}function rt(e){e.copy_||(e.copy_=dt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Tr=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){const a=n;n=t;const u=this;return function(h=a,...y){return u.produce(h,v=>n.call(this,v,...y))}}typeof n!="function"&&J(6),r!==void 0&&typeof r!="function"&&J(7);let o;if(he(t)){const a=$t(this),u=mt(t,void 0);let l=!0;try{o=n(u),l=!1}finally{l?ft(a):ht(a)}return Zt(a,r),en(o,a)}else if(!t||typeof t!="object"){if(o=n(t),o===void 0&&(o=t),o===yn&&(o=void 0),this.autoFreeze_&&St(o,!0),r){const a=[],u=[];pe("Patches").generateReplacementPatches_(t,o,a,u),r(a,u)}return o}else J(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(u,...l)=>this.produceWithPatches(u,h=>t(h,...l));let r,o;return[this.produce(t,n,(u,l)=>{r=u,o=l}),r,o]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){he(e)||J(8),we(e)&&(e=Ar(e));const t=$t(this),n=mt(e,void 0);return n[V].isManual_=!0,ht(t),n}finishDraft(e,t){const n=e&&e[V];(!n||!n.isManual_)&&J(9);const{scope_:r}=n;return Zt(r,t),en(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const o=t[n];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}n>-1&&(t=t.slice(n+1));const r=pe("Patches").applyPatches_;return we(e)?r(e,t):this.produce(e,o=>r(o,t))}};function mt(e,t){const n=Qe(e)?pe("MapSet").proxyMap_(e,t):He(e)?pe("MapSet").proxySet_(e,t):Sr(e,t);return(t?t.scope_:_n()).drafts_.push(n),n}function Ar(e){return we(e)||J(10,e),kn(e)}function kn(e){if(!he(e)||Ye(e))return e;const t=e[V];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=dt(e,t.scope_.immer_.useStrictShallowCopy_)}else n=dt(e,!0);return Pe(n,(r,o)=>{wn(n,r,kn(o))}),t&&(t.finalized_=!1),n}var G=new Tr,st=G.produce;G.produceWithPatches.bind(G);G.setAutoFreeze.bind(G);G.setUseStrictShallowCopy.bind(G);G.applyPatches.bind(G);G.createDraft.bind(G);G.finishDraft.bind(G);const Pr="_duration_a0qsu_1",xr={duration:Pr};function Er(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.round(e%60);return[t,n>9?n:t?"0"+n:n||"0",r>9?r:"0"+r].filter(Boolean).join(":")}function nn(e){const{className:t,timeStart:n,timeEnd:r,...o}=e,[a,u]=i.useState(new Date().getTime());i.useEffect(()=>{function h(){u(new Date().getTime())}const y=setInterval(h,500);return()=>{clearInterval(y)}},[]);const l=Math.floor(Math.max(0,((r??a)-(n??a))/1e3));return s("span",{className:De(t,xr.duration),...o,children:Er(l)})}function Tn(e){const{delay:t,autoplay:n,...r}=e,o=i.useRef(null);return i.useEffect(()=>{t&&setTimeout(()=>{var a;(a=o.current)==null||a.play()},t)},[t]),s(sr,{autoplay:t?!1:n,...r,lottieRef:a=>{o.current=a}})}function Dr(){const[e,t]=i.useState();return i.useEffect(()=>{A.tabs.getCurrent().then(n=>{t(n.id)})},[]),e}function Mr(e,t){const n=i.useRef(null),[r,o]=i.useState(null),[a,u]=i.useState(null),[l,h]=i.useState([]),[y,v]=i.useState(null),[f,M]=i.useState(null),_=i.useRef(t);i.useEffect(()=>{_.current=t},[t]),i.useEffect(()=>{if(e!==null){let w=function(){o(new Date().getTime()),v(p.state)},b=function(){u(new Date().getTime()),v(p.state)},N=function(){const T=[new Date().getTime(),null];h(g=>[...g,T]),v(p.state)},E=function(){h(T=>T.map((g,I)=>I===T.length-1?[g[0],new Date().getTime()]:g)),v(p.state)},U=function(T){console.error("Error: ",T)},W=function(T){M(T.data)};const p=new MediaRecorder(e,_.current);return o(null),u(null),h([]),M(null),v(p.state),p.addEventListener("error",U),p.addEventListener("start",w),p.addEventListener("stop",b),p.addEventListener("pause",N),p.addEventListener("resume",E),p.addEventListener("dataavailable",W),n.current=p,()=>{p.state!=="inactive"&&p.stop(),p.removeEventListener("error",U),p.removeEventListener("start",w),p.removeEventListener("stop",b),p.removeEventListener("pause",N),p.removeEventListener("resume",E),p.removeEventListener("dataavailable",W),n.current=null,v(null)}}},[e]);const x=i.useMemo(()=>l.length>0?l.reduce((w,b)=>b[1]===null?w:w+b[1]-(b[0]??0),0):0,[l]);return{getRecordingTime:i.useCallback(()=>{if(r!==null){const w=l.length>0&&l[l.length-1][1]===null?new Date().getTime()-l[l.length-1][0]:0;return a!==null?a-r-x:new Date().getTime()-r-x-w}return 0},[x,r,a,l]),timeStart:r,timeStop:a,pauses:l,state:y,data:f,refMediaRecorder:n,totalPauseDuration:x}}const Rr="_video_63wes_1",Nr="_progressInfo_63wes_9",Br="_question_63wes_15",Ir="_yesNoButtons_63wes_22",Or="_submitButtons_63wes_28",Wr="_answer_63wes_39",Z={video:Rr,progressInfo:Nr,question:Br,yesNoButtons:Ir,submitButtons:Or,answer:Wr},it="/assets/icon-failed-fdad2743.svg",ot="/assets/icon-passed-f5690e4b.svg";function Lr(e){const{recordingBlobObjectUrl:t,onClickUploadTest:n,onClickDiscardTest:r,onAllQuestionsAnswered:o}=e,[a,u]=i.useState([]),l=3,h=a.every(k=>k===!0),y=a.length===l;i.useEffect(()=>{y&&o(h)},[y,h,o]);function v(k){const w=k.currentTarget;w.duration===1/0&&(w.ontimeupdate=function(){w.currentTime=.1,w.currentTime=0,this.ontimeupdate=()=>{}},w.currentTime=Number.MAX_SAFE_INTEGER)}function f(){u([...a,!0])}function M(){u([...a,!1])}function _(){r()}function x(){n()}return s(L,{children:d(R,{children:[!y&&d(ne,{children:[s(j,{title:"Please take a look at your qualification test."}),s("video",{className:Z.video,src:t,onLoadedMetadata:v,controls:!0}),d("div",{className:Z.progressInfo,children:["Question ",a.length+1," of ",l]}),a.length<3&&d(ne,{children:[a.length===0&&s("p",{className:Z.question,children:"Did you complete all steps of your task and answered all the questions?"}),a.length===1&&s("p",{className:Z.question,children:"Can you hear your voice loud and clear?"}),a.length===2&&s("p",{className:Z.question,children:"Did you speak your thoughts and observations out loud?"}),d("div",{className:Z.yesNoButtons,children:[s($,{onClick:M,children:"No"}),s($,{onClick:f,children:"Yes"})]})]})]}),y&&d(R,{children:[h&&s(j,{title:"Good Job!",text:"You're ready to upload your qualification test for review."}),!h&&s(j,{title:"Give It One More Try!",text:"It looks like there's room for improvement."}),d("div",{children:[d("div",{className:Z.answer,children:[a[0]?s("img",{src:ot,alt:"Passed"}):s("img",{src:it,alt:"Failed"}),s("div",{children:"You completed all steps of your task and answered all the questions"})]}),d("div",{className:Z.answer,children:[a[1]?s("img",{src:ot,alt:"Passed"}):s("img",{src:it,alt:"Failed"}),s("div",{children:"Your voice is loud and clear"})]}),d("div",{className:Z.answer,children:[a[2]?s("img",{src:ot,alt:"Passed"}):s("img",{src:it,alt:"Failed"}),s("div",{children:"You spoke your thoughts and observations out loud"})]})]}),d("div",{className:Z.submitButtons,children:[h&&d(ne,{children:[s(Q,{onClick:x,children:"Upload qualification test"}),d("button",{className:Qt.buttonText,onClick:_,children:["Discard this test and retry",s(Ht,{})]})]}),!h&&d(ne,{children:[s(Q,{onClick:_,children:"Discard this test and retry"}),d("button",{className:Qt.buttonText,onClick:x,children:["Upload qualification test",s(Ht,{})]})]})]})]})]})})}var Fr=typeof global=="object"&&global&&global.Object===Object&&global;const jr=Fr;var Ur=typeof self=="object"&&self&&self.Object===Object&&self,Vr=jr||Ur||Function("return this")();const An=Vr;var Gr=An.Symbol;const Ve=Gr;var Pn=Object.prototype,zr=Pn.hasOwnProperty,qr=Pn.toString,Ae=Ve?Ve.toStringTag:void 0;function Qr(e){var t=zr.call(e,Ae),n=e[Ae];try{e[Ae]=void 0;var r=!0}catch{}var o=qr.call(e);return r&&(t?e[Ae]=n:delete e[Ae]),o}var Hr=Object.prototype,Yr=Hr.toString;function Xr(e){return Yr.call(e)}var Jr="[object Null]",Kr="[object Undefined]",rn=Ve?Ve.toStringTag:void 0;function Zr(e){return e==null?e===void 0?Kr:Jr:rn&&rn in Object(e)?Qr(e):Xr(e)}function $r(e){return e!=null&&typeof e=="object"}var es="[object Symbol]";function ts(e){return typeof e=="symbol"||$r(e)&&Zr(e)==es}var ns=/\s/;function rs(e){for(var t=e.length;t--&&ns.test(e.charAt(t)););return t}var ss=/^\s+/;function is(e){return e&&e.slice(0,rs(e)+1).replace(ss,"")}function Ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var sn=0/0,os=/^[-+]0x[0-9a-f]+$/i,as=/^0b[01]+$/i,cs=/^0o[0-7]+$/i,ls=parseInt;function on(e){if(typeof e=="number")return e;if(ts(e))return sn;if(Ge(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ge(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=is(e);var n=as.test(e);return n||cs.test(e)?ls(e.slice(2),n?2:8):os.test(e)?sn:+e}var us=function(){return An.Date.now()};const at=us;var ds="Expected a function",fs=Math.max,hs=Math.min;function ps(e,t,n){var r,o,a,u,l,h,y=0,v=!1,f=!1,M=!0;if(typeof e!="function")throw new TypeError(ds);t=on(t)||0,Ge(n)&&(v=!!n.leading,f="maxWait"in n,a=f?fs(on(n.maxWait)||0,t):a,M="trailing"in n?!!n.trailing:M);function _(p){var T=r,g=o;return r=o=void 0,y=p,u=e.apply(g,T),u}function x(p){return y=p,l=setTimeout(b,t),v?_(p):u}function k(p){var T=p-h,g=p-y,I=t-T;return f?hs(I,a-g):I}function w(p){var T=p-h,g=p-y;return h===void 0||T>=t||T<0||f&&g>=a}function b(){var p=at();if(w(p))return N(p);l=setTimeout(b,k(p))}function N(p){return l=void 0,M&&r?_(p):(r=o=void 0,u)}function E(){l!==void 0&&clearTimeout(l),y=0,r=h=o=l=void 0}function U(){return l===void 0?u:N(at())}function W(){var p=at(),T=w(p);if(r=arguments,o=this,h=p,T){if(l===void 0)return x(h);if(f)return clearTimeout(l),l=setTimeout(b,t),_(h)}return l===void 0&&(l=setTimeout(b,t)),u}return W.cancel=E,W.flush=U,W}var ms="Expected a function";function gs(e,t,n){var r=!0,o=!0;if(typeof e!="function")throw new TypeError(ms);return Ge(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ps(e,t,{leading:r,maxWait:t,trailing:o})}function ze(e,t){this.minValue=e,this.maxValue=t}ze.prototype.getRange=function(){return this.maxValue-this.minValue};ze.prototype.linearToLogarithmic=function(e){var t=Math.round(Math.pow(this.getRange()+1,e)+this.minValue-1);return t<this.minValue?t=this.minValue:t>this.maxValue&&(t=this.maxValue),t},ze.prototype.logarithmicToLinear=function(e){var t=e-this.minValue+1;return t<=0?0:e>=this.maxValue?1:Math.log(t)/Math.log(this.getRange()+1)};var Cs=ze;const bs="_audioLevel_1pv6s_1",ys="_bar_1pv6s_7",vs="_info_1pv6s_27",ct={audioLevel:bs,bar:ys,info:vs},ws=new Cs(0,100);function _s(e){const{className:t,audioTrack:n,onAudioLevelDetectedForTrack:r,...o}=e,[a,u]=i.useState(0),[l,h]=i.useState(null),[y,v]=i.useState(null),[f,M]=i.useState(null),[_,x]=i.useState(null);return i.useEffect(()=>{u(0),h(n)},[n]),i.useEffect(()=>{l!==null&&a>0&&l!==y&&(r==null||r(l),v(l))},[l,a,y,r]),i.useEffect(()=>{const k=new AudioContext;return M(k),k.audioWorklet&&k.audioWorklet.addModule("audioMeterProcessor.js").then(()=>{if(k.state==="closed")return;const w=new AudioWorkletNode(k,"audio-meter-processor");w.port.onmessage=gs(b=>{const{volume:N}=b.data;typeof N<"u"&&u(N)},50),x(w)}).catch(w=>{console.error(w)}),()=>{k.close()}},[]),i.useEffect(()=>{if(_!==null&&f!==null&&l){const k=new MediaStream([l]),w=f.createMediaStreamSource(k);return w.connect(_).connect(f.destination),()=>{w.disconnect()}}},[f,_,l]),d("div",{className:De(t,ct.audioLevel),...o,children:[a===0&&s("div",{className:ct.info,children:"(Silent)"}),a>0&&s("div",{className:ct.bar,style:{marginLeft:Math.max(.5,ws.logarithmicToLinear(a*100)*100)+"%"}})]})}function Ss(e){const[t,n]=i.useState([]),r=i.useCallback(()=>{navigator.mediaDevices.enumerateDevices().then(o=>{n(o.filter(a=>(!e||a.kind===e)&&a.deviceId))})},[e]);return i.useEffect(()=>{r()},[r]),i.useEffect(()=>{function o(){r()}return navigator.mediaDevices.addEventListener("devicechange",o),()=>{navigator.mediaDevices.removeEventListener("devicechange",o)}},[r]),[t,r]}function ks(e){var W,p,T;const{className:t,preferredDeviceId:n,onGotTrack:r,onAudioError:o,...a}=e,[u,l]=i.useState(null),[,,,,h]=bn("preferred-audio-device-id"),[y,v]=Ss("audioinput"),[f,M]=i.useState(null),[_,x]=i.useState(null),k=!!_,w=ie(k),b=Cn.useRef(r),N=((W=y.find(g=>g.deviceId===f))==null?void 0:W.deviceId)||((p=y.find(g=>g.deviceId===n))==null?void 0:p.deviceId)||((T=y[0])==null?void 0:T.deviceId)||null,E=N??n;i.useEffect(()=>{l(null);let g={audio:!0};E&&(g={audio:{deviceId:{ideal:E}}}),navigator.mediaDevices.getUserMedia(g).then(I=>{const z=I.getAudioTracks()[0];b.current(z),x(z)}).catch(I=>{l(I)})},[E]),i.useEffect(()=>{k&&!w&&v()},[k,w,v]),i.useEffect(()=>{if(_){let g=function(){v()};return _.addEventListener("ended",g),()=>{_.removeEventListener("ended",g)}}},[_,v]),i.useEffect(()=>{b.current=r},[r]),i.useEffect(()=>{u&&(o==null||o(u))},[u,o]);function U(g){M(g.target.value),h(g.target.value)}return d("select",{className:t,style:{width:"100%"},...a,disabled:y.length===0,value:N||"",onChange:U,children:[y.length===0&&s("option",{children:"No audio device found"}),y.map(g=>s("option",{value:g.deviceId,children:g.label},g.deviceId))]})}const Ts="_squircleMicrophone_1bb08_1",As="_gifTutorial_1bb08_9",Ps="_test_1bb08_16",xs="_readyToTestItems_1bb08_22",Es="_readyToTestItem_1bb08_22",Ds="_selectMicrophone_1bb08_42",Ms="_selectAudio_1bb08_49",Rs="_squircleSelectMicrophone_1bb08_56",Ns="_imageMicrophoneBlocked_1bb08_64",Bs="_microphoneStillHavingTrouble_1bb08_69",Is="_imagePinUserbrain_1bb08_78",X={squircleMicrophone:Ts,gifTutorial:As,test:Ps,readyToTestItems:xs,readyToTestItem:Es,selectMicrophone:Ds,selectAudio:Ms,squircleSelectMicrophone:Rs,imageMicrophoneBlocked:Ns,microphoneStillHavingTrouble:Bs,imagePinUserbrain:Is},Os="/assets/complete-each-task-b5978c7f.svg",Ws=e=>i.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M7.59999 7.53301H8.66666V8.49967C8.66666 8.61171 8.71388 8.6925 8.80833 8.74204C8.90277 8.79157 8.99533 8.77101 9.08599 8.68034L10.6167 7.14967C10.7055 7.06079 10.75 6.94412 10.75 6.79967C10.75 6.65523 10.7055 6.53856 10.6167 6.44967L9.08599 4.91901C8.99533 4.82834 8.90277 4.80777 8.80833 4.85731C8.71388 4.90685 8.66666 4.98764 8.66666 5.09967V6.06634H7.19999C6.7111 6.06634 6.29999 6.23301 5.96666 6.56634C5.63333 6.89967 5.46666 7.31079 5.46666 7.79967V8.59967C5.46666 8.80745 5.5366 8.98162 5.67648 9.12217C5.81636 9.26273 5.9897 9.33301 6.19648 9.33301C6.40326 9.33301 6.57777 9.26273 6.71999 9.12217C6.86221 8.98162 6.93333 8.80745 6.93333 8.59967V8.19967C6.93333 8.01745 6.99888 7.86079 7.12999 7.72967C7.2611 7.59856 7.41777 7.53301 7.59999 7.53301ZM1.01666 14.4163C0.808881 14.4163 0.634714 14.3464 0.494159 14.2065C0.353603 14.0666 0.283325 13.8933 0.283325 13.6865C0.283325 13.4845 0.353603 13.3139 0.494159 13.1749C0.634714 13.0359 0.808881 12.9663 1.01666 12.9663H14.9833C15.1911 12.9663 15.3653 13.0347 15.5058 13.1715C15.6464 13.3082 15.7167 13.4776 15.7167 13.6798C15.7167 13.8819 15.6464 14.0552 15.5058 14.1997C15.3653 14.3441 15.1911 14.4163 14.9833 14.4163H1.01666ZM2.99999 12.1663C2.44777 12.1663 1.98194 11.9766 1.60249 11.5972C1.22305 11.2177 1.03333 10.7519 1.03333 10.1997V3.79967C1.03333 3.24745 1.22305 2.78162 1.60249 2.40217C1.98194 2.02273 2.44777 1.83301 2.99999 1.83301H13C13.5522 1.83301 14.018 2.02273 14.3975 2.40217C14.7769 2.78162 14.9667 3.24745 14.9667 3.79967V10.1997C14.9667 10.7519 14.7769 11.2177 14.3975 11.5972C14.018 11.9766 13.5522 12.1663 13 12.1663H2.99999ZM2.99999 10.1997H13V3.79967H2.99999V10.1997Z",fill:"white"})),Ls="/assets/microphone-blocked-edb6cfbf.png",Fs="/assets/quiet-place-40105c7a.svg",js="/assets/speak-out-loud-d7ec018b.svg",Us="/assets/squircle-microphone-e3135d52.png",Vs="data:image/png;base64,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";var mn;const Gs=(mn=Hn)==null?void 0:mn.getOSName(),zs=Gs==="Windows"?"https://kb.userbrain.com/help/how-to-set-your-audio-or-video-permissions-for-windows-10":"https://kb.userbrain.com/help/how-to-set-your-audio-or-video-permission-for-mac",an=1,cn=2,ln=3,un=4,gt=5,Ct=6,qs=e=>{const{currentStep:t,onNextStep:n,onGotAudioTrack:r,preferredAudioDeviceId:o,audioTrack:a,videoTrack:u,videoError:l,isPinned:h,onClickPinnedUserbrain:y,videoTrackDisplaySurfaceIsAllowed:v,onClickOpenChooseDesktopMedia:f}=e,M=v,_=ie(M),[x,k]=i.useState(!1),[w,b]=i.useState(null),[N,E]=i.useState(null),U=()=>{y(),k(!0)};function W(g){b(g)}function p(g){r(g),E(null)}function T(g){E(g)}if(i.useEffect(()=>{_!==!0&&M===!0&&n(Ct)},[M,_,n]),i.useEffect(()=>{h&&t===an&&n(cn)},[h,t,n]),t===an)return s(L,{header:x&&s(ee,{icon:s(Oe,{}),type:"error",children:"Please pin the extension to your browser toolbar first."}),children:s("div",{style:{maxWidth:"29.333rem",textAlign:"center"},children:d(R,{children:[s(j,{title:"Pin the extension",text:"Please pin the extension to your browser toolbar first. You will have to open the extension multiple times while testing."}),s("img",{className:X.imagePinUserbrain,src:er,alt:"Click on the puzzle icon and pin Userbrain Recorder"}),s(Q,{big:!0,onClick:U,children:"Yes, I pinned the extension"})]})})});if(t===cn)return s(L,{children:s("div",{style:{maxWidth:"36rem",textAlign:"center"},children:d(R,{spacing:"large",children:[s(j,{title:"Get ready to test"}),d("div",{className:X.readyToTestItems,children:[d("div",{className:X.readyToTestItem,children:[s("img",{height:72,width:72,src:Fs,alt:"Quite Environment"}),s("p",{children:"Find a quiet place with no distractions."})]}),d("div",{className:X.readyToTestItem,children:[s("img",{height:72,width:72,src:js,alt:"Speak out loud"}),s("p",{children:"Continuously speak your thoughts out loud."})]}),d("div",{className:X.readyToTestItem,children:[s("img",{height:72,width:72,src:Os,alt:"Task Steps"}),s("p",{children:"Try to complete each task before moving on."})]})]}),s(Q,{big:!0,onClick:()=>n(ln),children:"Next"})]})})});if(t===ln)return s(L,{children:s("div",{style:{maxWidth:"36rem",textAlign:"center"},children:d(R,{spacing:"large",children:[s("img",{className:X.squircleMicrophone,src:Us,alt:"Microphone"}),s(j,{title:"Setup your Microphone",text:"To record you voice Userbrain needs to access your microphone."}),s(Q,{big:!0,onClick:()=>e.onNextStep(un),children:"Allow access"})]})})});if(t===un)return N?s(L,{header:d(ee,{type:"error",icon:s(Oe,{}),children:["Microphone blocked, please allow Userbrain Recorder to access your microphone.",Yn]}),children:s("div",{style:{maxWidth:"29.333rem",textAlign:"center"},children:d(R,{spacing:"large",children:[s(j,{title:"Setup your microphone"}),d(R,{spacing:"xsmall",children:[s("img",{className:X.imageMicrophoneBlocked,src:Ls,alt:"Microphone blocked"}),d("div",{className:X.microphoneStillHavingTrouble,children:["Still having trouble? ",s("a",{href:"https://support.google.com/chrome/answer/2693767?hl=en",target:"_blank",rel:"noopener noreferrer",children:"Troubleshoot microphone issues in Chrome"})]})]}),s(Q,{onClick:()=>E(null),children:"Check again"})]})})}):s(L,{children:s("div",{className:X.selectMicrophone,children:d(R,{spacing:"large",children:[s("img",{className:X.squircleSelectMicrophone,src:Vs,alt:"Microphone"}),s(j,{title:"Select your microphone"}),s("div",{className:X.selectAudio,children:d(R,{spacing:"small",children:[o!==void 0&&s(ks,{preferredDeviceId:o,onGotTrack:p,onAudioError:T}),a&&s(_s,{audioTrack:a,onAudioLevelDetectedForTrack:W})]})}),a&&s(Q,{big:!0,disabled:w!==a,onClick:()=>e.onNextStep(gt),children:"Next"})]})})});if(t===gt){let g;return l?g=d(ee,{type:"error",icon:s(Oe,{}),children:["It seems like your browser has no permission to record your audio and/or video. ",s("a",{href:zs,target:"_blank",rel:"noopener noreferrer",children:"Please go through these instructions"}),' and allow recording before you click on "Share my screen" again.']}):u!==null&&!v&&(g=s(ee,{type:"error",icon:s(Oe,{}),children:"You have shared a window or tab only, please share your entire screen."})),s(L,{header:g,children:d(R,{children:[s(j,{title:"Share your screen",text:"Please share your entire screen."}),s(Tn,{loop:!0,autoplay:!0,delay:800,style:{width:"100%",maxWidth:"29.3rem"},src:"/lottie-animations/share-your-screen.json"}),s("div",{style:{textAlign:"center"},children:!v&&s(Q,{onClick:f,big:!0,icon:s(Ws,{}),children:"Share my screen"})})]})})}return s("div",{children:"Step does not exist."})};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var bt=function(e,t){return bt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},bt(e,t)};function Qs(e,t){bt(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var yt=function(){return yt=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},yt.apply(this,arguments)};function Hs(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]]);return n}var Ys=100,Xs=100,dn=50,vt=50,wt=50;function fn(e){var t=e.className,n=e.counterClockwise,r=e.dashRatio,o=e.pathRadius,a=e.strokeWidth,u=e.style;return i.createElement("path",{className:t,style:Object.assign({},u,Ks({pathRadius:o,dashRatio:r,counterClockwise:n})),d:Js({pathRadius:o,counterClockwise:n}),strokeWidth:a,fillOpacity:0})}function Js(e){var t=e.pathRadius,n=e.counterClockwise,r=t,o=n?1:0;return`
      M `+vt+","+wt+`
      m 0,-`+r+`
      a `+r+","+r+" "+o+" 1 1 0,"+2*r+`
      a `+r+","+r+" "+o+" 1 1 0,-"+2*r+`
    `}function Ks(e){var t=e.counterClockwise,n=e.dashRatio,r=e.pathRadius,o=Math.PI*2*r,a=(1-n)*o;return{strokeDasharray:o+"px "+o+"px",strokeDashoffset:(t?-a:a)+"px"}}var Zs=function(e){Qs(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},t.prototype.getPathRadius=function(){return dn-this.props.strokeWidth/2-this.getBackgroundPadding()},t.prototype.getPathRatio=function(){var n=this.props,r=n.value,o=n.minValue,a=n.maxValue,u=Math.min(Math.max(r,o),a);return(u-o)/(a-o)},t.prototype.render=function(){var n=this.props,r=n.circleRatio,o=n.className,a=n.classes,u=n.counterClockwise,l=n.styles,h=n.strokeWidth,y=n.text,v=this.getPathRadius(),f=this.getPathRatio();return i.createElement("svg",{className:a.root+" "+o,style:l.root,viewBox:"0 0 "+Ys+" "+Xs,"data-test-id":"CircularProgressbar"},this.props.background?i.createElement("circle",{className:a.background,style:l.background,cx:vt,cy:wt,r:dn}):null,i.createElement(fn,{className:a.trail,counterClockwise:u,dashRatio:r,pathRadius:v,strokeWidth:h,style:l.trail}),i.createElement(fn,{className:a.path,counterClockwise:u,dashRatio:f*r,pathRadius:v,strokeWidth:h,style:l.path}),y?i.createElement("text",{className:a.text,style:l.text,x:vt,y:wt},y):null)},t.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},t}(i.Component);function $s(e){e.children;var t=Hs(e,["children"]);return i.createElement("div",{"data-test-id":"CircularProgressbarWithChildren"},i.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},i.createElement(Zs,yt({},t)),e.children?i.createElement("div",{"data-test-id":"CircularProgressbarWithChildren__children",style:{position:"absolute",width:"100%",height:"100%",marginTop:"-100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},e.children):null))}function ei(e){var t=e.rotation,n=e.strokeLinecap,r=e.textColor,o=e.textSize,a=e.pathColor,u=e.pathTransition,l=e.pathTransitionDuration,h=e.trailColor,y=e.backgroundColor,v=t==null?void 0:"rotate("+t+"turn)",f=t==null?void 0:"center center";return{root:{},path:We({stroke:a,strokeLinecap:n,transform:v,transformOrigin:f,transition:u,transitionDuration:l==null?void 0:l+"s"}),trail:We({stroke:h,strokeLinecap:n,transform:v,transformOrigin:f}),text:We({fill:r,fontSize:o}),background:We({fill:y})}}function We(e){return Object.keys(e).forEach(function(t){e[t]==null&&delete e[t]}),e}const ti=e=>(t,n,r)=>(r.revalidateOnFocus=!1,r.revalidateIfStale=!1,r.revalidateOnReconnect=!1,e(t,n,r)),ni=ir(or,ti),ri="_testingTip_k0ij7_1",si="_header_k0ij7_9",ii="_overline_k0ij7_15",oi="_title_k0ij7_25",ai="_text_k0ij7_33",de={testingTip:ri,header:si,overline:ii,title:oi,text:ai},ci="/assets/icon-header-d4c99f90.svg",li=e=>{const{className:t,title:n,text:r}=e;return d("section",{className:De(t,de.testingTip),children:[d("div",{className:de.header,children:[s("img",{className:de.iconHeader,height:56,width:56,src:ci,alt:"A motivated user tester, ready to learn"}),d("div",{className:de.titleGroup,children:[s("div",{className:de.overline,children:"Testing Tip"}),s("h1",{className:de.title,children:n})]})]}),s("div",{className:de.text,children:r})]})},ui="_upload_1jox9_1",di="_title_1jox9_5",fi="_subtitle_1jox9_14",hi="_testingTip_1jox9_18",pi="_circularProgressbarWrapper_1jox9_24",mi="_progressText_1jox9_30",q={upload:ui,title:di,subtitle:fi,testingTip:hi,circularProgressbarWrapper:pi,progressText:mi},gi="/assets/upload-complete-4efaeffd.png";function hn(e){return e instanceof Error?e.message:typeof e=="string"?e:JSON.stringify(e)}function Ci(e){const{blob:t,test:n,testMeta:r,onBlobUploaded:o,onTestSubmitted:a}=e,[u,l]=i.useState(null),[h,y]=i.useState(!1),v=ie(h),[f,M]=i.useState(null),[_,x]=i.useState(null),[k,w]=i.useState(null),[b,N]=i.useState(null),[E,U]=i.useState(!1),W=ie(E),[p,T]=i.useState(null),[g,I]=i.useState(null),{data:z}=ni("/testertips",Xn),oe=99/100*(u??0);i.useEffect(()=>{var H;if(((H=z==null?void 0:z.data)==null?void 0:H.length)>0){const _e=z.data[Math.floor(Math.random()*z.data.length)];I(_e)}},[z]),i.useEffect(()=>{if(t!==null&&n!==null&&u===null){let H=function(){ye(n,"uploading")};l(0),H();const _e=setInterval(H,6e4);Jn(t,n,l).then(({server:ge,hashedId:ae})=>{M(ge),x(ae),y(!0)}).catch(ge=>{w(ge)}).finally(()=>{clearInterval(_e)})}},[t,n,u]),i.useEffect(()=>{v===!1&&h===!0&&o()},[h,v,o]),i.useEffect(()=>{W===!1&&E===!0&&a()},[E,W,a]),i.useEffect(()=>{n&&h===!0&&b===null&&_!==null&&f!==null&&(N(0),Kn(n,(r==null?void 0:r.steps)||[],_,f).then(H=>{N(100),U(!0)}).catch(H=>{T(H)}))},[h,n,r,b,_,f]);function me(){w(null),l(null)}function Xe(){T(null),N(null)}return t===null&&!h?s(L,{children:s("div",{className:q.upload,children:d(R,{children:[s("h1",{className:q.title,style:{maxWidth:"20rem"},children:"Nothing to upload"}),s("p",{className:q.subtitle,children:"There seems to be a problem with your recording."})]})})}):s(L,{children:d("div",{className:q.upload,children:[E&&d(R,{children:[s("img",{width:750/2,src:gi,alt:"Upload complete"}),s("div",{children:s(j,{title:"Your test has been uploaded!",text:"Great job, thanks a lot!"})}),s(Q,{onClick:()=>window.close(),children:"Close this tab"})]}),!E&&d(R,{children:[k&&d(ne,{children:[s("h1",{className:q.title,style:{maxWidth:"20rem"},children:hn(k)}),s($,{onClick:me,children:"Retry upload"})]}),p&&d(ne,{children:[s("h1",{className:q.title,style:{maxWidth:"20rem"},children:hn(p)}),d("p",{className:q.subtitle,children:["Your video was uploaded (ID: ",_,") but there was an error submitting your test data.",s("br",{}),"Please try again or contact support."]}),s($,{onClick:Xe,children:"Retry"})]}),!k&&!p&&d(ne,{children:[s("h1",{className:q.title,style:{maxWidth:"20rem"},children:"Your test is being uploaded…"}),s("div",{className:q.circularProgressbarWrapper,children:s($s,{value:oe,maxValue:100,strokeWidth:4,styles:ei({strokeLinecap:"round",pathColor:"var(--color-primary-1)",textColor:"inherit",trailColor:"var(--color-border-on-light)",backgroundColor:"transparent"}),children:d("div",{className:q.progressText,children:[Math.round(oe??0),s("sup",{children:"%"})]})})})]}),s("p",{className:q.subtitle,style:{maxWidth:"20rem"},children:"Please do not close this tab until the upload has been completed."}),g&&s(li,{className:q.testingTip,title:g.title,text:g.tip})]}),s(Fe,{debugData:{progress:u,blobUploaded:h,blobUploadedServer:f,blobUploadedHashedId:_,uploadFailedReason:k,testSubmitProgress:b,testSubmitted:E,testSubmitFailedReason:p},initialExpanded:!0})]})})}const bi="_card_1fhiw_1",yi="_recorderReady_1fhiw_8",vi="_gifTutorial_1fhiw_19",wi="_video_1fhiw_24",_i="_title_1fhiw_31",Si="_buttons_1fhiw_37",ki="_buttonsCentered_1fhiw_43",Ti="_recordingTime_1fhiw_50",Ai="_discard_1fhiw_55",Pi="_pauseSecondary_1fhiw_59",xi="_pauseSecondaryDiscard_1fhiw_64",Ei="_pauseCountdown_1fhiw_68",Di="_pauseCountdownDuration_1fhiw_75",Mi="_pauseCountdownDuration_grace_1fhiw_85",Ri="_pauseCountdownDurationGraceBlinker_1fhiw_1",Ni="_pauseCountdownSq1_1fhiw_99",Bi="_pauseCountdownSq2_1fhiw_108",Ii="_pulsePauseCountdownSq2_1fhiw_1",Oi="_pauseCountdownSq3_1fhiw_120",Wi="_pulsePauseCountdownSq3_1fhiw_1",D={card:bi,recorderReady:yi,gifTutorial:vi,video:wi,title:_i,buttons:Si,buttonsCentered:ki,recordingTime:Ti,discard:Ai,pauseSecondary:Pi,pauseSecondaryDiscard:xi,pauseCountdown:Ei,pauseCountdownDuration:Di,pauseCountdownDuration_grace:Mi,pauseCountdownDurationGraceBlinker:Ri,pauseCountdownSq1:Ni,pauseCountdownSq2:Bi,pulsePauseCountdownSq2:Ii,pauseCountdownSq3:Oi,pulsePauseCountdownSq3:Wi},pn=e=>i.createElement("svg",{width:180,height:180,viewBox:"0 0 180 180",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M174.2 109.4C174.1 108.6 174.1 107.8 174 107C173.2 90.3001 168.8 51.2001 167.2 40.5001C166.1 33.0001 164.6 27.6001 161 25.2001C157.3 22.8001 151.4 23.1001 143.2 23.7001L141.8 23.8001C127.9 24.7001 111.5 25.9001 90.6 27.5001C83.3 28.1001 75.5 28.7001 67 29.3001C54.7 30.2001 35 32.1001 26.9 33.2001L25 33.5001C16.3 34.7001 12.7 35.2001 9.30001 39.0001C6.60001 41.9001 6.80001 46.7001 7.10001 55.4001C7.60001 71.3001 10.7 113.9 12.2 124.5C12.3 125.5 12.5 126.6 12.6 127.7C13 131.8 13.5 135.7 15.2 137.6C18.1 140.8 24 140.7 28.7 140.6C29.5 140.6 30.2 140.6 30.9 140.6C47.2 140.6 69.4 139.2 82.9 132.4C88.2 129.7 95.5 123.8 98.3 118.5C98.9 117.5 99.3 116.3 99.7 115.1C99.8 115.1 99.8 115.1 99.9 115.1H100.3C108.1 116 115.9 116 123.6 115C128.4 114.5 134.3 113.4 136.6 109.9C137.9 107.8 138.3 105.4 137.9 103.1C137.4 99.5001 134.6 95.1001 132.9 92.6001C132.6 92.1001 132.3 91.7001 132.1 91.4001C125.5 80.6001 105.7 54.7001 94.8 46.0001C90.3 42.4001 86.7 40.1001 83.2 40.4001C79.8 40.7001 76.9 42.8001 75.6 45.9001C75 47.1001 74.6 48.7001 74.3 50.3001C72.8 51.8001 71.3 53.8001 69.9 55.7001C61.8 67.5001 50.6 87.1001 45.8 100C44.8 102.7 44.2 105.5 44 108.3C43.8 111.1 44.8 113.9 46.9 116C49.2 118.1 52.4 118.5 55.2 118.7C64.1 119.3 73.1 118.9 81.9 117.4C82.7 117.3 83.3 116.5 83.1 115.7C83 114.9 82.2 114.3 81.4 114.5C72.8 115.9 64.1 116.4 55.4 115.8C53.1 115.6 50.5 115.4 48.9 113.9C47.5 112.5 46.8 110.6 46.9 108.6C47.1 106 47.6 103.5 48.5 101.1C53.1 88.8001 64.2 69.2001 72.3 57.4001C72.6 56.9001 73 56.3001 73.5 55.6001C73.4 57.2001 73.4 58.5001 73.4 59.3001C73.7 65.0001 76.1 82.9001 81 89.8001C82.7 92.1001 85.5 93.2001 88.3 92.6001C91.1 92.0001 93.1 89.7001 93.7 86.5001C94.2 83.6001 93.3 76.1001 92.7 72.6001C91.5 66.5001 90 60.5001 88.1 54.5001C87 51.7001 84.5 45.3001 77.8 47.6001C77.9 47.4001 78 47.1001 78.1 46.9001C79 44.8001 80.9 43.4001 83.2 43.2001C85.8 43.0001 89.5 45.6001 92.7 48.2001C102.6 56.2001 122 80.9001 129.3 92.8001C129.5 93.1001 129.8 93.6001 130.1 94.1001C131.5 96.3001 134.2 100.5 134.7 103.5C135 105.1 134.7 106.8 133.9 108.1C132 110.9 125.5 111.6 123 111.9C115.5 112.9 107.9 112.9 100.3 112H100C100.7 107.8 100.2 103.4 98.6 100.7C97.5 98.9001 95.8 97.5001 93.7 96.7001C91.2 95.8001 88.4 96.2001 86.1 97.7001C83.3 99.8001 82.2 103.4 83.2 106.7C84 109.3 85.9 111.5 88.4 112.6C91 113.7 93.7 114.3 96.2 114.6C95.9 115.4 95.6 116.2 95.2 116.9C92.7 121.6 85.9 127.1 81.1 129.6C68.1 136.1 46.4 137.5 30.5 137.5C29.8 137.5 29 137.5 28.2 137.5C24.3 137.6 18.9 137.7 17 135.5C15.9 134.3 15.5 130.4 15.1 127.3C15 126.2 14.9 125 14.7 124C13.1 113.4 10.1 71.1001 9.60001 55.1001C9.90001 47.6001 9.70001 43.0001 11.6 41.0001C14.3 38.0001 17.1 37.6001 25.5 36.5001L27.4 36.2001C35.4 35.1001 55.1 33.3001 67.3 32.3001C75.8 31.7001 83.6 31.0001 90.9 30.5001C111.7 28.9001 128.2 27.6001 142 26.8001L143.4 26.7001C151 26.2001 156.4 25.9001 159.4 27.8001C162.2 29.6001 163.5 35.5001 164.3 41.0001C165.9 51.6001 170.3 90.5001 171.1 107.2C171.1 108 171.2 108.8 171.3 109.7C171.6 113.9 171.9 118.3 169.6 121.2C168.1 123.1 164 124.6 158.3 125.5C151.6 126.5 129.5 128.5 112.8 129.2C109.8 129.2 106.9 129.6 104 130.4C100.8 131.4 98.3 133.7 97 136.9C96.2 139.2 96.1 141.6 96.1 143.9C96 145.3 96 146.7 95.8 148C95.3 150.9 92.3 151.6 88.7 152.2C84.4 152.8 80.1 153.2 75.7 153.2C75.3 153.2 74.9 153.2 74.5 153.2C72.3 153.2 69.2 153.3 67 154.3C65.5 155 64.5 156 64 157.3C63.7 158.1 63.5 159.4 64.3 161.1C65.7 164 69.3 164.7 72 165.2L72.6 165.3C76.1 166 81.8 166.4 88.3 166.4C101.6 166.4 118.6 164.8 128.7 160.5C129.5 160.2 129.8 159.3 129.5 158.5C129.2 157.7 128.3 157.4 127.5 157.7C113.4 163.7 83.4 164.3 73.2 162.3L72.6 162.2C70.4 161.8 67.8 161.3 67 159.8C66.7 159.2 66.7 158.7 66.8 158.3C67 157.8 67.5 157.4 68.2 157C69.8 156.2 72.5 156.2 74.5 156.2C75 156.2 75.4 156.2 75.8 156.2C80.3 156.2 84.7 155.8 89.1 155.2C92.4 154.7 97.8 153.8 98.7 148.5C98.9 147 99 145.5 99 144.1C99.1 141.9 99.2 139.8 99.8 138C100.7 135.8 102.5 134.1 104.8 133.4C107.4 132.6 110 132.3 112.8 132.3C128.5 131.7 151.2 129.8 158.7 128.6C165.4 127.6 169.9 125.8 171.9 123.2C175 119.2 174.6 114 174.2 109.4ZM79.2 50.6001C82.1 49.5001 83.8 50.9001 85.7 55.6001C87.5 61.4001 89.1 67.3001 90.2 73.2001C91 77.5001 91.6 84.0001 91.2 86.0001C90.8 88.0001 89.7 89.3001 88.1 89.7001C86.5 90.0001 84.9 89.4001 83.9 88.0001C79.9 82.5001 77.2 66.5001 76.8 59.1001C76.7 57.6001 76.8 54.5001 77.3 51.7001C78 51.2001 78.6 50.8001 79.2 50.6001ZM90.1 110C88.4 109.2 87.1 107.7 86.5 105.9C85.9 103.8 86.6 101.5 88.3 100.2C89.2 99.6001 90.3 99.3001 91.4 99.3001C92 99.3001 92.6 99.4001 93.1 99.6001C94.5 100.2 95.7 101.1 96.5 102.4C97.8 104.5 98.1 108.3 97.5 111.8C95.1 111.4 92.5 111 90.1 110Z",fill:"#0A0A2D"})),Li=e=>i.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M7.99999 14.9665C7.04444 14.9665 6.14444 14.7832 5.29999 14.4165C4.45555 14.0499 3.71388 13.5471 3.07499 12.9082C2.4361 12.2693 1.9361 11.5249 1.57499 10.6749C1.21388 9.82487 1.03333 8.92209 1.03333 7.96654C1.03333 6.99987 1.21388 6.09987 1.57499 5.26654C1.9361 4.4332 2.4361 3.69987 3.07499 3.06654C3.71388 2.4332 4.45555 1.93598 5.29999 1.57487C6.14444 1.21376 7.04444 1.0332 7.99999 1.0332C8.96666 1.0332 9.86944 1.21376 10.7083 1.57487C11.5472 1.93598 12.2861 2.4332 12.925 3.06654C13.5639 3.69987 14.0639 4.4332 14.425 5.26654C14.7861 6.09987 14.9667 6.99987 14.9667 7.96654C14.9667 8.92209 14.7861 9.82487 14.425 10.6749C14.0639 11.5249 13.5639 12.2693 12.925 12.9082C12.2861 13.5471 11.5472 14.0499 10.7083 14.4165C9.86944 14.7832 8.96666 14.9665 7.99999 14.9665ZM7.99999 12.9999C9.37777 12.9999 10.5555 12.5082 11.5333 11.5249C12.5111 10.5415 13 9.35543 13 7.96654C13 7.45543 12.9278 6.96654 12.7833 6.49987C12.6389 6.0332 12.4278 5.59987 12.15 5.19987L5.21666 12.1165C5.59444 12.4165 6.02221 12.6388 6.49999 12.7832C6.97777 12.9276 7.47777 12.9999 7.99999 12.9999ZM3.83333 10.7332L10.75 3.79987C10.35 3.5332 9.91944 3.3332 9.45833 3.19987C8.99721 3.06654 8.5111 2.99987 7.99999 2.99987C6.62221 2.99987 5.44444 3.4832 4.46666 4.44987C3.48888 5.41654 2.99999 6.58876 2.99999 7.96654C2.99999 8.47765 3.07221 8.96654 3.21666 9.4332C3.3611 9.89987 3.56666 10.3332 3.83333 10.7332Z",fill:"currentColor"})),lt=e=>i.createElement("svg",{width:140,height:140,viewBox:"0 0 140 140",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M0 60.592C0 10.6945 10.6945 0 60.592 0L79.408 0C129.306 0 140 10.6945 140 60.592V79.408C140 129.306 129.306 140 79.408 140H60.592C10.6945 140 0 129.306 0 79.408L0 60.592Z",fill:"#FF4018"})),Le=5,Fi=1,ji={steps:[]};function Ui(){const e=i.useRef(!1),[t,n]=i.useState(null),[r,o]=i.useState(null),[a,u]=i.useState(null),[l,h]=i.useState(!1),[y,v]=i.useState(!1),[f,M]=i.useState(null),_=ie(f),[x,k]=i.useState(null),w=ie(x),[b,N]=i.useState(null),[E,U]=i.useState(!1),[W,p]=i.useState(null),[T,g]=i.useState(!1),[I,z]=i.useState(null),[oe,me]=i.useState(!1),[Xe,H]=i.useState(null),[_e,ge]=i.useState(null),ae=Dr(),[xn]=bn("preferred-audio-device-id"),[Je,Tt]=tr(),Ke=!!(Je!=null&&Je.isOnToolbar),[m,En]=i.useState(null),[Y,At]=i.useState(0),[Pt,Dn]=i.useState(!1),[K,Ze]=i.useState(ji),[Me,xt]=i.useState(1),[Et,Mn]=i.useState(!1),[Rn,Dt]=i.useState(!1),[Mt,Rt]=i.useState(!1),[Nn,Bn]=i.useState(!1),[In,On]=i.useState(null),{getRecordingTime:ce,timeStart:Ce,timeStop:re,pauses:Re,state:B,data:Se,refMediaRecorder:F,totalPauseDuration:Nt}=Mr(In,{audioBitsPerSecond:64e3,videoBitsPerSecond:25e5,mimeType:Zn()}),Bt=ie(B),It=ie(re),le=f==null?void 0:f.getSettings(),ue=!!le&&((le==null?void 0:le.displaySurface)==="monitor"||typeof(le==null?void 0:le.displaySurface)>"u"),Ne=B==="inactive"&&ue&&b!==null&&Ke===!0&&m!==null;i.useEffect(()=>{Se!==null&&(ge(Se),H(Se.size),z(URL.createObjectURL(Se)))},[Se]),i.useEffect(()=>{f&&b&&ue&&On(new MediaStream([f,b]))},[f,b,ue]),i.useEffect(()=>()=>{b==null||b.stop()},[b]),i.useEffect(()=>()=>{f==null||f.stop()},[f]),i.useEffect(()=>{Me===Ct&&Ce===null&&(w===null&&x!==null||_!==null&&f===null)&&xt(gt)},[f,_,x,w,Me,Ce]),Yt(()=>{A.storage.local.get("selected-test").then(c=>{En(c["selected-test"]??null)}),A.tabs.getCurrent().then(c=>{c&&A.tabs.update(c.id,{pinned:!1})})});const se=i.useCallback(()=>{(F==null?void 0:F.current)!==null&&(F.current.stop(),b==null||b.stop(),f==null||f.stop(),r&&(A.tabs.remove(r),o(null)),A.tabs.update(ae,{active:!0,pinned:!1}))},[r,ae,F,b,f]),Wn=i.useCallback(c=>{N(c)},[]),$e=i.useCallback(()=>{F.current!==null&&(F.current.pause(),A.tabs.query({active:!0,lastFocusedWindow:!0}).then(c=>{c.length>0&&u(c[0].id??null)}),A.tabs.getCurrent().then(c=>{Ie(c)}))},[F]),Be=i.useCallback(()=>{h(!1),F.current!==null&&F.current.resume(),a!==null&&A.tabs.get(a).then(c=>{Ie(c)})},[F,a]),Ot=i.useCallback(async()=>{var C;if(!Ne)throw new Error("Could not start recording",{cause:"not-ready"});if(typeof(m==null?void 0:m.invitation_id)>"u"&&(await zt(`/test/${m==null?void 0:m.id}/status`)).status!=="available")throw window.location.replace("info.html#test-not-available"),n("Test is not available"),new Error("Test is not available",{cause:"not-available"});(C=F.current)==null||C.start(),A.tabs.update(ae,{pinned:!0});const c=await A.tabs.create({url:m==null?void 0:m.url,active:!0});o(c.id??null),me(!0),At(0),U(!1),ye(m,"started")},[ae,F,Ne,m]);i.useEffect(()=>{if(b!==null){let c=function(){N(null)};return b.addEventListener("ended",c),()=>{b.removeEventListener("ended",c)}}},[b]),i.useEffect(()=>{if(f!==null){let c=function(){B==="recording"&&(se(),v(!0)),M(null)};return f.addEventListener("ended",c),()=>{f.removeEventListener("ended",c)}}},[f,B,se]),i.useEffect(()=>{if(B==="paused"){Dt(!1),Rt(!1);const c=setTimeout(()=>{Dt(!0)},Le*60*1e3),C=setTimeout(()=>{me(!1),Rt(!0)},(Le+Fi)*60*1e3);return()=>{clearTimeout(c),clearTimeout(C)}}},[B]),i.useEffect(()=>{Mt===!0&&oe===!1&&(se(),ye(m,"discarded").finally(()=>{window.location.replace("info.html#paused-too-long")}))},[Mt,oe,se,m]);const be=i.useMemo(()=>{let c=B??"setup";return Et?c="upload-complete":c==="inactive"&&re===null?c="ready":c==="inactive"&&re!==null&&(c="recording-complete"),{state:c,test:m,currentTaskStep:Y,testMeta:K,allTaskStepsCompleted:Pt,timeStart:Ce,timeStop:re,pauses:Re}},[m,Y,K,Pt,Ce,re,Re,B,Et]);i.useEffect(()=>{A.runtime.sendMessage({type:"recorder-status-update",recorderStatus:be})},[be]),i.useEffect(()=>{const c=C=>{C.type==="popup-opened"&&U(!0)};return A.runtime.onMessage.addListener(c),()=>{A.runtime.onMessage.removeListener(c)}},[]),i.useEffect(()=>{const c=(C,S,P)=>{C.type==="recorder-status-request"&&P({recorderStatus:be})};return A.runtime.onMessage.addListener(c),()=>{A.runtime.onMessage.removeListener(c)}},[be]),i.useEffect(()=>{if(B==="recording"&&!E){const c=setTimeout(()=>{A.runtime.sendMessage({type:"send-notification",title:"Please read your task first.",message:"Click on the Userbrain Recorder icon to open your task.",priority:2})},5e3),C=setInterval(()=>{A.runtime.sendMessage({type:"set-badge",backgroundColor:[255,0,0,255],textColor:[255,255,255,255],text:e.current?"TASK":""}),e.current=!e.current},1e3);return()=>{clearTimeout(c),clearInterval(C),A.runtime.sendMessage({type:"set-badge",text:""})}}},[B,E]),i.useEffect(()=>{if(B==="recording"||B==="paused"){if(E)return qt({backgroundColor:[255,0,0,255],textColor:[255,255,255,255],text:()=>{function c(O,te){var Gt=te-O.toString().length+1;return Array(+(Gt>0&&Gt)).join("0")+O}const C=ce(),S=c(Math.floor(C/1e3)%60,2),P=Math.floor(C/1e3/60);return P>=10?P+"m":P+":"+S},intervalDuration:250})}else return qt({text:""})},[B,E,ce]),i.useEffect(()=>{if(Bt!==B){if(B==="recording"){let c=function(){ye(m,"testing")};c();const C=setInterval(c,6e4);return()=>{clearInterval(C)}}B==="paused"&&ye(m,"paused")}},[B,Bt,m]),Yt(()=>{A.runtime.sendMessage({type:"recorder-opened"})}),nr("recorder-opened");const Wt=i.useCallback((c,C)=>{Ze(st(K,S=>{const P=S.steps.findIndex(O=>O.teststep_id===c);if(P===-1)S.steps.push({teststep_id:c,response:C});else{const O={...S.steps[P].response};for(const te of Object.keys(C))O[te]=123;S.steps[P].response=O}}))},[K]),Lt=i.useCallback((c,C)=>{Ze(st(K,S=>{const P=S.steps.findIndex(O=>O.teststep_id===c);P===-1?S.steps.push({teststep_id:c,response:C}):S.steps[P].response=C}))},[K]),ke=i.useCallback((c,C,S)=>{Ze(st(K,P=>{const O=P.steps.findIndex(te=>te.teststep_id===c);if(O===-1){const te={};P.steps.push({teststep_id:c,response:te,[C]:S})}else P.steps[O][C]=S}))},[K]);i.useEffect(()=>{if(It===null&&re!==null){const c=ce();m!==null&&Y!==null&&ke(m.task[Y].id,"timestamp_completed",Math.floor(c/1e3))}},[ce,re,Y,It,m,ke]);const Ft=i.useCallback(async c=>{let C=null;if(r!==null)try{C=await A.tabs.get(r)}catch{}if(C)Ie(C,{url:c});else{const S=await A.tabs.create({url:c});o(S.id??null)}},[r]);i.useEffect(()=>{const c=C=>{if(C.type==="next-task"&&Y!==null&&m!==null){const S=ce(),P=m.task[Y];if(P.type==="redirect"){const te=Y===m.task.length-1;P.options.url&&Ft(P.options.url),te&&Dn(!0)}const O=Math.min(m.task.length-1,Y+1);ke(P.id,"timestamp_completed",Math.floor(S/1e3)),At(O)}if(C.type==="task-step-response"){const{stepId:S,response:P}=C;Lt(S,P)}};return A.runtime.onMessage.addListener(c),()=>{A.runtime.onMessage.removeListener(c)}},[m,Y,K,Ft,ce,Wt,Lt,ke]),i.useEffect(()=>{if(oe===!0&&l===!1){let c=function(C){return C.preventDefault(),C.returnValue=!0,!0};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}}},[oe,l]);const Te=i.useCallback((c=!0)=>{function C(){A.tabs.getCurrent().then(S=>{Ie(S)}),h(!0)}c===!0?A.tabs.query({active:!0,lastFocusedWindow:!0}).then(S=>{S.length>0&&c===!0&&u(S[0].id??null)}).finally(()=>{C()}):C()},[]);i.useEffect(()=>{const c=(C,S,P)=>{switch(C.type){case"start-recording":return Ot().then(()=>{P({success:!0})}).catch(O=>{n(O.message),P({success:!1,error:O})}),!0;case"stop-recording":se();break;case"stop-recording-and-upload":se(),g(!0);break;case"pause-recording":$e();break;case"resume-recording":Be();break;case"discard-recording-with-confirm":Te();break}};return A.runtime.onMessage.addListener(c),()=>{A.runtime.onMessage.removeListener(c)}},[Ot,se,ae,ce,b,Ne,r,f,Wt,m,Y,ke,F,$e,Be,Te]);function jt(){const c={video:{displaySurface:"monitor",width:{max:1920},frameRate:{max:10}}};navigator.mediaDevices.getDisplayMedia(c).then(C=>{k(null);const S=C.getVideoTracks()[0];f==null||f.stop(),M(S)}).catch(C=>{console.error("getDisplayMedia error",C),k(C)})}function Ln(){I!==null&&URL.revokeObjectURL(I),H(null),ge(null),z(null)}function Fn(){Mn(!0),me(!1)}function Ut(){g(!0)}function Vt(){Bn(!0),typeof(m==null?void 0:m.id)<"u"?(se(),ye(m,"discarded").finally(()=>{window.close()})):window.close()}function jn(){h(!1),Be()}function Un(){h(!1)}const Vn=i.useCallback(c=>{c===!1&&me(!1)},[]);function Gn(){Tt()}function zn(){(m==null?void 0:m.example)!==1&&g(!0),v(!1)}return m===null?null:Nn===!0?s(L,{children:s("div",{className:D.discard,children:d(R,{children:[s(pn,{}),s(j,{title:"Test discarding…"})]})})}):l===!0?s(L,{children:s("div",{className:D.discard,children:d(R,{children:[s(pn,{}),s(j,{title:"Are you sure you want to discard this test?",titleMaxWidth:"30rem",text:"The test will be deleted from your device and won’t be sent to our servers. You won’t be able to retake this test and you won’t get paid for it.",textMaxWidth:"35rem"}),d("div",{className:D.buttonsCentered,children:[s(Jt,{big:!0,icon:s(Li,{}),onClick:Vt,children:"Discard Test"}),be.state==="paused"||be.state==="recording"?s($,{big:!0,onClick:jn,children:"Continue Testing"}):s($,{big:!0,onClick:Un,children:"Cancel"})]})]})})}):y===!0?s(L,{header:s(ee,{type:"warning",children:"The recording was cancelled because you stopped sharing your screen."}),children:s(tt,{className:D.card,children:d(R,{children:[s("h1",{className:D.title,children:"Recording not ended properly"}),s("p",{children:"If you have already completed all tasks we can accept your recording anyways. Please stop the recording properly in the extension popup next time."}),s("p",{children:"Thank you!"}),d("div",{className:D.buttons,children:[s(Q,{onClick:zn,children:"Upload recording"}),s($,{onClick:()=>Te(),children:"Discard this recording"})]})]})})}):Me!==Ct?s(qs,{isExample:(m==null?void 0:m.example)===1,currentStep:Me,onNextStep:c=>xt(c),onGotAudioTrack:Wn,preferredAudioDeviceId:xn,audioTrack:b,videoTrack:f,videoError:x,videoTrackDisplaySurfaceIsAllowed:ue,onClickOpenChooseDesktopMedia:jt,onClickPinnedUserbrain:Gn,isPinned:Ke}):(m==null?void 0:m.example)===1&&!T&&I?s(Lr,{recordingBlobObjectUrl:I,onClickUploadTest:Ut,onAllQuestionsAnswered:Vn,onClickDiscardTest:Vt}):T===!0?s(Ci,{blob:_e,test:m,testMeta:K,onBlobUploaded:Ln,onTestSubmitted:Fn}):B==="paused"?s(L,{children:d(R,{spacing:"large",children:[s(j,{title:"Recording is paused…",text:`Pausing for longer than ${Le} minutes might lead to your test being rejected.`}),d("div",{className:D.pauseCountdown,children:[s(lt,{className:D.pauseCountdownSq1}),s(lt,{className:D.pauseCountdownSq2}),s(lt,{className:D.pauseCountdownSq3}),s(nn,{className:De(D.pauseCountdownDuration,Rn&&D.pauseCountdownDuration_grace),timeEnd:(Re[Re.length-1][0]??0)+Le*1e3*60})]}),s("div",{className:D.buttonsCentered,children:s(Q,{big:!0,icon:s(rr,{}),onClick:Be,children:"Resume your test"})}),d("div",{className:D.pauseSecondary,children:["Please don’t close this tab. ",s(ur,{className:D.pauseSecondaryDiscard,onClick:()=>Te(!1),children:"Discard test"})]})]})}):B==="recording"?s(L,{children:s(tt,{className:D.card,children:d(R,{children:[s("h1",{className:D.title,children:"Recording in progress…"}),Ce!==null&&s("div",{className:D.recordingTime,children:s(nn,{timeStart:Ce+Nt,timeEnd:re})}),s("p",{children:"Please don’t close this tab."}),s("p",{children:"To continue your test, please click on the Userbrain Recorder icon in your browser toolbar."}),d("p",{children:["If you have any questions, please feel free to reach out to us at ",s("a",{href:"mailto:tester@userbrain.com",children:"tester@userbrain.com"})]}),s("p",{children:"Thank you!"}),d("div",{className:D.buttons,children:[s($,{onClick:$e,children:"Pause recording"}),s(Jt,{onClick:()=>Te(!1),children:"Discard test"})]}),s(Fe,{debugData:{totalPauseDuration:Nt}})]})})}):I?s(L,{children:d(tt,{className:D.card,children:[d(R,{children:[s("h1",{className:D.title,children:"Finished recording, your test is ready to upload"}),s("video",{className:D.video,src:I,controls:!0}),s("div",{className:D.buttons,children:s($,{onClick:Ut,children:"Upload test"})})]}),s(Fe,{debugData:{"File size:":$n(Xe??0),test:m}})]})}):s(L,{children:d(R,{children:[t&&s(ee,{type:"error",children:t}),Ne&&s("div",{className:D.recorderReady,children:d(R,{spacing:"large",children:[s(j,{title:"Ready to start recording",text:"To start recording, first click on the Userbrain Recorder icon and after that on “Open site and start recording”."}),s(Tn,{loop:!0,autoplay:!0,delay:800,style:{width:"100%",maxWidth:"29.3rem"},src:"/lottie-animations/ready-to-start.json"})]})}),!Ke&&d(ne,{children:[s(ee,{type:"error",children:"Please pin the extension to your browser toolbar"}),s($,{onClick:()=>Tt(),children:"Check again"})]}),!ue&&d(ne,{children:[f!==null&&!ue&&s(ee,{type:"error",children:"You have shared a window or tab only, please share your entire screen."}),!f&&s(ee,{type:"error",children:"Screen is not shared, please share your screen."}),x&&s(ee,{type:"error",children:x.message}),!ue&&s(Q,{onClick:jt,children:"Share my screen"})]}),s(Fe,{actions:[{label:"Check test status",onClick:()=>{zt(`/test/${m==null?void 0:m.id}/status`).then(c=>{console.log("testStatusResponseData",c),p(c)})}},{label:"Set error message",onClick:()=>{n("This is an error message")}}],debugData:{testStatusResponseData:W,test:m}})]})})}qn.createRoot(document.getElementById("root")).render(s(Cn.StrictMode,{children:s(Qn,{children:s(Ui,{})})}));
