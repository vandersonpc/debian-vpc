var TubeBuddyShareTracker=function(){var e=false;var t;var i;var a;var r;var o={facebook:{name:"Facebook",dataTbServiceId:1,notSharedMsg:"You haven't shared to Facebook."},twitter:{name:"Twitter",dataTbServiceId:2,notSharedMsg:"You haven't shared to Twitter."},linkedin:{name:"LinkedIn",dataTbServiceId:9,notSharedMsg:"You haven't shared to LinkedIn."},pinterest:{name:"Pinterest",dataTbServiceId:7,notSharedMsg:"You haven't shared to Pinterest."},reddit:{name:"Reddit",dataTbServiceId:5,notSharedMsg:"You haven't shared to Reddit."},blogger:{name:"Blogger",dataTbServiceId:4,notSharedMsg:"You haven't shared to Blogger."}};var n=TBGlobal.GetToolById("sharetracker").name;var s=function(){var e=TBGlobal.host+"/ModuleManager/sharetracker/sharetracker?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/sharetracker.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/sharetracker.html"}TBExtension.Get(e,"CRTBLoadShareTrackerTemplate")};var l=function(){jQuery(document).on("click",".tb-share-tracker-checkbox",function(){var e=jQuery(this);var t=e.closest(".tb-share-checkbox-container").attr("data-tb-service-name");if(e.prop("checked")){u(true,t,false)}else{u(false,t,false)}});jQuery(document).on("click",".tb-share-tracker-close, .tb-share-tracker-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-layout-share-container").hide()})};var u=function(e,i,a){var r={service:i,shared:e};var s=TBGlobal.host;var l=jQuery.param({VideoId:t.id,SocialSiteType:o[i.toLowerCase()].dataTbServiceId});if(e){TBUtilities.ReportProductEvent("Feature Used",{Tool:n,Action:`Adding ${i}`});var u=jQuery("#tb-share-"+i.toLowerCase()).find(".tb-share-tracker-checkbox").prop("checked");if(a&&u){TBExtension.Post(s+TBGlobal.apiUrls.sharedVideoRemove,l,null,null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}s+=TBGlobal.apiUrls.sharedVideoAdd}else{TBUtilities.ReportProductEvent("Feature Used",{Tool:n,Action:`Removing ${i}`});s+=TBGlobal.apiUrls.sharedVideoRemove}TBExtension.Post(s,l,"CRShareTrackerPost",r,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});TBUtilities.AddAction(null,TBUtilities.ActionTypes.ShareTracker_Track,"sharetracker")};var c=function(){jQuery(document.body).on("CRTBLoadShareTrackerTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);m()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyShareTracker] CRTBLoadShareTrackerTemplate"})}});jQuery(document.body).on("CRTBShareTrackerGetHistory",function(e,t){try{if(t.success){var i=JSON.parse(t.response);if(i.SharedWithFacebookDate!=null){o.facebook.shareStatus=true;o.facebook.sharedMsg="You shared to Facebook on "+i.SharedWithFacebookDate+"."}else{o.facebook.shareStatus=false}if(i.SharedWithTwitterDate!=null){o.twitter.shareStatus=true;o.twitter.sharedMsg="You shared to Twitter on "+i.SharedWithTwitterDate+"."}else{o.twitter.shareStatus=false}if(i.SharedWithBloggerDate!=null){o.blogger.shareStatus=true;o.blogger.sharedMsg="You shared to Blogger on "+i.SharedWithBloggerDate+"."}else{o.blogger.shareStatus=false}if(i.SharedWithRedditDate!=null){o.reddit.shareStatus=true;o.reddit.sharedMsg="You shared to Reddit on "+i.SharedWithRedditDate+"."}else{o.reddit.shareStatus=false}if(i.SharedWithPinterestDate!=null){o.pinterest.shareStatus=true;o.pinterest.sharedMsg="You shared to Pinterest on "+i.SharedWithPinterestDate+"."}else{o.pinterest.shareStatus=false}if(i.SharedWithLinkedInDate!=null){o.linkedin.shareStatus=true;o.linkedin.sharedMsg="You shared to LinkedIn on "+i.SharedWithLinkedInDate+"."}else{o.linkedin.shareStatus=false}}else{}d();jQuery("#tb-share-tracker-loading").hide();jQuery("#tb-share-tracker-video-container").show();jQuery("#tb-layout-share-button-container").show();jQuery("#tb-share-tracker-buttons-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyShareTracker] CRTBShareTrackerGetHistory"})}});jQuery(document.body).on("CRShareTrackerPost",function(e,t){b(t.data.service,t.data.shared)})};var d=function(){var e=jQuery(".jssocials-shares").children();jQuery.each(e,function(e,t){var i=jQuery(t);var a=t.className.slice(t.className.search("jssocials-share-")+16);var r=jQuery("#tb-share-service-template").clone().attr("id","tb-share-"+a);var n=r.find(".tb-share-tracker-checkbox");r.attr("data-tb-service-name",o[a].name).attr("data-tb-service-id",o[a].dataTbServiceId);n.attr("id","tb-share-tracker-checkbox-"+a);r.find(".tb-share-tracker-checkbox-label").attr("for","tb-share-tracker-checkbox-"+a);if(o[a].shareStatus){n.prop("checked",true);n.parent().attr("title",o[a].sharedMsg)}else{n.parent().attr("title",o[a].notSharedMsg)}r.removeClass("tb-hid").appendTo(i)})};var b=function(e,t){var i=jQuery(".jssocials-share-"+e.toLowerCase()).find("#tb-share-"+e.toLowerCase());var a=i.find(".tb-share-tracker-checkbox");if(t){a.prop("checked",true);a.parent().attr("title","You shared to "+o[e.toLowerCase()].name+" today.")}else{a.prop("checked",false);a.parent().attr("title","You haven't shared to "+o[e.toLowerCase()].name+".")}};var h=function(e){t=e;var i=TBGlobal.host+TBGlobal.apiUrls.sharedVideoGetHistory+"?videoId="+e.id;TBExtension.Get(i,"CRTBShareTrackerGetHistory")};var p=function(e,t,i){jQuery("#tb-share-tracker-thumbnail").attr("src",i);jQuery("#tb-share-tracker-title").text(t);jQuery("#tb-share-tracker-title").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-share-tracker-loading").show();jQuery("#tb-share-tracker-video-container").hide();jQuery("#tb-layout-share-button-container").hide();jQuery("#tb-share-tracker-buttons-container").hide();jQuery("#tb-share-tracker-video-thumbnail").attr("src",i);jQuery("#tb-share-tracker-video-link").text(t);jQuery("#tb-share-tracker-video-link").attr("href","https://www.youtube.com/watch?v="+e);TBYouTubeApi.GetVideoDetails(e,"snippet",h);jQuery("#tb-layout-share-container").fadeIn();var a="https://youtu.be/"+e;jQuery("#tb-share-tracker-buttons-container").jsSocials({url:a,text:t,showLabel:false,showCount:false,shareIn:"blank",shares:["facebook","twitter","linkedin","pinterest","reddit","blogger"],on:{click:function(e){if(this.share){u(true,this.share,true)}}}})};var m=function(){p(i,a,r)};return{ShowForVideo:function(t,o,n){if(TBGlobal.IsAuthenticated()){i=t;a=o;r=n;if(!e){c();s();l();e=true}else{m()}}}}}();var TubeBuddyEmbed=function(){var e=false;var t=false;var i;var a;var r;var o={url:"",videoId:"",height:315,width:560,start:null,end:null,playlistId:""};var n=function(){var e=TBGlobal.host+"/ModuleManager/embed/embed?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/embed.html")}else if(loadLocalHTML&&TBExtension.GetType()==="safari"){e="modules/embed.html"}TBExtension.Get(e,"CRTBLoadEmbedTemplate")};var s=function(){o.url="https://www.youtube.com";o.start=null;if(jQuery("#tb-embed-start").val()!==""){var e=parseInt(jQuery("#tb-embed-start").val());if(e!==null)o.start=e}o.end=null;if(jQuery("#tb-embed-end").val()!==""){var i=parseInt(jQuery("#tb-embed-end").val());if(i!==null)o.end=i}if(jQuery("#tb-embed-size").val()==="1"){o.height=315;o.width=560}else if(jQuery("#tb-embed-size").val()==="2"){o.height=360;o.width=640}else if(jQuery("#tb-embed-size").val()==="3"){o.height=480;o.width=853}else if(jQuery("#tb-embed-size").val()==="4"){o.height=720;o.width=1280}else if(jQuery("#tb-embed-size").val()==="5"){o.height=315;o.width=560;var a=null;var r=null;if(jQuery("#tb-embed-height").val().replace("px","").replace("PX","").replace(" ","")!=="")a=parseInt(jQuery("#tb-embed-height").val().replace("px","").replace("PX","").replace(" ",""));if(jQuery("#tb-embed-width").val().replace("px","").replace("PX","").replace(" ","")!=="")r=parseInt(jQuery("#tb-embed-width").val().replace("px","").replace("PX","").replace(" ",""));if(a!==null&&r!==null){o.height=a;o.width=r}}if(jQuery("#tb-embed-privacy").is(":checked"))o.url="https://www.youtube-nocookie.com";var n=o.videoId+"?";if(t==true){n="videoseries?list="+o.playlistId+"&"}var s='<iframe type="text/html" width="'+o.width+'" height="'+o.height+'" src="'+o.url+"/embed/"+n;if(o.start)s+="start="+o.start+"&";if(o.end)s+="end="+o.end+"&";if(jQuery("#tb-embed-showVideoInfo").is(":checked"))s+="showinfo=0&";if(jQuery("#tb-embed-disablePlayControls").is(":checked"))s+="controls=0&";if(jQuery("#tb-embed-modestBranding").is(":checked"))s+="modestbranding=1&";if(jQuery("#tb-embed-disabledKeyboardControls").is(":checked"))s+="disablekb=1&";if(jQuery("#tb-embed-forceClosedCaptions").is(":checked"))s+="cc_load_policy=1&";if(jQuery("#tb-embed-lightTheme").is(":checked"))s+="theme=light&";if(jQuery("#tb-embed-autoPlayVideo").is(":checked"))s+="autoplay=1&";if(jQuery("#tb-embed-loopVideo").is(":checked"))s+="loop=1&playlist="+o.videoId+"&";if(jQuery("#tb-embed-autoHidePlayBar").is(":checked"))s+="autohide=1&";if(jQuery("#tb-embed-hideRelatedVideos").is(":checked"))s+="rel=0&";if(jQuery("#tb-embed-jsapi").is(":checked"))s+="enablejsapi=1&";if(jQuery("#tb-embed-disableFullscreen").is(":checked"))s+="fs=0&";s=s.substring(0,s.length-1);s+='" frameborder="0"';if(jQuery("#tb-embed-autoPlayVideo").is(":checked")){s+=' allow="autoplay" '}s+="></iframe>";jQuery("#tb-embed-code").val(s);jQuery("#tb-embed-preview").html(s);jQuery(".copy-tags-element").remove();jQuery("#tb-embed-copy").attr("data-clipboard-text",s);var l=new ClipboardJS("#tb-embed-copy")};var l=function(){jQuery(document).on("click","#tb-embed-copy",function(){jQuery("#tb-embed-copy").html("Copied");window.setTimeout(function(){jQuery("#tb-embed-copy").html("Copy")},1500);TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("advancedvideoembedding").name,Action:"Copy html",VideoId:i,VideoTitle:a})});jQuery(document).on("click change keypress keydown keyup",".tb-embed-option",function(){s()});jQuery(document).on("click","#tb-embed-close, .tb-embed-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-layout-embed-container").hide()});jQuery(document).on("click change","#tb-embed-size",function(){var e=jQuery(this).val();if(e==="5"){jQuery("#tb-embed-custom-size").show()}else{jQuery("#tb-embed-custom-size").hide()}});jQuery(document).on("click",".tb-embed-explorer-tab-header",function(){try{jQuery(".tb-embed-explorer-tab").hide();jQuery("#"+jQuery(this).attr("data-tab-id")).fadeIn();jQuery(".tb-embed-explorer-tab-header").removeClass("selected");jQuery(this).addClass("selected")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyembedExplorer] tb-embed-explorer-tab-header [click]"})}})};var u=function(){jQuery(document.body).on("CRTBLoadEmbedTemplate",function(e,o){try{if(o.success){o.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(o.response,DOMPurifyConfig));jQuery("body").append(o.response);if(t==true){d(i,a,r)}else{c(i,a,r)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEmbed] CRTBLoadEmbedTemplate"})}})};var c=function(e,i,a){t=false;o.videoId=e;s();jQuery("#tb-layout-embed-container").fadeIn();jQuery(".tb-embed-mode-title").text("Video");jQuery("#tb-embed-video-thumbnail").attr("src",a);jQuery("#tb-embed-video-link").text(i);jQuery("#tb-embed-video-link").attr("href","https://www.youtube.com/watch?v="+e)};var d=function(e,i,a){t=true;o.playlistId=e;s();jQuery("#tb-layout-embed-container").fadeIn();jQuery(".tb-embed-mode-title").text("Playlist");jQuery("#tb-embed-video-thumbnail").attr("src",a);jQuery("#tb-embed-video-link").text(i);jQuery("#tb-embed-video-link").attr("href","https://www.youtube.com/playlist?list="+e)};return{ShowForVideo:function(o,s,d){if(TBGlobal.IsAuthenticated()){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AdvancedVideoEmbedding_Use,"advancedvideoembedding");if(!e){i=o;a=s;r=d;u();n();l();e=true;t=false}else{c(o,s,d)}}},ShowForPlaylist:function(o,s,c){if(TBGlobal.IsAuthenticated()){TBUtilities.AddAction(null,TBUtilities.ActionTypes.AdvancedVideoEmbedding_Use,"advancedvideoembedding");if(!e){i=o;a=s;r=c;u();n();l();e=true;t=true}else{d(o,s,c)}}}}}();var TubeBuddyCommentManager=function(){var t=false;var a=false;var r=false;var o=false;var n=null;var s=null;var l=null;var u=false;var c=[];var d=null;var b=null;var h=null;var p=false;var m=false;var y=null;var f=false;var g=null;var v=false;var T=0;var j=0;var Q=false;var k=null;var B=null;var C=null;var w=null;var x=null;var I=null;var A=function(){this.isLoaded=false;this.name="";this.thumbnail="";this.channelId="";this.channelId="";this.viewCount=0;this.videoCount=0;this.subscriberCount=0;this.hiddenSubscriberCount=false;this.dateContacted=null;this.socialProfiles=[];this.contacted=false;this.twitterHandle=""};var S=function(){this.image="";this.url="";this.handle="";this.type=0};var U={YouTube:0,GooglePlus:1,Twitter:2,Facebook:3};var L=function(){B=jQuery("#tb-commentsCannedResponse-channelInfoTemplate").html();C=jQuery("#tb-commentsCannedResponse-subscriberCountTemplate").html();w=jQuery("#tb-commentsCannedResponse-facebookTemplate").html();x=jQuery("#tb-commentsCannedResponse-twitterTemplate").html();I=jQuery("#tb-commentsCannedResponse-instagramTemplate").html();l=null;n=null;o=TBGlobal.Profile().SettingsShowCommentCannedResponses;r=false;G();TBUtilities.Log("Canned Responses Enabled: "+o);if(o==true||r){R()}};var G=function(){try{var e=TBUtilities.GetParameterByName("v",window.location.href);jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").append('<div style="padding: 4px 12px 4px 29px;">Loading...</div>');if(k!=e){k=e;TubeBuddyYouTubeActions.GetVideoInfo(e,function(e){var t=TBGlobal.CurrentChannelId().toLowerCase();if(e.channelid.toLowerCase()==t){Q=true}else{Q=false}var i=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(i,"CRTBCannedResponseGetCannedResponses")})}}catch(e){Q=false;TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] checkOwnerChannel"})}};var E=function(){jQuery(".tb-commenter-campaign-dropdown-list").each(function(){var e=jQuery(this);e.empty();if(TBGlobal.Profile().Campaigns.length==0){e.append('<span style="font-size:11px; color:Red">You haven\'t created any Campaigns</span>')}else{jQuery.each(TBGlobal.Profile().Campaigns,function(t,i){e.append('<a class="tb-commenter-insert-campaign" data-campaign-id="'+i.Id+'">'+i.Name+"</a><br>")})}TBUtilities.Log("Populating Camapigns: "+TBGlobal.Profile().Campaigns.length)})};var R=function(){u=true;j=P();jQuery(".comment-renderer").css("overflow","visible");var e=M();var t=TBGlobal.GetYouTubeUI();jQuery(e.commentSelector).each(function(i,a){var r=this;if(t=="material"){var o=jQuery(r).find(e.commentTextSelector).text();var n=jQuery(r).find(e.commentAuthorSelector).attr("href");var s=n+o;jQuery(this).attr("data-cid",s.hashCode())}V(r)});E();oe()};var P=function(){var e=0;var t=M();e=jQuery(t.commentSelector).length;return e};var M=function(){var e={footerRowSelector:"",lastElementSelector:"",actionMenuContainer:"",commentSelector:""};var t=TBGlobal.GetYouTubeUI();switch(t){case"studio":case"material":{e.footerRowSelector="#toolbar";e.lastElementSelector="#dislike-button";e.actionMenuContainer="#toolbar";e.commentSelector="div#body.ytd-comment-renderer";e.commentTextSelector="yt-formatted-string#content-text";e.commentRendererSelector="#comment";e.replyButtonSelector="button";e.commentAuthorSelector="#author-text";e.commentAuthorTitleSelector="#author-text > span";e.commentTextAreaSelector="#contenteditable-root";e.commentAuthorUrlSelector="#author-thumbnail a:first";e.commentPublishTimeSelector="#published-time-text";break}case"default":{e.footerRowSelector=".comment-renderer-footer";e.lastElementSelector=".sprite-dislike";e.actionMenuContainer=".comment-renderer-action-menu";e.commentSelector=".comment-renderer";e.commentRendererSelector=".comment-renderer";e.replyButtonSelector=".comment-renderer-reply";e.commentAuthorTitleSelector=".comment-author-text";e.commentTextAreaSelector=".comment-simplebox-text";e.commentAuthorUrlSelector="a:first";e.commentPublishTimeSelector=".comment-renderer-time";break}}return e};var V=function(e){try{if(o){O(e);jQuery(".tb-commentsCannedResponse-manage-cannedResponses").attr("href",TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId())}if(r){var t=M();if(jQuery(e).find(".tb-commentsCannedResponse-channelInfo").length==0&&jQuery(e).find(".creator").length==0){var a=jQuery(e).find(t.commentAuthorUrlSelector).attr("href");TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(a,function(a){if(a.success==true){var r="";if(a.subscribersFormatted!=null){r=C.formatTemplate(a.subscribersFormatted)}var o="";var n="";var s="";for(i=0;i<a.socialProfiles.length;i++){var l=a.socialProfiles[i];if(l.url!==undefined&&l.url.indexOf("twitter.com")!==-1){n=x.formatTemplate(l.url)}else if(l.url!==undefined&&l.url.indexOf("facebook.com")!==-1&&l.url.indexOf("youtube.com")===-1){o=w.formatTemplate(l.url)}else if(l.url!==undefined&&l.url.indexOf("instagram.com")!==-1){s=I.formatTemplate(l.url)}}var u=TBGlobal.GetYouTubeUI();var c="";if(u=="material"){c="tb-move-up4"}var d=B.formatTemplate(r,o,n,s,c);jQuery(e).find(t.commentPublishTimeSelector).after(d)}})}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] populateMenus"})}};var O=function(e){var t=M();var i=TBGlobal.GetYouTubeUI();jQuery(e).find(t.footerRowSelector).each(function(e,a){if(jQuery(this).find(".tb-commentsCannedResponse-cannedResponse-menu").length==0){if(jQuery(this).closest(t.commentSelector).hasClass("channel-owner")==false){jQuery(this).find(t.lastElementSelector).after(D());switch(i){case"studio":case"material":{jQuery(this).find(t.lastElementSelector).after(F());break}case"default":{jQuery(this).find(t.actionMenuContainer).append(F());break}}}}})};var D=function(){if(n){return n}else{var e=jQuery("#tb-commentsCannedResponse-menuMenuTemplate").html();n=e;return n}};var F=function(){if(l){return l}else{var e="";try{s=TBGlobal.Profile().Campaigns;s=s.map((e,t)=>{s[t].Name=e.Name.replaceAll("&amp;","&");s[t].Template=e.Template.replaceAll("&amp;","&");return s[t]});var t=jQuery("#tb-commentsCannedResponse-menuContainerTemplate").html();var i=_();if(t)e=t.formatTemplate(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] getCannedResponsesMenuHtml"})}l=e;return l}};var _=function(){var e="";if(Q==true){var t=jQuery("#tb-commentsCannedResponse-menuButtonTemplate").html();var i=jQuery("#tb-commentsCannedResponse-menuButtonTemplate-fav").html();if(s.length>0){if(s.some(e=>e.Order===0)){s.sort((e,t)=>e.Name.localeCompare(t.Name));jQuery.each(s,function(t,a){if(a.IsFavorite==true){e+=i.formatTemplate(a.Id,a.Name)}});jQuery.each(s,function(i,a){if(a.IsFavorite==false){e+=t.formatTemplate(a.Id,a.Name)}})}else{s.sort((e,t)=>{return e.Order-t.Order});jQuery.each(s,function(a,r){if(r.IsFavorite==false){e+=t.formatTemplate(r.Id,r.Name)}else{e+=i.formatTemplate(r.Id,r.Name)}})}}else{e=jQuery("#tb-commentsCannedResponse-menuButtonTemplateEmpty").html()}}else{e=jQuery("#tb-commentsCannedResponse-menuButtonTemplateNotOwner").html()}return e};var N=function(){var e=TBGlobal.host+"/ModuleManager/commentmanager/commentmanager?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/commentmanager.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/commentmanager.html"}TBExtension.Get(e,"CRTBLoadCommentManagerTemplate")};var W=function(){if(r==true||o==true){R()}};var z=function(e){var t=jQuery(e);t.closest(".tb-video-commenter-info").hide();t.closest(".tb-commenter-action-icon").fadeIn("fast")};var H=function(t){try{TBUtilities.Log("actionDropDownClicked");jQuery(".tb-video-commenter-info").hide();jQuery(".tb-commenter-action-icon").fadeIn("slow");var i=jQuery(t).attr("data-channelid");TBUtilities.Log(i);if(i){TBUtilities.Log("channel id found");var a=TBUtilities.GetInArray(c,"channelId",i);var r=jQuery(t).siblings('.tb-video-commenter-info[data-channelid="'+i+'"]');r.find(".tb-video-commenter-thumbnail").attr("src",a.thumbnail);r.find(".tb-video-commenter-name").text(a.name);r.find(".tb-video-commenter-name").attr("href","https://www.youtube.com/channel/"+a.channelId);r.find(".tb-video-commenter-thumbnail-link").attr("href","https://www.youtube.com/channel/"+a.channelId);r.fadeIn("fast")}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] actionDropDownClicked"})}};var Y=function(t){TBUtilities.Log("cRTBCommentManagerRedirectUrl result = "+t.success);if(t.success){try{var a=t.response;var r=$.parseHTML(DOMPurify.sanitize(a,DOMPurifyConfig));var o=jQuery(r).find("meta[itemprop=channelId]").first().attr("content");var n=parseInt(jQuery(r).find(".yt-subscription-button-subscriber-count-branded-horizontal").first().text());TBUtilities.Log("cRTBCommentManagerRedirectUrl channelId = "+o);var s=TBUtilities.GetInArray(c,"channelId",t.data.channelId);s.channelId=o;s.subscriberCount=n;var l=TBGlobal.host+TBGlobal.apiUrls.contactHistoryGetContactHistoryByChannelId+"?channelId="+s.channelId;TBUtilities.Log(l);TBExtension.Get(l,"CRTBCommentManagerGetHistoryByProfileId",s.channelId);var u=jQuery('.tb-video-commenter-info[data-channelid="'+s.channelId+'"]');if(s.channelId){TBYouTubeApi.GetChannelStatisticsNoApiClient(s.channelId,"CRTBCommentManagerGetChannelStatisticsCallback")}u.find(".tb-commenter-social-accounts").empty();jQuery("#header-links",r).find(".channel-links-item").each(function(e,t){var i=new S;i.image=jQuery(this).find("img:first").attr("src");i.url=jQuery(this).find("a:first").attr("href");if(i.url.toLowerCase().indexOf("twitter.com/")>-1){i.type=U.Twitter;var a=i.url.toLowerCase().indexOf("twitter.com/")+"twitter.com/".length;if(a>0){var r=i.url.toLowerCase().substring(a,i.url.toLowerCase().length);if(r.indexOf("/")>0)r=r.substring(0,r.indexOf("/"));if(r.indexOf("&")>0)r=r.substring(0,r.indexOf("&"));if(r.indexOf("?")>0)r=r.substring(0,r.indexOf("?"));i.handle=r;if(s.twitterHandle=="")s.twitterHandle=r}}else if(i.url.toLowerCase().indexOf("facebook.com/")>-1){i.type=U.Facebook}else if(i.url.toLowerCase().indexOf("plus.google.com/")>-1){i.type=U.GooglePlus}u.find(".tb-commenter-social-accounts").append('<a href="'+i.url+'" target="_blank"><img src="'+i.image+'" /></a>&nbsp;');s.socialProfiles.push(i)});u.find(".tb-video-commenter-addToGooglePlusCircle").hide();for(i=0;i<s.socialProfiles.length;i++){var d=s.socialProfiles[i];if(d.type==U.GooglePlus){u.find(".tb-video-commenter-addToGooglePlusCircle").show()}}if(jQuery("#header-links",r).find(".channel-links-item").length==0){u.find(".tb-commenter-social-accounts").append('<span style="color:#999; font-size:11px;">(none)</span>')}u.find(".tb-commenter-social-accounts-loading").hide()}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] cRTBCommentManagerRedirectUrl"})}}else{var s=TBUtilities.GetInArray(c,"channelId",t.data.channelId);var u=jQuery('.tb-video-commenter-info[data-channelid="'+s.channelId+'"]');u.find(".tb-commenter-social-accounts-loading").hide();u.find(".tb-commenter-suspended").show()}};var q=function(){jQuery(".tb-video-commenter-info").hide()};var J=function(e){try{if(e.success){e.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(e.response,DOMPurifyConfig));jQuery("body").append(e.response);L()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentManager] CRTBLoadCommentManagerTemplate"})}};var Z=function(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=i.exec(t);if(!a)return null;if(!a[2])return"";return decodeURIComponent(a[2].replace(/\+/g," "))};var X=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var K=function(e){var t=jQuery(e).attr("data-campaign-id");var i=jQuery(e).closest(".tb-video-commenter-contact").find(".tb-video-commenter-message:first");var a=TBUtilities.GetInArray(TBGlobal.Profile().Campaigns,"Id",t).Template;var r=jQuery(e).closest(".tb-video-commenter-info");r=r.find(".tb-video-commenter-name:first");r=r.text();a=TBUtilities.ReplaceAll(a,"{N}",r);a=TBUtilities.ReplaceAll(a,"{n}",r);i.val(a);TubeBuddyCommentManager.HideCannedResponses(e)};var ee=function(e){var t=jQuery(e).parent().find(".tb-commenter-campaign-dropdown:first");t.toggle()};var te=function(e,t){if(t)jQuery(e).find(".tb-commenter-social-accounts-tb:first").css("opacity",".75");else jQuery(e).find(".tb-commenter-social-accounts-tb:first").css("opacity",".4")};var ie=function(){E()};var ae=function(e){jQuery(e).closest(".tb-commenter-campaign-dropdown").hide()};var re=function(){TBUtilities.Log("checkNewRender");var e=false;if(jQuery("#comment-section-renderer-items").length==0)e=true;if(!e){if(!jQuery("#comment-section-renderer-items").hasClass("loading"))e=true}if(e){TBUtilities.Log("Done! Load new comments");W();clearInterval(h)}};var oe=function(){TBUtilities.Log("checkForNewComments");if(d){clearInterval(d)}var e=M();var t=jQuery(e.commentSelector).length;TBUtilities.Log("commentCount = "+t);if(t>j){TBUtilities.Log("new comments found");clearInterval(d);W();d=setInterval(oe,1e4)}else{d=setInterval(oe,5e3)}};var ne=function(){TBUtilities.Log("checkEmbeddedComments");try{var e=false;var t=TBGlobal.GetYouTubeUI();switch(t){case"studio":case"material":{if(jQuery("#comments").find(".ytd-comment-thread-renderer").length>0||jQuery(".ytd-comments-header-renderer#simple-box").length>0){e=true}else{e=false}break}case"default":{if(jQuery("#watch-discussion").find(".comment-author-text").length>0){e=true}else if(jQuery("#watch-discussion").find("iframe").length>0){TBUtilities.Log("iframe detected, do not init comment manager");e=false}else{e=false}break}}if(e==true){TBUtilities.Log("comments are visible");p=true;setTimeout(TubeBuddyCommentManager.Initialize,1e3)}else{TBUtilities.Log("comments are not visible");m=setTimeout(TubeBuddyCommentManager.CheckEmbeddedComments,2e3)}}catch(e){TBUtilities.Log("checkEmbeddedComments exception ="+e)}};var se=function(){jQuery(".tb-commentsCannedResponse-cannedResponse-menu-list").addClass("tb-hid").hide()};var le=function(){jQuery(document).on("click",".yt-sort-filter-sub-menu-renderer a.yt-dropdown-menu",function(e){if(jQuery(this).hasClass("yt-dropdown-menu")){TBUtilities.Log("comment sort clicked");jQuery(".ytd-comment-renderer .tb-commentsCannedResponse-channelInfo").remove();setTimeout(function(){W()},2e3)}});jQuery(document).on("click",".tb-commentManager-chart",function(){var e=TBGlobal.GetYouTubeUI();var t;var i;var a;var r;switch(e){case"studio":case"material":{i=jQuery(this).closest("#body");var o=jQuery(i).find("#author-thumbnail").find("a:first").attr("href");var t=o.substr(o.lastIndexOf("/")+1);a=jQuery(i).find("#author-text").find("span:first").text().trim();r=jQuery(i).find("#img").attr("src");break}case"default":{i=jQuery(this).closest(".comment-renderer");var n=jQuery(i).find(".comment-author-text:first").attr("href");var s=n.lastIndexOf("/");var t=n.substring(s+1);a=jQuery(i).find(".comment-author-text:first").text();r=jQuery(i).find('img[data-ytimg="1"]').attr("src");break}}if(t&&a&&r){TubeBuddyChannelytics.ShowForChannel(t,a,r)}});jQuery(document).on("click",".tb-commentsCannedResponse-topicgenerator-input",function(e){e.stopPropagation()});jQuery(document).on("click",".comment-section-sort-menu-item",function(e){TBUtilities.Log("Setting Interval");h=setInterval(re,500)});jQuery(document).on("change",".tb-commentsCannedResponse-topicgenerator-input",function(e){TBUtilities.Log("tb-commentsCannedResponse-topicgenerator-input change");try{var t=jQuery(this).is(":checked");if(v==false&&t==true){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("have more than 5 comment suggestions","videotopicplanner");return}if(t){TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_SaveComment,"videotopicplanner")}var i="";var a="";var r="";var o="";var n="";var s="";var l=TBGlobal.GetYouTubeUI();switch(l){case"studio":case"material":{var u=this;commentItem=jQuery(u).closest("#comment");var c=jQuery(commentItem).find("a:first").attr("href");o=c.substr(c.lastIndexOf("/")+1);r=jQuery(commentItem).find("#author-text").find("span:first").text().trim();s=jQuery(commentItem).find("#img").attr("src");n=jQuery(commentItem).find("#content-text").text().trim();a=TBUtilities.GetUrlParameter("v");var d=jQuery(u).closest("#body");i=jQuery(d).attr("data-cid");break}case"default":{commentItem=jQuery(this).closest(".comment-renderer");i=jQuery(commentItem).attr("data-cid");a=TBUtilities.GetUrlParameter("v");r=jQuery(commentItem).find(".comment-author-text").text();var b=jQuery(commentItem).find(".comment-author-text:first").attr("href");var h=b.lastIndexOf("/");var o=b.substring(h+1);n=jQuery(commentItem).find(".comment-renderer-text-content").text();s=jQuery(commentItem).find(".yt-thumb-clip").find("img").attr("src");break}}var p={VideoId:a,CommentId:i,CommentorChannelId:o,CommentorName:r,Comment:n,CommentorPhoto:s};TBUtilities.Log(p);var m=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(m,JSON.stringify(p),null,null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-topicgenerator-input change"})}});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponseEmpty",function(){var t=window.open(TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId(),"_blank");t.focus();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-refresh-cannedResponses",function(e){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeOut();var t=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(t,"CRTBCannedResponseGetCannedResponses");e.stopPropagation()});jQuery(document).on("focus","#contenteditable-textarea",function(){jQuery(".tb-emoji-toggle").hide();jQuery(".tb-emoji-contenteditable").remove();jQuery(this).find("#contenteditable-root").before('<span style="position:absolute; right:5px; opacity:.7; z-index:999;" class="tb-emoji-toggle tb-emoji-contenteditable"><img src="'+TBGlobal.host+'/images/modules/emoji/face.png" style=" cursor:pointer; position:relative; bottom:5px;" /></span>')});jQuery(document).on("focusin click","yt-formatted-string.ytd-commentbox #contenteditable-root",function(e){jQuery(this).commentFormatter({parentCommentBoxSelector:"#main.ytd-commentbox",marginPixels:{top:"-30",left:"30"}})});jQuery(document).on("click","#cancel-button, #submit-button",function(e){var t=jQuery(this).parents("#main.ytd-commentbox");if(t.find(".tb-comment-formatter-container").length>0){t.find("#contenteditable-root").commentFormatter("destroy")}});jQuery(document).click(function(){se()});jQuery(document).on("click",".tb-commentsCannedResponse-manage-cannedResponses",function(e){TBUtilities.ReportProductEvent("Canned Response Edit Settings",{timestamp:(new Date).toISOString(),video_id:TBUtilities.GetUrlParameter("v"),tool:"Canned Response",applied:true})});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponse",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-menu-cannedResponse click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.CannedResponses_Use,"cannedresponses");se();var t=jQuery(this).attr("data-id");var i=M();var a=jQuery(this).closest(i.footerRowSelector);var r=jQuery(this).closest(i.commentRendererSelector);if(r.length==0){r=jQuery(this).closest("ytd-comment-replies-renderer")}TBUtilities.Log(a.attr("class"));var o=a.find(i.replyButtonSelector);TBUtilities.Log(o.attr("class"));if(o.length>0){o[o.length-1].click()}else{TBUtilities.LogError({Exception:"Reply Button not selected",Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-menu-cannedResponse click"})}var n=TBUtilities.GetInArray(s,"Id",t);TBUtilities.Log(n);var l=n.Template;var u=r.find(i.commentAuthorTitleSelector).text().trim();TBUtilities.ReportProductEvent("Canned Response Selected",{timestamp:(new Date).toISOString(),video_id:TBUtilities.GetUrlParameter("v"),response_title:n.Name||"",comment:l,starred:n.IsFavorite||false,tool:TBGlobal.GetToolById("cannedresponses").name,applied:true});TBUtilities.Log(u);if(u){l=TBUtilities.ReplaceAll(l,"{N}",u);l=TBUtilities.ReplaceAll(l,"{n}",u)}TBUtilities.Log(l);var c=TBGlobal.GetYouTubeUI();switch(c){case"studio":case"material":{var d=jQuery(r).find(i.commentTextAreaSelector);setTimeout(function(){jQuery(d).parent().parent().siblings("label:first").hide()},10);jQuery(d).focus();jQuery(d).sendkeys(l);jQuery(d).blur();break}case"default":{var d=jQuery(a).find(i.commentTextAreaSelector);jQuery(d).append(l);break}}var o=jQuery(a).parent().find("#submit-button");if(o){o.removeAttr("disabled")}e.stopPropagation()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-menu-cannedResponse click"})}});jQuery(document).on("click",".tb-commentsCannedResponse-cannedResponse-menu",function(e){TBUtilities.Log("Comment Manager tb-commentsCannedResponse-cannedResponse-menu click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");se();var t=M();var i=null;var a=TBGlobal.GetYouTubeUI();switch(a){case"studio":case"material":{var r=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu-row").parent();i=r.find(".tb-commentsCannedResponse-cannedResponse-menu-list");break}case"default":{var r=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu-row").parent();var o=r.siblings(".comment-renderer-action-menu");i=o.find(".tb-commentsCannedResponse-cannedResponse-menu-list");break}}var n=$(this).offset();var l=n.top-$(window).scrollTop()+20;var u=n.left-$(window).scrollLeft();var c=u+"px";var d=l+"px";TBUtilities.Log("left = "+c);TBUtilities.Log("top = "+d);jQuery(i).css({position:"fixed",top:d,left:c}).show();if(jQuery(i).hasClass("tb-hid")){jQuery(i).removeClass("tb-hid").show();var b="";try{var t=M();var a=TBGlobal.GetYouTubeUI();switch(a){case"studio":case"material":{commentItem=jQuery(this).closest(t.commentSelector);break}case"default":{commentItem=jQuery(this).closest(t.commentRendererSelector);break}}b=jQuery(commentItem).attr("data-cid")}catch(e){TBExtension.Log(e)}if(s.length>0&&jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").find(".tb-commentsCannedResponse-menu-cannedResponse").length===0){var h=_();jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(i).find(".tb-commentsCannedResponse-cannedResponses-container").html(h)}var p=TBGlobal.host+TBGlobal.apiUrls.topicsGetCommentAudienceSuggestedTopic+"?commentId="+b;TBExtension.Get(p,"CRTBCannedResponseGetCommentAudienceSuggestedTopic",b)}e.stopPropagation()});jQuery(document).on("click",".tb-commenter-action-icon",function(e){TubeBuddyCommentManager.ActionDropDownClicked(this);e.stopPropagation()});jQuery(document).on("click",".tb-video-commenter-info-close",function(e){TubeBuddyCommentManager.ModalClose(this)});jQuery(document).on("mouseenter",".tb-commenter-action-icon",function(){TubeBuddyCommentManager.HighlightUser(this,true)});jQuery(document).on("mouseleave",".tb-commenter-action-icon",function(){TubeBuddyCommentManager.HighlightUser(this,false)});jQuery(document).on("mouseenter",".HPa, .Wv",function(){TubeBuddyCommentManager.HighlightTubeBuddyIcon(this,true)});jQuery(document).on("mouseleave",".HPa, .Wv",function(){TubeBuddyCommentManager.HighlightTubeBuddyIcon(this,false)});jQuery(document).on("click",".tb-commenter-show-campaigns",function(){TubeBuddyCommentManager.ShowCannedResponses(this);e.stopPropagation()});jQuery(document).on("click",".tb-commenter-insert-campaign",function(){TubeBuddyCommentManager.InsertCannedResponse(this);e.stopPropagation()});jQuery(document).on("click",".yJa, #watch-discussion",function(e){TubeBuddyCommentManager.HideAllModals()});jQuery(document).on("click",".tb-video-commenter-info",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-commenter-campaign-dropdown-close",function(e){TubeBuddyCommentManager.HideCannedResponses(this)});jQuery(document).on("click",".tb-commenter-manage-campaigns",function(e){e.stopPropagation()})};var ue=function(){jQuery(document.body).on("CRTBCannedResponseGetCommentAudienceSuggestedTopic",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var a=TBGlobal.GetYouTubeUI();var r=null;switch(a){case"studio":case"material":{var o=jQuery("[data-cid='"+t.data+"']");r=jQuery(o).find(".tb-commentsCannedResponse-topicgenerator-input:first");break}case"default":{var o=jQuery(".comment-renderer[data-cid='"+t.data+"']");var r=jQuery(o).find(".tb-commentsCannedResponse-topicgenerator-input");break}}v=i.CanAdd;jQuery(r).removeAttr("disabled");jQuery(r).attr("checked",i.IsSuggestedTopic)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCommentAudienceSuggestedTopic"})}});jQuery(document.body).on("CRTBCannedResponseGetCannedResponses",function(e,t){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeIn();try{if(t.success){s=JSON.parse(t.response);s=s.map((e,t)=>{s[t].Name=e.Name.replaceAll("&amp;","&");s[t].Template=e.Template.replaceAll("&amp;","&");return s[t]});s.sort((e,t)=>{return e.Order-t.Order});var i=_();jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").html(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCannedResponses"})}});jQuery(document.body).on("CRTBLoadCommentManagerTemplate",function(e,t){TubeBuddyCommentManager.CRTBLoadCommentManagerTemplateCallback(t)});jQuery(document.body).on("CRTBCommentManagerRedirectUrl",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerRedirectUrlCallback(t)});jQuery(document.body).on("CRTBCommentManagerChannelUrlGet",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerChannelUrlGetCallBack(t)});jQuery(document.body).on("CRTBCommentManagerGetHistoryByProfileId",function(e,t){TubeBuddyCommentManager.CRTBCommentManagerGetHistoryByProfileIdCallback(t)})};return{Initialize:function(){u=false;var e=window.location.href;if(e.indexOf("youtube.com/watch")>0&&p==false){TBUtilities.Log("setting embedded comment manager timer");m=setTimeout(TubeBuddyCommentManager.CheckEmbeddedComments,2e3);return}Q=null;if(TBGlobal.IsAuthenticated()){p=false;if(!a){TBUtilities.Log("not initialized, about to");le();ue();N();TBGlobal.AddProfileUpdateListener(ie);a=true}else{TBUtilities.Log("re-populating content");G()}}},PopulateDropDowns:function(){R()},NewCommentsLoaded:function(){W()},ModalClose:function(e){z(e)},HideAllModals:function(){q()},InsertCannedResponse:function(e){K(e)},ShowCannedResponses:function(e){ee(e)},HideCannedResponses:function(e){ae(e)},CRTBLoadCommentManagerTemplateCallback:function(e){J(e)},CRTBCommentManagerRedirectUrlCallback:function(e){Y(e)},CheckEmbeddedComments:function(){ne()}}}();var TubeBuddyThumbnailGenerator=function(){var e=false;var t;var i;var a;var r;var o;var n;var s=[];var l=1;var u=false;var c=null;var d=null;var b;var h=false;var p=false;var m=false;var y=null;var f=null;var g=null;var v=false;var T=null;var j=null;var Q=null;var k=false;var B="#000";var C;let w;let x=[];var I=function(){var e=chrome.extension.getURL("modules/thumbnailgenerator.html");TBExtension.Get(e,function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] LoadHtml: "+e);if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));if(Q){Q.parent().append(i)}else{jQuery("body").append(i)}Ee()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadHtml"})}})};var A=function(){n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();jQuery(".tb-thumbnail-creator-step4-success-download").removeClass("tb-hid");n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()};var S=function(e){if(e==false){n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}jQuery(".tb-thumbnail-settings-preview-container").unblock();q(4);jQuery("#tb-thumbnail-creator-step4-success").removeClass("tb-hid");jQuery(".upload-thumb-img").each(function(){if(jQuery(this).attr("src").indexOf(t)>0)jQuery(this).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())});if(window.location.href.indexOf("my_videos")>-1){var i=jQuery("div[data-video-id='"+t+"']");if(i&&v==false){var a=jQuery(i).find("img:first");if(a){jQuery(a).attr("src","https://i.ytimg.com/vi/"+t+"/default.jpg?time="+Math.random())}}}if(window.location.href.indexOf("edit?o=U&video_id=")>-1){var a=jQuery(".custom-thumb-selectable").find("img:first");if(a){jQuery(a).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())}}var r=TBGlobal.GetYouTubeUI();if(r==="studio"){jQuery(".ytcp-img-with-fallback").each(function(){if(jQuery(this).attr("src")&&jQuery(this).attr("src").indexOf(t)>0)jQuery(this).attr("src","https://i.ytimg.com/vi/"+t+"/0.jpg?time="+Math.random())})}if(TBGlobal.CanAccessLevel1Tools()){A()}else{jQuery(".tb-thumbnail-creator-step4-success-download-upgrade").removeClass("tb-hid")}};var U=function(e){n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll();jQuery(".tb-thumbnail-settings-container").unblock();var i="There was an error with YouTube's API and we were unable to publish your thumbnail";jQuery("#tb-thumbnail-settings-steps-container").show();jQuery("#tb-thumbnail-settings-size-container").hide();if(e){if(e.status==413){jQuery("#tb-thumbnail-settings-steps-container").hide();jQuery("#tb-thumbnail-settings-size-container").show();i="YouTube did not allow us to publish the video because the file size is too big.\n\nYou could try making the image less complex (smaller background image, fewer colors, etc).\n\nIf it still fails, you will need to create this Thumbnail outside of TubeBuddy, sorry!"}else if(e.status==403){i="Failed to access the image. Try again and if that fails, you can refresh the page and then build the thumbnail again from scratch.\n\nIf it still fails, email your video id to support@tubebuddy.com and we'll see if we can help..."}}A();q(3);jQuery(".tb-thumbnail-settings-error-message").html(i);jQuery("#tb-thumbnail-settings-error-link").attr("href","https://www.youtube.com/edit?o=U&video_id="+t);jQuery(".tb-thumbnail-settings-error-container").show();jQuery(".tb-thumbnail-settings-preview-container").hide()};var L=function(){var e=[];var t=se();var i=new fabric.Image.filters.Brightness({brightness:t});e.push(i);var a=le();var r=new fabric.Image.filters.Contrast({contrast:a});e.push(r);return e};var G=function(){var e=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");if(e){n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var t=n.toDataURL("image/png");TubeBuddyYouTubeActions.PostCustomThumbnailStudio(e,t).then(function(e){S(false)}).catch(function(e){U(e)})}};var E=function(){var e=TBGlobal.host+TBGlobal.apiUrls.brandingsGetBackgroundImages;TBExtension.Get(e,function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] GetBackgroundImages: "+e);jQuery(".tb-thumbnail-creator-backgroundSelect-uploaded-image").remove();jQuery(".tb-thumbnail-creator-backgroundSelect-uploaded-image-delete:visible").remove();if(e){var a=jQuery.parseJSON(i);var r=TBGlobal.host+"/images/icons/x.png";jQuery.each(a,function(e,t){var i=jQuery("#tb-thumbnail-creator-backgroundSelect-uploaded-image-template").html();var a=i.formatTemplate("tb-thumbnail-creator-backgroundSelect-stock-image tb-thumbnail-creator-backgroundSelect-uploaded-image","width:115px;height:64px;cursor: pointer; margin-bottom: 10px; margin-left: 5px; background-size:cover;background-position:center;background-image:url("+t.ImageUrl+");float:left",t.ImageUrl,t.Id,"uploaded",r);jQuery("#tb-thumbnail-creator-backgroundSelect-upload").after(DOMPurify.sanitize(a,DOMPurifyConfig))});if(a.length>=5){jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").addClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] GetBackgroundImages"})}})};var R=function(){jQuery(document).on("click","#tb-thumbnail-creator-container .tb-module-close",function(){H()});window.addEventListener("message",function(e){if(e.origin!=="https://www.youtube.com")return;if(e.data.tbevent&&e.data.tbevent==="ScreenCapResponse"){if(e.data.imageUrl!=null){j=e.data.imageUrl;Z()}else{TBUtilities.Alert("There was a problem capturing a still image from your video.  Please try again.")}}},false);jQuery(document).on("click",".tb-thumbnail-creator-download-step3",function(){try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var e=document.createElement("a");var i=n.toDataURL("image/png");var a=_(i.replace(/^data:image\/(png|jpg);base64,/,""));var r=URL.createObjectURL(a);e.download=t+".png";e.innerHTML="download";e.href=r;e.setAttribute("type","hidden");document.body.appendChild(e);e.click();e.remove();TBUtilities.ReportProductEvent("Thumbnail Generator Download Thumbnail",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),applied:true})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] download thumbnail click"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("keypress","#tb-thumbnail-settings-tab-youtube-competitors-preview-search",function(e){if(e.which===13){$(jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val())}});jQuery(document).on("click","#tb-thumbnail-settings-tab-youtube-competitors-preview-search-button",function(e){$(jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val())});jQuery(document).on("click","#backgroundImageUploadFake",function(e){jQuery("#backgroundImageUpload").click()});jQuery(document).on("click",".tb-thumbnail-creator-brandings-uploadEnabled",function(e){jQuery("#imgLoader").click()});jQuery(document).on("click",".tb-thumbnail-publish-button-seo-studio",function(e){try{if(C)M();n.discardActiveObject();n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var i=n.toDataURL("image/png");jQuery(this).closest(".tb-module-template").hide();TBUtilities.ReportProductEvent("Thumbnail Generator Save & Publish Thumbnail",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),applied:true});_seoStudioCallback(true,i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] SEO Studio transfer click"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-backgroundSelect-uploaded-image-delete",function(e){e.stopPropagation();var t=jQuery(this).attr("data-image-id");TBUtilities.Log("deleting image = "+t);TBUtilities.Confirm("Are you sure you want to delete this image?",function(){var e=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type");if(e=="uploaded"){var i=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-uploaded-id");if(t==i){jQuery("#tb-thumbnail-creator-backgroundSelect-stock-image-default").click()}}var a={Id:t};var r=TBGlobal.host+TBGlobal.apiUrls.brandingsDeleteBackgroundImage;TBExtension.Post(r,JSON.stringify(a),function(e,t,i){try{TBUtilities.Log("[tb-thumbnail-creator-backgroundSelect-uploaded-image-delete] delete background image click");TBUtilities.Log("[TubeBuddyThumbnailGenerator] Delete background image click: "+e);E()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] delete background image click"})}},null,{contentType:"application/json"})},function(){})});jQuery(document).on("change","#backgroundImageUpload",function(e){if(TBGlobal.CanAccessLevel1Tools()==false){TBGlobal.ShowUpgradePage("upload an image","thumbnailgenerator");return}var i=document.getElementById("backgroundImageUpload").value;var a=i.match(/\.([^\.]+)$/)[1];a=a.toLowerCase();switch(a){case"png":case"bmp":case"gif":case"jpg":break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#backgroundImageUpload").val("");return}var r=e.target.files[0].size;if(r>8388608){TBUtilities.Alert("The maximum image file size is 8MB. Please select a smaller image.");jQuery("#backgroundImageUpload").val("");return}var o=new FileReader;o.readAsDataURL(e.target.files[0]);o.onloadend=function(e){jQuery(".tb-thumbnail-creator-backgroundSelect-uploading").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").addClass("tb-hid");var i=e.target.result;var r="";switch(a){case"png":r=i.replace("data:image/png;base64,","");break;case"bmp":r=i.replace("data:image/bmp;base64,","");break;case"gif":r=i.replace("data:image/gif;base64,","");break;case"jpg":r=i.replace("data:image/jpeg;base64,","");break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#backgroundImageUpload").val("");return}jQuery(".tb-thumbnail-creator-font-uploading").removeClass("tb-hid");var o={ImageData:r,ImageExt:a,VideoId:t};var n=TBGlobal.host+TBGlobal.apiUrls.brandingsAddBackgroundImage;TBExtension.Post(n,JSON.stringify(o),function(e,t,i){try{TBUtilities.Log("[backgroundImageUpload] upload background image click",e);jQuery(".tb-thumbnail-creator-backgroundSelect-uploading").addClass("tb-hid");if(e){E()}else{jQuery(".tb-thumbnail-creator-backgroundSelect-upload-enabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-upload-disabled").addClass("tb-hid");TBUtilities.Alert("There was an error uploading your image.  Please make sure the image is larger than 1280 x 720 and that the file type is .png.")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] upload background image click"})}},null,{contentType:"application/json"})}});jQuery(document).on("click",".tb-thumbnail-creator-preview-tab-header",function(){jQuery("#tb-thumbnail-creator-tab-header-preview").find(".tb-thumbnail-creator-tabs-menu-item-container").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(this).addClass("tb-thumbnail-creator-tabs-selected-menu-item");var e=jQuery(this).attr("data-tab");switch(e){case"tb-thumbnail-creator-tab-youtube":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();break}case"tb-thumbnail-creator-tab-facebook":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").hide();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").show();break}case"tb-thumbnail-creator-tab-twitter":{jQuery(".tb-thumbnail-settings-tab-youtube-competitors").hide();jQuery(".tb-thumbnail-settings-tab-twitter").show();jQuery(".tb-thumbnail-settings-tab-facebook").hide();break}}});jQuery(document).on("click",".tb-thumbnail-creator-close",function(){if(_seoStudioCallback){_seoStudioCallback(true,null);_seoStudioCallback=null}TubeBuddyMenu.HideBackground();jQuery(this).closest(".tb-module-template").hide()});jQuery(document).on("click",".tb-thumbnail-creator-setting-backgroundOption, .tb-thumbnail-creator-setting-bg-tab",function(){var e=jQuery(this).attr("data-type");z(e);TBUtilities.ReportProductEvent("Thumbnail Generator Background Tab",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),background_type:e,used:true});return false});jQuery(document).on("click",".tb-thumbnail-creator-next",function(e){if(l<=3&&l>0){l++;q(l)}});jQuery(document).on("click",".tb-thumbnail-creator-previous",function(e){if(l<=3&&l>0){l--;q(l,l+1)}});jQuery(document).on("click",".tb-thumbnail-creator-reload",function(e){location.reload()});jQuery(document).on("click","#nextframe",function(){H();var e=c.getCurrentTime();var t=30;var i=1;var a=1/t*i;var r=e+a;c.seekTo(r)});jQuery(document).on("click","#prevframe",function(){H();var e=c.getCurrentTime();var t=30;var i=1;var a=1/t*i;var r=e-a;c.seekTo(r)});jQuery(document).on("click",".tb-thumbnail-creator-tab",function(e){var t=jQuery(this).attr("data-tab-id");q(parseInt(t));return false});jQuery(document).on("click",".tb-thumbnail-creator-layer-add",function(){var e=jQuery(this).attr("data-type");x.push(e);TBUtilities.Log("[TubeBuddyThumbnailGenerator] Add layer click: "+e);n.discardActiveObject().renderAll();n.renderAll();jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(this).addClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-edit-toolbar").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-button").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-template-upgrade").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-frame-upgrade").addClass("tb-hid");Ce();switch(e){case"text":{jQuery("#tb-thumbnail-creator-text").val("Enter Text Here");jQuery(".tb-thumbnail-creator-format-btn--active").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-add-text").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-text-container").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-text").focus();jQuery("#tb-thumbnail-creator-text").select();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");ue(100);jQuery(".tb-thumbnail-creator-addlayer-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-add-text").removeClass("tb-hid");break}case"image":{we();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");ue(100);ce(0);de(0);jQuery(".tb-thumbnail-creator-layer-branding-container").removeClass("tb-hid");break}case"template":{if(TBGlobal.CanAccessLevel1Tools()){jQuery(".tb-thumbnail-creator-layer-template-container").removeClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-layer-template-upgrade").removeClass("tb-hid")}break}case"shape":{jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");ue(100);jQuery(".tb-thumbnail-creator-add-shape").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape").removeClass("tb-thumbnail-creator-layer-shape-selected");jQuery("#tb-thumbnail-creator-shapes-selection").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-add-shape").removeClass("tb-hid");break}case"emoji":{we();jQuery(".tb-thumbnail-creator-layer-container-opacity").removeClass("tb-hid");ue(100);ce(0);de(0);jQuery(".tb-thumbnail-creator-layer-emoji-container").removeClass("tb-hid");V("people");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),function(e,t){TBUtilities.Log("[TubeBuddyThumbnailGenerator] Get recent emojis: "+t);var i=new Array;if(t){i=JSON.parse(t)}if(i.length>0){jQuery(".tb-thumbnail-creator-layer-emoji-recent-container").show();jQuery(".tb-thumbnail-creator-layer-emoji-recent").empty();jQuery(".tb-thumbnail-creator-emoji-container").removeClass("tb-thumbnail-creator-emoji-container--no-recent");jQuery.each(i,function(e,t){var i=t;var a='<img crossorigin="anonymous" class="tb-thumbnail-creator-branding-stock tb-thumbnail-creator-branding-stock-emoji" src='+i+" />";jQuery(".tb-thumbnail-creator-layer-emoji-recent").append(DOMPurify.sanitize(a,DOMPurifyConfig))})}else{jQuery(".tb-thumbnail-creator-emoji-container").addClass("tb-thumbnail-creator-emoji-container--no-recent")}});break}case"frame":{jQuery(".tb-thumbnail-creator-layer-frame-container").removeClass("tb-hid");ue(100);ce(0);de(0);if(TBGlobal.CanAccessLevel1Tools()){jQuery("#tb-thumbnail-creator-layer-frame-upgrade").addClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-layer-frame-upgrade").removeClass("tb-hid")}}}});jQuery(document).on("click",".tb-thumbnail-creator-add-text",function(e){var t=new fabric.IText("",{left:100,top:100});t.set({fill:ae(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});t.fontFamily=me();t.set({fontSize:ye(),text:jQuery("#tb-thumbnail-creator-text").val()});if(jQuery(".tb-thumbnail-creator-bold").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("fontWeight","bold")}if(jQuery(".tb-thumbnail-creator-underline").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textDecoration","underline")}if(jQuery(".tb-thumbnail-creator-outline").hasClass("tb-thumbnail-creator-format-btn--active")){t.set({stroke:"#000000",strokeWidth:3})}if(jQuery(".tb-thumbnail-creator-outline-white").hasClass("tb-thumbnail-creator-format-btn--active")){t.set({stroke:"#FFFFFF",strokeWidth:3})}if(jQuery(".tb-thumbnail-creator-leftAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","left")}if(jQuery(".tb-thumbnail-creator-centerAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","center")}if(jQuery(".tb-thumbnail-creator-rightAlign").hasClass("tb-thumbnail-creator-format-btn--active")){t.set("textAlign","right")}t.set("opacity",ne());n.add(t);je();jQuery(".tb-thumbnail-creator-layer-text-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container-opacity").addClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-delete-all",function(e){TBUtilities.Confirm("Are you sure you want to delete all layers?",function(){n.forEachObject(function(e){if(e.id=="background"||e.id=="grid"){if(e.selectable==true){n.remove(e)}}else{if(e.lockMovementY==false||e.lockMovementX==false){n.remove(e)}}});n.renderAll();je()},function(){})});jQuery(document).on("change","#tb-thumbnail-creator-lockBackground",function(e){var t=jQuery(this).is(":checked");y.selectable=!t;je()});jQuery(document).on("click",".tb-thumbnail-creator-delete",function(e){var t=ie();if(t){n.remove(t);je()}});jQuery(document).on("click",".tb-thumbnail-creator-front",function(e){var t=ie();if(t){n.bringToFront(t)}});jQuery(document).on("click",".tb-thumbnail-creator-underline",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");var t=ie();if(t&&t.get("type")=="i-text"){if(t.getTextDecoration()==""){t.set("textDecoration","underline")}else{t.set("textDecoration","")}n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-opacity",function(e){var t=ie();var i=ne();be(i);if(t!=null){t.set("opacity",i);n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-brightness",function(e){var t=ie();if(t!=null&&t.get("type")=="image"){var i=se();he(i);jQuery.each(t.filters,function(e,a){if(typeof a.brightness!="undefined"){a.brightness=i;t.applyFilters(n.renderAll.bind(n))}})}});jQuery(document).on("change",".tb-thumbnail-creator-contrast",function(e){var t=ie();if(t!=null&&t.get("type")=="image"){var i=le();pe(i);jQuery.each(t.filters,function(e,a){if(typeof a.contrast!="undefined"){a.contrast=i;t.applyFilters(n.renderAll.bind(n))}})}});jQuery(document).on("click",".tb-thumbnail-creator-outline",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");if(jQuery(".tb-thumbnail-creator-outline-white").hasClass("tb-thumbnail-creator-format-btn--active")){jQuery(".tb-thumbnail-creator-outline-white").removeClass("tb-thumbnail-creator-format-btn--active")}var t=ie();if(t&&t.get("type")=="i-text"){if(t.stroke==null||t.stroke=="#FFFFFF"){t.set({stroke:"#000000",strokeWidth:3})}else{t.set({stroke:null,strokeWidth:0})}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-outline-white",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");if(jQuery(".tb-thumbnail-creator-outline").hasClass("tb-thumbnail-creator-format-btn--active")){jQuery(".tb-thumbnail-creator-outline").removeClass("tb-thumbnail-creator-format-btn--active")}var t=ie();if(t&&t.get("type")=="i-text"){if(t.stroke==null||t.stroke=="#000000"){t.set({stroke:"#FFFFFF",strokeWidth:3})}else{t.set({stroke:null,strokeWidth:0})}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-bold",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");var t=ie();if(t&&t.get("type")=="i-text"){if(t.fontWeight&&t.fontWeight=="bold"){t.set("fontWeight","normal")}else{t.set("fontWeight","bold")}n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-leftAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-centerAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-rightAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=ie();if(t&&t.get("type")=="i-text"){t.set("textAlign","left");n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-centerAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-leftAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-rightAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=ie();if(t&&t.get("type")=="i-text"){t.set("textAlign","center");n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-rightAlign",function(e){jQuery(this).toggleClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-leftAlign").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(".tb-thumbnail-creator-centerAlign").removeClass("tb-thumbnail-creator-format-btn--active");var t=ie();if(t&&t.get("type")=="i-text"){t.set("textAlign","right");n.renderAll()}});jQuery(document).on("click","#tb-thumbnail-creator-lockLayer-toggle",function(){var e=jQuery(this).attr("data-is-locked");var t=ie();t.lockMovementX=!e;t.lockMovementY=!e;n.renderAll();if(e){jQuery(this).removeAttr("data-is-locked");jQuery(this).attr("title","lock layer");jQuery(this).find("i").toggleClass("tb-hid")}else{jQuery(this).attr("data-is-locked",true);jQuery(this).attr("title","unlock layer");jQuery(this).find("i").toggleClass("tb-hid")}});jQuery(document).on("click",".tb-thumbnail-creator-back",function(e){var t=ie();if(k)M();if(jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")){var i=null;var a=n.getObjects();for(var r=0;r<a.length;r++){if(a[r].id=="background"){i=a[r]}}if(i){var o=n.getObjects().indexOf(i);n.moveTo(t,o+1)}else{t.sendToBack()}}else{t.sendToBack()}if(k)P()});jQuery(document).on("click",".tb-thumbnail-creator-upload",function(e){TBUtilities.Log("[TubeBuddyThumbnailGenerator] - publish click");TBUtilities.Confirm("Are you sure you want to publish this thumbnail?",function(){TBUtilities.ReportProductEvent("Thumbnail Generator Save & Publish Thumbnail",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),applied:true});try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();jQuery("#tb-thumbnail-creator-container").find(".subnav").addClass("tb-hid");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ThumbnailGenerator_Use,"thumbnailgenerator")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] [publish click] AddAction"})}n.discardActiveObject();var e='<span class="tb-spinner"></span>'+'<span style="margin-left:10px; font-size: 130%">Publishing Thumbnail...</span>';jQuery(".tb-thumbnail-settings-preview-container").block({message:e,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");var i=n.toDataURL("image/png");i=i.replace("data:image/png;base64,","");TBUtilities.Log("TubeBuddyThumbnailGenerator - tb-thumbnail-creator-upload - uploading to server");TBUtilities.Log("TubeBuddyThumbnailGenerator - imageData length = "+i.length);if(v==true){G()}else{var a=TBGlobal.host+TBGlobal.apiUrls.thumbnailAdd;var r={VideoId:t,ImageData:i};TBExtension.Post(a,JSON.stringify(r),function(e,i,a){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Post Thumbnail",a);if(a.status==413){U(a)}else if(e){S(true)}else{TBUtilities.Log("API publish failed, trying post to UI");n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var r=n.toDataURL("image/png");TubeBuddyYouTubeActions.PostCustomThumbnailStudio(t,r).then(function(e){S(false)}).catch(function(e){U(e)})}}catch(e){U();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Post Thumbnail"})}},null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] publish click"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}},function(){})});jQuery(document).on("change","#imgLoader",function(e){if(h){var t=new FileReader;t.readAsDataURL(e.target.files[0]);var i=e.target.files[0].size;if(i>2621440){TBUtilities.Alert("The maximum image file size is 2.5MB. Please select a smaller image.");jQuery("#imgLoader").val("");return}t.onloadend=function(e){jQuery(".tb-thumbnail-creator-uploading").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").addClass("tb-hid");var t={ImageData:e.target.result};var i=TBGlobal.host+TBGlobal.apiUrls.brandingsAdd;TBExtension.Post(i,JSON.stringify(t),function(e,t,i){try{jQuery(".tb-thumbnail-creator-image-tab-custom").click();TBUtilities.Log("[TubeBuddyThumbnailGenerator] Post Branding: ",i);jQuery("#imgLoader").val("");ge()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Post Branding"})}},null,{contentType:"application/json"})}}else if(TBGlobal.CanAccessLevel1Tools()==true){TBUtilities.Alert("You've reached the maximum of 20 uploaded images.")}else{TBGlobal.ShowUpgradePage("upload more than a single custom image","thumbnailgenerator");try{document.getElementById("imgLoader").value=""}catch(e){}}});jQuery(document).on("change","#fontUpload",function(e){var t=document.getElementById("fontUpload").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"ttf":break;default:TBUtilities.Alert("Only .ttf file types are allowed.");this.value=""}var a=new FileReader;a.readAsDataURL(e.target.files[0]);a.onloadend=function(e){jQuery(".tb-thumbnail-creator-font-uploading").removeClass("tb-hid");var i={FontData:e.target.result,FileName:t};var a=TBGlobal.host+TBGlobal.apiUrls.brandingsFontAdd;TBExtension.Post(a,JSON.stringify(i),function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Post Thumbnail Font Branding: "+e);jQuery(".tb-thumbnail-creator-font-uploading").addClass("tb-hid");if(e){jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").val("");ve(i.replace(/"/g,""));jQuery("#tb-thumbnail-insert-text-button").click()}else{TBUtilities.Alert("There was an error uploading your font. Please try again")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] font upload file change"})}},null,{contentType:"application/json"})}});jQuery(document).on("change","#tb-thumbnail-creator-picker-text",function(){var e=ie();if(e&&e.get("type")==="i-text"){e.set("fill",ae());n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-font",function(){var e=ie();var t=me();if(t=="spacer"){return}if(t=="upload"){jQuery(".tb-thumbnail-creator-layer-container ").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").removeClass("tb-hid");return}if(t=="upgrade"){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.thumbnails);return}if(e&&e.get("type")==="i-text"){e.fontFamily=t;n.renderAll()}});jQuery(document).on("change",".tb-thumbnail-creator-font-size",function(){var e=ie();if(e&&e.get("type")==="i-text"){e.set("fontSize",ye());n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-font-upload-container",function(){jQuery("#fontUpload").click()});jQuery(document).on("click",".tb-thumbnail-creator-branding-delete",function(){var e=jQuery(this).attr("data-branding-id");TBUtilities.Confirm("Are you sure you want to delete this image?",function(){try{var t=n.getObjects();for(var i=0;i<t.length;i++){if(t[i].id==e){n.remove(t[i])}}n.renderAll();if(e){var a=TBGlobal.host+TBGlobal.apiUrls.brandingsDelete;TBExtension.Post(a,JSON.stringify({Id:e}),function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Delete Branding Image",i);ge()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Delete Branding Image"})}},null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] delete click"})}},function(){})});jQuery(document).on("click",".tb-thumbnail-creator-filter-tab",function(){if(jQuery(this).hasClass("tb-thumbnail-creator-filter-tab-disabled")){return}var e=jQuery(this).attr("data-tab-id");jQuery(".tb-thumbnail-creator-filter-tab").removeClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab").addClass("tb-thumbnail-creator-filter-tab-inactive");switch(e){case"opacity":{jQuery(".tb-thumbnail-creator-filter-tab-opacity").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-opacity").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-opacity").removeClass("tb-hid");break}case"brightness":{jQuery(".tb-thumbnail-creator-filter-tab-brightness").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-brightness").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-brightness").removeClass("tb-hid");break}case"contrast":{jQuery(".tb-thumbnail-creator-filter-tab-contrast").addClass("tb-thumbnail-creator-filter-tab-active");jQuery(".tb-thumbnail-creator-filter-tab-contrast").removeClass("tb-thumbnail-creator-filter-tab-inactive");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container-contrast").removeClass("tb-hid");break}}return false});jQuery(document).on("click",".tb-thumbnail-creator-layer-option",function(e){Ue()});jQuery(document).on("click","#tb-thumbnail-creator-set-opacity",function(){jQuery(".tb-thumbnail-creator-filter-container-opacity").removeClass("tb-hid")});jQuery(document).on("click","#tb-thumbnail-creator-set-brightness",function(){jQuery(".tb-thumbnail-creator-filter-container-brightness").removeClass("tb-hid")});jQuery(document).on("click","#tb-thumbnail-creator-set-contrast",function(){jQuery(".tb-thumbnail-creator-filter-container-contrast").removeClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-shadow",function(){var e=ie();var t=jQuery(this).attr("data-shadow-color");if(e.shadow&&e.shadow.color==t){e.setShadow({color:null,blur:0,offsestX:0,offsetY:0});jQuery(this).removeClass("tb-thumbnail-creator-format-btn--active").focusout()}else{e.setShadow({color:t,blur:20,offsestX:-3,offsetY:-3});jQuery(".tb-thumbnail-creator-shadow").removeClass("tb-thumbnail-creator-format-btn--active");jQuery(this).addClass("tb-thumbnail-creator-format-btn--active")}n.renderAll()});jQuery(document).on("click",".tb-thumbnail-creator-image-tab",function(){var e=jQuery(this).attr("data-tab-id");switch(e){case"custom":{jQuery(".tb-thumbnail-creator-image-tab-custom").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-image-tab-stock").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-brandings-container").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-brandings-container-stock").addClass("tb-hid");break}case"stock":{jQuery(".tb-thumbnail-creator-image-tab-stock").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-image-tab-custom").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-brandings-container").addClass("tb-hid");jQuery("#tb-thumbnail-creator-brandings-container-stock").removeClass("tb-hid");break}}return false});jQuery(document).on("click",".tb-thumbnail-creator-image-tab-emoji",function(){var e=jQuery(this).attr("data-tab-id");jQuery(".tb-thumbnail-creator-image-tab-emoji").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(this).addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-creator-emoji-container").hide();jQuery(".tb-thumbnail-creator-emoji-container-"+e).show();V(e);return false});jQuery(document).on("click",".tb-thumbnail-creator-upgrade-license",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.thumbnails)});jQuery(document).on("click",".tb-thumbnail-creator-border",function(){if(!TBGlobal.CanAccessLevel1Tools()){return}var e=jQuery(this)[0];var t=e.getAttribute("src");var i=new Image;i.crossOrigin="Anonymous";i.src=t;i.onerror=function(){TBUtilities.LogError("Error loading image from ",t+" - TubeBuddyThumbnailGenerator [border image click]")};i.onload=function(){var e=new fabric.Image(i);n.add(e);var t=720/e.height;e.set({left:0,top:0,scaleY:t,scaleX:t});e.set({opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});e.setCoords();e.id="frame";n.bringToFront(e);n.renderAll();var a=L();jQuery.each(a,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e);je();jQuery(".tb-thumbnail-creator-back").click();n.renderAll()};jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("click",".tb-thumbnail-creator-branding-stock",function(){var e=jQuery(this)[0];var t=e.getAttribute("src");var i=new Image;i.crossOrigin="Anonymous";i.src=t;i.onerror=function(){TBUtilities.LogError("Error loading image from "+t+" - TubeBuddyThumbnailGenerator [branding image click]")};i.onload=function(){var e=new fabric.Image(i);n.add(e);if(e.width>1280&&e.height>720){var t=1280/e.width;var a=720/e.height;e.set({left:n.width/2,top:n.height/2,scaleY:a,scaleX:a})}else{e.set({left:n.width/2,top:n.height/2,scaleY:2,scaleX:2})}e.set({opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});e.setCoords();n.bringToFront(e);n.renderAll();je();var r=L();jQuery.each(r,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e);n.renderAll()};jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("click",".tb-branding-image",function(){var e=jQuery(this)[0];var t=e.getAttribute("data-branding-id");var i;var a=false;if(t){var r=TBUtilities.GetInArray(s,"Id",t);i=r.Image}else{a=true;i=b}fabric.Image.fromURL(i,function(e){e.id=t;n.add(e);e.set({opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});var i=e.width;var a=e.height;if(i>1280&&a>720){var r=1280/e.width;var o=720/e.height;e.set({scaleY:o,scaleX:o})}n.bringToFront(e);n.renderAll();var s=L();jQuery.each(s,function(t,i){e.filters.push(i)});e.applyFilters(n.renderAll.bind(n));n.setActiveObject(e);je();e.setCoords()},{crossOrigin:"anonymous",padding:5});n.renderAll();jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");return false});jQuery(document).on("keyup","#tb-thumbnail-creator-text",function(){var e=ie();if(e&&e.type=="i-text"){e.set("text",jQuery(this).val());n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-backgroundSelect-stock-image",function(){var e=jQuery(this).attr("data-src-url");var t=jQuery(this).attr("id");var i=jQuery(this).attr("data-image-type");if(e){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src",e);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-standard");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-type");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type",i);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-uploaded-id");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width(640);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height(360);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-height");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeAttr("data-image-width");switch(i){case"uploaded":{jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width("");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height("");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-uploaded-id",t);var a=new Image;a.onload=function(){var e=this.width;var t=this.height;jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-height",t);jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-width",e);if(e>640){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").width(640)}else if(t>360){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").height(360)}};a.src=e;break}case"stock":{jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");break}case"thumbnail":{jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");var r=jQuery(this).attr("data-standard");if(typeof r!==typeof undefined&&r!==false){jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-standard",r);if(r=="true"){jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("style","width:640;height:360px;cursor: pointer; background-size:cover;background-position:center;background-image:url("+e+"?"+(new Date).getTime()+")")}else{jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("style","width:1280px;height:319px;cursor: pointer; background-size:cover;background-position:center;background-image:url("+e+"?"+(new Date).getTime()+")")}}break}}}});jQuery(document).on("click",".tb-thumbnail-creator-step4-success-download",function(){TBUtilities.ReportProductEvent("Thumbnail Generator Download Thumbnail",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),applied:true});try{n.setZoom(1);n.setWidth(1280);n.setHeight(720);n.renderAll();var e=document.createElement("a");var i=n.toDataURL("image/png");var a=_(i.replace(/^data:image\/(png|jpg);base64,/,""));var r=URL.createObjectURL(a);e.download=t+".png";e.innerHTML="download";e.href=r;e.setAttribute("type","hidden");document.body.appendChild(e);e.click();e.remove()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] download click"})}finally{n.setZoom(n.getZoom()/2);n.setWidth(640);n.setHeight(360);n.renderAll()}});jQuery(document).on("click",".tb-thumbnail-creator-step4-success-download-upgrade-link",function(){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.thumbnails)});jQuery(document).on("click",".tb-thumbnail-creator-save-template",function(){if(TBGlobal.CanAccessLevel1Tools()){let o=window.prompt("What would you like the name of the template to be?","My Thumbnail Template");if(o!=null){TBUtilities.ReportProductEvent("Thumbnail Generator Save Layers as Template",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),used:true});var e=new fabric.Canvas("tb-thumbnail-canvas-clone");n.forEachObject(function(t){if(t.id!="background"&&t.id!="grid"){t.zindex=n.getObjects().indexOf(t);TBUtilities.Log(t.zindex);var i=fabric.util.object.clone(t);e.add(i)}});e.renderAll();var i=JSON.stringify(e.toJSON(["zindex"]));TBUtilities.Log("[TubeBuddyThumbnailGenerator] templateAsJson",i);var a=TBGlobal.host+TBGlobal.apiUrls.thumbnailAddTemplate;var r={Template:i,Name:o,IsHighRes:true};TBExtension.Post(a,JSON.stringify(r),function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Post Template",i);Te()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Save Template"})}},null,{contentType:"application/json"})}}else{TBGlobal.ShowUpgradePage("save Thumbnail Templates","thumbnailgenerator")}});jQuery(document).on("click",".tb-thumbnail-creator-canvastemplate-container",function(){var e=jQuery(this).attr("data-template-id");if(e){var t=TBUtilities.GetInArray(g,"Id",e);if(t){var i='<span class="tb-spinner"></span>'+'<span style="margin-left:10px; font-size: 130%">Loading Template...</span>';jQuery("#tb-thumbnail-creator-step2").block({message:i,css:{padding:"30px 20px;",border:"2px solid #77889",backgroundColor:"transparent"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var a=TBGlobal.host+TBGlobal.apiUrls.thumbnailGetTemplate+"?id="+t.Id;TBExtension.Get(a,function(e,t,i){if(e===true){var a=jQuery.parseJSON(i.Template);var r=a.objects.length;var o=0;var s=new Array;var l=new fabric.Canvas("tb-thumbnail-canvas-clone");l.loadFromJSON(i.Template,l.renderAll.bind(l),function(e,t){o++;l.renderAll();var a=fabric.util.object.clone(t);s.push(a);if(o>=r){function u(e,t){if(e.zindex&&t.zindex){return parseInt(e.zindex)-parseInt(t.zindex)}}s.sort(u);jQuery.each(s,function(e,t){if(i.IsHighRes==false){t.set({top:t.getTop()*2,left:t.getLeft()*2,scaleY:t.getScaleY()*2,scaleX:t.getScaleX()*2})}t.set({transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.add(t)});n.renderAll();je();n.forEachObject(function(e){if(e.type==="image"&&e.filters.length){e.applyFilters(function(){e.canvas.renderAll()})}})}})}else{TBUtilities.Alert("There was an error retrieving the template... Please try again.")}jQuery("#tb-thumbnail-creator-step2").unblock()},null,{dataType:"json"})}}});jQuery(document).on("click",".tb-thumbnail-creator-canvastemplate-delete",function(e){e.stopPropagation();var t=jQuery(this).attr("data-template-id");TBUtilities.Confirm("Are you sure you want to delete this template?",function(){try{if(t){var e=TBGlobal.host+TBGlobal.apiUrls.thumbnailDeleteTemplate;var i={Id:t};TBExtension.Post(e,JSON.stringify(i),function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Delete Template",i);Te()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Delete Template"})}},null,{contentType:"application/json"})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] delete template click"})}},function(){})});jQuery(document).on("change","#tb-thumbnail-creator-picker-shapes",function(){var e=ie();if(e){var t=e.datashapetype;var i=e.get("type");switch(i){case"line":{e.setStroke(oe());n.renderAll();break}case"group":{var a=e.getObjects();jQuery.each(a,function(e,t){switch(t.get("type")){case"triangle":{t.set("fill",oe());break}case"line":{t.set("stroke",oe());break}}});n.renderAll();break}case"triangle":case"rect":case"circle":case"arrow":case"polygon":{if(t&&t.indexOf("outline")!=-1){e.set("stroke",oe())}else{e.set("fill",oe())}n.renderAll();break}}}});jQuery(document).on("click",".tb-thumbnail-creator-layer-shape",function(){var e=jQuery(this).attr("data-shape-type");if(!e){TBUtilities.Alert("Please select a shape to add");return}switch(e){case"rectangle":{n.add(new fabric.Rect({left:n.width/2,top:n.height/2,fill:oe(),width:200,height:200,opacity:ne(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"circle":{n.add(new fabric.Circle({left:n.width/2,top:n.height/2,fill:oe(),radius:100,opacity:ne(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"line":{n.add(new fabric.Line([200,200,400,400],{left:n.width/2,top:n.height/2,stroke:oe(),datashapetype:e,strokeWidth:10,opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"triangle":{n.add(new fabric.Triangle({left:n.width/2,top:n.height/2,fill:oe(),width:200,height:200,opacity:ne(),datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"star":{var t=D(5,100,50);var i=new fabric.Polygon(t,{fill:oe(),left:n.width/2,top:n.height/2,datashapetype:e,opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"},false);n.add(i);break}case"rectangle-outline":{n.add(new fabric.Rect({left:n.width/2,top:n.height/2,fill:"transparent",width:200,height:200,opacity:ne(),stroke:oe(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"circle-outline":{n.add(new fabric.Circle({left:n.width/2,top:n.height/2,fill:"transparent",radius:100,opacity:ne(),stroke:oe(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"triangle-outline":{n.add(new fabric.Triangle({left:n.width/2,top:n.height/2,width:200,height:200,opacity:ne(),fill:"transparent",stroke:oe(),strokeWidth:15,datashapetype:e,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"}));break}case"star-outline":{var t=D(5,100,50);var i=new fabric.Polygon(t,{left:n.width/2,top:n.height/2,fill:"transparent",stroke:oe(),strokeWidth:15,datashapetype:e,opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"},false);n.add(i);break}case"arrow":{var a=[50,100,200,200];var r=N(a);var o=W(a);var s=new fabric.Group([r,o]);s.setControlVisible("tr",false);s.setControlVisible("tl",false);s.setControlVisible("br",false);s.setControlVisible("bl",false);s.setControlVisible("ml",false);s.setControlVisible("mr",false);s.set({opacity:ne(),transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.add(s);break}}je();jQuery(".tb-thumbnail-creator-layer-shape-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape").removeClass("tb-thumbnail-creator-layer-shape-selected");jQuery(".tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container-opacity").addClass("tb-hid")});jQuery(document).on("click",".tb-thumbnail-creator-branding-stock-emoji",function(){T=jQuery(this).attr("src");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),function(e,t){TBUtilities.Log("[TubeBuddyThumbnailGenerator] GetRecentEmoji response: "+t);var i=new Array;if(t){i=JSON.parse(t)}if(i.indexOf(T)==-1){i.unshift(T)}i=i.slice(0,7);TBExtension.SetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),JSON.stringify(i),"");TBExtension.GetDbValue("tb-thumbnail-creator-"+TBGlobal.CurrentChannelId(),function(e,t){TBUtilities.Log("[TubeBuddyThumbnailGenerator] ReadRecentEmoji response: "+t);var i=new Array;if(t){i=JSON.parse(t)}if(i.length>0){jQuery(".tb-thumbnail-creator-layer-emoji-recent-container").show();jQuery(".tb-thumbnail-creator-layer-emoji-recent").empty();jQuery(".tb-thumbnail-creator-emoji-container").removeClass("tb-thumbnail-creator-emoji-container--no-recent");jQuery.each(i,function(e,t){var i=t;var a='<img crossorigin="anonymous" class="tb-thumbnail-creator-branding-stock tb-thumbnail-creator-branding-stock-emoji" src='+i+" />";jQuery(".tb-thumbnail-creator-layer-emoji-recent").append(DOMPurify.sanitize(a,DOMPurifyConfig))})}else{jQuery(".tb-thumbnail-creator-emoji-container").addClass("tb-thumbnail-creator-emoji-container--no-recent")}})})});jQuery(document).on("click",".tb-thumbnail-generator-grid-toggle",function(){if(!k){k=true;jQuery(this).text("Hide Grid");jQuery(".tb-thumbnail-generator-grid-options-container").css("left",jQuery(this).position().left).fadeIn();P()}else{k=false;jQuery(this).text("Show Grid");jQuery(".tb-thumbnail-generator-grid-options-container").fadeOut();M()}});jQuery(document).on("change",'input[type=radio][name="tb-thumbnail-generator-grid-color"]',function(){var e=jQuery(this).val();if(e=="light"){B="#fff"}else{B="#000"}M();C=null;P()})};var P=function(){if(!C){var e=80;var t=[];for(var i=0;i<640*2/e;i++){t.push(new fabric.Line([i*e,0,i*e,360*2],{stroke:B,selectable:false}))}for(var i=0;i<360*2/e;i++){t.push(new fabric.Line([0,i*e,640*2,i*e],{stroke:B,selectable:false}))}C=new fabric.Group(t);C.id="grid";C.lockMovementX=true;C.lockMovementY=true;C.selectable=false}if(n.getObjects().filter(e=>e.id=="grid").length==0){n.add(C)}var a=null;var r=null;var o=n.getObjects();for(var i=0;i<o.length;i++){if(o[i].id=="background"){a=o[i]}else if(o[i].id=="frame"){r=o[i]}}if(r){var s=n.getObjects().indexOf(r);n.moveTo(C,s+1)}else if(a){var l=n.getObjects().indexOf(a);n.moveTo(C,l+1)}else{C.sendToBack()}n.observe("object:moving",Be)};var M=function(){n.remove(C);n.stopObserving("object:moving",Be)};var V=function(e){if(jQuery(".tb-thumbnail-creator-emoji-container-"+e).find(".tb-thumbnail-creator-branding-stock-emoji").length==0){var t="";switch(e){case"people":{t=O(1,1011,e);t+=O(2508,2666,e);break}case"activity":{t=O(1276,1620,e);break}case"flags":{t=O(2198,2464,e);break}case"food":{t=O(1177,1275,e);break}case"nature":{t=O(1012,1176,e);break}case"symbols":{t=O(1925,2197,e);t+=O(2465,2465,e);t+=O(2469,2469,e);t+=O(2498,2507,e);break}case"travel":{t=O(1621,1740,e);break}case"objects":{t=O(1741,1924,e);break}}jQuery(".tb-thumbnail-creator-emoji-container-"+e).empty();jQuery(".tb-thumbnail-creator-emoji-container-"+e).append(DOMPurify.sanitize(t,DOMPurifyConfig))}};var O=function(e,t,i){var a="";for(var r=e;r<=t;r++){var o='<img crossorigin="anonymous" class="tb-thumbnail-creator-branding-stock tb-thumbnail-creator-branding-stock-emoji" data-loaded="0" src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/'+i+"/"+r+'.png" />';a+=o}return a};var D=function(e,t,i){var a=Math.PI/2*3;var r=t;var o=t;var n=Math.PI/e;var s=[];var l=0;for(var u=0;u<e;u++){var c=r+Math.cos(l)*t;var d=o+Math.sin(l)*t;s.push({x:c,y:d});l+=n;c=r+Math.cos(l)*i;d=o+Math.sin(l)*i;s.push({x:c,y:d});l+=n}return s};var F=function(e){var t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),r=a.length,o=new Uint8Array(r);while(r--){o[r]=a.charCodeAt(r)}return new Blob([o],{type:i})};var _=function(e,t,i){t=t||"";i=i||512;var a=atob(e);var r=[];for(var o=0;o<a.length;o+=i){var n=a.slice(o,o+i);var s=new Array(n.length);for(var l=0;l<n.length;l++){s[l]=n.charCodeAt(l)}var u=new Uint8Array(s);r.push(u)}var c=new Blob(r,{type:t});return c};var N=function(e){var t=60,i=e[0],a=e[1],r=e[2],o=e[3],n=r-i,s=o-a,l=Math.atan2(s,n);l*=180/Math.PI;l+=90;var u=new fabric.Triangle({angle:l,fill:oe(),top:o,left:r,height:t,width:t,originX:"center",originY:"center",transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});return u};var W=function(e){var t=new fabric.Line(e,{strokeWidth:7,stroke:oe(),originX:"center",originY:"center",lockScalingX:true,transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});t.setControlVisible("tr",false);t.setControlVisible("tl",false);t.setControlVisible("br",false);t.setControlVisible("bl",false);t.setControlVisible("ml",false);t.setControlVisible("mr",false);return t};var z=function(e){d=e;m=true;jQuery("#tb-thumbnail-creator-step1-complete").removeClass("tb-hid");H();jQuery(".tb-thumbnail-creator-bg-tabs-content").addClass("tb-hid");jQuery("#tb-thumbnail-bg-tab-header").find(".tb-thumbnail-creator-tabs-selected-menu-item").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-tab-"+d).removeClass("tb-hid");jQuery("#tb-tab-header-"+d).addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-backgroundSelect-still").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-color").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-stock").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").prop("disabled",false);jQuery(".tb-thumbnail-creator-next").removeClass("tb-thumbnail-creator-button-disabled");jQuery(".tb-thumbnail-creator-backgroundSelect-option-container").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-prompt").addClass("tb-hid");switch(e){case"still":{jQuery("#tb-thumbnail-creator-backgroundSelect-still").removeClass("tb-hid");c.playVideo();break}case"color":{jQuery(".tb-thumbnail-creator-backgroundSelect-color").removeClass("tb-hid");break}case"stock":{E();jQuery(".tb-thumbnail-creator-backgroundSelect-stock").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-stock-image").css("width","115px","height","64px");break}}};var H=function(){try{c.pauseVideo()}catch(e){}};var Y=function(){if(C)M();n.discardActiveObject();$(i);jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();document.getElementById("tb-thumbnail-fb-preview").innerHTML="";document.getElementById("tb-thumbnail-tw-preview").innerHTML="";var e=document.createElement("div");e.setAttribute("style","width:474px;height:268px; background-size:cover;background-position:center;background-image:url("+n.toDataURL("image/png")+")");document.getElementById("tb-thumbnail-fb-preview").appendChild(e);var t=document.createElement("img");t.setAttribute("src",n.toDataURL("image/png"));t.setAttribute("style","width:506px; border-radius:.85714em;");document.getElementById("tb-thumbnail-tw-preview").appendChild(t)};var $=function(e){jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").empty();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-loading").show();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-search").val(e);TubeBuddyYouTubeActions.GetVideoSearchResults(e,function(e){jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview-loading").hide();n.discardActiveObject();var a=jQuery("#tb-thumbnail-creator-video-template-this-video").html();var s=a.formatTemplate(t,"https://www.youtube.com/watch?v="+t,Le(i,45),o?o+" views":"",Le(TBGlobal.Profile().Title,45),"https://www.youtube.com/channel/"+TBGlobal.CurrentChannelId(),Le(r,200),n.toDataURL("image/png"));if(e!=null&&e.length>0){var l=jQuery("#tb-thumbnail-creator-video-template").html();jQuery.each(e,function(e,t){var i=l.formatTemplate(t.id,"https://www.youtube.com/watch?v="+t.id,Le(t.title,45),t.views,Le(t.channelName,30),t.channelUrl,Le(t.description,200));jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview:visible").append(DOMPurify.sanitize(i,DOMPurifyConfig))});jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(DOMPurify.sanitize(s,DOMPurifyConfig))}else{jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(DOMPurify.sanitize(s,DOMPurifyConfig));var u=jQuery("#tb-thumbnail-creator-video-template-no-videos").html();jQuery("#tb-thumbnail-settings-tab-youtube-competitors-preview").prepend(DOMPurify.sanitize(u,DOMPurifyConfig))}})};var q=function(e,a){TBUtilities.Log("[TubeBuddyThumbnailGenerator] - setStep");TBUtilities.Log("[TubeBuddyThumbnailGenerator] setting step: "+e);TBUtilities.Log("[TubeBuddyThumbnailGenerator] previousStep step: "+a);if(e!=1&&m==false){return}jQuery(".tb-thumbnail-settings-container").find(".tb-thumbnail-settings-tab").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step-tabs").find(".tb-tab-header").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-container").find(".subnav").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-options").addClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-option, .tb-thumbnail-creator-addlayer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-download-step3").hide();jQuery(".tb-thumbnail-publish-button-seo-studio").addClass("tb-hid");switch(e){case 1:{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="1"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");TBUtilities.ReportProductEvent("Thumbnail Generator Background Tab",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),background_type:d,used:true});jQuery("#tb-thumbnail-creator-step1").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").addClass("tb-hid");l=1;break}case 2:{try{if(a&&a==3){}else{Z()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] setbackground on page "+window.location.href});TBUtilities.Alert("There was a problem capturing a still image from your video.\n\nThis can happen if YouTube just finished processing a new upload.\n\nPlease try again in a couple minutes or select a different background type.");Ae();xe(true);q(1);return}jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="2"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-step2").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-next").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");jQuery(".tb-thumbnail-creator-all-layer-option").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-container-default").removeClass("tb-hid");je();TBUtilities.ReportProductEvent("Thumbnail Generator Layers Tab",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",timestamp:(new Date).toISOString(),used:true});if(k){jQuery(".tb-thumbnail-generator-grid-toggle").text("Hide Grid");jQuery(".tb-thumbnail-generator-grid-options-container").css("left",jQuery(".tb-thumbnail-generator-grid-toggle").position().left).fadeIn();P()}else{jQuery(".tb-thumbnail-generator-grid-toggle").text("Show Grid");jQuery(".tb-thumbnail-generator-grid-options-container").hide();M()}if(_seoStudioCallback){jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-publish-button-seo-studio").removeClass("tb-hid")}l=2;break}case 3:{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-step3").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step2-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-tab-header-preview").find(".tb-thumbnail-creator-tabs-menu-item-container").removeClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery("#tb-thumbnail-creator-preview-tab-header-youtube").addClass("tb-thumbnail-creator-tabs-selected-menu-item");jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();jQuery(".tb-thumbnail-creator-preview-video-title").text(i);l=3;TBUtilities.ReportProductEvent("Thumbnail Generator Thumbnail Previewed",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",items_added:x.toString(),timestamp:(new Date).toISOString(),used:true});Y();jQuery(".tb-thumbnail-settings-error-message").text("");jQuery(".tb-thumbnail-settings-error-container").hide();jQuery(".tb-thumbnail-settings-preview-container").show();if(v==true){jQuery(".tb-thumbnail-settings-tab-youtube").find(".yt-lockup-meta-info").hide()}if(TBGlobal.CanAccessLevel1Tools()){J()}break}case 4:{jQuery(".tb-thumbnail-creator-step4-publish-failed").hide();var r=window.location.href;if(r.indexOf("youtube.com/upload")>0||v==true||Q!==null){jQuery(".tb-thumbnail-creator-reload-container").addClass("tb-hid")}jQuery("#tb-thumbnail-creator-step3-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-container").find(".subnav").addClass("tb-hid");jQuery("#tb-thumbnail-creator-step3-complete").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-step4").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-previous").addClass("tb-hid");jQuery(".tb-thumbnail-creator-next").addClass("tb-hid");jQuery(".tb-thumbnail-creator-upload").addClass("tb-hid");l=4;break}}};var J=function(){jQuery(".tb-thumbnail-creator-download-step3").show()};var Z=function(){TBUtilities.Log("[TubeBuddyThumbnailGenerator] setBackground: "+d);if(y){n.remove(y);n.renderAll()}n.setZoom(1);switch(d){case"still":{H();c.setSize(1280,720);var e=TBGlobal.GetYouTubeUI();TBUtilities.Log("TBLayout - TBLoadLayoutTemplate YouTubeUI = "+e);var i=null;switch(e){case"material":case"default":{i=Ie();break}case"studio":{if(j==null){var a={};a.tbevent="ScreenCapRequest";var r=document.getElementById("screenshotPlayer");r.contentWindow.postMessage(a,"https://www.youtube.com");return}else{i=j;j=null}break}}try{if(TBGlobal.CanAccessLevel2Tools){var o={ImageData:i,ImageExt:"",VideoId:t};var s=TBGlobal.host+TBGlobal.apiUrls.brandingsAddStilFrameImage;TBExtension.Post(s,JSON.stringify(o),"",null,{contentType:"application/json"})}}catch(e){}fabric.Image.fromURL(i,function(e){e.setOptions({width:1280,height:720});n.add(e);y=e;y.id="background";y.sendToBack();y.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked");n.setZoom(n.getZoom()/2)},{crossOrigin:"anonymous"});break}case"color":{n.setZoom(n.getZoom()/2);H();var l=re();y=new fabric.Rect({width:1280,height:720,fill:l});n.add(y);y.sendToBack();y.id="background";y.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked");break}case"stock":{n.setZoom(n.getZoom()/2);var u=jQuery(".tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").first().attr("data-image-type");TBUtilities.Log("image type = "+u);switch(u){case"uploaded":{TBUtilities.Log("setting uploaded");stockImageSrc=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");var b=parseInt(jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-height"));var h=parseInt(jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-width"));TBUtilities.Log("image height ="+b);TBUtilities.Log("image width ="+h);var p=1280/h;var m=720/b;var f=document.getElementById("tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview-tag");var g=f.clientWidth;var v=f.clientHeight;fabric.Image.fromURL(stockImageSrc,function(e){e.set({scaleX:p,scaleY:p});n.add(e);y=e;y.id="background";y.sendToBack();y.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")},{crossOrigin:"anonymous"});break}case"stock":{TBUtilities.Log("setting stock");stockImageSrc=jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");var T=new Image;T.crossOrigin="Anonymous";T.src=stockImageSrc;T.onerror=function(){TBUtilities.LogError("Error loading image from ",+stockImageSrc+" - TubeBuddyThumbnailGenerator [stock background click]")};T.onload=function(){var e=new fabric.Image(T);e.set({width:1280,height:720});n.add(e);y=e;y.id="background";y.sendToBack();y.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")};break}case"thumbnail":{TBUtilities.Log("setting thumbnail");stockImageSrc=jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src");var Q=jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-standard");fabric.Image.fromURL(TBGlobal.host+TBGlobal.apiUrls.thumbnailGetImageFromUrl+"?url="+stockImageSrc+"&t"+(new Date).getTime()+"&standard="+Q,function(e){e.set({width:1280,height:720});n.add(e);y=e;y.id="background";y.sendToBack();y.selectable=!jQuery("#tb-thumbnail-creator-lockBackground").is(":checked")},{crossOrigin:"anonymous"});break}}break}}n.renderAll()};var X=function(){try{j=null;jQuery("#tb-thumbnail-creator-container").css("left","28%");jQuery(".tb-thumbnail-creator-step4-publish-failed").hide();TBGlobal.AddUserDebugInfo("Opening ThumbnailGenerator");jQuery('input[value="youtubecompetitor"]').prop("checked",true);jQuery(".tb-thumbnail-settings-tab-youtube-competitors").show();jQuery(".tb-thumbnail-settings-tab-twitter").hide();jQuery(".tb-thumbnail-settings-tab-facebook").hide();jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid");jQuery(".tb-thumbnail-settings-tab-video-title").text(i);jQuery(".tb-thumbnail-settings-tab-video-title").attr("title",i);jQuery(".tb-thumbnail-settings-tab-video-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery(".tb-thumbnail-settings-tab-video-by").text(TBGlobal.Profile().Title);jQuery(".tb-thumbnail-settings-tab-video-by").attr("href","https://www.youtube.com/channel/"+TBGlobal.CurrentChannelId());jQuery("#tb-thumbnail-creator-tw-preview-video-link").attr("href","https://youtu.be/"+t);jQuery("#tb-thumbnail-creator-tw-preview-video-link").text("youtu.be/"+t);jQuery(".tb-thumbnail-creator-image-tab-custom").click();Ae();d="default";m=false;jQuery("#tb-thumbnail-creator-step1-complete").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-backgroundSelect-option-prompt").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upload-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-uploading").addClass("tb-hid");jQuery(".tb-thumbnail-publish-button-seo-studio").addClass("tb-hid");jQuery("#tb-thumbnail-still-frame-background").addClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery(".tb-thumnail-creator-video-loading").removeClass("tb-hid");jQuery(".tb-thumnail-creator-video-loading").removeClass("tb-hid");jQuery("#screenshotPlayer").addClass("tb-hid");jQuery("#tb-thumbnail-creator-layer-template-upgrade").addClass("tb-hid");jQuery("#tb-thumbnail-thumbnail").attr("src",a);jQuery("#tb-thumbnail-title").attr("href","https://www.youtube.com/watch?v="+t);jQuery("#tb-thumbnail-title").text(i);jQuery(".tb-thumbnail-creator-next").prop("disabled",true);jQuery(".tb-thumbnail-creator-next").addClass("tb-thumbnail-creator-button-disabled");jQuery("#tb-thumbnail-creator-container").show();if(n){n.clear().renderAll()}else{n=new fabric.Canvas("tb-thumbnail-canvas",{preserveObjectStacking:true});n.observe("object:selected",ke);n.observe("selection:cleared",Qe);n.backgroundColor="black"}ge();q(1,0);jQuery("#tb-thumbnail-creator-picker-text").spectrum({color:"#F00",showInput:true,preferredFormat:"hex",replacerClassName:"tb-thumbnail-creator-text-fill-btn",containerClassName:"tb-thumbnail-creator-background-select-custom tb-thumbnail-creator-color-picker--shadow",appendTo:"#tb-thumbnail-creator-container"});jQuery("#tb-thumbnail-creator-picker-solidColor").spectrum({color:"#666",showInput:true,showButtons:false,flat:true,containerClassName:"tb-thumbnail-creator-background-select-custom",preferredFormat:"hex",appendTo:"#tb-thumbnail-creator-container",move:function(e){jQuery("#tb-thumbnail-creator-backgroundSelect-color-preview").css("background-color",e.toHexString())}});jQuery(".sp-dragger").css("top","5px").css("left","5px");jQuery("#tb-thumbnail-creator-picker-shapes").spectrum({showInput:true,color:"#FF0000",preferredFormat:"hex",replacerClassName:"tb-thumbnail-creator-shape-fill-btn",containerClassName:"tb-thumbnail-creator-background-select-custom tb-thumbnail-creator-color-picker--shadow",appendTo:"#tb-thumbnail-creator-container"});jQuery("#tb-thumbnail-creator-backgroundSelect-color-preview").css("background-color","#666");var e=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);if(e||t===null){jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').hide();jQuery(".tb-thumbnail-creator-still-loading").hide()}else{jQuery(".tb-thumbnail-creator-still-loading").show();jQuery("#tb-thumbnail-creator-still-option-label").html("Still frame from video");jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').show();xe(false)}if(v==true){jQuery('.tb-thumbnail-creator-setting-backgroundOption[data-type="still"]').hide();jQuery('#tb-thumbnail-creator-backgroundSelect option[value="still"]').hide();jQuery(".tb-thumbnail-creator-setting-backgroundOption-first-or").hide();jQuery(".tb-thumbnail-creator-still-loading").hide()}var r=TBGlobal.CurrentChannelId()+"-channelThumbnail";var o=lscache.get(r);if(o!=null){b=o;K(o)}else{TBYouTubeApi.GetChannelDetails(TBGlobal.CurrentChannelId(),"id,snippet",function(e){try{if(e){b=e.Snippet.Thumbnails.ThumbnailDefault;lscache.set(r,b,43800);K(b)}}catch(e){}},null)}ee();if(TBGlobal.CanAccessLevel1Tools()){ve();jQuery(".tb-thumbnail-creator-font-upgrade").addClass("tb-hid");jQuery(".tb-thumbnail-creator-font-upgraded").removeClass("tb-hid");te()}Te();var s=TBGlobal.Profile().TwitterAccounts;if(s&&s.length>0){jQuery("#tb-thumbnail-creator-tw-preview-twitter-name").text("@"+s[0].ScreenName);jQuery("#tb-thumbnail-creator-tw-preview-twitter-handle").text(s[0].Handle);jQuery("#tb-thumbnail-creator-tw-preview-avatar").attr("style","background-image: url("+s[0].ThumbnailUrl+")");jQuery("#tb-thumbnail-creator-tw-preview-avatar-placeholder").addClass("tb-hid")}var l=TBGlobal.Profile().FacebookAccounts;if(l&&l.length>0){jQuery("#tb-thumbnail-creator-fb-preview-fb-name").text(l[0].Name);jQuery("#tb-thumbnail-creator-fb-preview-avatar").attr("style","background-image: url("+l[0].ThumbnailUrl+")");jQuery("#tb-thumbnail-creator-fb-preview-avatar-placeholder").addClass("tb-hid")}jQuery("#tb-thumbnail-creator-backgroundSelect-stock-current-thumbnail").remove();jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").removeClass("tb-hid");jQuery("div.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").addClass("tb-hid");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("src","https://tubebuddy.s3-us-west-1.amazonaws.com/thumbnailgenerator/bg5-med.png");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("data-image-type","stock");jQuery("img.tb-thumbnail-creator-backgroundSelect-stock-preview-image-preview").attr("crossorigin","anonymous");jQuery("#tb-thumbnail-creator-abtestlink").attr("href",TBGlobal.host+"/channel/abtestcreate/"+TBGlobal.CurrentChannelId()+"?videoid="+t+"&videotitle="+i+"&videothumbnail="+encodeURI("https://img.youtube.com/vi/"+t+"/mqdefault.jpg"));if(v==false&&t!=null){TBYouTubeApi.GetVideoDetails(t,"snippet,contentDetails,statistics",fe)}if(_seoStudioCallback){jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').addClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-container").find('.tb-tab-header[data-tab-id="3"]').removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] prepareDialog"})}};var K=function(e){if(e&&jQuery("#tb-thumbnail-creator-brandings-container").find("#tb-thumbnail-creator-channelThumbnail").length==0){var t=jQuery("#tb-thumbnail-creator-brandingChannelImageTemplate").html();var i=t.formatTemplate("tb-thumbnail-creator-channelThumbnail",e);jQuery("#tb-thumbnail-creator-brandings-container").append(i);var a=jQuery("#tb-thumbnail-creator-brandings-container").find("#"+"tb-thumbnail-creator-channelThumbnail").first()[0];a.addEventListener("dragstart",TubeBuddyThumbnailGenerator.HandleDragStart,false);a.addEventListener("dragend",TubeBuddyThumbnailGenerator.HandleDragEnd,false)}};var ee=function(){WebFont.load({google:{families:["Permanent Marker","Archivo Black","Press Start 2P","Coda","Anton","Knewave"]}})};var te=function(){WebFont.load({google:{families:["Creepster","Black Ops One","Sigmar One","Luckiest Guy","Rubik Mono One"]}})};var ie=function(){return n._activeObject};var ae=function(){return jQuery("#tb-thumbnail-creator-picker-text").spectrum("get").toHexString()};var re=function(){return jQuery("#tb-thumbnail-creator-picker-solidColor").spectrum("get").toHexString()};var oe=function(){return jQuery("#tb-thumbnail-creator-picker-shapes").spectrum("get").toHexString()};var ne=function(){try{var e=jQuery(".tb-thumbnail-creator-opacity").val();return e*.01}catch(e){return 1}};var se=function(){try{var e=jQuery(".tb-thumbnail-creator-brightness").val();return Math.round(e)}catch(e){return 0}};var le=function(){try{var e=jQuery(".tb-thumbnail-creator-contrast").val();return Math.round(e)}catch(e){return 1}};var ue=function(e){try{jQuery(".tb-thumbnail-creator-opacity").val(e);be(ne())}catch(e){}};var ce=function(e){try{jQuery(".tb-thumbnail-creator-brightness").val(e);he(e)}catch(e){}};var de=function(e){try{jQuery(".tb-thumbnail-creator-contrast").val(e);pe(le())}catch(e){}};var be=function(e){try{var t=e*100;jQuery(".tb-thumbnail-creator-opacity-percentage").text(Math.round(t)+" %")}catch(e){}};var he=function(e){try{var t=0;var i=" ";if(e>0){t=Math.floor(e/255*100);i="+"+t+" %"}else if(e<0){t=Math.floor(e/-255*100);i="-"+t+" %"}else{i="0"}if(t==0){i="0"}jQuery(".tb-thumbnail-creator-brightness-display").text(i)}catch(e){}};var pe=function(e){try{var t=0;var i=" ";if(e>0){t=Math.floor(e/255*100);i="+"+t+" %"}else if(e<0){t=Math.floor(e/-255*100);i="-"+t+" %"}else{i="0"}if(t==0){i="0"}jQuery(".tb-thumbnail-creator-contrast-percentage").text(i)}catch(e){}};var me=function(){return jQuery(".tb-thumbnail-creator-font").val()};var ye=function(){var e=jQuery(".tb-thumbnail-creator-font-size").val();if(e){return parseInt(e)}else{return 12}};var fe=function(e){try{var t=jQuery("<img />");t.attr("class","tb-thumbnail-creator-backgroundSelect-stock-image tb-margin-bottom10 tb-margin-left5 tb-cursor-pointer");t.attr("style","width:115px;height:64px;");t.attr("src",e.snippet.thumbnails.thumbnailMedium+"?"+(new Date).getTime());t.attr("data-image-type","thumbnail");if(e.snippet.thumbnails.thumbnailStandard){t.attr("data-src-url",e.snippet.thumbnails.thumbnailStandard);t.attr("data-standard","true")}else{t.attr("data-src-url",e.snippet.thumbnails.thumbnailHigh);t.attr("data-standard","false")}t.attr("id","tb-thumbnail-creator-backgroundSelect-stock-current-thumbnail");jQuery("#tb-thumbnail-creator-backgroundSelect-upload").after(t);jQuery(".tb-thumbnail-settings-tab-video-description").html(DOMPurify.sanitize(e.snippet.description,DOMPurifyConfig));if(e.statistics.ViewCount){jQuery(".tb-thumbnail-settings-tab-video-views").text(TBUtilities.FormatNumberWithCommas(e.statistics.ViewCount)+" views")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] getVideoDetailsCallback"})}};var ge=function(){try{var e=TBGlobal.host+TBGlobal.apiUrls.brandingsGetAll;TBExtension.Get(e,function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Load Branding Images: "+e);jQuery(".tb-thumbnail-creator-uploading").addClass("tb-hid");if(e){jQuery("#tb-thumbnail-creator-brandings-container").find(".tb-thumbnail-creator-brandingImage-creator").remove();s=jQuery.parseJSON(i);if(TBGlobal.CanAccessLevel1Tools()==true){h=true;if(s.length>=20){p=true;h=false;jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").addClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").removeClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid")}}else if(TBGlobal.CanAccessLevel1Tools()==false){if(s.length<1){h=true}else{h=false}jQuery(".tb-thumbnail-creator-brandings-uploadEnabled").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-maxImages").addClass("tb-hid")}jQuery.each(s,function(e,t){var i=jQuery("#tb-thumbnail-creator-brandingImage").html();var a=i.formatTemplate(t.Id,t.Image);jQuery("#tb-thumbnail-creator-brandings-container").append(DOMPurify.sanitize(a,DOMPurifyConfig))})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadBrandings"})}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadBrandings"})}};var ve=function(e){try{var t=TBGlobal.host+TBGlobal.apiUrls.brandingsGetAllFonts;TBExtension.Get(t,function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Load Branding Fonts: "+e);if(e){var a=jQuery.parseJSON(i);jQuery.each(a,function(e,t){var i=jQuery(".tb-thumbnail-creator-font option[value='"+t.Name+"']").length;if(i==0){var a="font-family:"+t.Name;jQuery(".tb-thumbnail-creator-font option:first").before(jQuery("<option></option>").attr("value",t.Name).attr("style",a).text(t.Name));var r="font-family:'"+t.Name+"';";r=r+"src: url("+t.Font+") format('truetype')";var o=document.createElement("style");o.type="text/css";if(o.styleSheet){o.styleSheet.cssText="@font-face {"+r+"}"}else{o.appendChild(document.createTextNode("@font-face {"+r+"}"))}document.getElementsByTagName("head")[0].appendChild(o)}});if(t){jQuery(".tb-thumbnail-creator-font").val(t)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadBrandingsFonts"})}},e)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadBrandingFonts"})}};var Te=function(){try{if(TBGlobal.CanAccessLevel1Tools()){var e=TBGlobal.host+TBGlobal.apiUrls.thumbnailGetTemplateList;TBExtension.Get(e,function(e,t,i){try{TBUtilities.Log("[TubeBuddyThumbnailGenerator] Load Templates: "+e);jQuery(".tb-thumbnail-creator-layer-template-has").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-template-hasNone").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-template-has").html("");if(e){g=jQuery.parseJSON(i);if(g.length>0){jQuery(".tb-thumbnail-creator-layer-template-has").removeClass("tb-hid")}else{jQuery(".tb-thumbnail-creator-layer-template-hasNone").removeClass("tb-hid")}jQuery.each(g,function(e,t){var i=jQuery("#tb-thumbnail-creator-canvas-template-row").html();var a=i.formatTemplate(t.Id,Le(t.Name,30));jQuery(".tb-thumbnail-creator-layer-template-has").append(DOMPurify.sanitize(a,DOMPurifyConfig))})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadTemplates"})}},null)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] LoadTemplates"})}};var je=function(){if(n==null){jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",true);return}if(n.getObjects()==null){jQuery(".tb-thumbnail-creator-delete-all").addClass("tb-hid");return}var e=0;n.forEachObject(function(t){if(t.id=="background"){if(t.selectable==true){e++}}else{e++}});if(e==0){jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",true)}else{jQuery(".tb-thumbnail-creator-delete-all").attr("disabled",false)}};var Qe=function(e){jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-edit-toolbar").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid")};var ke=function(e){jQuery(".tb-thumbnail-creator-layer-selected-title").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-edit-toolbar").addClass("tb-hid");jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-add").removeClass("tb-thumbnail-creator-layer-add--active");jQuery(".tb-thumbnail-creator-shadow").removeClass("tb-thumbnail-creator-format-btn--active");if(e.target){var t=n._activeObject;var i=n._activeGroup;if(t){e.target.set({transparentCorners:false,cornerColor:"#4A90E2",borderColor:"white"});n.renderAll();jQuery(".tb-thumbnail-creator-layer-selected-title").removeClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-edit-toolbar").css("top","124px","left","164px");jQuery(".tb-thumbnail-creator-layer-edit-toolbar").removeClass("tb-hid");if(e.target.lockMovementY==true||e.target.lockMovementX==true){jQuery("#tb-thumbnail-creator-lockLayer").attr("checked",true);jQuery("#tb-thumbnail-creator-lockLayer-locked").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("data-is-locked",true);jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("title","unlock layer");jQuery("#tb-thumbnail-creator-lockLayer-locked").addClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-unlocked").removeClass("tb-hid")}else{jQuery("#tb-thumbnail-creator-lockLayer").attr("checked",false);jQuery("#tb-thumbnail-creator-lockLayer-unlocked").removeClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-toggle").removeAttr("data-is-locked");jQuery("#tb-thumbnail-creator-lockLayer-toggle").attr("title","lock layer");jQuery("#tb-thumbnail-creator-lockLayer-unlocked").addClass("tb-hid");jQuery("#tb-thumbnail-creator-lockLayer-locked").removeClass("tb-hid")}if(t&&t.shadow&&t.shadow.color!=null){jQuery("#tb-thumbnail-creator-shadow-"+t.shadow.color).addClass("tb-thumbnail-creator-format-btn--active")}try{if(t&&t.opacity){var a=t.opacity*100;ue(a)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] CanvasObjectSelected"})}Ce();var r=e.target.datashapetype;switch(e.target.type){case"i-text":{jQuery(".tb-thumbnail-creator-add-text").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-text-container").removeClass("tb-hid");jQuery("#tb-thumbnail-insert-text-button").addClass("tb-thumbnail-creator-layer-add--active");if(n._activeObject&&n._activeObject.stroke=="#000000"){jQuery(".tb-thumbnail-creator-outline").addClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-outline").removeClass("tb-thumbnail-creator-format-btn--active")}if(n._activeObject&&n._activeObject.stroke=="#FFFFFF"){jQuery(".tb-thumbnail-creator-outline-white").addClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-outline-white").removeClass("tb-thumbnail-creator-format-btn--active")}if(n._activeObject&&n._activeObject.fontWeight=="normal"){jQuery(".tb-thumbnail-creator-bold").removeClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-bold").addClass("tb-thumbnail-creator-format-btn--active")}if(e.target.getTextDecoration()!="underline"){jQuery(".tb-thumbnail-creator-underline").removeClass("tb-thumbnail-creator-format-btn--active")}else{jQuery(".tb-thumbnail-creator-underline").addClass("tb-thumbnail-creator-format-btn--active")}jQuery(".tb-thumbnail-creator-font").val(n._activeObject.fontFamily);jQuery("#tb-thumbnail-creator-text").val(n._activeObject.text);jQuery("#tb-thumbnail-creator-picker-text").spectrum("set",n._activeObject.fill);break}case"triangle":case"line":case"rect":case"circle":case"arrow":case"group":case"polygon":{jQuery("#tb-thumbnail-creator-shapes-selection").addClass("tb-hid");jQuery(".tb-thumbnail-creator-add-shape").addClass("tb-hid");jQuery(".tb-thumbnail-creator-layer-shape-container").removeClass("tb-hid");var o=n._activeObject.fill;if(r&&r.indexOf("outline")!=-1){o=e.target.getStroke()}jQuery("#tb-thumbnail-creator-picker-shapes").spectrum("set",o);break}case"image":{try{if(e.target.filters.length==0){ce(0);de(0);var s=L();jQuery.each(s,function(t,i){e.target.filters.push(i)});e.target.applyFilters(n.renderAll.bind(n))}jQuery.each(e.target.filters,function(e,t){if(typeof t.brightness!="undefined"){ce(t.brightness)}if(typeof t.contrast!="undefined"){de(t.contrast)}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] CanvasObjectSelected"})}we();break}}}else if(i){n._discardActiveGroup()}}};var Be=function(e){if(!k){return}else{var t=80;var i=e.target.getHeight();var a=e.target.getWidth();if(Math.round(e.target.left/t*4)%4==0&&Math.round(e.target.top/t*4)%4==0){e.target.set({left:Math.round(e.target.left/t)*t,top:Math.round(e.target.top/t)*t}).setCoords()}else if(Math.round((e.target.left+a)/t*4)%4==0&&Math.round(e.target.top/t*4)%4==0){e.target.set({left:Math.round((e.target.left+a)/t)*t-a,top:Math.round(e.target.top/t)*t}).setCoords()}else if(Math.round((e.target.left+a)/t*4)%4==0&&Math.round((e.target.top+i)/t*4)%4==0){e.target.set({left:Math.round((e.target.left+a)/t)*t-a,top:Math.round((e.target.top+i)/t)*t-i}).setCoords()}else if(Math.round(e.target.left/t*4)%4==0&&Math.round((e.target.top+i)/t*4)%4==0){e.target.set({left:Math.round(e.target.left/t)*t,top:Math.round((e.target.top+i)/t)*t-i}).setCoords()}else if(Math.round(e.target.top/t*4)%4==0){e.target.set({top:Math.round(e.target.top/t)*t}).setCoords()}else if(Math.round(e.target.left/t*4)%4==0){e.target.set({left:Math.round(e.target.left/t)*t}).setCoords()}else if(Math.round((e.target.left+a)/t*4)%4==0){e.target.set({left:Math.round((e.target.left+a)/t)*t-a}).setCoords()}else if(Math.round((e.target.top+i)/t*4)%4==0){e.target.set({top:Math.round((e.target.top+i)/t)*t-i}).setCoords()}}};var Ce=function(){jQuery("#tb-thumbnail-creator-set-brightness").attr("disabled","disabled");jQuery("#tb-thumbnail-creator-set-contrast").attr("disabled","disabled")};var we=function(){jQuery("#tb-thumbnail-creator-set-brightness").removeAttr("disabled");jQuery("#tb-thumbnail-creator-set-contrast").removeAttr("disabled")};var xe=function(e){jQuery("#screenshotPlayer").width(640).height(360);if(c&&e==false){try{c.setSize(640,360);jQuery(".tb-thumbnail-creator-still-loading").hide();jQuery(".tb-thumbnail-creator-still-loading").closest(".tb-thumbnail-creator-setting-backgroundOption").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery("#tb-thumbnail-still-frame-background").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");c.loadVideoById(t,0,"highres");H();Se()}catch(e){}}else{if(c){c.destroy()}c=new YT.Player("screenshotPlayer",{height:"360",width:"640",videoId:t,enablejsapi:true,playerVars:{showinfo:0,origin:window.location.href,html5:1,rel:0},events:{onReady:TubeBuddyThumbnailGenerator.OnPlayerReady,onStateChange:TubeBuddyThumbnailGenerator.OnPlayerStateChange,onPlaybackQualityChange:TubeBuddyThumbnailGenerator.OnPlayerPlaybackQualityChange}})}};var Ie=function(){jQuery("#screenshotPlayer").contents().find(".video-stream").attr("crossorigin","anonymous");var e=null;var t=jQuery("#screenshotPlayer").contents().find(".html5-main-video:first");var i=t[0];var a=jQuery("#tb-thumbnail-temp-canvas")[0];var r=a.getContext("2d");a.width=1280;a.height=720;r.fillRect(0,0,1280,720);r.drawImage(i,0,0,a.width,a.height);e=a.toDataURL();return e};var Ae=function(){jQuery("#tb-thumbnail-temp-canvas").remove();var e=document.createElement("canvas");e.id="tb-thumbnail-temp-canvas";e.style.display="none";var t=document.getElementById("tb-thumbnail-temp-canvas-container");t.appendChild(e)};var Se=function(){jQuery(".tb-thumnail-creator-video-loading").addClass("tb-hid");jQuery("#screenshotPlayer").removeClass("tb-hid")};var Ue=function(){jQuery(".tb-thumbnail-creator-filter-container").addClass("tb-hid")};var Le=function(e,t){if(e&&t){return e.length>t?e.substring(0,t-3)+"...":e}else{return""}};var Ge=function(){TubeBuddyYouTubeActions.GetChannelFeatureEligibility().then(function(e){try{const i=e.trustTiersStatus.featuresInfo.intermediateLevel;if(typeof i!=="undefined"&&i.status.toLowerCase().indexOf("unlocked")>-1){f=true;jQuery("#tb-thumbnail-creator-step1").show();jQuery(".tb-thumbnail-settings-container .tb-thumbnail-not-eligible").hide()}else{f=false;TBUtilities.Log("Thumbnails disabled");jQuery("#tb-thumbnail-creator-step1").hide();if(jQuery(".tb-thumbnail-settings-container .tb-thumbnail-not-eligible").length>0){jQuery(".tb-thumbnail-settings-container .tb-thumbnail-not-eligible").show()}else{var t="<div class='tb-thumbnail-not-eligible' style='text-align:center; margin-top:120px; margin-bottom:120px;'> <img src='"+TBGlobal.host+"/images/icons/error.png' /> <b style='color:coral; font-size:20px;'>Your channel does not have custom thumbnails enabled.</b><br/><br /><br><br/>You need to <a target='new' href='https://www.youtube.com/verify'>Verify</a> your channel in order to enable thumbnails.</div>";jQuery(".tb-thumbnail-settings-container").append(DOMPurify.sanitize(t,DOMPurifyConfig))}}}catch{f=true;TBUtilities.LogError({Exception:e,Location:"TubeBuddyThumbnailGenerator - TubeBuddyYouTubeActions.GetChannelFeatureEligibility response"})}}).catch(function(e){f=true;TBUtilities.LogError({Exception:e,Location:"TubeBuddyThumbnailGenerator - checkIfThumbnailsEnabled"})})};var Ee=function(){k=false;C=null;B=jQuery("#tb-thumbnail-generator-grid-dark").is(":checked")?"#000":"#fff";TBUtilities.ReportProductEvent("Thumbnail Generator Launched",{channel_id:TBGlobal.CurrentChannelId(),video_id:t,tool:"Thumbnail Generator",source:w,timestamp:(new Date).toISOString(),used:true});X()};return{Show:function(s,l,u,d,b,h,p){try{if(TBGlobal.IsAuthenticated()){t=s;i=l;a=u;r=d?d:"";o=b?b:"";v=false;_seoStudioCallback=null;w=p;TBGlobal.ClearUserDebugInfo();if(h){Q=h}else{Q=null}if(!e){I();R();e=true;if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{Ge()}}else{if(jQuery("#tb-thumbnail-creator-container").length===0){if(c){c.destroy();c=null}if(n){n.dispose();n=null}I()}else if(h){if(c){c.destroy();c=null}if(n){n.dispose();n=null}if(jQuery("#tb-thumbnail-creator-container").length>0)jQuery("#tb-thumbnail-creator-container").remove();I()}else{Ee();if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{Ge()}}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Show"})}},ShowForLiveStream:function(){try{if(TBGlobal.IsAuthenticated()){v=true;t=jQuery(".metadata-app[data-video-id]:first").attr("data-video-id");i=jQuery(".video-settings-title").val();_seoStudioCallback=null;TBGlobal.ClearUserDebugInfo();if(!e){I();R();e=true;Ge()}else{Ee();if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{Ge()}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] ShowForLiveStream"})}},ShowForSeoStudio:function(n,s,l,u,c,d){try{if(TBGlobal.IsAuthenticated()){t=n?n:null;i=s?s:null;a=l?l:null;r=u?u:"";o=c?c:"";v=false;_seoStudioCallback=d;w="SEO Studio";TBGlobal.ClearUserDebugInfo();if(!e){I();R();e=true;if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{Ge()}}else{Ee();if(TBGlobal.Profile().LegacyEnabled==true){f=true}else{Ge()}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyThumbnailGenerator] Show"})}},OnPlayerReady:function(e){jQuery(".tb-thumbnail-creator-still-loading").hide();jQuery(".tb-thumbnail-creator-still-loading").closest(".tb-thumbnail-creator-setting-backgroundOption").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");jQuery("#tb-tab-header-still").removeClass("tb-thumbnail-creator-setting-backgroundOption--disabled");e.target.setPlaybackQuality("hd720");Se()},OnPlayerStateChange:function(e){if(e.data==YT.PlayerState.BUFFERING){e.target.setPlaybackQuality("hd720")}},OnPlayerPlaybackQualityChange:function(e){var t=e.target.getPlaybackQuality();var i="hd720";TBUtilities.Log("Quality changed to: "+t);if(t!=="hd720"){TBUtilities.Log("Setting quality to "+i);e.target.setPlaybackQuality(i)}},GetVideoId:function(){return t},OnYouTubePlayerAPIReady:function(){u=true}}}();function onYouTubePlayerAPIReady(){TubeBuddyThumbnailGenerator.OnYouTubePlayerAPIReady()}(function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,a=t.Image.filters,r=t.util.createClass;a.Contrast=r(a.BaseFilter,{type:"Contrast",initialize:function(e){e=e||{};this.contrast=e.contrast||0},applyTo:function(e){var t=e.getContext("2d"),i=t.getImageData(0,0,e.width,e.height),a=i.data,r=259*(this.contrast+255)/(255*(259-this.contrast));for(var o=0,n=a.length;o<n;o+=4){a[o]=r*(a[o]-128)+128;a[o+1]=r*(a[o+1]-128)+128;a[o+2]=r*(a[o+2]-128)+128}t.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}});t.Image.filters.Contrast.fromObject=function(e){return new t.Image.filters.Contrast(e)}})(typeof exports!=="undefined"?exports:this);var TubeBuddySearchRanking=function(){var e=false;var t="";var i;var a;var r=[];var o=0;var n=0;var s=[];var l=0;var u=0;var c=false;var d=true;var b;var h;var p={id:"",term:"",rank:-1,date:""};var m=function(){var e=TBGlobal.host+"/ModuleManager/SearchRanking/SearchRanking?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/searchranking.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/searchranking.html"}TBExtension.Get(e,"CRTBLoadSearchRankingTemplate")};var y=function(e,i){var a=[];jQuery.each(e,function(e,i){var r={VideoId:t,SearchTerm:i.term,Id:i.id};a.push(r)});var r=jQuery.param({Rankings:a});var o=TBGlobal.host+TBGlobal.apiUrls.searchRankGetMostRecentBeforeToday;TBExtension.Post(o,r,"CRSearchRankingGetMostRecentBeforeToday",{isCustom:i},{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})};var f=function(e){var i=TBGlobal.host+TBGlobal.apiUrls.searchRankAddRankings;var a=new Date;var r=a.getDate();var o=a.getMonth()+1;var n=a.getFullYear();var s=[];jQuery.each(e,function(e,i){var a={SearchDate:n+"-"+o+"-"+r,VideoId:t,SearchTerm:i.term,Rank:i.rank};s.push(a)});var l=jQuery.param({Rankings:s});TBExtension.Post(i,l,"CRSearchRankingNOTUSED",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})};function g(e,t){if(jQuery(e).children("th").length>0){return 99}if(jQuery(e).children("td").eq(t).html().indexOf("blue-pen.png")>0)return 1;if(jQuery(e).children("td").eq(t).html().indexOf("blue-tag.png")>0)return 0;if(jQuery(e).children("td").eq(t).attr("data-rank")){return jQuery(e).children("td").eq(t).attr("data-rank")}return jQuery(e).children("td").eq(t).text()}function v(e){return function(t,i){var a=g(t,e),r=g(i,e);a=a.toString().replace("N/R",999);r=r.toString().replace("N/R",999);if(a=="-")a=0;if(r=="-")r=0;a=a.toString().replace("+","");r=r.toString().replace("+","");if(jQuery.isNumeric(a)&&jQuery.isNumeric(r)){return a-r}else{return a.localeCompare(r)}}}var T=function(){jQuery(document).on("click",".tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-search-ranking-container").hide();jQuery("#tb-search-ranking-selected-term-container").hide()});jQuery(document).on("click","th",function(){var e=jQuery("#tb-search-ranking-table").eq(0);var t=e.find("tr").toArray().sort(v(jQuery(this).index()));if(d==true){this.asc=true}else{this.asc=!this.asc}if(!this.asc){t=t.reverse()}for(var i=0;i<t.length;i++){e.append(t[i])}});jQuery(document).on("click",".tb-search-term-row",function(){var e=jQuery(this).attr("data-tag-id");var i=TBUtilities.GetInArray(r,"id",e);if(!i){i=TBUtilities.GetInArray(s,"id",e)}jQuery("#tb-search-ranking-selected-term-click").hide();jQuery("#tb-search-ranking-selected-term-container").show();jQuery("#tb-search-ranking-selected-term").text(i.term);jQuery("tr").removeClass("tb-search-rankings-selected-row");jQuery(this).addClass("tb-search-rankings-selected-row");jQuery("#tb-search-ranking-selected-term-link").attr("href","https://www.youtube.com/results?search_query="+TBUtilities.GetUrlEncoded(i.term));if(TBGlobal.CanAccessLevel1Tools()==true){jQuery("#tb-search-ranking-historical-loading").show()}jQuery("#tb-search-ranking-historical-graph").hide();var a=TBGlobal.host+TBGlobal.apiUrls.searchRankGetHistory;var o=jQuery.param({VideoId:t,Term:i.term});TBExtension.Post(a,o,"CRSearchRankingGetSearchRankHistory",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})});jQuery(document).on("keydown","#tb-search-ranking-input",function(e){if(e.keyCode==13){jQuery("#tb-search-ranking-insert").trigger("click")}});jQuery(document).on("click",".tb-search-rankings-delete-tag",function(e){var i=jQuery(this).attr("data-tag-id");var a=TBUtilities.GetInArray(s,"id",i);$row=this;TBUtilities.Confirm("Are you sure you want to stop tracking this Search Term on this video?",function(){var r=TBGlobal.host+TBGlobal.apiUrls.searchTermRemove;var o=jQuery.param({VideoId:t,Term:a.term});TBExtension.Post(r,o,"CRSearchRankingRemoveSearchTermDONOTHING",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery($row).closest("tr").remove();TBUtilities.RemoveFromArray(s,"id",i);e.stopPropagation()},function(){e.stopPropagation();return});e.stopPropagation()});jQuery(document).on("click","#tb-search-ranking-insert",function(){if(!jQuery("#tb-search-ranking-input").val()){TBUtilities.Alert("Please enter a Search Term to track");return}var e=TBUtilities.GetInArray(r,"term",jQuery("#tb-search-ranking-input").val().toLowerCase().trim());if(e){TBUtilities.Alert("The Search Term you entered is already being tracked");return}if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("add Custom Search Term",TBGlobal.limitation.searchRanking);return}var i=TBGlobal.host+TBGlobal.apiUrls.searchTermAddSearchTerm;var a=jQuery.param({VideoId:t,Term:jQuery("#tb-search-ranking-input").val().trim()});TBExtension.Post(i,a,"CRSearchRankingAddTerm",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})});jQuery(document).on("click",".tb-search-ranking-settings-upgrade-link",function(){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.searchRanking)})};var j=function(e){var t=e%10,i=e%100;if(t==1&&i!=11){return e+"st"}if(t==2&&i!=12){return e+"nd"}if(t==3&&i!=13){return e+"rd"}return e+"th"};var Q=function(){jQuery(document.body).on("CRTBLoadSearchRankingTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);A()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRTBLoadSearchRankingTemplate"})}});jQuery(document.body).on("CRSearchRankingAddTerm",function(e,i){try{if(i.success){var a=JSON.parse(i.response);if(a.Term=="TB_ERROR_SEARCH_TERM_EXISTS"){TBUtilities.Alert("The Search Term you entered is already being tracked for this video.");return}jQuery("#tb-search-ranking-input").val("");var r=C(a.Term,a.Id,null);w(r);l++;s.push(r);TubeBuddyYouTubeActions.GetVideoSearchRank(t,r.term,k,1,{id:r.id,isCustom:r.isCustom})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRSearchRankingGetTerms",function(e,i){try{if(i.success){var a=JSON.parse(i.response);l=a.length;jQuery.each(a,function(e,i){var a=C(i.Term,i.Id,null);s.push(a);w(a);TubeBuddyYouTubeActions.GetVideoSearchRank(t,a.term,k,1,{id:a.id,isCustom:a.isCustom})})}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRSearchRankingGetMostRecentBeforeToday",function(e,t){try{if(t.success){var i=r;if(t.data.isCustom==true){i=s}var a="<span class='tb-search-ranking-muted-text'>Does not show up in search results";var o="<span class='tb-search-ranking-muted-text'><span class='tb-search-ranking-bold-text'>{0}</span> in search results, {1}</span>";var n=JSON.parse(t.response);jQuery.each(i,function(e,t){var i=TBUtilities.GetInArray(n,"SearchTerm",t.term);var r=0;if(i){r=i.Rank}var s=t.rank;if(s==0){s=21}TBUtilities.Log(r,s,i);var l="";var u=0;if(r>0){if(r==s){l='<span> with <span class="tb-search-ranking-bold-text">no change</span> since last time.</span>'}else if(r<s){u=s-r;l='<span> which is <span class="tb-search-ranking-bold-text tb-search-ranking-red">'+u+'</span> position<span class="tb-search-ranking-s">s</span> worse than last time</span>'}else{u=r-s;l='<span> which is <span class="tb-search-ranking-bold-text tb-search-ranking-green">'+u+'</span> position<span class="tb-search-ranking-s">s</span> better than last time</span>'}}else{l="<span> with no history</span>"}var c="";if(t.rank==0){c=a}else{var d=j(t.rank);c=TBUtilities.ReplaceAll(o,"{0}",d,false,false);c=TBUtilities.ReplaceAll(c,"{1}",l,false,false)}jQuery(".rankDesc"+t.id).html(DOMPurify.sanitize(c,DOMPurifyConfig));var b=t.rank;if(t.rank==0){b="NA"}jQuery(".rankDesc"+t.id).attr("data-rank",b);if(u==1){jQuery(".rankDesc"+t.id).find(".tb-search-ranking-s").hide()}});try{TBUtilities.AddAction({SearchTermCount:r.length},TBUtilities.ActionTypes.SearchRanking_View,"searchranking")}catch(e){TBUtilities.LogError({Exception:e,Location:"[SearchRanking] [addAction]"})}if(t.data.isCustom==false&&c==false){c=true;jQuery(".tb-search-ranking-sort-rank").click()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingGetMostRecentBeforeToday"})}});jQuery(document.body).on("CRSearchRankingGetSearchRankHistory",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var a=false;if(i.length>=1){var r=[];var o=[];jQuery("#tb-search-rankings-start-date").text(i[0].SearchDateDisplay);jQuery.each(i,function(e,t){o.push(t.RankDisplay);r.push("");if(t.RankDisplay<21)a=true});if(i.length==1)jQuery.each(i,function(e,t){o.push(t.RankDisplay);r.push("")});var n={labels:r,datasets:[{label:"Position",fillColor:"rgba(108,200,97,.1)",strokeColor:"rgba(108,200,97,.8)",pointColor:"rgba(108,200,97,.8)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:o,minValue:0,min:0}]};if(a){jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").show();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-canvas").empty();jQuery("#tb-search-ranking-actual-chart").show();h=jQuery("#tb-search-ranking-canvas")[0].getContext("2d");if(b)b.destroy();b=new Chart(h).Line(n,{scaleShowHorizontalLines:false,showXLabels:parseInt(o/2.7)})}else{jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").show();jQuery("#tb-search-ranking-actual-chart").hide()}}else{jQuery("#tb-search-ranking-historical-graph").show();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").show();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-actual-chart").hide()}}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingGetSearchRankHistory"})}})};var k=function(e,t,i,a){if(i==-1){x()}if(a.isCustom==true){u++;var t=TBUtilities.GetInArray(s,"id",a.id);t.rank=i;if(u>=l){f(s);y(s,a.isCustom)}}else{n++;var t=TBUtilities.GetInArray(r,"id",a.id);t.rank=i;if(n>=o){f(r);y(r,a.isCustom)}}};var B=function(e){try{jQuery('[data-tbtooltip!=""]').qtip({content:{attr:"data-tbtooltip"},style:{classes:"qtip-youtube-tubebuddy"}});jQuery("#tb-search-ranking-loading").hide();if(TBGlobal.CanAccessLevel1Tools()==false){return}if(e.snippet.tags==null){jQuery("#tb-search-ranking-no-tags").show();return}if(e.snippet.tags.length==0){jQuery("#tb-search-ranking-no-tags").show();return}jQuery("#tb-search-rankings-ideas").css("display","inline-block");jQuery("#tb-search-ranking-head").css("display","flex");n=0;o=e.snippet.tags.length;jQuery.each(e.snippet.tags,function(e,i){var a=C(i,null,e);r.push(a);w(a);TubeBuddyYouTubeActions.GetVideoSearchRank(t,a.term,k,1,{id:a.id,isCustom:a.isCustom})})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoDetailsCallback"})}};var C=function(e,t,i){var a=true;var r=null;if(!t){a=false;r="tag"+i}else{a=true;r=t}var o={id:r,term:e,rank:0,isCustom:a};return o};var w=function(e){if(TBGlobal.CanAccessLevel1Tools()==false){return}var t='<img src="'+TBGlobal.host+'/images/icons/blue-pen.png" style="height:12px; width:12px;" />';if(e.isCustom==false){t='<img src="'+TBGlobal.host+'/images/icons/blue-tag.png" style="height:12px; width:12px;" />'}var i='<span class="tb-spinner tb-margin-right-5"></span>';var a=i;var r="<table>";r+='<tr data-tag-id="'+e.id+'" class="tb-search-term-row">';r+='<td style="width:37px; text-align:center;">'+t+"</td>";r+='<td style="width:100px; text-align:left;">'+e.term+(e.isCustom?'<img class="tb-search-rankings-delete-tag" data-tag-id="'+e.id+'" src="'+TBGlobal.host+'/images/icons/delete.png" style="height:8px; width:8px; padding-left:3px;" />':"")+"</td>";r+='<td class="tb-search-term-rank-cell rankDesc'+e.id+'">'+a+"</td>";r+="</tr></table>";r=DOMPurify.sanitize(r,DOMPurifyConfig);r=TBUtilities.ReplaceAll(r,"<html><head></head><body><table><tbody>","");r=TBUtilities.ReplaceAll(r,"</tbody></table></body></html>","");if(e.isCustom){jQuery("#tb-search-ranking-body").prepend(r)}else{jQuery("#tb-search-ranking-body").append(r)}};var x=function(){jQuery(".tb-search-ranking-error").show()};var I=function(e,t,i){try{jQuery("#tb-search-ranking-loading").hide();jQuery(".tb-search-ranking-settings-legacy-off").hide();jQuery(".tb-search-ranking-settings-container").show();if(true==true){r=[];if(TBGlobal.CanAccessLevel1Tools()==true){jQuery("#tb-search-ranking-loading").show()}jQuery("#tb-search-ranking-body").empty();jQuery("#tb-search-rankings-ideas").css("display","none");jQuery("#tb-search-ranking-head").css("display","none");jQuery("#tb-search-ranking-no-tags").hide();jQuery("#tb-search-ranking-video-thumbnail").attr("src",t);jQuery("#tb-search-ranking-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-search-ranking-video-link").text(i);jQuery("#tb-search-ranking-text").text("Pick a Winner")}else{jQuery(".tb-search-ranking-settings-container").hide();jQuery(".tb-search-ranking-settings-legacy-off").show()}r=[];o=0;n=0;s=[];l=0;u=0;c=false;d=true;jQuery("#tb-search-ranking-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){jQuery(".tb-search-ranking-settings-upgrade").show()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var A=function(){I(t,a,i);TBYouTubeApi.GetVideoDetails(t,"snippet",B);var e=TBGlobal.host+TBGlobal.apiUrls.searchTermGetForVideo+"?videoId="+t;TBExtension.Get(e,"CRSearchRankingGetTerms");jQuery("#tb-search-ranking-historical-graph").hide();jQuery("#tb-search-ranking-historical-loading").hide();jQuery("#tb-search-ranking-canvas-loading").hide();jQuery("#tb-search-ranking-canvas").hide();jQuery("#tb-search-ranking-no-history").hide();jQuery("#tb-search-ranking-no-rankings-ever").hide();jQuery("#tb-search-ranking-actual-chart").hide();jQuery("#tb-search-ranking-selected-term-click").show();jQuery(".tb-search-ranking-disclaimer").show()};return{Show:function(r,o,n){if(TBGlobal.IsAuthenticated()){t=r;i=n;a=o;if(!e){Q();m();T();e=true}else{A()}}}}}();var TubeBuddyStrategies=function(){var e=false;var t=false;var i="goalsList";var a=[];var r="";var o=[];var n="";var s=[];var l=0;var u=false;var c=false;var d=function(){jQuery("#tb-strategies-app").hide();jQuery(".tb__strategies__wrapper").hide();jQuery(".tb-strategies-view").hide();jQuery(".tb-strategies-settings").attr("href",TBGlobal.host+"/channel/preferences/"+TBGlobal.CurrentChannelId()+"?setting=strategies");var e=TBGlobal.Profile().LicenseType<23?TBGlobal.Profile().LicenseName:"Legend";jQuery(".tb-strategies-user-license-badge").attr("src",TBGlobal.host+"/images/modules/strategies/"+e.toLowerCase()+"-license.png").attr("title",e+" Badge");C().then(e=>{var i=TBGlobal.Profile().EnablePreview;i=false;if(i==true&&(!e||TBGlobal.Profile().SettingsShowStrategies==true)){w().then(i=>{t=i?i.showStrategies:false;var r="Start a Strategy";if(i){r="Resume Strategy"}else if(!e){r="Want to impmrove your channel?"}jQuery(".tb-strategies-btn-text").text(r);if(t||location.href.split("/")[2]=="studio.youtube.com"||b()||jQuery("#creator-page-sidebar").length>0)jQuery(".tb__strategies__wrapper").show();x().then(e=>{a=e;h()})})}})};var b=function(){if(location.href.indexOf("playlist")>-1){var e=jQuery("#upload-info #text > a").attr("href");if(e&&e.indexOf(TBGlobal.CurrentChannelId())>-1&&jQuery("#subscribe-button").length==0||location.href.indexOf("view_all_playlists?")>-1||jQuery('paper-button[aria-label="Customize channel"]').length>0||jQuery("#content>#description-form").length>0&&jQuery(".ytd-subscribe-button-renderer").length==0){return true}}else{return false}};var h=function(){if(t){w().then(function(e){if(e&&e.selectedStrategy&&!e.selectedStrategyCompleted){r=e.selectedGoal;n=e.selectedStrategy;l=e.scrollTop;y(e.selectedStrategy);jQuery(".tb-strategies-btn-text").text("Resume Strategy");jQuery("#tb-strategies-menu-button").fadeOut()}else if(e&&e.selectedStrategyCompleted){Q()}else{p();jQuery("#tb-strategies-menu-button").fadeOut()}})}else{jQuery("#tb-strategies-menu-button").fadeIn()}};var p=function(){i="goalsList";jQuery(".tb-strategies-hide-strategies").hide();jQuery(".tb-strategies-zoom-in, .tb-strategies-zoom-out").hide();jQuery("#tb-strategies-app").css("width","");jQuery("#tb-strategies-app").css("max-width","520px");if(jQuery("#tb-strategies-goals-list-container .tb-strategy-goal-item").length==0){var e=jQuery("#tb-strategies-goal-item-template").html();a.forEach(function(t){var i=e.formatTemplate(t.Title,t.Id,t.Image);jQuery("#tb-strategies-goals-list-container").append(DOMPurify.sanitize(i,DOMPurifyConfig))})}if(jQuery(".tb-strategies-view-goals-list:visible").length==0){jQuery(".tb-strategies-view").hide();k();jQuery(".tb-strategies-view-goals-list").fadeIn()}};var m=function(e){o=[];i="strategiesForGoal";r=e;var t=jQuery("#tb-strategies-for-goal-template").html();jQuery("#tb-strategies-for-goal-container").empty();jQuery(".tb-strategies-hide-strategies").hide();jQuery(".tb-strategies-zoom-in, .tb-strategies-zoom-out").hide();jQuery("#tb-strategies-app").css("width","");jQuery("#tb-strategies-app").css("max-width","520px");A(e.Id).then(function(i){o=i;o.forEach(function(e){var i=n&&n.Id==e.Id?"Continue":"Start";var a;if(e.License>21){a="Legend License Required."}else if(e.License>20){a="Star License Required."}else{a="Pro License Required."}var r=t.formatTemplate(e.Title,e.Description,e.Id,e.upgradeRequired?" tb-hid":"",i,e.upgradeRequired?"":" tb-hid",e.upgradeRequired?a:"",i.toLowerCase(),e.upgradeRequired?"tb-strategy-list-item-disabled":"");jQuery("#tb-strategies-for-goal-container").append(DOMPurify.sanitize(r,DOMPurifyConfig))});jQuery(".tb-strategies-page-title").text(e.Title);k();jQuery(".tb-strategies-view").hide();jQuery(".tb-strategies-view-strategies-for-goal").fadeIn()})};var y=function(e){if(!e.upgradeRequired){if(n&&n.Id!=e.Id||!n){l=0}n=e;t=true;f();i="strategy";var a=jQuery("#tb-strategies-strategy-step-template").html();jQuery(".tb-strategies-hide-strategies").show();jQuery(".tb-strategies-zoom-in, .tb-strategies-zoom-out").show();jQuery(".tb-strategies-open-full-link").attr("href",TBGlobal.host+"/strategy/"+e.Id);jQuery("#tb-strategies-steps-container").empty();jQuery(".tb-strategies-btn-text").text("Resume Strategy");S(e.Id).then(function(e){s=e;s.forEach(function(e){var t=a.formatTemplate(e.StepNumber,e.Body);jQuery("#tb-strategies-steps-container").append(DOMPurify.sanitize(t,DOMPurifyConfig))});jQuery(".tb-strategies-page-title").text(B(n.Title,65));jQuery(".tb-strategies-page-title").attr("title",n.Title);jQuery(".tb-strategy-step-list-desc").text(n.Description);k();jQuery(".tb-strategies-view").hide();c=true;jQuery(".tb-strategies-view-strategy").fadeIn(400,"linear",function(){jQuery(".tb-strategy-step-list").scrollTop(l);setTimeout(function(){c=false},1e3)});jQuery(".tb-strategy-item img").attr("data-action","zoom");TBExtension.GetDbValue("tb-strategy-size-settings-"+TBGlobal.CurrentChannelId(),function(e,t){if(t){var i=JSON.parse(t);jQuery("#tb-strategies-app").width(i.appContainerWidth);jQuery("#tb-strategies-app").css("max-width",i.appContainerWidth);jQuery(".tb-strategy-item img").width(i.imageWidth);jQuery(".tb-strategy-step-list").height(i.stepListHeight)}})})}else{return}};var f=function(){var e={selectedStrategy:n,selectedGoal:r,scrollTop:l?l:0,showStrategies:t,selectedStrategyCompleted:u};if(n){TBExtension.SetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-current-strategy-info",JSON.stringify(e),function(e,t){TBUtilities.Log("Current strategy saved: "+t)})}};var g=function(e){if(!c){l=e.target.scrollTop;f()}};var v=function(){t=false;if(i=="strategy")f();i="goalsList";jQuery("#tb-strategies-app").fadeOut(100);if(location.href.split("/")[2]=="studio.youtube.com"||jQuery("#creator-page-sidebar").length>0||b())jQuery("#tb-strategies-menu-button").fadeIn(500)};var T=function(){n="";s=[];l=0;u=false;r=""};var j=function(){jQuery(".tb-strategies-btn-text").text("Start a Strategy");T();w().then(e=>{if(e){TBExtension.RemoveDbValue("tb-"+TBGlobal.CurrentChannelId()+"-current-strategy-info");if(i!="strategy"){v()}}else{v()}});p()};var Q=function(){jQuery(".tb-strategies-btn-text").text("Start a Strategy");T();w().then(e=>{if(e)TBExtension.RemoveDbValue("tb-"+TBGlobal.CurrentChannelId()+"-current-strategy-info")})};var k=function(){if(!jQuery("#tb-strategies-app").is(":visible"))jQuery("#tb-strategies-app").show();if(jQuery("#tb-strategies-menu-button").is(":visible"))jQuery("#tb-strategies-menu-button").fadeOut()};var B=function(e,t){if(!e){return""}else if(e.length<t){return e}else{return e.slice(0,t-1)+"..."}};var C=function(){return new Promise(function(e){TBExtension.GetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-strategies-loaded",function(t,i){if(i){e(i)}else{e(false)}})})};var w=function(){return new Promise(function(e){TBExtension.GetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-current-strategy-info",function(t,i){if(i){e(JSON.parse(i))}else{e(false)}})})};var x=function(){return new Promise(function(e,t){TBExtension.Get(TBGlobal.host+TBGlobal.apiUrls.strategiesGetAllGoals,function(i,a,r){try{if(i){e(JSON.parse(r))}else{t()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] getStrategyGoals"});t()}},null,{contentType:"application/json",dataType:"text"})})};var I=function(e){switch(e){case 0:return"Starter";break;case 20:return"Pro";break;case 21:return"Star";break;case 22:return"Legend";break;default:return"Starter"}};var A=function(e){return new Promise(function(t,i){if(e!=null){TBExtension.Get(TBGlobal.host+TBGlobal.apiUrls.strategiesGetStrategiesByGoalId+"?goalId="+e,function(e,a,r){try{if(e){var o=TBGlobal.Profile().LicenseType;var n=JSON.parse(r);if(n.length>0){n.forEach(function(e){e.upgradeRequired=e.License>o;e.licenseLabel=I(e.License)})}t(n)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] getStrategiesByGoalId"});i()}},null,{contentType:"application/json",dataType:"text"})}else{i()}})};var S=function(e){return new Promise(function(t,i){if(e!=null){TBExtension.Get(TBGlobal.host+TBGlobal.apiUrls.strategiesGetStrategyById+"?id="+e,function(e,a,r){try{if(e){t(JSON.parse(r))}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] getStrategyById"});i()}},null,{contentType:"application/json",dataType:"text"})}else{i()}})};var U=function(){var e=TBGlobal.host+"/ModuleManager/strategies/strategies?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/strategies.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/strategies.html"}TBExtension.Get(e,"CRTBLoadStrategiesTemplate")};var L=function(e){var t={Enabled:e};TBUtilities.Log(t);var i=TBGlobal.host+TBGlobal.apiUrls.youtubeChannelToggleStrategies;TBExtension.Post(i,JSON.stringify(t),"",null,{contentType:"application/json"})};var G=function(){var e={appContainerWidth:jQuery("#tb-strategies-app").width(),imageWidth:jQuery(".tb-strategy-item img").width(),stepListHeight:jQuery(".tb-strategy-step-list").height()};TBExtension.SetDbValue("tb-strategy-size-settings-"+TBGlobal.CurrentChannelId(),JSON.stringify(e))};var E=function(){jQuery(document).on("click","#tb-strategies-menu-button",function(){C().then(e=>{if(!e){TBExtension.SetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-strategies-loaded",true,function(e,t){TBUtilities.Log("Strategies loaded.")});var i=jQuery("#tb-strategies-splash-screen-template").html();jQuery.blockUI({message:i,blockMsgClass:"tb-strategies-block-msg",overlayCSS:{backgroundColor:"#fff",cursor:"pointer",opacity:.6}})}else{if(jQuery("#tb-strategies-app").is(":visible")&&t){v()}else{t=true;h()}}})});jQuery(document).on("click",".blockOverlay",function(){jQuery.unblockUI()});jQuery(document).on("click",".tb-strategies-show-option",function(e){jQuery.unblockUI();var i=jQuery(this).attr("data-tb-show")=="true";L(true);if(i){t=true;h()}else{window.location.replace(TBGlobal.host+"/channel/preferences/"+TBGlobal.CurrentChannelId()+"?setting=strategies")}});jQuery(document).on("click",".tb-strategy-item img",function(){var e=jQuery(".tb-strategies-image-full");e.find("img").attr("src",jQuery(this).attr("src"));e.fadeIn()});jQuery(document).on("click",".tb-strategy-close-full-screen-image, .tb-strategies-block-full-screen-image, .tb-strategies-image-full",function(e){jQuery(".tb-strategies-image-full").fadeOut()});jQuery(document).on("click",".tb-strategies-back-to-goals",function(){p()});jQuery(document).on("click",".tb-strategies-back-to-strategies-list",function(){m(r)});jQuery(document).on("click",".tb-strategies-hide-strategies",function(){v()});jQuery(document).on("click",".tb-strategies-cancel-strategy",function(){j()});jQuery(document).on("click",".tb-strategies-finish-strategy",function(){u=true;t=false;f();jQuery(".tb-strategies-finished-text").text('You completed "'+n.Title+'"!');jQuery(".tb-strategies-view").hide();jQuery(".tb-strategies-view-finished").fadeIn();jQuery(".tb-strategies-hide-strategies").hide();jQuery(".tb-strategies-zoom-in, .tb-strategies-zoom-out").hide();jQuery("#tb-strategies-app").css("width","");jQuery("#tb-strategies-app").css("max-width","520px");try{TBUtilities.AddAction({Data:"strategyId = "+n.Id},TBUtilities.ActionTypes.Strategy_Finish,"strategies")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] finishStrategy"})}Q()});jQuery(document).on("click",".tb-strategies-finished-action-button",function(){Q();var e=jQuery(this).attr("data-action-type");if(e=="back"){p()}else{v()}});jQuery(document).on("click",".tb-strategies-goal-show-strategies",function(){var e=jQuery(this).attr("data-goal-id");var t=a.filter(function(t){return t.Id==e})[0];m(t)});jQuery(document).on("click",".tb-strategies-upgrade",function(){var e=o.filter(e=>e.Id==jQuery(this).attr("data-strategy-id"))[0];var t=I(e.License);var i="Sorry, this Strategy uses tools that require a "+t+" or higher license.";TBGlobal.ShowUpgradePage(i,t,true)});jQuery(document).on("click",".tb-show-strategy",function(){var e=jQuery(this).attr("data-strategy-id");var t=jQuery(this).attr("data-strategy-action");var i=o.filter(function(t){return t.Id==e})[0];y(i);if(t=="start"){try{TBUtilities.AddAction({Data:"strategyId = "+i.Id},TBUtilities.ActionTypes.Strategy_Start,"strategies")}catch(e){TBUtilities.LogError({Exception:Ex,Location:"[Strategies] startStrategy"})}}});jQuery(document).on("mouseenter",".tb-strategy-goal-item",function(){var e=jQuery(this).attr("data-goal-id");var t=a.filter(function(t){return t.Id==e})[0].Image;jQuery(this).find("img").attr("src",TBGlobal.host+"/images/modules/strategies/"+t+"-opacity.png")});jQuery(document).on("mouseleave",".tb-strategy-goal-item",function(){var e=jQuery(this).attr("data-goal-id");var t=a.filter(function(t){return t.Id==e})[0].Image;jQuery(this).find("img").attr("src",TBGlobal.host+"/images/modules/strategies/"+t+".png")});jQuery(document).on("click",".tb-strategies-description-toggle-details",function(){if(jQuery(this).siblings(".tb-strategies-strategy-description").first().is(":visible")){jQuery(this).siblings(".tb-strategies-strategy-description").first().slideUp();jQuery(this).text("view details")}else{jQuery(this).siblings(".tb-strategies-strategy-description").first().slideDown();jQuery(this).text("hide details")}});jQuery(document).on("click",".tb-strategies-zoom-in",function(){if(jQuery(window).height()>jQuery(".tb-strategy-step-list").height()+170){var e=jQuery("#tb-strategies-app").width();jQuery("#tb-strategies-app").css("max-width",e+50);jQuery("#tb-strategies-app").width(e+50);jQuery(".tb-strategy-item img").width(jQuery(".tb-strategy-item img").width()+50);jQuery(".tb-strategy-step-list").height(jQuery(".tb-strategy-step-list").height()+50);G()}else{TBUtilities.Alert("Increase the height of your browser window to zoom in further.")}});jQuery(document).on("click",".tb-strategies-zoom-out",function(){var e=jQuery("#tb-strategies-app").width();if(e>=400){jQuery("#tb-strategies-app").css("max-width",e-50);jQuery("#tb-strategies-app").width(e-50);jQuery(".tb-strategy-item img").width(jQuery(".tb-strategy-item img").width()-50);jQuery(".tb-strategy-step-list").height(jQuery(".tb-strategy-step-list").height()-50);G()}else{TBUtilities.Alert("Strategies window is at the smallest size.")}})};var R=function(){jQuery(document.body).on("CRTBLoadStrategiesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);d();P()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyStrategies] CRTBLoadStrategiesTemplate"})}})};var P=function(){jQuery(".tb-strategy-step-list").scroll(function(e){if(!c)g(e)})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){R();U();E();e=true}else{d()}}}}}();var TubeBuddyBulkThumbnail=function(){var e=false;var t={ids:0,playlist:1,search:2,all:3,recent:4};var i={action:"",validImage:false,overlayImageUrl:"",method:t.all,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",videoEntity:null,videos:[],destinationVideos:[],currentVideo:null,isStopped:false,totalDestinationVideos:0,failedVideos:[]};var a=function(){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [loadData]"})}};var r=function(){var e=TBGlobal.host+"/ModuleManager/bulkthumbnail/bulkthumbnail?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/bulkthumbnail.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/bulkthumbnail.html"}TBExtension.Get(e,"CRTBLoadBulkThumbnailTemplate")};var o=function(){jQuery(document).on("click","#tb-bulkthumbnail-error-copy",function(){jQuery(this).find("span").text("Copied");window.setTimeout(function(){jQuery("#tb-bulkthumbnail-error-copy").find("span").text("Copy video ids")},1500)});jQuery(document).on("click","#tb-bulkthumbnail-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("click",".tb-bulk-thumbnail-recent-url",function(){jQuery("#tb-bulkthumbnail-overlay").val(jQuery(this).text());$("#tb-bulkthumbnail-load").click()});jQuery(document).on("click","#tb-bulkthumbnail-close, .tb-bulkthumbnail-closex, .tb-module-close",function(){try{if(i.step==4)location.reload();TubeBuddyMenu.HideBackground();jQuery("#tb-bulkthumbnail-container").hide();jQuery("#tb-bulkthumbnail-overlay").val("");jQuery(".tb-bulk-thumbnail-action--selected").removeClass("tb-bulk-thumbnail-action--selected");jQuery("#tb-bulk-thumbnails-valid-image").hide();i.step=1}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] tb-bulkthumbnail-close"})}});jQuery(document).on("click","#tb-bulkthumbnail-method-ids, #tb-bulkthumbnail-method-playlist, #tb-bulkthumbnail-method-search, #tb-bulkthumbnail-method-full",function(e){i.method=parseInt(jQuery(this).attr("data-method"));TBUtilities.Log({StatusMethod:i.method});var t=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect().data("plugin_playlistSelect");switch(i.method){case 0:jQuery("#tb-bulkthumbnail-input-ids").removeAttr("disabled","disabled");t.disable();i.playlistId="";jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;t.enable();t.showDropDown();break;case 2:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");t.disable();i.playlistId="";i.specificVideoIds.length=0;i.specificVideos.length=0;jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").removeAttr("disabled","disabled");break;case 3:jQuery("#tb-bulkthumbnail-input-ids").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-playlist").attr("disabled","disabled");jQuery("#tb-bulkthumbnail-input-search").attr("disabled","disabled");i.specificVideoIds.length=0;i.specificVideos.length=0;break}});jQuery(document).on("dblclick",".overlayimg",function(e){var t=jQuery(this).attr("data-video-id");jQuery(this).parent().find(".tb-bulkthumbnails-video:first").trigger("dblclick")});jQuery(document).on("error",".overlayimg",function(e){jQuery(this).css("display","none")});jQuery(document).on("dblclick",".tb-bulkthumbnails-video",function(e){var t=jQuery(this).attr("data-video-id");if(i.action=="add"){if(!jQuery(this).parent().parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}else if(i.action=="remove"){var a="https://s3-us-west-1.amazonaws.com/tubebuddy/videothumbnails/"+TBGlobal.CurrentChannelId()+"/"+t+"_0.jpg";jQuery(this).parent().find(".overlayimg:first").on("error",function(){jQuery(this).attr("src",TBGlobal.host+"/images/modules/thumbnail/nooverlaysfound.png");if(jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}).on("load",function(){if(!jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").prop("checked"))jQuery(this).parent().find(".tb-bulkthumbnail-checkbox-include").trigger("click")}).attr("src",a)}jQuery(this).parent().find(".overlayimg:first").css("display","inline-block")});jQuery(document).on("click","#tb-bulkthumbnail-load",function(e){if(jQuery("#tb-bulkthumbnail-overlay").val()==""||jQuery("#tb-bulkthumbnail-overlay").val()=="http://"||jQuery("#tb-bulkthumbnail-overlay").val()=="http:"){TBUtilities.Alert("Please enter a URL to an Image");return}jQuery("#tb-bulkthumbnail-overlay").prop("disabled",true);i.overlayImageUrl=jQuery("#tb-bulkthumbnail-overlay").val();if(!i.overlayImageUrl){jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");return}jQuery("#tb-bulk-thumbnails-preview-container").show();jQuery("#tb-bulkthumbnail-source-preview-container").show();jQuery("#tb-bulkthumbnail-source-selection-container").addClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulk-thumbnails-preview-show").show();jQuery("#tb-bulk-thumbnail-loading-preview").show();jQuery("#tb-bulkthumbnail-upload-link").hide();c()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-playlist",function(e){i.playlistId="";var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulkthumbnail-input-playlist-status").hide();return}if(t.indexOf("list=")>0){t=t.substring(t.indexOf("list=")+5)}if(t.length!=18&&t.length!=34||t.substring(0,2)!="PL"){jQuery("#tb-bulkthumbnail-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","red")}else{jQuery("#tb-bulkthumbnail-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","green");i.playlistId=t}jQuery("#tb-bulkthumbnail-input-playlist-status").show()});jQuery(document).on("click","#playlist-select-type-manual",function(){var e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").children("input");e.each(function(e,t){i.validPlaylistIds.push(jQuery(t).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var e=jQuery(this).val();if(i.validPlaylistIds.indexOf(e)==-1){jQuery(".tb-playlist-select-manual-id-invalid").show()}else{jQuery(".tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery(".tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-search",function(e){i.search=jQuery(this).val().trim()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-bulkthumbnail-input-ids",function(e){var t=jQuery(this).val().trim();t=TBUtilities.ReplaceAll(t,'"',"");if(t.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").hide();return}jQuery("#tb-bulkthumbnail-input-ids-status").show();i.specificVideoIds=[];if(t.indexOf(",")>-1){i.specificVideoIds=t.split(",")}else{i.specificVideoIds=t.split(" ")}for(var a=0;a<i.specificVideoIds.length;a++){i.specificVideoIds[a]=i.specificVideoIds[a].trim();i.specificVideoIds[a]=i.specificVideoIds[a].replace("https://www.youtube.com/watch?v=","");i.specificVideoIds[a]=i.specificVideoIds[a].replace("https://youtu.be/","");if(i.specificVideoIds[a].length!=11){i.specificVideoIds.splice(a,1);a--}}if(i.specificVideoIds.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").text("No videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","red")}else if(i.specificVideoIds.length==1){jQuery("#tb-bulkthumbnail-input-ids-status").text("1 video detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","green");jQuery("#tb-bulkthumbnail-method-ids").prop("checked",true);jQuery("#tb-bulkthumbnail-method-ids").trigger("click")}else{jQuery("#tb-bulkthumbnail-input-ids-status").text(i.specificVideoIds.length+" videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").css("color","green");jQuery("#tb-bulkthumbnail-method-ids").prop("checked",true);jQuery("#tb-bulkthumbnail-method-ids").trigger("click")}});jQuery(document).on("click",".tb-bulkthumbnail-checkbox-include",function(){try{if(jQuery(this).is(":checked")){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length>1){jQuery(this).prop("checked",false);TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays");return}if(i.action=="remove"){var e=jQuery(this).attr("data-video-id");var t="https://s3-us-west-1.amazonaws.com/tubebuddy/videothumbnails/"+TBGlobal.CurrentChannelId()+"/"+e+"_0.jpg";jQuery(this).parentsUntil(".tb-bulkthumbnail-destination-row").find(".overlayimg").attr("src",t).css("background",'url("")')}jQuery(this).closest(".tb-bulkthumbnail-destination-row").find(".overlayimg").css("display","inline-block")}else{jQuery(this).closest(".tb-bulkthumbnail-destination-row").find(".overlayimg").css("display","none")}jQuery("#tb-bulkthumbnail-destination-selected-count").text(jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] tb-bulkthumbnail-checkbox-include"})}});jQuery(document).on("click","#tb-bulkthumbnail-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()&&i.videos.length>1){TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays");return}jQuery(".tb-bulkthumbnail-checkbox-include:visible").prop("checked",false);jQuery(".tb-bulkthumbnail-checkbox-include:visible").trigger("click")});jQuery(document).on("change","#tb-bulkthumbnail-position, #tb-bulkthumbnail-background",function(){c()});jQuery(document).on("change","#tb-bulk-thumbnail-upload-input",function(e){if(TBGlobal.CanAccessLevel2Tools()==false){TBGlobal.ShowUpgradePage("upload an image","bulkthumbnailoverlays");return}if(jQuery(this)[0].files[0]){var t=jQuery(this)[0].files[0].size;if(t>10485760){jQuery(this).wrap("<form>").closest("form").get(0).reset();jQuery(this).unwrap();alertify.alert("Sorry, you need to select a file less than 10MB")}var i=new FileReader;i.readAsDataURL(e.target.files[0]);i.onloadend=function(e){var t=e.target.result;var i=t.replace("data:image/png;base64,","");var a={ImageData:i,ImageExt:"png"};var r=TBGlobal.host+TBGlobal.apiUrls.thumbnailUploadBulkOverlayImage;TBExtension.Post(r,JSON.stringify(a),"CRTBBulkThumbnailUploadOverlay",null,{contentType:"application/json"})}}});jQuery(document).on("click","#tb-bulk-thumbnail-upload-input",function(){if(TBGlobal.CanAccessLevel2Tools()==false){TBGlobal.ShowUpgradePage("upload an image","bulkthumbnailoverlays");return}});jQuery(document).on("change",".tb-bulk-thumbnails-source",function(){var e=jQuery(this).val();i.overlayImageUrl="";jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulkthumbnail-overlay").val();jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-upload-input").parent().trigger("reset");if(e=="onweb"){u();jQuery("#tb-bulkthumbnail-overlay").val("");jQuery("#tb-bulk-thumbnails-source-web").show();jQuery("#tb-bulk-thumbnails-source-computer").hide();jQuery("#tb-bulkthumbnail-overlay").focus()}else if(e=="upload"){jQuery("#tb-bulk-thumbnails-source-web").hide();jQuery("#tb-recent-image-urls").hide();jQuery("#tb-bulk-thumbnails-source-computer").show();jQuery("#tb-bulk-thumbnail-upload-input").change()}else{jQuery("#tb-bulk-thumbnails-source-web").hide();jQuery("#tb-recent-image-urls").hide();jQuery("#tb-bulk-thumbnails-source-computer").hide()}});jQuery(document).on("click",".tb-bulkthumbnail-more-info",function(){TBGlobal.ShowUpgradePage("update thumbnails in bulk (more than 1 video at a time)","bulkthumbnailoverlays")});jQuery(document).on("click","#tb-bulkthumbnail-select-no-checkboxes",function(){jQuery(".tb-bulkthumbnail-checkbox-include:visible").prop("checked",true);jQuery(".tb-bulkthumbnail-checkbox-include:visible").trigger("click")});jQuery(document).on("click","#tb-bulkthumbnail-stop",function(){i.isStopped=true;jQuery("#tb-bulkthumbnail-stop").hide();jQuery("#tb-bulkthumbnail-close").show();jQuery("#tb-bulkthumbnail-working").hide();jQuery("#tb-bulkthumbnail-stopped").show()});jQuery(document).on("click",".tb-bulkthumbnail-action",function(){jQuery(".tb-bulk-thumbnail-action--selected").removeClass("tb-bulk-thumbnail-action--selected");i.action=jQuery(this).attr("data-action-type");jQuery(this).addClass("tb-bulk-thumbnail-action--selected");jQuery("#tb-bulk-thumbnails-valid-image").hide();if(jQuery(this).attr("data-action-type")=="add"){jQuery("#tb-bulkthumbnails-add-description").show();jQuery("#tb-bulk-thumbnails-source-image").show()}else{i.overlayImageUrl="";jQuery(".overlayimg").attr("src","").css("background",'url("")');jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulkthumbnails-add-description").hide();jQuery("#tb-bulk-thumbnails-source-image").hide();jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview")}});jQuery(document).on("click","#tb-bulkthumbnail-kickoff",function(){if(!jQuery("#tb-bulkthumbnail-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to run these bulk actions.");return}i.step=4;jQuery("#tb-bulkthumbnail-status").show();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-stop").show();jQuery("#tb-bulkthumbnail-back").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-continue").hide();h()});jQuery(document).on("keyup","#tb-bulkthumbnail-overlay, #tb-bulkthumbnail-kickoff",function(e){if(e.keyCode==13){$("#tb-bulkthumbnail-load").click()}});jQuery(document).on("click","#tb-bulkthumbnail-continue, #tb-bulkthumbnail-kickoff",function(){try{if(i.step==1){if(!i.action){TBUtilities.Alert("You must select an action to continue (Add Overlay or Remove Overlay)");return}if(i.action=="add"&&i.overlayImageUrl.length==0){TBUtilities.Alert("You must select an overlay image");return}if(!i.validImage&&(i.action=="add"||i.action=="replace")){TBUtilities.Alert("You must enter a valid image (and click Load)");return}jQuery("#tb-bulkthumbnail-loading-videos").show();jQuery("#tb-bulkthumbnail-destination-list").hide();jQuery("#tb-bulkthumbnail-source").hide();jQuery("#tb-bulkthumbnail-method").show();jQuery("#tb-bulkthumbnail-back").show();i.overlayImageUrl=jQuery("#tb-bulkthumbnail-overlay").val();jQuery(".overlayimg").attr("src",i.overlayImageUrl).css("background","url("+i.overlayImageUrl+")");TBUtilities.Log(i);i.step=2}else if(i.step==2){switch(parseInt(i.method)){case 0:if(i.specificVideoIds.length==0){jQuery("#tb-bulkthumbnail-input-ids-status").css("color","red");jQuery("#tb-bulkthumbnail-input-ids-status").text("No videos detected");jQuery("#tb-bulkthumbnail-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(i.specificVideoIds));d();break;case 1:var e=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect().data("plugin_playlistSelect");var t=e.getSelectedPlaylistIds();if(t.length>0){i.playlistId=t.join(",")}if(t.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(i.playlistId==""){jQuery("#tb-bulkthumbnail-input-playlist-status").css("color","red");jQuery("#tb-bulkthumbnail-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-bulkthumbnail-input-playlist-status").show();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+i.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(i.playlistId,null,v);break;case 2:if(i.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+i.search+"]");jQuery("#tb-bulkthumbnail-destination").show();TBYouTubeApi.GetChannelVideosSearch(i.search,null,v);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var a=null;if(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage").is(":checked")){var r=/^\+?\d+$/.test(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").val());if(r==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}a=parseInt(jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").val());if(a<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,v,null,a,null);break}jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-destination-list").hide();jQuery("#tb-bulkthumbnail-loading-videos").show();i.step=3}else if(i.step==3){if(jQuery(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length==0&&i.destinationVideos.length==0){TBUtilities.Alert("Please select at least 1 video to run add a Thumbnail Overlay on (check the box next to the video).");return}i.destinationVideos=[];jQuery(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").each(function(){if(jQuery(this).is(":checked")){var e=jQuery(this).attr("data-video-id");jQuery.each(i.videos,function(t,a){if(a.id==e){i.destinationVideos.push(a);TBGlobal.AddUserDebugInfo("Selected Destination Video: https://www.youtube.com/watch?v="+e)}})}});var o="Please confirm that you want to";switch(i.action){case"add":o+=" ADD an image overlay on top of the <b>"+i.destinationVideos.length+"</b> Video Thumbnail";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"replace":o+=" REPLACE all existing image overlays with a new image overlay of the <b>"+i.destinationVideos.length+"</b> Video";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"remove":o+=" REMOVE all existing image overlays from the <b>"+i.destinationVideos.length+"</b> Video Thumbnail";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break;case"original":o+=' SET the current thumbnail as the "original" (and lose the previously saved "original" thumbnail) of the <b>'+i.destinationVideos.length+"</b> Video";if(i.destinationVideos.length>1)o+="s";o+=" that you selected.";break}jQuery("#tb-bulkthumbnail-confirmation-text").html(DOMPurify.sanitize(o,DOMPurifyConfig));jQuery("#tb-bulkthumbnail-queue-list").empty();jQuery("#tb-bulkthumbnail-completed-list").empty();jQuery("#tb-bulkthumbnail-destination-selected-count").text(i.destinationVideos.length);jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-confirm-checkbox").prop("checked",false);i.step=4;jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-confirm").show();jQuery("#tb-bulkthumbnail-kickoff").show();jQuery("#tb-bulkthumbnail-continue").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [click] #tb-bulkthumbnail-continue, #tb-bulkthumbnail-kickoff"})}});jQuery(document).on("click","#tb-bulkthumbnail-back",function(){jQuery("#tb-bulkthumbnail-continue").show();if(i.step==2){jQuery("#tb-bulkthumbnail-source").show();jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-back").hide();i.step=1}else if(i.step==3){i.step=2;jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-method").show();jQuery("#tb-bulkthumbnail-destination-selected-count").text("0");i.specificVideoIds.length=0;i.specificVideos.length=0;jQuery("#tb-bulkthumbnail-input-ids").val("");jQuery("#tb-bulkthumbnail-input-ids-status").hide()}else if(i.step==4){i.step=3;jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-continue").show()}})};var n=function(e){if(e.width==0){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();var t='<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, we could not find a valid image at the URL you provided. <br><a href="'+e.src+'" target="_blank">'+e.src+"</a>";jQuery("#tb-bulkthumbnail-invalid").html(DOMPurify.sanitize(t,DOMPurifyConfig));jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false)}else if(!(e.width==1280&&e.height==720||e.width==1920&&e.height==1080)){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false);jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();var t='<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, the image you selected is <b>not the correct size</b>. (must be 1280x720 or 1920x1080)';jQuery("#tb-bulkthumbnail-invalid").html(DOMPurify.sanitize(t,DOMPurifyConfig))}else{i.validImage=true;jQuery("#tb-bulk-thumbnails-valid-image").show();jQuery("#tb-bulkthumbnail-invalid").hide();jQuery("#tb-bulkthumbnail-overlay-preview").on("load",function(){jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false);jQuery("#tb-bulkthumbnail-overlay-preview").show()}).attr("src",e.src);TBUtilities.Log("Writing out: "+"tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url"+" || VALUE: "+e.src);TBExtension.SetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url",e.src);if(jQuery("#tb-bulk-thumbnail-overlay-source-onweb").is(":checked"))s(jQuery("#tb-bulkthumbnail-overlay").val())}};var s=function(e){var t=l();if(t){if(t.map(function(e){return e.imageUrl}).indexOf(e)>-1){return}else if(t.length>=3){t.pop()}}else{t=[]}t.unshift({date:new Date,imageUrl:e});window.localStorage.setItem("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url",JSON.stringify(t));u()};var l=function(){var e=JSON.parse(window.localStorage.getItem("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url"));if(!e){return}else{return e}};var u=function(){jQuery("#tb-recent-image-urls").empty();var e=l();if(e){jQuery("#tb-recent-image-urls").append('<div id="tb-bulkthumbnail-recent-text">or select a recent URL</div>');jQuery(e).each(function(e,t){jQuery("#tb-recent-image-urls").append('<div class="tb-bulk-thumbnail-recent-url"><a style="text-decoration:none;">'+t.imageUrl+"</a></div>")});jQuery("#tb-recent-image-urls").show()}};var c=function(){if(!i.overlayImageUrl)return;if(jQuery("#tb-bulkthumbnail-overlay-preview").attr("src").length<0)jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-invalid").hide();var e=new Image;e.onload=function(){n(e)};e.onerror=function(t){i.validImage=false;jQuery("#tb-bulk-thumbnails-valid-image").hide();jQuery("#tb-bulk-thumbnail-loading-preview").hide();jQuery("#tb-bulkthumbnail-invalid").show();var a='<img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:3px;" /> Sorry, we could not find a valid image at the URL you provided. <br><a href="'+e.src+'" target="_blank">'+e.src+"</a>";jQuery("#tb-bulkthumbnail-invalid").html(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-bulkthumbnail-overlay").prop("disabled",false)};e.src=i.overlayImageUrl;TBUtilities.Log(i)};var d=function(){var e=i.specificVideoIds[0];i.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails,snippet,id",b)};var b=function(e){if(e!=null)i.specificVideos.push(e);if(i.specificVideoIds.length>0){d()}else{v(i.specificVideos)}};var h=function(){try{i.failedVideos=[];i.totalDestinationVideos=i.destinationVideos.length;i.hasFinished=false;i.errorCount=0;i.successCount=0;jQuery("#tb-bulkthumbnail-queue-list").empty();jQuery("#tb-bulkthumbnail-completed-list").empty();jQuery("#tb-bulkthumbnail-working").show();jQuery("#tb-bulkthumbnail-done").hide();jQuery("#tb-bulkthumbnail-stopped").hide();TBUtilities.Log(i);if(i.action=="add"){try{TBUtilities.AddAction({VideoCount:i.totalDestinationVideos,Data:"overlay = "+i.overlayImageUrl},TBUtilities.ActionTypes.BulkThumbnailOverlays_Add,"bulkthumbnailoverlays")}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailAddOverlay] [addAction]"})}}if(i.action=="remove"){try{TBUtilities.AddAction({VideoCount:i.totalDestinationVideos,Data:"overlay = "+i.overlayImageUrl},TBUtilities.ActionTypes.BulkThumbnailOverlays_Remove,"bulkthumbnailoverlays")}catch(e){TBUtilities.LogError({Exception:e,Location:"[ThumbnailDeleteOverlay] [addAction]"})}}m();p()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [startProcessing]"})}};var p=function(){jQuery("#tb-bulkthumbnail-queue-list2").empty();jQuery("#tb-bulkthumbnail-queue-complete-list2").hide();var e=0;jQuery.each(i.destinationVideos,function(t,i){var a=jQuery(".tb-bulkthumbnail-processing-template2:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",i.snippet.thumbnails.default.url);a=a.replace("default.jpg","mqdefault.jpg");a=TBUtilities.ReplaceAll(a,"#VIDEOID#",i.id);a=a.replace("#VIDEOTITLE#",i.snippet.title);a=a.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);a=a.replace("display: none","display:flex");jQuery("#tb-bulkthumbnail-queue-list2").prepend(a);e++;if(e==3)return false});if(e==0){jQuery("#tb-bulkthumbnail-queue-complete-list2").show();jQuery("#tb-bulkthumbnail-queue-list2").hide()}else{jQuery("#tb-bulkthumbnail-queue-list2").show()}};var m=function(){try{if(i.isStopped)return;jQuery("#tb-bulkthumbnail-progress-container").html("Start &#707;");if(i.destinationVideos.length==0){var e="<b>"+i.totalDestinationVideos+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete";jQuery("#tb-bulkthumbnail-status-count").html(DOMPurify.sanitize(e,DOMPurifyConfig));jQuery("#tb-bulkthumbnail-progress-container").hide();if(i.currentVideo){if(!i.currentVideo.error)y(i.currentVideo);else f(i.currentVideo)}p();jQuery("#tb-bulkthumbnail-working").hide();jQuery("#tb-bulkthumbnail-done").show();jQuery("#tb-bulkthumbnail-stop").hide();jQuery("#tb-bulkthumbnail-close").show();return}if(i.currentVideo){if(!i.currentVideo.error)y(i.currentVideo);else f(i.currentVideo)}var t=i.destinationVideos[0].id;var a=TBUtilities.RemoveFromArray(i.destinationVideos,"id",t)[0];i.currentVideo=a;var r="<b>"+parseInt(i.totalDestinationVideos-i.destinationVideos.length)+"</b> of <b>"+i.totalDestinationVideos+"</b> videos complete";jQuery("#tb-bulkthumbnail-status-count").html(DOMPurify.sanitize(r,DOMPurifyConfig));var o=jQuery("#tb-bulkthumbnail-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+t+'">'+t+"</a> &#707;";jQuery("#tb-bulkthumbnail-progress-container").html(DOMPurify.sanitize(o,DOMPurifyConfig));p();TBGlobal.AddUserDebugInfo("Getting Video Details for: "+a.id);var n;if(i.action=="add"){n=TBGlobal.host+TBGlobal.apiUrls.thumbnailAddOverlay}else if(i.action=="remove"){n=TBGlobal.host+TBGlobal.apiUrls.thumbnailRemoveOverlay}jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Publishing Thumbnail  &#707;");var s={VideoId:a.id,OverlayUrl:i.overlayImageUrl};TBExtension.Post(n,JSON.stringify(s),"CRTBBulkThumbnailCreatorPostThumbnail",null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [processNextVideo]"});jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-bulkthumbnail-stop").trigger("click")}};var y=function(e){var t=jQuery(".tb-bulkthumbnail-processed-success:last")[0].outerHTML;t=t.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);t=t.replace("default.jpg","mqdefault.jpg");t=TBUtilities.ReplaceAll(t,"#VIDEOID#",e.id);t=t.replace("#VIDEOTITLE#",e.snippet.title);t=t.replace("#HREF#","https://studio.youtube.com/video/"+e.id+"/edit");t=t.replace("display:none","display:flex");jQuery("#tb-bulkthumbnail-completed-list2").prepend(t);jQuery("#tb-bulkthumbnail-completed-none-list2").hide();jQuery("#tb-bulkthumbnail-completed-list2").show();i.successCount++;jQuery("#tb-bulkthumbnail-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(i.successCount))};var f=function(e){try{jQuery("#tb-bulkthumbnail-error-copy-container").show();var t=jQuery("#tb-bulkthumbnail-error-copy").attr("data-clipboard-text");var a=[];if(t!=""){a=t.split(",");if(a.indexOf(e.id)==-1){a.push(e.id)}}else{a.push(e.id)}jQuery("#tb-bulkthumbnail-error-copy").attr("data-clipboard-text",a.join(","))}catch(e){}var r=jQuery(".tb-bulkthumbnail-processed-error:last")[0].outerHTML;r=r.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);r=r.replace("default.jpg","mqdefault.jpg");r=TBUtilities.ReplaceAll(r,"#VIDEOID#",e.id);r=r.replace("#VIDEOTITLE#",e.snippet.title);r=r.replace("#ERROR#",e.error);r=r.replace("#HREF#","https://studio.youtube.com/edit/"+e.id+"edit");r=r.replace("display:none","display:block");jQuery("#tb-bulkthumbnail-error-list2").prepend(r);jQuery("#tb-bulkthumbnail-error-list2").show();jQuery("#tb-bulkthumbnail-error-none-list2").hide();i.errorCount++;jQuery("#tb-bulkthumbnail-error-list2-count").text(TBUtilities.FormatNumberWithCommas(i.errorCount))};var g=function(e,t){i.currentVideo.error=t;m()};var v=function(e){try{if(e==null){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulkthumbnail-back").trigger("click");return}else if(e.length==0){if(i.method==0)TBUtilities.Alert("No valid Video IDs found");else if(i.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(i.method==2)TBUtilities.Alert("No videos matching your search");else if(i.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-bulkthumbnail-back").trigger("click");return}jQuery("#tb-bulkthumbnail-loading-videos").hide();i.videos=[];jQuery("#tb-bulkthumbnail-destination-list").empty();jQuery.each(e,function(e,t){if(t.id.videoId!=null){t.id=t.id.videoId}if(t.snippet.resourceId!=null)t.id=t.snippet.resourceId.videoId;if(t.snippet.tags==null)t.snippet.tags="";if(t.snippet!=null&&t.snippet.title=="Deleted video"&&t.snippet.thumbnails==null)return;i.videos.push(t);var a=jQuery(".tb-bulkthumbnail-destination-row:last")[0].outerHTML;a=a.replace("#VIDEOTITLE#",t.snippet.title);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",t.id);a=a.replace("#VIDEOTHUMBNAIL#",t.snippet.thumbnails.default.url+"?x="+Math.random());a=a.replace("#OVERLAYIMAGE",i.overlayImageUrl);if(t.status)a=a.replace("#PRIVACY#",t.status.privacy);a=a.replace("#TITLEDISPLAY#","display:none;");a=a.replace("#ENABLED#","");a=a.replace("#enabled#","");a=a.replace("#DISPLAYCHECKBOX#","");a=a.replace("#DISPLAYX#","display:none");jQuery("#tb-bulkthumbnail-destination-list").append(a)});jQuery("#tb-bulkthumbnail-destination").show();jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-destination-list").show();if(i.method==0||i.method==1)jQuery("#tb-bulkthumbnail-select-all-checkboxes").trigger("click")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] [gotVideoList]"})}};var T=function(){jQuery(document.body).on("CRTBBulkThumbnailUploadOverlay",function(e,t){try{if(t.success){t.response=TBUtilities.ReplaceAll(t.response,'"',"");jQuery("#tb-bulkthumbnail-overlay").val(t.response);i.overlayImageUrl=t.response;jQuery("#tb-bulk-thumbnails-preview-container").show();jQuery("#tb-bulkthumbnail-source-preview-container").show();jQuery("#tb-bulkthumbnail-source-selection-container").addClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulk-thumbnails-preview-show").show();jQuery("#tb-bulk-thumbnail-loading-preview").show();jQuery("#tb-bulkthumbnail-upload-link").hide();c()}else{jQuery("#tb-bulk-thumbnail-upload-input").wrap("<form>").closest("form").get(0).reset();jQuery("#tb-bulk-thumbnail-upload-input").unwrap();alertify.alert("Sorry, image failed!<br><Br>Make sure you are selecting a valid image and that the size is 1280x720 or 1920x1080.")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBBulkThumbnailUploadOverlay"})}});jQuery(document.body).on("CRTBBulkThumbnailCreatorPostThumbnail",function(e,t){try{if(t.success&&(t.response=="Success"||t.response=='"Success"')){jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Successfully Published");var a=jQuery("div[data-video-id='"+i.currentVideo.id+"']");if(a){TBUtilities.Log("updating thumbnails");var r=jQuery(a).find("img:first");if(r){jQuery(r).attr("src","https://i.ytimg.com/vi/"+i.currentVideo.id+"/mqdefault.jpg?time="+Math.random())}}m()}else{jQuery("#tb-bulkthumbnail-progress-container").html(jQuery("#tb-bulkthumbnail-progress-container").html()+" Successfully Published");t.location="CRTBBulkThumbnailCreatorPostThumbnail";TBUtilities.LogError("Unable to bulk add thumbnails. Result: "+JSON.stringify(t));g(i.currentVideo.id,"Processing Failed")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBFRGetEditUrl"});g(i.currentVideo.id,"Post Exception")}});jQuery(document).on("change",".tb-bulkthumbnail-filter",function(){jQuery(".tb-bulkthumbnail-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();jQuery('.tb-bulkthumbnail-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-bulkthumbnail-destination-row[data-privacy="public"]').hide();break}jQuery("#tb-bulkthumbnail-destination-selected-count").text(jQuery("#tb-bulkthumbnail-destination-list").find(".tb-bulkthumbnail-checkbox-include").filter(":visible").filter(":checked").length)});jQuery(document.body).on("CRTBLoadBulkThumbnailTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);Q()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkThumbnail] CRTBLoadBulkThumbnailTemplate"})}})};jQuery(document.body).on("TBBulkThumbnailGetLastValue",function(e,t){TBUtilities.Log("Last Thumbnail URL");TBUtilities.Log(t);if(t)jQuery("#tb-bulkthumbnail-overlay").val(t.value)});var j=function(){try{jQuery("#tb-bulkthumbnail-error-copy-container").hide();jQuery("#tb-bulkthumbnail-error-copy").prop("data-clipboard-text","");var e=new ClipboardJS("#tb-bulkthumbnail-error-copy");jQuery("#tb-bulkthumbnail-selected-count").text("0");jQuery("#tb-bulkthumbnail-destination-selected-count").text("0");jQuery("#tb-bulkthumbnail-method").hide();jQuery("#tb-bulkthumbnail-status").hide();jQuery("#tb-bulkthumbnail-confirm").hide();jQuery("#tb-bulkthumbnail-bulk-description-updates-container").hide();jQuery("#tb-bulkthumbnail-featured-content-container").hide();jQuery("#tb-bulkthumbnail-kickoff").hide();jQuery("#tb-bulkthumbnail-summary-container").hide();jQuery(".tb-bulkthumbnail-filter").val("publicunlisted");jQuery("#tb-bulkthumbnail-featured-video-status-complete").hide();jQuery("#tb-bulkthumbnail-featured-video-status-processing").hide();jQuery("#tb-bulkthumbnail-bulk-descriptions-status-complete").hide();jQuery("#tb-bulkthumbnail-bulk-descriptions-status-processing").hide();jQuery("#tb-bulkthumbnail-success").hide();jQuery("#tb-bulkthumbnail-back").hide();jQuery("#tb-bulkthumbnail-container").fadeIn();jQuery("#tb-bulkthumbnail-methods-container").fadeIn();jQuery("#tb-bulkthumbnail-continue").show();jQuery("#tb-bulkthumbnail-close").hide();jQuery("#tb-bulkthumbnail-upload-link").show();jQuery("#tb-bulkthumbnail-none").hide();jQuery("#tb-bulkthumbnail-has").hide();jQuery("#tb-bulkthumbnail-destination").hide();jQuery("#tb-bulkthumbnail-source").show();jQuery("#tb-bulkthumbnail-input-ids").val("");jQuery("#tb-bulkthumbnail-input-ids-status").text("");jQuery("#tb-bulkthumbnail-method-full").prop("checked","checked");jQuery("#tb-bulkthumbnail-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-bulkthumbnail-onlyLoadFirstPage").prop("checked",false);i.action="";i.validImage=false;i.overlayImageUrl="";jQuery("#tb-bulk-thumbnails-action").find("option").prop("selected",false);jQuery("#tb-bulk-thumbnails-action").eq(0).prop("selected",true);jQuery("#tb-bulkthumbnails-add-description").hide();jQuery("#tb-bulk-thumbnails-source-image").hide();jQuery("#tb-bulkthumbnail-overlay-preview").hide();jQuery("#tb-bulkthumbnail-overlay-preview").attr("src","");jQuery("#tb-bulk-thumbnails-preview-container").hide();jQuery("#tb-bulkthumbnail-source-preview-container").hide();jQuery("#tb-bulkthumbnail-source-selection-container").removeClass("tb-bulkthumbnail-source-selection--show-preview");jQuery("#tb-bulkthumbnail-completed-list2").empty();jQuery("#tb-bulkthumbnail-error-list2").empty();jQuery("#tb-bulkthumbnail-error-list2").hide();jQuery("#tb-bulkthumbnail-error-none-list2").show();jQuery("#tb-bulkthumbnail-completed-list2-count").text("0");jQuery("#tb-bulkthumbnail-error-list2-count").text("0");var t=jQuery("#tb-bulk-thumbnail-upload-input");t.replaceWith(t.val("").clone(true));var a=jQuery("#tb-bulkthumbnail-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){i.playlistId=e}}).data("plugin_playlistSelect");jQuery("#tb-bulkthumbnail-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-bulkthumbnail-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");a.disable();TBExtension.GetDbValue("tb-"+TBGlobal.CurrentChannelId()+"-recent-bulk-thumbnail-url","TBBulkThumbnailGetLastValue")}catch(e){TBUtilities.LogError({Exception:e,Location:"[V2VPromote] prepareDialog"})}};var Q=function(){TBGlobal.ClearUserDebugInfo();TBGlobal.AddUserDebugInfo("Opening BulkThumbnail");i.videoEntity=null;i.videos=[];i.destinationVideos=[];i.currentVideo=null;i.step=1;i.action="";i.specificVideoIds.length=0;i.specificVideos.length=0;i.method=3;a();j();c()};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){T();r();o();e=true}else{Q()}}}}}();var TubeBuddyPickAWinner=function(){var e=false;var t;var i;var a;var r=0;var o=function(e){try{jQuery("#tb-pick-a-winner-commenter-winner-container").removeClass("tb-hid");jQuery(".tb-pick-a-winner-start").attr("disabled",false);jQuery(".tb-pick-a-winner-start").find(".tb-spinner").addClass("tb-hid");var t=jQuery("#tb-contains-text").prop("checked")?jQuery("#tb-comment-contains-text").val().toLowerCase():"";var i=e.filter(function(e){return e.Comment.toLowerCase().search(t)>-1});var a=u(0,i.length-1);var r=i[a];if(r){jQuery(".tb-pick-a-winner-commenter-winner-channelThumbnail").attr("src",r.AuthorProfileImageUrl);jQuery(".tb-pick-a-winner-commenter-winner-channelUrl").attr("href",r.AuthorChannelUrl+"/about");jQuery(".tb-pick-a-winner-commenter-winner-channelUrl").text(r.AuthorChannelName);jQuery(".tb-pick-a-winner-commenter-winner-comment").html(DOMPurify.sanitize(r.Comment,DOMPurifyConfig));jQuery("#tb-pick-a-winner-description").hide();jQuery("#tb-pick-a-winner-text").text("Pick another Winner");jQuery("#tb-pick-a-winner-social").html('<div class="tb-spinner tb-loading-social"></div> ');var o=r.AuthorChannelUrl;TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(o,n)}else{jQuery("#tb-pick-a-winner-commenter-winner-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoCommentsCallback"})}};var n=function(e){var t=e.socialProfiles;if(t.length>0){jQuery.each(t,function(e,t){var i='<a target="_blank" href="https://youtube.com'+t.url+'"><img class="tb-margin-right3" src="'+t.image+'"/></a>';jQuery("#tb-pick-a-winner-social").append(DOMPurify.sanitize(i,DOMPurifyConfig))})}jQuery(".tb-loading-social").addClass("tb-hid")};var s=function(){var e=chrome.extension.getURL("modules/pickawinner.html");TBExtension.Get(e,function(e,t,i){try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] loadHtml"})}})};var l=function(){jQuery(document).on("click",".tb-pick-a-winner-start",function(e){try{jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").addClass("tb-hid");TBUtilities.AddAction(null,TBUtilities.ActionTypes.PickAWinner_Pick,"pickawinner")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] [addAction]"})}const i=TBGlobal.GetToolById("pickawinner").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:i,Action:`Picking a winner`});jQuery(".tb-pick-a-winner-start").attr("disabled",true);jQuery(".tb-pick-a-winner-start").find(".tb-spinner").removeClass("tb-hid");TBYouTubeApi.GetVideoComments(t,1e3,o)});jQuery(document).on("click","#tb-comment-contains-text",function(e){jQuery("#tb-contains-text").prop("checked",true);jQuery("#tb-random").prop("checked",false)});jQuery(document).on("click",".tb-module-close",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-pick-a-winner-container").hide();jQuery("#tb-contains-text").prop("checked",false);jQuery("#tb-comment-contains-text").val("");jQuery("#tb-pick-a-winner-no-comments-found-with-input-text").addClass("tb-hid");jQuery("#tb-random").prop("checked",true)})};var u=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var c=function(e,t,i){try{TBGlobal.AddUserDebugInfo("Opening Pick a winner");jQuery(".tb-pick-a-winner-start-container").removeClass("tb-hid");jQuery(".tb-pick-a-winner-finish-container").addClass("tb-hid");jQuery(".tb-pick-a-winner-none").addClass("tb-hid");jQuery("#tb-pick-a-winner-video-thumbnail").attr("src",t);jQuery("#tb-pick-a-winner-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-pick-a-winner-video-link").text(i);jQuery("#tb-pick-a-winner-text").text("Pick a Winner");jQuery("#tb-pick-a-winner-container").show();jQuery("#tb-pick-a-winner-description").show();jQuery(".tb-pick-a-winner-start").attr("disabled",true);jQuery("#tb-pick-a-winner-commenter-winner-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-none").addClass("tb-hid")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var d=function(e){try{r=e.statistics.CommentCount;if(r>0){jQuery(".tb-pick-a-winner-start").attr("disabled",false);jQuery(".tb-pick-a-winner-start-container").removeClass("tb-hid")}else{jQuery(".tb-pick-a-winner-start-container").addClass("tb-hid");jQuery("#tb-pick-a-winner-none").removeClass("tb-hid")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] getVideoDetailsCallback"})}};var b=function(){c(t,a,i);TBYouTubeApi.GetVideoDetails(t,"statistics",d);TBGlobal.ClearUserDebugInfo()};return{Show:function(r,o,n){if(TBGlobal.IsAuthenticated()){t=r;a=o;i=n;if(!e){s();l();e=true}else{b()}}}}}();var TubeBuddyTagTranslator=function(){var e=false;var t="";var i=[];var a=[];var r=0;var o=0;var n=null;var s=null;var l=null;var u=false;var c;var d;var b={id:"",term:"",rank:-1,date:""};var s=null;var h=null;var p="";var m=function(){$("#languageGraph").highcharts({chart:{type:"column",style:{fontFamily:"Roboto-Medium",color:"#424242",fontWeight:"normal"}},title:{text:null},colors:["rgba(74, 144, 226, 0.8)","rgba(108, 200, 97, 0.8)","rgba(255, 170, 54, 0.8)","rgba(250, 53, 53, 0.8)","rgba(128, 133, 233, 0.8)"],subtitle:{text:null},xAxis:{type:"category"},yAxis:{title:{text:null}},legend:{enabled:false},credits:{enabled:false},plotOptions:{series:{borderWidth:0,dataLabels:{formatter:function(){return this.x+"   "+this.y},enabled:true,format:"{point.y:.1f}%",color:"#424242",style:{fontSize:"13px",fontFamily:"Roboto-Bold"}}}},tooltip:{headerFormat:'<span style="font-size:13px; font-family:"Roboto-Medium",sans-serif;>{series.name}</span><br>',pointFormat:'<span style="color:{point.color};font-family:"Roboto-Medium",sans-serif;">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'},series:[{name:"Language",colorByPoint:true,data:a}]});jQuery("#languageGraphLoading").hide();jQuery("#languageContainer").slideDown()};var y=function(){var e=TBGlobal.host+"/ModuleManager/TagTranslator/TagTranslator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/tagtranslator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/tagtranslator.html"}TBExtension.Get(e,"CRTBLoadTagTranslatorTemplate")};var f=function(){const e=TBGlobal.GetToolById("languageanalysis").name;var t=TBGlobal.host+TBGlobal.apiUrls.dataGetChannelLanguageStatistics;TBExtension.Get(t,"CRTagTranslationGetLanguageData")};var g=function(){jQuery(document).on("click",".tb-tag-translator-close, .tb-tag-translator-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-tag-translator-container").hide()});jQuery(document).on("change",".tb-tag-translator-language",function(){var e=jQuery(this).val();var t=jQuery(this).find("option:selected").text();if(e!="select"&&e!=n){n=e;r=0;jQuery("#tb-tag-translator-body").empty();try{TBUtilities.AddAction({TagCount:i.length},TBUtilities.ActionTypes.AutoTranslator_Use,"autotranslator");if(!u){TBUtilities.AddAction(null,TBUtilities.ActionTypes.LanguageAnalysis_Use,"languageanalysis");u=true}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TagTranslator] [addAction]"})}jQuery.each(i,function(e,t){T(t)})}var a=location.pathname;var o=[];var o=a.substring(1).split("/");for(var s=0;s<5-o.length;s++){o.push("")}var l=o[1];var c=jQuery("div.input-container.title ytcp-social-suggestions-textbox#title-textarea").find("div#textbox").text()});jQuery(document).on("click",".tb-tag-translator",function(){TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.tagtranslator)});jQuery(document).on("click",".tb-tag-translator-translation",function(){var e=jQuery(this).attr("data-tag-translated");TBUtilities.AddDebug(e);TBUtilities.ReportProductEvent("Tag Tools Translate Tags Inserted",{timestamp:(new Date).toISOString(),video_id:t,channel_id:TBGlobal.CurrentChannelId(),tool:"Translate Tags"});if(s==null){jQuery(".video-settings-add-tag:first").val(e);jQuery(".video-settings-add-tag:first").focus();jQuery(".video-settings-title:first").focus();jQuery(".video-settings-add-tag").trigger("blur")}else if(typeof s==="function"){s(e)}else{s.closest(".upload-item").find(".video-settings-add-tag:first").val(e);s.closest(".upload-item").find(".video-settings-add-tag:first").focus();s.closest(".upload-item").find(".video-settings-title:first").focus();s.closest(".upload-item").find(".video-settings-add-tag").trigger("blur")}jQuery(this).attr("src",TBGlobal.host+"/images/icons/check.png");jQuery(this).removeClass("tb-tag-translator-translation");jQuery(this).css("cursor","default")});jQuery(document).on("click",".yt-chip",function(){var e=jQuery(this).find("span:first").text();if(!_isRepopulating){TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyKeywordExplorer.Show(e,jQuery(this),null,null,null,null,"Tag Translator")}})};var v=function(){jQuery(document.body).on("CRTBLoadTagTranslatorTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!l){jQuery("body").append(t.response)}else{l.append(t.response)}Q()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] CRTBLoadTagTranslatorTemplate"})}});jQuery(document.body).on("CRTagTranslationGetTranslation",function(e,t){try{if(t.success){var i=JSON.parse(t.response);if(i.Text==i.TranslatedText){jQuery('[data-tag-name="'+i.Text+'"]').html('<span style="font-size:14px; color:#999;">(same)</span>')}else{var a='<img class="tb-tag-translator-translation" data-tag-translated="'+i.TranslatedText+'" style="height:14px; width:14px; position:relative; top:3px; cursor:pointer; margin-right:3px;" src="'+TBGlobal.host+'/images/icons/add2.png"  /> '+i.TranslatedText+' <a target="_blank" href="https://translate.google.com/#auto/'+n+"/"+i.Text+'" style="position:relative; top:02px; float:right;"><img style="height:13px; margin-right:5px;" src="'+TBGlobal.host+'/images/icons/external-blue.png" /></a> <a target="_blank" href="https://www.youtube.com/results?search_query='+i.TranslatedText+'" style="position:relative; top:02px; float:right"><img src="'+TBGlobal.host+'/images/icons/search-blue.png" style="height:13px; margin-right:5px;" /></a>';jQuery('[data-tag-name="'+i.Text+'"]').html(DOMPurify.sanitize(a,DOMPurifyConfig))}}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}});jQuery(document.body).on("CRTagTranslationGetLanguageData",function(e,t){try{if(t.success){a=[];var i=JSON.parse(t.response);jQuery.each(i,function(e,t){if(e>4)return;a.push({y:t.Percent*100,name:t.Language})});m()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySearchRanking] CRSearchRankingAddTerm"})}})};var T=function(e,t){var a="<table>";a+='<tr data-tag="'+e+'" class="tb-search-term-row">';a+='<td style="font-size:14px; width:380px;">'+e+"</td>";if(t){a+='<td data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px;">...</td>'}else{if(r==2&&!TBGlobal.CanAccessLevel3Tools()){a+='<td valign="top" data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px; padding:15px; line-height:18px;" rowspan="'+(i.length-1)+'">Please <a class="tb-tag-translator">Upgrade your License</a> to view translations for the rest of your Tags. Thanks!</td>';TBUtilities.ReportProductEvent("Subscription Paywall",{ChannelId:TBGlobal.CurrentChannelId(),LicenseName:TBGlobal.Profile().LicenseName,Tool:TBGlobal.GetToolById("autotranslator").name,Platform:"extension"})}else if(TBGlobal.CanAccessLevel3Tools()||r<=1){a+='<td data-tag-name="'+e+'" class="tb-tag-translator-translated" style="font-size:14px; width:380px;"><span class="tb-spinner"></span></td>';var o=jQuery.param({Text:e,TargetLanguage:n});var s=TBGlobal.host+TBGlobal.apiUrls.translateGetTranslation;TBExtension.Post(s,o,"CRTagTranslationGetTranslation",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}}a+="</tr></table>";a=DOMPurify.sanitize(a,DOMPurifyConfig);a=TBUtilities.ReplaceAll(a,"<html><head></head><body><table><tbody>","");a=TBUtilities.ReplaceAll(a,"</tbody></table></body></html>","");jQuery("#tb-tag-translator-body").append(a);r++};var j=function(e,t){try{s=t;i=[];jQuery("#tb-tag-translator-body").empty();jQuery(".tb-tag-translator-language").val("select");i=e;jQuery("#tb-tag-translator-no-tags").hide();jQuery.each(i,function(e,t){T(t,true)});jQuery("#tb-tag-translator-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] prepareDialog"})}};var Q=function(){try{f();j(h,s);jQuery("#tb-tag-translator-canvas-loading").hide();jQuery("#tb-tag-translator-canvas").hide();jQuery("#tb-tag-translator-no-history").hide();jQuery("#tb-tag-translator-no-rankings-ever").hide();jQuery("#tb-tag-translator-actual-chart").hide();jQuery("#tb-tag-translator-selected-term-click").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagTranslator] show"})}};return{Show:function(i,a,r,o,n){if(TBGlobal.IsAuthenticated()){h=i;s=a;p=r;console.dir(o);if(o){t=o}if(n){l=n}else{l=null}if(!e){v();y();g();e=true}else if(e&&(n&&jQuery(".tb-tag-translator-modal").length===0)){y()}else{if(jQuery("#tb-tag-translator-container").length==0){y()}else{Q()}}}}}}();var TubeBuddyPublishToFacebook=function(){var e=false;var t=[];var i=null;var a=null;var r=null;var o=null;var n=null;var s=null;var l=null;var u=null;var c=null;var d=0;var b="-~-~~-~~~-~~-~-";var h=null;var p=false;var m="https://graph-video.facebook.com/v2.9/";var y=false;var f=null;var g=TBGlobal.GetToolById("publishtofacebook").name;const v=function(){let e=`${TBGlobal.host}/ModuleManager/PublishToFacebook?v=${TBGlobal.versionNumber}`;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/publishtofacebook.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/publishtofacebook.html"}TBExtension.Get(e,function(e,t,i){try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);R()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] LoadHtml"})}})};var T=function(){var e=TBGlobal.host+TBGlobal.apiUrls.socialAccountsGetFacebook;TBExtension.Get(e,function(e,a,r){try{TBUtilities.Log("TubeBuddyPublishToFacebook - LoadFBAccounts");TBUtilities.Log(a);if(e){t=jQuery.parseJSON(r);if(t.length>0){jQuery(".tb-publish-to-facebook-none").addClass("tb-hid");jQuery(".tb-publish-to-facebook-start-container").removeClass("tb-hid");var o=jQuery(".tb-publish-to-facebook-accounts");o.empty();var n=null;jQuery.each(t,function(e,t){if(n==null&&t.SocialAccountType==1){n=t;o.append(jQuery("<option>").attr("value",t.Id).text(t.Name).prop("selected","selected"))}else{o.append(jQuery("<option>").attr("value",t.Id).text(t.Name))}});if(n!=null){jQuery("#tb-publish-to-facebook-thumbnailContainer").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-video-settings-publish-option-future").prop("disabled",false);jQuery(".tb-publish-to-facebook-video-settings-publish-option-draft").prop("disabled",false);jQuery("input[name=facebook-upload-option]").prop("disabled",false);jQuery(".tb-publish-to-facebook-copy").prop("disabled",false);jQuery("#tb-publish-to-facebook-upload-input").prop("disabled",false)}else{jQuery(".tb-publish-to-facebook-video-settings-publish-options").hide();jQuery(".tb-publish-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery("#tb-publish-to-facebook-thumbnailContainer").addClass("tb-hid");jQuery(".tb-publish-to-facebook-video-settings-publish-option-future").prop("disabled",true);jQuery(".tb-publish-to-facebook-video-settings-publish-option-draft").prop("disabled",true);jQuery(".tb-publish-to-facebook-api-update").show();var s=moment();var l=moment.utc();var u=new Date(l.format());u.setHours(0,0,0,0);var c=new Date("2018-08-01T00:00:00");if(u>=c){jQuery(".tb-publish-to-facebook-copy").prop("disabled",true);jQuery("input[name=facebook-upload-option]").prop("disabled",true);jQuery("#tb-publish-to-facebook-upload-input").prop("disabled",true)}}TBYouTubeApi.GetVideoDetails(i,"snippet, contentDetails, status, fileDetails",G)}else{jQuery(".tb-publish-to-facebook-none").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-start-container").addClass("tb-hid");jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] LoadFBAccounts"})}})};var j=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetLatestPublishToFacebook+"?videoId="+i;TBExtension.Get(e,function(e,t,i){try{if(e){var a=jQuery.parseJSON(i);if(a!=""&&a!=null){var r=jQuery("#tb-publish-to-facebook-published-template").html();var o=r.formatTemplate(a);jQuery(".tb-publish-to-facebook-published-template-container").html(o)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] LoadLastPublish"})}})};var Q=function(){jQuery(document).on("change",'input[name="facebook-upload-option"]',function(e){if(jQuery(this).val()=="upload"){jQuery(".tb-publish-to-facebook-validation").show()}else{jQuery(".tb-publish-to-facebook-validation").hide()}});jQuery(document).on("change","#tb-publish-to-facebook-upload-input",function(e){var t=document.getElementById("tb-publish-to-facebook-upload-input").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"3g2":case"3gp":case"3gpp":case"asf":case"avi":case"dat":case"divx":case"dv":case"flv":case"gif":case"m2ts":case"m4v":case"mkv":case"mod":case"mov":case"mp4":case"mpe":case"mpeg":case"mpeg4":case"mpg":case"mts":case"nsv":case"ogm":case"ogv":case"qt":case"tod":case"ts":case"vob":case"wmv":{jQuery(".tb-publish-to-facebook-validation").hide();jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);$("#namefile").html(t)}break;default:TBUtilities.Alert("Only 3g2, 3gp, 3gpp, asf, avi, dat, divx, dv, f4v, flv, gif, m2ts, m4v, mkv, mod, mov, mp4, mpe, mpeg, mpeg4, mpg, mts, nsv, ogm, ogv, qt, tod, ts, vob, and wmv formats are allowed.");jQuery("#tb-publish-to-facebook-upload-input").val("");return}var a=e.target.files[0].size;if(a>10737418240){TBUtilities.Alert("The maximum video file size is 10GB. Please select a smaller video file.");jQuery("#tb-publish-to-facebook-upload-input").val("");return}});jQuery(document).on("change",".tb-publish-to-facebook-video-settings-publish-option",function(e){var t=jQuery("input[name=scheduledPublishOption]:checked").val();if(t=="future"){jQuery(".tb-publish-to-facebook-video-settings-publish-options").show()}else{jQuery(".tb-publish-to-facebook-video-settings-publish-options").hide()}});jQuery(document).on("change",".tb-publish-to-facebook-accounts",function(e){var i=jQuery(".tb-publish-to-facebook-accounts").val();var a=TBUtilities.GetInArray(t,"Id",i);jQuery(".tb-publish-to-facebook-call-to-action").hide();if(a.SocialAccountType==1){jQuery(".tb-publish-to-facebook-video-settings-publish-option-future").prop("disabled",false);jQuery(".tb-publish-to-facebook-video-settings-publish-option-draft").prop("disabled",false);jQuery("#tb-publish-to-facebook-thumbnailContainer").removeClass("tb-hid");jQuery("input[name=facebook-upload-option]").prop("disabled",false);jQuery(".tb-publish-to-facebook-copy").prop("disabled",false);jQuery("#tb-publish-to-facebook-upload-input").prop("disabled",false)}else{jQuery(".tb-publish-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery(".tb-publish-to-facebook-video-settings-publish-options").hide();jQuery("#tb-publish-to-facebook-thumbnailContainer").addClass("tb-hid");jQuery(".tb-publish-to-facebook-video-settings-publish-option-future").prop("disabled",true);jQuery(".tb-publish-to-facebook-video-settings-publish-option-draft").prop("disabled",true);jQuery(".tb-publish-to-facebook-api-update").show();var r=moment();var o=moment.utc();var n=new Date(o.format());n.setHours(0,0,0,0);var s=new Date("2018-08-01T00:00:00");if(n>=s){jQuery("input[name=facebook-upload-option]").prop("disabled",true);jQuery(".tb-publish-to-facebook-copy").prop("disabled",true);jQuery("#tb-publish-to-facebook-upload-input").prop("disabled",true)}}});jQuery(document).on("click",".tb-add-facebook-accounts",function(e){TBUtilities.Alert("Please link your Facebook account at TubeBuddy.com and then come back to YouTube and click Refresh");jQuery(this).hide();jQuery(".tb-publish-to-facebook-refresh").show();jQuery(".tb-add-facebook-account-div").hide()});jQuery(document).on("click",".tb-publish-to-facebook-refresh",function(e){jQuery(this).hide();jQuery(".tb-add-facebook-accounts").show();TubeBuddyPublishToFacebook.Show(i,a,o)});jQuery(document).on("click",".tb-module-close",function(e){p=true;jQuery(".tb-publish-to-facebook-settings-container").unblock();TubeBuddyMenu.HideBackground();jQuery("#tb-publish-to-facebook-container").hide();jQuery("#namefile").html("No file selected")});jQuery(document).on("click",".tb-publish-to-facebook-copy",function(e){var r=window.location.href;if(r.indexOf("youtube.com/upload")>0){if(!TBGlobal.CanPublishFacebookOnUploadScreen()){TBGlobal.ShowUpgradePage("use Publish To Facebook","publishtofacebook");return}}else{if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("use Publish To Facebook","publishtofacebook");return}}var o=jQuery("input[name='facebook-upload-option']:checked").val();switch(o){case"auto":{break}case"upload":{var n=document.getElementById("tb-publish-to-facebook-upload-input");if(n.files.length==0){TBUtilities.Alert("Please select a video file to Publish to Facebook",function(){jQuery("#tb-publish-to-facebook-upload-input").css({border:"#cc181e 1px solid"});return});return}break}}jQuery(".tb-publish-to-facebook-copy").text("Publishing to Facebook...");jQuery(".tb-publish-to-facebook-copy").attr("disabled",true);jQuery(".tb-publish-to-facebook-validation").hide();TBUtilities.AddAction(null,TBUtilities.ActionTypes.PublishToFacebook_Publish,"publishtofacebook");var s=jQuery(".tb-publish-to-facebook-accounts").val();var l=TBUtilities.GetInArray(t,"Id",s);if(l){TBUtilities.ReportProductEvent("Feature Used",{Tool:g,Action:`Publishing to Facebook`});var u=jQuery(".tb-publish-to-facebook-video-settings-title").val();var c=jQuery(".tb-publish-to-facebook-video-settings-description").val();var d=null;var b=jQuery("input:radio[name='scheduledPublishOption']:checked").val();if(l.SocialAccountType!=1){b="now"}switch(b){case"future":{let e=jQuery("#tb-publish-to-facebook-video-settings-publish-date-mv3").val();var h=jQuery("#tb-publish-to-facebook-video-settings-publish-time").val();var p=jQuery(".tb-publish-to-facebook-video-timezones").val();TBUtilities.Log("date = "+e);TBUtilities.Log("time = "+h);TBUtilities.Log("zone = "+p);TBUtilities.Log("date and time = "+e+" "+h);let t=moment.tz(e+" "+h,"YYYY-MM-DD HH:mm",p);d=t.unix();break}case"now":{d=null;break}case"draft":{d=-1;break}}var m=null;if(l.SocialAccountType==1&&jQuery("#tb-publish-to-facebook-useYouTubeThumbnail").is(":checked")){m=a}B(i,l.Id,u,c,m,d,!jQuery("#tb-publish-to-facebook-addToTimeline").is(":checked"))}})};var k=function(e){TBUtilities.Alert(e)};var B=function(e,i,a,r,o,n,s){TBUtilities.Log("TubeBuddyPublishToFacebook - postVideoToFacebook");var l={VideoId:e,SocialAccountId:i,Title:a,Description:r,Thumbnail:o,PublishDate:n,AddToTimeLine:s};TBUtilities.Log(l);var u=jQuery("input[name='facebook-upload-option']:checked").val();switch(u){case"auto":{var c='<img src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span style="margin-left:10px; font-size: 130%">Publishing To Facebook...</span>';jQuery(".tb-publish-to-facebook-settings-container").block({message:c,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var d=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosPublishToFacebook;TBExtension.Post(d,JSON.stringify(l),function(e,i,a){try{TBUtilities.Log("TubeBuddyPublishToFacebook - PublishToFacebookPublishToFacebook");TBUtilities.Log(a);jQuery(".tb-publish-to-facebook-settings-container").unblock();if(e){jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);jQuery(".tb-publish-to-facebook-video-loaded-step1").addClass("tb-hid");jQuery(".tb-publish-to-facebook-video-loaded-complete").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid");var r=jQuery(".tb-publish-to-facebook-accounts").val();var o=TBUtilities.GetInArray(t,"Id",r);jQuery(".tb-publish-to-facebook-video-loaded-complete-link").attr("href","https://www.facebook.com/"+o.ExternalId+"/videos/"+a.replace(/['"]+/g,""));jQuery(".tb-publish-to-facebook-video-loaded-complete-link").text("https://www.facebook.com/"+o.ExternalId+"/videos/"+a.replace(/['"]+/g,""));jQuery(".tb-publish-to-facebook-close").text("Close")}else{TBUtilities.Log("Failed to publish to FaceBook. Result: "+JSON.stringify(i));if(a==501){jQuery(".tb-publish-to-facebook-published-template-container").addClass("tb-hid");jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);jQuery(".tb-publish-to-facebook-autherror").removeClass("tb-hid")}else{throw"Failed to post to facebook"}}}catch(e){jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);k("There was a problem publishing your video to Facebook.  Please try again later...");TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] PublishToFacebookPublishToFacebook"})}},null,{contentType:"application/json"});break}case"upload":{var c='<div><span class="tb-publish-to-facebook-publishing-message" style="margin-left:10px; font-size: 130%">Publishing To Facebook...</span></div><div><div class="tb-facebook-upload-progress"><div class="tb-facebook-upload-progress-bar"></div><div class="tb-facebook-upload-progress-percent">0%</div></div></div>';jQuery(".tb-publish-to-facebook-settings-container").block({message:c,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});if(o!=null){jQuery(".tb-publish-to-facebook-publishing-message").text("Creating Thumbnail...");var d=TBGlobal.host+TBGlobal.apiUrls.imageGetBytes+"?url="+encodeURIComponent(o);TBExtension.Get(d,function(e,t,i){try{if(e){t.Thumbnail=JSON.parse(i);C(t)}else{throw"Failed to convert thumbnail"}}catch(e){TBUtilities.LogError(e);x("There was a problem publishing your video to Facebook.  Please try again...")}},l)}else{C(l)}break}}};var C=function(e){jQuery(".tb-publish-to-facebook-publishing-message").text("Publishing To Facebook...");var i=document.getElementById("tb-publish-to-facebook-upload-input");d=0;h=null;s=TBUtilities.GetInArray(t,"Id",e.SocialAccountId);c=e;if(i.files.length){n=i.files[0];var a=new FormData;a.append("access_token",s.AccessToken);a.append("upload_phase","start");a.append("file_size",n.size);var r=m+s.ExternalId+"/videos";TBExtension.Post(r,a,function(e,t,i){try{if(e){l=i.upload_session_id;u=i.video_id;var a=U(n,i.start_offset,i.end_offset);if(a.size==0){A()}else{I(n,i.start_offset);w(a,i.start_offset)}}else{TBUtilities.LogFailedWebRequest({Location:"publishToFacebook.js|startUploadToFacebook",Data:t,Response:i});x("There was a problem publishing your video to Facebook.  Please try again...")}}catch(e){TBUtilities.LogError({Exception:e,Location:"publishToFacebook.js|startUploadToFacebook"});x("There was a problem publishing your video to Facebook.  Please try again...")}},null,{dataType:f,contentType:y})}else{x("Please select a video file to upload.")}};var w=function(e,t){if(p===true){TBUtilities.Log("Cancelling upload");return}let i=new FileReader;i.addEventListener("loadend",e=>{let a=i.result;var r=new FormData;r.append("access_token",s.AccessToken);r.append("upload_phase","transfer");r.append("start_offset",t);r.append("upload_session_id",l);r.append("video_file_chunk",a);var o=m+s.ExternalId+"/videos";TBExtension.Post(o,r,function(e,t,i){try{if(e){h=i;var a=U(n,i.start_offset,i.end_offset);if(a.size==0){A()}else{I(n,i.start_offset);w(a,i.start_offset,i.end_offset)}}else{TBUtilities.LogFailedWebRequest({Location:"publishToFacebook.js|sendChunk",Data:t,Response:i});d++;if(d<=4){var a=U(n,h.start_offset,h.end_offset);if(a.size==0){A()}else{I(n,h.start_offset);w(a,h.start_offset,h.end_offset)}}else{jQuery(".tb-publish-to-facebook-settings-container").unblock();jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);k("There was a problem publishing your video to Facebook.  Please try again again...")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"publishToFacebook.js|sendChunk"});d++;if(d<=4){var a=U(n,h.start_offset,h.end_offset);if(a.size==0){A()}else{I(n,h.start_offset);w(a,h.start_offset,h.end_offset)}}else{jQuery(".tb-publish-to-facebook-settings-container").unblock();jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);k("There was a problem publishing your video to Facebook.  Please try again again...")}}},null,{contentType:y,dataType:f})});i.readAsDataURL(e)};var x=function(e){jQuery(".tb-publish-to-facebook-settings-container").unblock();jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",true);k(e)};var I=function(e,t){try{var i=n.size;var a=t/i*100;var r=Math.round(a)+"%";var o=jQuery(".tb-facebook-upload-progress-bar");o.css("width",r);var s=jQuery(".tb-facebook-upload-progress-percent");s.html(r)}catch(e){TBUtilities.Log(e)}};var A=function(e,t){var i=new FormData;i.append("access_token",s.AccessToken);i.append("upload_phase","finish");i.append("upload_session_id",l);i.append("title",c.Title);i.append("description",c.Description);i.append("no_story",c.AddToTimeLine);if(c.Thumbnail!=null){i.append("fb-thumb",c.Thumbnail)}if(c.PublishDate!=null){if(c.PublishDate==-1){i.append("unpublished_content_type","DRAFT");i.append("published","false")}else{i.append("scheduled_publish_time",c.PublishDate);i.append("unpublished_content_type","SCHEDULED");i.append("published","false")}}var a=m+s.ExternalId+"/videos";TBExtension.Post(a,i,function(e,t,i){try{if(e){S(true,i)}else{TBUtilities.LogFailedWebRequest({Location:"publishToFacebook.js|videoUploadComplete",Data:t,Response:i});S(false,i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"publishToFacebook.js|videoUploadComplete"});S(false,i)}},null,{contentType:y,dataType:f})};var S=function(e,i){try{TBUtilities.Log("TubeBuddyPublishToFacebook - clientSideFileUploadComplete");TBUtilities.Log(i);jQuery(".tb-publish-to-facebook-settings-container").unblock();if(e===true){jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);jQuery(".tb-publish-to-facebook-video-loaded-step1").addClass("tb-hid");jQuery(".tb-publish-to-facebook-video-loaded-complete").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid");var a=jQuery(".tb-publish-to-facebook-accounts").val();var r=TBUtilities.GetInArray(t,"Id",a);jQuery(".tb-publish-to-facebook-video-loaded-complete-link").attr("href","https://www.facebook.com/"+r.ExternalId+"/videos/"+u);jQuery(".tb-publish-to-facebook-video-loaded-complete-link").text("https://www.facebook.com/"+r.ExternalId+"/videos/"+u);jQuery(".tb-publish-to-facebook-validation").hide();jQuery(".tb-publish-to-facebook-close").text("Close")}else{throw"Failed to upload to facebook"}}catch(e){x("There was a problem publishing your video to Facebook.  Please try again...");TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] clientSideFileUploadComplete"})}};var U=function(e,t,i){var a=e.mozSlice?e.mozSlice:e.webkitSlice?e.webkitSlice:e.slice?e.slice:noop;return a.bind(e)(t,i)};var L=function(e,t,i){try{y=undefined;f="json";p=false;TBGlobal.AddUserDebugInfo("Opening publish to facebook");var a=t?t:"https://img.youtube.com/vi/"+e+"/mqdefault.jpg";if(TBGlobal.Profile().UserIdForLoginLink!=null)jQuery(".tb-publish-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account/integrations");else jQuery(".tb-publish-to-facebook-accounts-manage").attr("href",TBGlobal.host+"/account/integrations");jQuery("#tb-publish-to-facebook-container").show();jQuery(".tb-publish-to-facebook-copy").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-thumbnail").attr("src",a);jQuery(".tb-publish-to-facebook-start-container").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-finish-container").addClass("tb-hid");jQuery(".tb-publish-to-facebook-none").addClass("tb-hid");jQuery(".tb-publish-to-facebook-autherror").addClass("tb-hid");jQuery(".tb-publish-to-facebook-loading-video").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-video-loaded").addClass("tb-hid");jQuery("#tb-publish-to-facebook-video-thumbnail").attr("src",a);jQuery("#tb-publish-to-facebook-video-link").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-publish-to-facebook-video-link").text(i);jQuery("#tb-publish-to-facebook-text").text("Publish to Facebook");jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid");jQuery(".tb-publish-to-facebook-private").addClass("tb-hid");jQuery(".tb-publish-to-facebook-license").addClass("tb-hid");jQuery(".tb-publish-to-facebook-length").addClass("tb-hid");jQuery(".tb-publish-to-facebook-video-settings-publish-option-now").prop("checked","checked");jQuery("#tb-publish-to-facebook-useYouTubeThumbnail").prop("checked","checked");jQuery(".tb-publish-to-facebook-video-loaded-step1").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-video-loaded-complete").addClass("tb-hid");jQuery(".tb-publish-to-facebook-start").attr("disabled",true);jQuery(".tb-publish-to-facebook-close").text("Cancel");jQuery(".tb-publish-to-facebook-published-template-container").empty();jQuery(".tb-publish-to-facebook-api-update").hide();const d="#tb-publish-to-facebook-video-settings-publish-date-mv3";TBUtilities.DatePickerSetTomorrow(d);TBUtilities.DatePickerSetMin(d);TBUtilities.DatePickerReadOnly(d);var r=window.location.href;if(r.indexOf("youtube.com/upload")>0){jQuery("#addToTimeline").prop("checked",true);jQuery("#tb-publish-to-facebook-useYouTubeThumbnail").prop("checked",false)}else{jQuery("#addToTimeline").prop("checked",false)}jQuery(".tb-publish-to-facebook-video-settings-publish-options").hide();jQuery(".tb-publish-to-facebook-video-timezones").timezones();var o=jQuery(".tb-facebook-upload-progress-bar").css("width","0%");var n=jQuery(".tb-facebook-upload-progress-percent").html("");s=null;l=null;u=null;c=null;jQuery("#tb-publish-to-facebook-upload-input").val("");if(TBGlobal.Profile().LegacyEnabled==true){jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);jQuery(".tb-publish-to-facebook-upload-option").show();jQuery("input[name=facebook-upload-option][value=auto]").attr("checked","checked")}else{jQuery("input[name=facebook-upload-option][value=upload]").attr("checked","checked");jQuery(".tb-publish-to-facebook-upload-option").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] prepareDialog"})}};var G=function(e){try{jQuery(".tb-publish-to-facebook-loading-video").addClass("tb-hid");if(e==null){TBUtilities.Alert("There was an error loading your video.  Please try agian and if the error continues contact support@tubebuddy.com")}if(TBGlobal.Profile().LegacyEnabled==true&&e.contentDetails.durationInMinutes>=45){jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid");jQuery(".tb-publish-to-facebook-length").removeClass("tb-hid")}else if(e.status.privacy=="public"||e.status.privacy=="unlisted"){jQuery(".tb-publish-to-facebook-video-loaded").removeClass("tb-hid");jQuery(".tb-publish-to-facebook-video-settings-title").val(jQuery("<div>").html(e.snippet.title).text());var t=E(jQuery("<div>").html(e.snippet.description).text());jQuery(".tb-publish-to-facebook-video-settings-description").val(t);jQuery(".tb-publish-to-facebook-copy").removeClass("tb-hid");a=e.snippet.thumbnails.thumbnailHigh;r=e.fileDetails.FileName;if(r){jQuery(".tb-publish-to-facebook-upload-filename").text(r)}else{jQuery(".tb-publish-to-facebook-upload-filename-container").hide()}if(TBGlobal.Profile().LegacyEnabled==true){jQuery(".tb-publish-to-facebook-copy").attr("disabled",false);jQuery(".tb-publish-to-facebook-upload-option").show();jQuery("input[name=facebook-upload-option][value=auto]").attr("checked","checked");jQuery(".tb-publish-to-facebook-validation").hide()}else{jQuery("input[name=facebook-upload-option][value=upload]").attr("checked","checked");jQuery(".tb-publish-to-facebook-upload-option").hide();jQuery(".tb-publish-to-facebook-validation").show()}}else{jQuery(".tb-publish-to-facebook-copy").addClass("tb-hid");jQuery(".tb-publish-to-facebook-private").removeClass("tb-hid");var i=window.location.href;if(i.indexOf("youtube.com/upload")>0){jQuery(".tb-publish-to-facebook-private-upload").removeClass("tb-hid")}else{jQuery(".tb-publish-to-facebook-private-upload").addClass("tb-hid")}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPublishToFacebook] getVideoDetailsCallback"})}};var E=function(e){try{var t=e.indexOf(b);if(t>=0){var i=e.lastIndexOf(b);var a="";var r="";if(i>0&&i!=t){a=e.substring(0,t);r=e.substring(i+b.length,e.length)}else{r=e.substring(t+b.length,e.length)}e=a+r}}catch(e){TBUtilities.Log(e)}return e};var R=function(){L(i,a,o);T();j();TBGlobal.ClearUserDebugInfo()};return{Show:function(t,r,n){if(TBGlobal.IsAuthenticated()){i=t;a=r;o=n;if(!e){v();Q();e=true}else{R()}}}}}();const TubeBuddyTagSorter=function(){let e=false;let t="";let i=[];var a=[];const r=0;const o=0;const n="fr";var s=null;let l=null;let u;let c;const d={id:"",term:"",rank:-1,date:""};let b;var a;var s;let h;const p=function(){let e=`${TBGlobal.host}/ModuleManager/TagSorter/TagSorter?v=${TBGlobal.versionNumber}`;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/tagsorter.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/tagsorter.html"}TBExtension.Get(e,"CRTBLoadTagSorterTemplate")};const m=function(){jQuery(document).on("click",".tb-tag-sorter-close, .tb-tag-sorter-closex",()=>{TubeBuddyMenu.HideBackground();jQuery("#tb-tag-sorter-container").hide()});jQuery(document).on("click",".tb-tag-sorter-apply",()=>{TBUtilities.ReportProductEvent("Tag Tools Tags Sort Apply",{timestamp:(new Date).toISOString(),video_id:t,tool:"Tag Tools Sort Apply",sort_by:"manual"});const e=[];jQuery("#tb-tag-sorter-list").find("li").each(function(t,i){e.push(jQuery(this).find(".tb-tag-sorter-tag-name:first").text())});if(h&&typeof h==="function"){h(e)}TubeBuddyMenu.HideBackground();jQuery("#tb-tag-sorter-container").hide();try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagSorter_Sorted,"tagsorter")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TagSorter] [addAction]"})}});jQuery(document).on("click",".tb-tag-sorter-auto-sort",e=>{if(!e.target.classList.contains("tb-btn-disabled")){TBUtilities.ReportProductEvent("Tag Tools Tags Sort Apply",{timestamp:(new Date).toISOString(),video_id:t,tool:"Tag Tools Sort Apply",sort_by:"auto"});jQuery("#tb-tag-sorter-list").empty();i.sort((e,t)=>{let i=TBUtilities.GetInArray(a,"tag",e).rank;let r=TBUtilities.GetInArray(a,"tag",t).rank;if(i==null||i==0)i=999;else i=parseInt(i.toString().replace("#",""));if(r==null||r==0)r=999;else r=parseInt(r.toString().replace("#",""));i=parseInt(i);r=parseInt(r);return i==r?0:i>r?1:-1});let e=1;jQuery.each(i,(t,i)=>{let r="";const o=TBUtilities.GetInArray(a,"tag",i);if(o!=null){if(o.rank!=null&&o.rank!="")r=`&nbsp;&nbsp;<span class="tb-tag-rank-value" style="background-color:#6CC861; color:white;line-height: 14px;font-size: 12px;padding: 1px 4px 1px 4px;border-radius: 2px;position: relative;font-family:"Roboto-Bold", sans-serif;">${o.rank}</span>&nbsp;`}const n=`<li draggable="true"><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">${e}</span>|${e})</span> <span class="tb-tag-sorter-tag-name">${i}</span>${r}</li>`;jQuery("#tb-tag-sorter-list").append(DOMPurify.sanitize(n,DOMPurifyConfig));e++});$(".tb-sortable").sortable()}});jQuery(document).on("click",".tb-tag-sorter",()=>{TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.tagsorter)});jQuery(document).on("sortupdate",".tb-sortable",(e,t)=>{let i=1;jQuery("#tb-tag-sorter-list").find("li").each(function(e,t){jQuery(this).find(".tb-tag-sorter-tag-order").text(i++)})});jQuery(document).on("click",".tb-sorter-remove-duplicates",function(e,t){jQuery(".tb-sorter-is-duplicate").remove();jQuery(this).remove();setTimeout(()=>{jQuery(".tb-sorter-checkmark").fadeOut()},100)})};const y=function(){jQuery(document.body).on("CRTBLoadTagSorterTemplate",(e,t)=>{try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!l){jQuery("body").append(t.response)}else{l.append(t.response)}g()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagSorter] CRTBLoadTagSorterTemplate"})}})};const f=function(e,t,r){try{i=e;a=t;s=r;jQuery("#tb-tag-sorter-list").empty();jQuery(".tb-sorter-auto-sort").addClass("tb-btn-disabled");jQuery(".tb-sorter-auto-sort").qtip({content:{text:"Auto sort is disabled because your video does not rank in top search results for any of the included tags"},style:{classes:"qtip-youtube-tubebuddy",tip:false},position:{at:"bottom left",adjust:{x:-80}}});jQuery(".tb-sorter-remove-duplicates").hide();let o=1;let n=false;jQuery.each(i,(e,a)=>{let r="";const s=TBUtilities.GetInArray(t,"tag",a);if(s!=null){if(s.rank!=null&&s.rank!=""){r=`&nbsp;&nbsp;<span class="tb-tag-rank-value" style="background-color:#6CC861; color:white;line-height: 14px;font-size: 12px;padding: 1px 4px 1px 4px;border-radius: 2px;position: relative;font-family:"Roboto-Bold", sans-serif;">${s.rank}</span>&nbsp;`;jQuery(".tb-sorter-auto-sort").removeClass("tb-btn-disabled");jQuery(".tb-sorter-auto-sort").qtip("destroy")}}let l=false;jQuery.each(i,(t,i)=>{if(e>t&&a.toLowerCase()==i.toLowerCase()){n=true;l=true}});if(!l){const e=`<li><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">${o}</span>|${o})</span> <span class="tb-tag-sorter-tag-name">${a}</span>${r}</li>`;jQuery("#tb-tag-sorter-list").append(DOMPurify.sanitize(e,DOMPurifyConfig))}else{const e=`<li class="tb-sorter-is-duplicate" style="background-color:#FA3535; color: white; "><span style="display:none; font-size:10px; font-weight:bold; background-color:#ffffcc; padding:1px;">(<span class="tb-tag-sorter-tag-order">${o}</span>|${o})</span> <span class="tb-tag-sorter-tag-name">${a}</span>${r}</li>`;jQuery("#tb-tag-sorter-list").append(DOMPurify.sanitize(e,DOMPurifyConfig))}o++});if(n)jQuery(".tb-sorter-remove-duplicates").show();$(".tb-sortable").sortable();jQuery("#tb-tag-sorter-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyPickAWinner] prepareDialog"})}};var g=function(){f(b,a,s)};return{Show(i,r,o,n,u,c){if(TBGlobal.IsAuthenticated()){b=i;a=r;s=o;h=n;if(u){l=u}else{l=null}if(c){t=c}if(!e||u&&jQuery(".tb-tag-sorter-modal").length===0){y();p();m();e=true}else if(jQuery("#tb-tag-sorter-container").length==0){p()}else{g()}}}}}();(function(e){let t;let i=e();e.fn.sortable=function(a){const r=String(a);a=e.extend({connectWith:false},a);return this.each(function(){if(/^(enable|disable|destroy)$/.test(r)){var o=e(this).children(e(this).data("items")).attr("draggable",r=="enable");if(r=="destroy"){o.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s")}return}let n;let s;var o=e(this).children(a.items);const l=e(`<${/^(ul|ol)$/i.test(this.tagName)?"li":"div"} class="sortable-placeholder">`);o.find(a.handle).mousedown(()=>{n=true}).mouseup(()=>{n=false});e(this).data("items",a.items);i=i.add(l);if(a.connectWith){e(a.connectWith).add(this).data("connectWith",a.connectWith)}o.attr("draggable","true").on("dragstart.h5s",function(i){if(a.handle&&!n){return false}n=false;const r=i.originalEvent.dataTransfer;r.effectAllowed="move";r.setData("Text","dummy");s=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",()=>{if(!t){return}t.removeClass("sortable-dragging").show();i.detach();if(s!=t.index()){t.parent().trigger("sortupdate",{item:t})}t=null}).not("a[href], img").on("selectstart.h5s",function(){this.dragDrop&&this.dragDrop();return false}).end().add([this,l]).on("dragover.h5s dragenter.h5s drop.h5s",function(r){if(!o.is(t)&&a.connectWith!==e(t).parent().data("connectWith")){return true}if(r.type=="drop"){r.stopPropagation();i.filter(":visible").after(t);t.trigger("dragend.h5s");return false}r.preventDefault();r.originalEvent.dataTransfer.dropEffect="move";if(o.is(this)){if(a.forcePlaceholderSize){l.height(t.outerHeight())}t.hide();e(this)[l.index()<e(this).index()?"after":"before"](l);i.not(l).detach()}else if(!i.is(this)&&!e(this).children(a.items).length){i.detach();e(this).append(l)}return false})})}})(jQuery);var TubeBuddySuggestedTags=function(){var t=false;var i=0;var a=[];var r=[];var o=[];var n;var s=[];var l=[];var u=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your","ain't","aren't","can't","could've","couldn't","didn't","doesn't","don't","hasn't","he'd","he'll","he's","how'd","how'll","how's","i'd","i'll","i'm","i've","isn't","it's","might've","mightn't","must've","mustn't","shan't","she'd","she'll","she's","should've","shouldn't","that'll","that's","there's","they'd","they'll","they're","they've","wasn't","we'd","we'll","we're","weren't","what'd","what's","when'd","when'll","when's","where'd","where'll","where's","who'd","who'll","who's","why'd","why'll","why's","won't","would've","wouldn't","you'd","you'll","you're","you've","http","https","com","net","org"];var c;var d;var b;var h;var p;var m;var y=function(){var e=TBGlobal.host+"/ModuleManager/SuggestedTags/SuggestedTags?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/suggestedtags.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/suggestedtags.html"}TBExtension.Get(e,"CRTBLoadSuggestedTagsTemplate")};var f=function(){jQuery(document).on("click",".tb-missing-token-oauth-relink",function(){var e=TBUtilities.GetTimeZoneOffSetInHours();var t="";if(TBGlobal.Profile()!=null)t="&agencyid="+encodeURIComponent(TBGlobal.Profile().AgencyId);if(t==null)t="";var i=TBGlobal.host+"/oauth/AuthRedirect?channelid="+TBGlobal.CurrentChannelId()+"&redirectUrl="+encodeURIComponent(window.location)+"&timeZoneOffset="+encodeURIComponent(e)+t;window.location=i});jQuery(document).on("click",".tb-suggested-tags-upgrade-modal",function(){TBGlobal.ShowUpgradePage(null,"suggestedtags")});jQuery(document).on("dblclick",".tb-suggested-tags-header-expand-all",function(){jQuery(this).parent().parent().parent().find(".tb-suggested-tags-details").trigger("click")});jQuery(document).on("click",".tb-suggested-tags-close, .tb-suggested-tags-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-suggested-tags-container").hide()});jQuery(document).on("click","#tb-suggested-tags-warning-btn",function(){jQuery("#tb-suggested-tags-warning").fadeOut(function(){jQuery("#tb-competitorx-analysis-data-table").show()})});jQuery(document).on("click",".suggested-tag",function(){var e=jQuery(this).attr("data-tag");if(e==null||e=="")return;jQuery(this).attr("src",TBGlobal.host+"/images/icons/check.png");jQuery(this).removeClass("suggested-tag");jQuery(this).addClass("suggested-tag-added");jQuery(this).parent().siblings(".tb-suggested-tags-tag").addClass("suggested-tag-added");if(m){m(e)}else{var t=b.parents(".basic-info-form-input");t.find(".video-settings-add-tag:first").val(e);t.find(".video-settings-add-tag:first").focus();t.find(".video-settings-title:first").focus();t.find(".video-settings-add-tag").trigger("blur")}if(jQuery("#tb-suggested-tags-inserted").is(":visible")==false){jQuery("#tb-suggested-tags-inserted").fadeIn().delay(3e3).fadeOut()}o.push(e)});jQuery(document).on("click",".tb-suggested-tags-details",function(){var e=jQuery(this).attr("data-tag");var t=jQuery(this).attr("data-tag-type");if(e==null||e=="")return;var i=".tb-suggested-tags-search-container";if(t=="related"){i=".tb-suggested-tags-related-container"}if(jQuery(this).attr("data-expanded")=="true"){jQuery(this).attr("data-expanded","false");var a=TBGlobal.host+"/images/icons/collapsed.png";jQuery(this).attr("src",a);var r=jQuery(i).find(".tb-suggested-tags-details-row[data-tag='"+e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")+"']");r.remove()}else{jQuery(this).attr("data-expanded","true");var a=TBGlobal.host+"/images/icons/expanded.png";jQuery(this).attr("src",a);var o=jQuery(i).find("tr[data-tag='"+e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")+"']");if(o){var n=null;var u=null;var d=null;var b=TBUtilities.CreateGuid();if(t=="related"){n=TBUtilities.GetInArray(l,"Tag",e);if(n){u=jQuery("#tb-suggested-tags-details-template-related").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","")}}else{n=TBUtilities.GetInArray(s,"Tag",e);if(n){u=jQuery("#tb-suggested-tags-details-template-search").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","")}}d=u.formatTemplate(e,b);if(d){o.after(DOMPurify.sanitize(d,DOMPurifyConfig));v(e,i);var h=TBGlobal.host+TBGlobal.apiUrls.searchRankGetTagRankingsForToday;var p=jQuery.param({Tags:e,VideoId:c});TBExtension.Post(h,p,"CRSuggestedTagsGetTagRankingsForToday",b,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}}}})};var g=function(){o=[];jQuery(".yt-chip").each(function(){var e=jQuery(this).attr("title");if(e){o.push(e.toLowerCase())}})};var v=function(e,t){var i=jQuery("body")[0].outerHTML;var a=i.indexOf('PSUGGEST_TOKEN":"')+'PSUGGEST_TOKEN":"'.length;var r=i.indexOf('"',a);var o=i.substring(a,r);var n="https://clients1.google.com/complete/search?client=youtube&hl=en&gl=us&gs_rn=23&gs_ri=youtube&tok="+o+"&ds=yt&cp=15&gs_id=a&q="+TBUtilities.GetUrlEncoded(e)+"&callback=google.sbox.p50&gs_gbg=3no8d";TBExtension.Get(n,"CRGetRelatedTags",{tag:e,tagContainer:t})};var T=function(){i++;switch(i){case 1:{j();break}case 2:{w();break}case 3:{I();break}case 4:{var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGradeTags;TBExtension.Post(e,JSON.stringify(a),"CRTBSuggestedGradeTags","search",{contentType:"application/json"});break}case 5:{Q();break}case 6:{k();break}case 7:{B();break}case 8:{var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGradeTags;TBExtension.Post(e,JSON.stringify(r),"CRTBSuggestedGradeTags","related",{contentType:"application/json"});break}}};var j=function(){var e=TBUtilities.GetUrlParameter("video_id");if(!e)e=c;var t=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetVideoTrafficSearchTerms+"?videoId="+e;TBExtension.Get(t,"CRTBSuggestedTagsGetVideoTrafficSources")};var Q=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetChannelTrafficSearchTerms;TBExtension.Get(e,"CRTBSuggestedTagsGetChannelTrafficSources")};var k=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetVideoRelatedVideos+"?videoId="+c;TBExtension.Get(e,"CRTBSuggestedTagsGetRelatedVideos")};var B=function(){TBYouTubeApi.GetCurrentChannel(C)};var C=function(t){try{var i=t.Snippet.Title;var a=i.match(/\w+/g),o={},n=[],s,l;for(l=0;l<u.length;l++){o[u[l].trim()]=true}for(l=0;l<a.length;l++){s=a[l].trim().toLowerCase();if(!o[s]){n.push(s)}}for(l=0;l<n.length;l++){var c=n[l];if(c){r.push({Tag:c,Category:1,Source:"channelmeta",Views:null})}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getCurrentChannelFromApiCallback"})}finally{T()}};var w=function(){var e=d.trim();e=e.replace("+","");e=e.replace("@","");e=e.replace("$","");e=e.replace("#","");e=e.replace("-","");e=e.replace('"',"");e=e.replace("*","");e=e.replace("..","");e=e.replace(/([\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2694-\u2697]|\uD83E[\uDD10-\uDD5D])/g,"");TubeBuddyYouTubeActions.GetSearchResults(c,e,x,1,null,undefined,"video")};var x=function(e){try{var t=TBGlobal.GetYouTubeUI();if(t=="default"&&e&&e.response&&e.response.indexOf('window["ytInitialData"]')>-1){t="material"}var i=new Array;switch(t){case"studio":case"material":{try{var r=e.response.indexOf('window["ytInitialData"] =');if(r!=-1){var o=TBUtilities.ParseResponseContextFromHtml(e.response);if(o.contents.twoColumnSearchResultsRenderer.primaryContents){var n=TBUtilities.GetVideoSearchCollection(o.contents.twoColumnSearchResultsRenderer.primaryContents);if(n&&n.length){jQuery.each(n,function(e,t){if(t.videoRenderer){i.push(t.videoRenderer.videoId)}})}}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getSearchResult material UI parse json"})}break}case"default":{var s=DOMPurify.sanitize(e.response,DOMPurifyConfig);jQuery(".item-section",s).find("li > div").each(function(){var e=jQuery(this).attr("data-context-item-id");if(e){i.push(e)}})}}if(i.length==0){T()}else{var l=0;jQuery.each(i,function(e,t){TubeBuddyYouTubeActions.GetVideoTags(t,function(e){jQuery.each(e,function(e,t){if(t.length>=2){a.push({Tag:t,Source:"videosearchresults",Views:null,Category:0})}});l++;if(l>=i.length){T()}})})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getSearchResult"})}};var I=function(){try{jQuery("#tb-suggested-tags-meta-loading").hide();var t=jQuery("#creator-editor-title-link").attr("title");var i=jQuery(".video-settings-description").text();if(typeof t==="undefined"){t=jQuery(".video-settings-title").val()}i=i.replace(/^(\[url=)?(https?:\/\/)?(www\.|\S+?\.)(\S+?\.)?\S+$\s*/gm,"");var r=t+i.substring(1,200);var o=r.match(/\w+/g),n={},s=[],l,c;for(c=0;c<u.length;c++){n[u[c].trim()]=true}for(c=0;c<o.length;c++){l=o[c].trim().toLowerCase();if(!n[l]){s.push(l)}}for(c=0;c<s.length;c++){var d=s[c];if(d){if(d.length>=2){a.push({Tag:d,Category:0,Source:"meta",Views:null})}}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] getUncommonWordsFromMeta"})}finally{T()}};var A=function(e,t,i,a){if(i>=0){var r={VideoId:c,SearchTerm:t,Rank:i};var o=jQuery.param({Rankings:[r]});var n=TBGlobal.host+TBGlobal.apiUrls.searchRankAddRankings;TBExtension.Post(n,o,"CRSuggestedTagsSearchRankingNOTUSED",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}if(i<=0){i="-"}var s=jQuery("#"+a);s.empty();s.append('<span style="color: #999; font-size:14px; line-height: 30px;" >Search Rank</span><br/>');s.append(DOMPurify.sanitize('<span">'+i+"</span>",DOMPurifyConfig))};var S=function(){jQuery(document.body).on("CRTBSuggestedTagsGetTagScore",function(e,t){var i=null;try{if(t.success){i=jQuery.parseJSON(t.response)}i.sort(function(e,t){return t.Score-e.Score})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetTagScore"})}finally{h(i)}});jQuery(document.body).on("CRSuggestedTagsGetTagRankingsForToday",function(e,t){try{if(t.success){var i=JSON.parse(t.response);jQuery.each(i,function(e,i){if(i.Rank==-1){TubeBuddyYouTubeActions.GetVideoSearchRank(c,i.SearchTerm,function(e,i,a){A(c,i,a,t.data)})}else if(i.Rank>=0){A(c,i.SearchTerm,i.Rank,t.data)}})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRSuggestedTagsGetTagRankingsForToday"})}});jQuery(document.body).on("CRGetRelatedTags",function(e,t){try{if(t.success){var i=t.data.tag;var a=jQuery(t.data.tagContainer).find('td[data-origintag="'+i+'"]');var r=t.response.indexOf("[");var n=t.response.indexOf("{");var s=t.response.substring(r,n);s=TBUtilities.ReplaceAll(s,'"',"'");var l=s.match(/'[^']*'/g);a.empty();var u=0;var c=[];jQuery.each(l,function(e,t){if(u>=5){return false}var r=t.replace(/["']/g,"");r=r.replace("\\u0027","");r=r.replace("\\u0026","&");r=r.replace("&","&");if(r!=i&&c.indexOf(r)==-1){var n="suggested-tag";var s=TBGlobal.host+"/images/icons/add.png";if(o.indexOf(r)!=-1){n="suggested-tag-added";s=TBGlobal.host+"/images/icons/check.png"}var l=jQuery("#tb-suggested-tags-related-template").html();var d=l.formatTemplate(r,n,s);a.append(DOMPurify.sanitize(d,DOMPurifyConfig));c.push(r);u++}});var d=jQuery(t.data.tagContainer).find('td[data-origintag="'+i+'"]');if(d.find(".tb-suggested-tags-tag").length==0){d.html('<span style="margin-top:5px;color: #999; font-size:14px; line-height: 30px">No Suggested Searches found</span>')}else{d.prepend('<span style="color: #999; font-size:14px; line-height: 30px;" >Auto-Suggested by YouTube Search</span><br/>')}}}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRGetRelatedTags"})}});jQuery(document.body).on("CRTBLoadSuggestedTagsTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);U()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBLoadSuggestedTagsTemplate"})}});jQuery(document.body).on("CRTBSuggestedTagsGetVideoTrafficSources",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.TrafficSearchTerms.length>0){jQuery.each(i.TrafficSearchTerms,function(e,t){if(t.SearchTerm.length>=2){a.push({Tag:t.SearchTerm,Source:"videosearchtraffic",Views:t.Views,Category:0})}})}}else{if(t.httpErrorCode==501){jQuery("#tb-suggested-tags-traffic-need-scope").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetVideoTrafficSources"})}finally{T()}});jQuery(document.body).on("CRTBSuggestedTagsGetChannelTrafficSources",function(e,t){try{jQuery("#tb-suggested-tags-related-loading").hide();if(t.success){var i=jQuery.parseJSON(t.response);if(i.TrafficSearchTerms.length>0){jQuery.each(i.TrafficSearchTerms,function(e,t){if(t.SearchTerm.length>=2){r.push({Tag:t.SearchTerm,Source:"channelsearchtraffic",Views:t.Views,Category:1})}})}}else{if(t.httpErrorCode==501){jQuery("#tb-suggested-tags-need-scope").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetVideoTrafficSources"})}finally{T()}});jQuery(document.body).on("CRTBSuggestedTagsGetRelatedVideos",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var a=0;jQuery.each(i,function(e,t){TubeBuddyYouTubeActions.GetVideoTags(t.id,function(e){jQuery.each(e,function(e,t){if(t.length>=2){r.push({Tag:t,Category:1,Source:"relatedvideos",Views:null})}});a++;if(a>=i.length){T()}})})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedTagsGetRelatedVideos"})}});jQuery(document.body).on("CRTBSuggestedGradeTags",function(e,t){try{if(t.success){if(t.data=="search"){jQuery("#tb-suggested-tags-search-body").empty()}else{jQuery("#tb-suggested-tags-related-body").empty()}var i=jQuery.parseJSON(t.response);var a=jQuery("#tb-suggested-tags-row-template").html().replace("<table>","").replace("</table>","").replace("<tbody>","").replace("</tbody>","");a=TBUtilities.FixLocalHtml(a);jQuery.each(i.GradedTags,function(e,i){if(i.Tag.length>=2){var r="display:none";if(i.IsCensored===true){r=""}var n="suggested-tag";var s=TBGlobal.host+"/images/icons/add.png";if(o.indexOf(i.Tag)!=-1){n="suggested-tag-added";s=TBGlobal.host+"/images/icons/check.png"}if(t.data=="search"){var l=i.Views==null||i.Views==0?"-":TBUtilities.FormatNumberAbbreviated(i.Views);var u=i.TopRankingVideosOccurrences==null||i.TopRankingVideosOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.TopRankingVideosOccurrences);var c=i.WordUsedInMetaOccurrences==null||i.WordUsedInMetaOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.WordUsedInMetaOccurrences);var d=a.formatTemplate(i.Tag,n,s,l,u,c,t.data,r);jQuery("#tb-suggested-tags-search-body").append(DOMPurify.sanitize(d,DOMPurifyConfig))}else{var l=i.Views==null||i.Views==0?"-":TBUtilities.FormatNumberAbbreviated(i.Views);var b=i.WordUsedInChannelMetaOccurrences==null||i.WordUsedInChannelMetaOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.WordUsedInChannelMetaOccurrences);var h=i.TopRelatedOccurrences==null||i.TopRelatedOccurrences==0?"-":TBUtilities.FormatNumberAbbreviated(i.TopRelatedOccurrences);var d=a.formatTemplate(i.Tag,n,s,l,h,b,t.data,r);jQuery("#tb-suggested-tags-related-body").append(DOMPurify.sanitize(d,DOMPurifyConfig))}}});switch(t.data){case"search":{jQuery(".tb-suggested-tags-search-loading").hide();s=i.GradedTags;if(i.GradedTags.length>0){jQuery(".tb-suggested-tags-search-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){if(jQuery(".tb-suggested-tags-search-container").find(".tb-suggested-tags-search-container-list-upgrade").length==0){let e='<div class="tb-suggested-tags-related-container-list-upgrade" style="text-align:center;margin-top:2px; padding-top:5px; padding-bottom:5px; font-size:12px; line-height:15px;"><br>Only '+i.GradedTags.length+" of "+i.TotalResults+' total results are shown. <br><br>Please consider <a style="cursor:pointer" class="tb-suggested-tags-upgrade-modal">Upgrading your License</a> to see all results.<br><br><br></div>';jQuery("#tb-suggested-tags-search-table").after(DOMPurify.sanitize(e,DOMPurifyConfig))}}}else{jQuery(".tb-suggested-tags-search-none").show()}break}case"related":{jQuery(".tb-suggested-tags-related-loading").hide();l=i.GradedTags;if(i.GradedTags.length>0){jQuery(".tb-suggested-tags-related-container").show();if(TBGlobal.CanAccessLevel1Tools()==false){if(jQuery(".tb-suggested-tags-related-container").find(".tb-suggested-tags-related-container-list-upgrade").length==0){let e='<div class="tb-suggested-tags-related-container-list-upgrade" style="text-align:center;margin-top:2px; padding-top:5px; padding-bottom:5px; font-size:12px; line-height:15px;"><br>Only '+i.GradedTags.length+" of "+i.TotalResults+' total results are shown. <br><Br>Please consider <a style="cursor:pointer" class="tb-suggested-tags-upgrade-modal">Upgrading your License</a> to see all results.<br><br><br></div>';jQuery("#tb-suggested-tags-related-table").after(DOMPurify.sanitize(e,DOMPurifyConfig))}}}else{jQuery(".tb-suggested-tags-related-none").show()}break}}}jQuery(".tb-suggested-tags-key").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] CRTBSuggestedGradeTags"})}finally{T()}})};var U=function(){try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.SuggestedTags_Use,"suggestedtags")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySuggestedTags] [addAction]"})}jQuery("#tb-suggested-tags-need-scope").hide();jQuery("#tb-suggested-tags-container").show();jQuery(".tb-suggested-tags-search-loading").show();jQuery(".tb-suggested-tags-search-container").hide();jQuery(".tb-suggested-tags-related-loading").show();jQuery(".tb-suggested-tags-related-container").hide();jQuery(".tb-suggested-tags-related-none").hide();jQuery(".tb-suggested-tags-search-none").hide();jQuery(".tb-suggested-tags-related-container-list-upgrade").remove();jQuery(".tb-suggested-tags-search-container-list-upgrade").remove();jQuery(".tb-suggested-tags-key").hide();if(typeof n==="undefined"||n==null){g()}else{o=n}i=0;T()};var L=function(e,t){h=t;p=e;var i=jQuery("body")[0].outerHTML;var a=i.indexOf('PSUGGEST_TOKEN":"')+'PSUGGEST_TOKEN":"'.length;var r=i.indexOf('"',a);var o=i.substring(a,r);var n=0;var s=[];var l=[];jQuery.each(e,function(e,t){if(t.split(" ").length>1){l.push(t)}});jQuery.each(l,function(t,i){TubeBuddyYouTubeActions.GetYouTubeAutoComplete(o,i,function(t){n++;if(t&&t.length>0){s.push.apply(s,t)}if(n>=l.length){var i=TBGlobal.GetPrefCookieObject();var a={Region:"us",Tags:[],Language:"en"};if(i&&i.gl){a.Region=i.gl}if(i&&i.hl){a.Language=i.hl}var r=[];jQuery.each(s,function(t,i){if(jQuery.inArray(i,r)===-1&&jQuery.inArray(i,e)===-1){r.push(i)}});a.Tags=r;var o=TBGlobal.host+TBGlobal.apiUrls.tagScoreGet;TBExtension.Post(o,JSON.stringify(a),"CRTBSuggestedTagsGetTagScore",null,{contentType:"application/json"})}})})};return{Show:function(e,i,s,l,u){if(TBGlobal.IsAuthenticated()){a=[];r=[];o=[];c=e;d=i;b=s;n=l;m=u;if(!t){S();y();f();t=true}else{U()}}},GetTagSuggestions:function(e,i){if(!t){S()}L(e,i)}}}();const TubeBuddySunsetVideo=function(){let e=false;let t=null;let i=null;let a=null;let r=null;const o=function(){const e=chrome.runtime.getURL("modules/sunsetvideo.html");TBExtension.Get(e,(e,t,i)=>{try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] loadHtml"})}})};const n=function(){jQuery(document).on("change","#tb-sunset-video-removeFromPlaylistOptions",function(e){const t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){jQuery("#tb-sunset-video-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-sunset-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-sunset-video-removeFromPlaylistIds").prop("disabled",false);jQuery("#tb-sunset-playlist-options").show()}else{jQuery("#tb-sunset-video-removeFromAllPlaylists").prop("disabled",true);jQuery("#tb-sunset-video-removeFromPlaylistIds").prop("disabled",true);jQuery("#tb-sunset-video-input-ids").val("");jQuery("#tb-sunset-video-input-ids").prop("disabled",true);t.disable();jQuery("#tb-sunset-playlist-options").hide()}});jQuery(document).on("change","#tb-sunset-video-removeFromPlaylistIds",function(e){const t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");console.log(jQuery(this).is(":checked"));if(jQuery(this).is(":checked")){jQuery("#tb-sunset-playlists-wrapper").removeClass("tb-hidden").show();t.enable()}else{console.log("not");t.disable();jQuery("#tb-sunset-playlists-wrapper").addClass("tb-hidden").hide()}});jQuery(document).on("change","#tb-sunset-video-removeFromAllPlaylists",function(e){const t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){jQuery("#tb-sunset-video-input-ids").val("");jQuery("#tb-sunset-video-input-ids").prop("disabled",true);jQuery("#tb-sunset-playlists-wrapper").hide();t.disable()}else{}});jQuery(document).on("click",".tb-sunset-video-upgrade-link",e=>{TBGlobal.ShowUpgradePage("","sunsetvideos")});jQuery(document).on("click","#tb-sunset-video-timepicker",e=>{TBUtilities.Log("aa");if(jQuery("#tb-sunset-video-edit:visible").find(".tp-timepicker_wrap").length>0){TBUtilities.Log("cc");if(jQuery("#tb-sunset-video-edit:visible").find(".tp-timepicker_wrap")[0].outerHTML.indexOf("tb-pickr-midnight")==-1){TBUtilities.Log("dd");jQuery("#tb-sunset-video-edit:visible").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')}}TBUtilities.Log("bb")});jQuery(document).on("click",".tb-pickr-set-to-midnight",e=>{jQuery("#tb-sunset-video-edit").find(".tp-meridian").find("input").val("AM");jQuery("#tb-sunset-video-edit").find(".tp-time").find("input").val("12");jQuery("#tb-sunset-video-edit").find(".tp-mins").find("input").val("00")});jQuery(document).on("click",".tb-sunset-video-close",e=>{TubeBuddyMenu.HideBackground();jQuery("#tb-video-scheduled-action-container").hide()});jQuery(document).on("click",".tb-sunset-video-cancel",e=>{try{TBUtilities.Confirm("Are you sure you want to cancel this Sunset Video?",()=>{const e=TBGlobal.GetToolById("sunsetvideos").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:e,Action:"Cancelling sunsetting video"});const i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosDeleteYouTubeVideoScheduledAction;const a={Id:t};TBExtension.Post(i,JSON.stringify(a),(e,t,i)=>{if(e){jQuery(".tb-sunset-video-cancel").addClass("tb-hidden").hide();jQuery("#tb-sunset-video-current").html("");jQuery("#tb-sunset-video-current").addClass("tb-hidden").hide();jQuery("#tb-sunset-video-edit").removeClass("tb-hidden").show();jQuery(".tb-sunset-video-save").removeClass("tb-hidden").show()}},null,{contentType:"application/json"})},()=>{})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] cancel click"})}});jQuery(document).on("click",".tb-sunset-video-save",e=>{const t=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");let i=t.getSelectedPlaylistIds();i=TBUtilities.ReplaceAll(i.join(",")," ","");if(i==null)i="";const a=i.trim();if(a==""&&jQuery("#tb-sunset-video-removeFromPlaylistIds").is(":checked")&&jQuery("#tb-sunset-video-removeFromPlaylistOptions").is(":checked")){TBUtilities.Alert("There was a problem validating your playlists.  Please check your playlists and try again...")}else{s()}})};var s=function(){TBUtilities.AddAction(null,TBUtilities.ActionTypes.SunsetVideos_Schedule,"sunsetvideos");const e=TBGlobal.GetToolById("sunsetvideos").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:e,Action:"Sunsetting video"});try{jQuery(".tb-sunset-video-save").text("Scheduling...");jQuery(".tb-sunset-video-save").attr("disabled",true);const e=jQuery('.tb-video-scheduled-action-privacy:first input[name="privacy"]:checked').val();const a=jQuery("#tb-sunset-video-datepicker-mv3").val();const r=d(jQuery("#tb-sunset-video-timepicker").val());const o=jQuery("#tb-sunset-video-timepicker").val();const n=jQuery("#tb-sunset-video-timezone-select").val();const s=jQuery("#tb-sunset-video-removeFromPlaylistOptions").is(":checked");let l=jQuery("#tb-sunset-video-removeFromAllPlaylists").is(":checked");const u=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");const b=u.getSelectedPlaylistIds();let h=b.join(",");if(s==false){l=false;h=""}const p=jQuery("#tb-sunset-video-emailreminder").is(":checked");const m=jQuery("#tb-sunset-video-emailreminder-now").is(":checked");const y={Id:t,Type:0,VideoId:i,ActionType:e,Date:a,Time:r,TimeZoneId:n,RemoveFromAllPlaylists:l,PlaylistIdsToRemoveFrom:h,SendWarningEmail:p,SendWarningEmailNow:m,TimeRecent:o};TBUtilities.Log(y);TBExtension.SetDbValue(`tb-sunset-recent-${TBGlobal.CurrentChannelId()}`,y);const f=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosAddYouTubeVideoScheduledAction;TBExtension.Post(f,JSON.stringify(y),(e,t,i,a)=>{jQuery(".tb-sunset-video-save").text("Schedule Sunset");jQuery(".tb-sunset-video-save").attr("disabled",false);if(e){try{const e=jQuery.parseJSON(i);if(e.LocalDate!=null){c(e)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] save"})}}else if(a==426){TBUtilities.Alert("You must select a date and time in the future.")}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...")}},null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] save click"});jQuery(".tb-sunset-video-save").text("Schedule Sunset");jQuery(".tb-sunset-video-save").attr("disabled",false)}};const l=function(){TBUtilities.DatePickerSetMin("#tb-sunset-video-datepicker-mv3");TBUtilities.DatePickerReadOnly("#tb-sunset-video-datepicker-mv3");TBExtension.GetDbValue(`tb-sunset-recent-${TBGlobal.CurrentChannelId()}`,(e,t)=>{TBUtilities.Log("Got TBSunsetGetRecent");TBUtilities.Log(t);if(t){if(new Date(t.Date)<new Date)t.Date=new Date;jQuery("#tb-sunset-video-timezone-select").val(t.TimeZoneId);TBUtilities.DatePickerSetValue("#tb-sunset-video-datepicker-mv3",t.Date);jQuery("#tb-sunset-video-emailreminder").prop("checked",t.SendWarningEmail);jQuery("#tb-sunset-video-emailreminder-now").prop("checked",t.SendWarningEmailNow);const e=jQuery(`.tb-video-scheduled-action-privacy input[name="privacy"][value="${t.ActionType}"]`);if(e){e.prop("checked",true)}jQuery("#tb-sunset-video-timepicker").val(t.TimeRecent);if(jQuery("#tb-video-scheduled-action-container").find(".tp-time_pick").length==0)jQuery("#tb-sunset-video-timepicker").timepicki({start_time:[t.TimeRecent.substring(0,2),t.TimeRecent.substring(5,7),t.TimeRecent.substring(10,12).toUpperCase()],increase_direction:"up"})}else if(!jQuery("#tb-sunset-video-timepicker").attr("data-timepicki-tim")){jQuery("#tb-sunset-video-timepicker").val("09 : 30 : AM");jQuery("#tb-sunset-video-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}})};const u=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(i){const e=`${TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledAction}?videoId=${i}&type=0`;TBExtension.Get(e,(e,t,i)=>{try{if(e){const e=jQuery.parseJSON(i);jQuery("#tb-video-scheduled-action-loading").addClass("tb-hidden").hide();jQuery("#tb-video-scheduled-action-loaded").removeClass("tb-hidden").show();jQuery(".tb-sunset-video-save").removeClass("tb-hidden").show();jQuery(".tb-sunset-video-cancel").addClass("tb-hidden").hide();const t=document.getElementById("tb-sunset-video-datepicker-mv3");t.onchange=function(){try{const e=24*60*60*1e3;const t=Math.abs((new Date(date).getTime()-(new Date).getTime())/e);if(t<=1){document.querySelector("#tb-sunset-video-emailreminder'").checked=false;document.querySelector("#tb-sunset-video-emailreminder'").disabled=true}else{document.querySelector("#tb-sunset-video-emailreminder'").disabled=false}}catch(e){TBUtilities.Log(e)}};TBUtilities.DatePickerSetTomorrow("#tb-sunset-video-datepicker-mv3");const a=jQuery("#tb-sunset-video-timezone-select");a.empty();jQuery(e.TimeZones).each(function(){a.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});try{const t=TBUtilities.GetTimeZoneOffSetInHours();jQuery.each(e.TimeZones,(e,i)=>{if(i.DisplayName.indexOf(t)>0){a.val(i.Id)}})}catch(e){}jQuery("#tb-sunset-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-sunset-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-sunset-video-input-ids").prop("disabled",true);if(e.LocalDate!=null){c(e);if(!jQuery("#tb-sunset-video-timepicker").attr("data-timepicki-tim")&&jQuery("#tb-video-scheduled-action-container").find(".tp-time_pick").length==0){jQuery("#tb-sunset-video-timepicker").val("09 : 30 : AM");jQuery("#tb-sunset-video-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}}else{setTimeout(l,100)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] getScheduledAction"})}})}}else{TBGlobal.ShowUpgradePage("",TBGlobal.limitation.sunsetvideos);jQuery("#tb-video-scheduled-action-container").addClass("tb-hid").hide();jQuery("#tb-video-scheduled-action-loading").addClass("tb-hidden").hide();jQuery(".tb-sunset-video-save").addClass("tb-hidden").hide()}};var c=function(e){try{t=e.Id;jQuery("#tb-sunset-video-timezone-select").val(e.TimeZoneId);const i=jQuery("#tb-sunset-video-currentTemplate").html();let a="No playlist changes";if(e.RemoveFromAllPlaylists==true){a="Video will be removed from <span><strong>all</strong> playlists</span>"}else if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom!=""){const t=e.PlaylistIdsToRemoveFrom.split(",");if(e.PlaylistHtmlToRemoveFrom&&e.PlaylistHtmlToRemoveFrom!="(none)"){a=`<div style="display: inline-block;">${e.PlaylistHtmlToRemoveFrom}</div>`}else{jQuery.each(t,(e,t)=>{a=`<strong style="font-size:13px;"><a target="_blank" href="https://www.youtube.com/playlist?list=${t}">${t}</a></strong>`})}}let r="We'll send you an email reminder the day before";if(e.SendWarningEmail==false){r="No reminder"}const o=i.formatTemplate(e.ActionLabel,e.LocalDate,b(e.LocalTime),jQuery("#tb-sunset-video-timezone-select option:selected").text(),a,r);jQuery("#tb-sunset-video-current").html(DOMPurify.sanitize(o,DOMPurifyConfig));jQuery("#tb-sunset-video-current").removeClass("tb-hidden").show();jQuery(".tb-sunset-video-cancel").removeClass("tb-hidden").show();jQuery("#tb-sunset-video-edit").addClass("tb-hidden").hide();jQuery(".tb-sunset-video-save").addClass("tb-hidden").hide();jQuery(".tb-sunset-video-close").text("Close")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTubeBuddySunsetVideo] setScheduledAction"})}};var d=function(e){const t=e.split(":");if(t.length!=3){throw"invalid time format"}let i=t[0];const a=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i+=12}if(t[2].trim()=="AM"&&t[0]==12)i=0;const r=parseInt(i,10)*60+parseInt(a,10);return r};var b=function(e){let t=Math.floor(e/60);var e=e%60;const i=t>=12?"PM":"AM";t%=12;t=t||12;e=e<10?`0${e}`:e;const a=`${t}:${e} ${i}`;return a};var h=function(){jQuery("#tb-video-scheduled-action-container").show();jQuery("#tb-video-scheduled-action-loading").removeClass("tb-hidden").show();jQuery("#tb-video-scheduled-action-loaded").addClass("tb-hidden").hide();jQuery("#tb-sunset-video-current").addClass("tb-hidden").hide();jQuery(".tb-sunset-video-cancel").addClass("tb-hidden").hide();jQuery(".tb-video-scheduled-action-upgrade").addClass("tb-hidden").hide();jQuery(".tb-sunset-video-save").removeClass("tb-hidden").show();jQuery("#tb-sunset-video-edit").removeClass("tb-hidden").show();jQuery(".tb-sunset-video-save").addClass("tb-hidden").hide();jQuery("#tb-sunset-video-emailreminder").attr("disabled",false);jQuery("#tb-sunset-video-input-ids").val("");jQuery("#tb-sunset-video-emailreminder").attr("checked",true);jQuery("#tb-sunset-video-thumbnail").attr("src",r);jQuery("#tb-sunset-video-watch-link").text(a);jQuery("#tb-sunset-video-watch-link").attr("href",`https://www.youtube.com/watch?v=${i}`);jQuery(".tb-sunset-video-close").text("Cancel");jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true});const e=jQuery("#tb-sunset-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");e.disable();u()};return{Show(t,s,l){if(TBGlobal.IsAuthenticated()){i=t;a=s;r=l||`https://img.youtube.com/vi/${i}/mqdefault.jpg`;if(!e){o();n();e=true}else{h()}}}}}();const TubeBuddyScheduledPublish=function(){let e=false;let t=null;let i=null;let a=null;let r=null;let o=null;const n=function(){const e=chrome.extension.getURL("modules/scheduledpublish.html");TBExtension.Get(e,(e,t,i)=>{try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);f();y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledPublish] LoadHtml"})}})};const s=function(){jQuery(document).on("change","#tb-go-live-video-addToPlaylists",function(e){if(jQuery(this).is(":checked")){var t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");t.enable();jQuery("#tb-go-live-playlist-options").show()}else{var t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");t.disable();jQuery("#tb-go-live-playlist-options").hide()}});jQuery(document).on("change","#tb-go-live-video-addCommentUponPublish",function(e){if(jQuery(this).is(":checked"))jQuery(".tb-go-live-comment-text-container").removeClass("tb-hidden");else jQuery(".tb-go-live-comment-text-container").addClass("tb-hidden")});jQuery(document).on("keyup",".tb-go-live-video-comment-textarea",function(e){const t=jQuery(this).val().length;jQuery(".tb-go-live-video-comment-char-count").text(t);if(t>500){jQuery(".tb-go-live-video-comment-char-count-container").addClass("tb-font-color-red");jQuery(".tb-go-live-video-comment-char-count-error-text").removeClass("tb-hidden");jQuery(this).addClass("tb-go-live-video-comment-error");jQuery(".tb-go-live-video-save").addClass("tb-btn-disabled")}else{jQuery(".tb-go-live-video-comment-char-count-error-text").addClass("tb-hidden");jQuery(".tb-go-live-video-comment-char-count-container").removeClass("tb-font-color-red");jQuery(this).removeClass("tb-go-live-video-comment-error");jQuery(".tb-go-live-video-save").removeClass("tb-btn-disabled")}});jQuery(document).on("click","#tb-go-live-timepicker",e=>{if(jQuery("#tb-go-live-video-edit").find(".tp-timepicker_wrap").length>0){if(jQuery("#tb-go-live-video-edit .tb-pickr-midnight").length==0){jQuery("#tb-go-live-video-edit").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:15px 5px 0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')}}});jQuery(document).on("click",".tb-pickr-set-to-midnight",e=>{jQuery("#tb-go-live-video-edit").find(".tp-meridian").find("input").val("AM");jQuery("#tb-go-live-video-edit").find(".tp-time").find("input").val("12");jQuery("#tb-go-live-video-edit").find(".tp-mins").find("input").val("00")});jQuery(document).on("click",".tb-go-live-video-upgrade-link",e=>{TBGlobal.ShowUpgradePage("","schedulegolive")});jQuery(document).on("click",".tb-go-live-video-close, .tb-go-live-video-closex",e=>{TubeBuddyMenu.HideBackground();jQuery("#tb-go-live-video").hide();g();p()});jQuery(document).on("click",".tb-go-live-video-cancel",e=>{try{TBUtilities.Confirm("Are you sure you want to cancel this Scheduled Publish?",()=>{const e=TBGlobal.GetToolById("schedulegolive").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:e,Action:"Cancelling schedule video publish"});const a=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosDeleteYouTubeVideoScheduledAction;const r={Id:t};TBExtension.Post(a,JSON.stringify(r),(e,t,a)=>{if(e){jQuery(".tb-go-live-video-cancel").addClass("tb-hid").hide();jQuery("#tb-go-live-video-current").html("");jQuery("#tb-go-live-video-current").addClass("tb-hid").hide();jQuery("#tb-go-live-video-edit").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").removeClass("tb-hid").show();jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hidden").hide();i=null;setTimeout(b,100)}},null,{contentType:"application/json"})},()=>{})}catch(e){TBUtilities.LogError({Exception:e,Location:"[tb-go-live-video-cancel] cancel click"})}});jQuery(document).on("click",".tb-go-live-video-edit-scheduled",e=>{jQuery("#tb-go-live-video-current").addClass("tb-hid").hide();jQuery(".tb-go-live-video-cancel").addClass("tb-hid").hide();jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hidden").hide();jQuery("#tb-go-live-video-edit").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").removeClass("tb-hid").text("Save Scheduled Publish").show();jQuery("#tb-go-live-video-timezone-select").val(i.TimeZoneId);let t=i.LocalDate;t=new Date(t);t=t.toISOString().split("T")[0];TBUtilities.DatePickerReadOnly("#tb-go-live-video-datepicker-mv3");document.querySelector("#tb-go-live-video-datepicker-mv3").value=t;const a=jQuery(`.tb-go-live-video-privacy input[name="privacy"][value="${i.ActionType}"]`);if(a){a.prop("checked",true)}p();let r=u(i.LocalTime);if(r.length==7)r=`0${r}`;const o=r.substring(0,2);const n=r.substring(3,5);const s=r.substring(6,8).toUpperCase();jQuery("#tb-go-live-timepicker").val(`${o} : ${n} : ${s}`);jQuery("#tb-go-live-timepicker").attr("data-timepicki-tim",o).attr("data-timepicki-mini",n).attr("data-timepicki-meri",s);jQuery("#tb-go-live-timepicker").timepicki({start_time:[o,n,s],increase_direction:"up"});if(i.PlaylistIdsToAddTo){const e=i.PlaylistIdsToAddTo.split(",");jQuery("#tb-go-live-video-addToPlaylists").prop("checked","checked");const t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");t.enable();jQuery("#tb-go-live-playlist-options").show();jQuery("#tb-go-live-playlist-options").after('<div class="tb-go-live-video-edit-playlist-opts-loading" style="background-color:white;margin-left:2px;width:412px;position:relative;top:-22px;display:flex;align-items:center;"><span class="tb-spinner"></span><span>Loading selections...</span></div>');var l=setInterval(()=>{const t=jQuery(".playlistSelectMutliSelectListItem .tb-material-checkbox-input");if(t.length>0){clearInterval(l);jQuery.each(t,function(){if(e.indexOf(jQuery(this).val())>-1&&!jQuery(this).is(":checked")){jQuery(this).trigger("click")}});jQuery(".tb-go-live-video-edit-playlist-opts-loading").remove()}},1e3)}if(i.AddCommentUponPublish&&i.AddCommentUponPublish.length>0){jQuery("#tb-go-live-video-addCommentUponPublish").prop("checked","checked");jQuery(".tb-go-live-video-comment-textarea").val(i.AddCommentUponPublish);jQuery(".tb-go-live-comment-text-container").removeClass("tb-hidden");jQuery(".tb-go-live-video-comment-textarea").trigger("keyup")}if(i.SendWarningEmail)jQuery("#tb-go-live-video-emailreminder").prop("checked","checked");if(i.SendWarningEmailNow)jQuery("#tb-go-live-video-emailreminder-now").prop("checked","checked")});jQuery(document).on("click",".tb-go-live-video-save",function(e){if(jQuery(this).hasClass("tb-btn-disabled"))return;const t=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");let r=t.getSelectedPlaylistIds();r=TBUtilities.ReplaceAll(r.join(",")," ","");if(r==null)r="";const o=r.trim();if(o==""&&jQuery("#tb-go-live-video-addToPlaylists").is(":checked")){TBUtilities.Alert("There was a problem validating your playlists.  Please check your playlists and try again...")}else if(i&&i.VideoId==a){c(true)}else{c()}jQuery(".tb-go-live-video-edit-scheduled").removeClass("tb-hidden").show()})};const l=function(e){const t=e.split(":");if(t.length!=3){throw"invalid time format"}let i=t[0];const a=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i+=12}if(t[2].trim()=="AM"&&t[0]==12)i=0;const r=parseInt(i,10)*60+parseInt(a,10);return r};var u=function(e){let t=Math.floor(e/60);var e=e%60;const i=t>=12?"PM":"AM";t%=12;t=t||12;e=e<10?`0${e}`:e;const a=`${t}:${e} ${i}`;return a};var c=function(e){const i=TBGlobal.GetToolById("schedulegolive").name;TBUtilities.AddAction(null,TBUtilities.ActionTypes.ScheduleGoLive_Schedule,"schedulegolive");try{jQuery(".tb-go-live-video-save").text("Scheduling...");jQuery(".tb-go-live-video-save").attr("disabled",true);const r=jQuery('.tb-go-live-video-privacy:first input[name="privacy"]:checked');const o=r.val();const n=jQuery("#tb-go-live-video-datepicker-mv3").val();const s=l(jQuery("#tb-go-live-timepicker").val());const u=jQuery("#tb-go-live-timepicker").val();const c=jQuery("#tb-go-live-video-timezone-select").val();const d=jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");const b=d.getSelectedPlaylistIds();let h="";if(b.length>0){h=b.join(",")}const p=jQuery("#tb-go-live-video-addCommentUponPublish").is(":checked")?jQuery(".tb-go-live-video-comment-textarea").val():null;if(p&&p.length>0)TBUtilities.AddAction(null,TBUtilities.ActionTypes.ScheduleGoLive_AddCommentAfterPublish,"schedulegolive");const y=jQuery("#tb-go-live-video-emailreminder").is(":checked");const f=jQuery("#tb-go-live-video-emailreminder-now").is(":checked");const g={Id:t,VideoId:a,Type:1,ActionType:o,Date:n,Time:s,TimeZoneId:c,PlayListIdsToAddTo:h,SendWarningEmail:y,SendWarningEmailNow:f,TimeRecent:u,AddCommentUponPublish:p};TBExtension.SetDbValue(`tb-go-live-recent-${TBGlobal.CurrentChannelId()}`,g);let v;if(!e){TBUtilities.ReportProductEvent("Feature Used",{Tool:i,Action:"Scheduling publish video"});v=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosAddYouTubeVideoScheduledAction}else{TBUtilities.ReportProductEvent("Feature Used",{Tool:i,Action:"Updating schedule publish video"});v=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosUpdateYouTubeVideoScheduledAction}TBExtension.Post(v,JSON.stringify(g),(e,t,i,a)=>{jQuery(".tb-go-live-video-save").text("Schedule Publish");jQuery(".tb-go-live-video-save").attr("disabled",false);if(e){try{const e=jQuery.parseJSON(i);if(e.LocalDate!=null){m(e)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledPublish] save post"})}}else if(a==426){TBUtilities.Alert("You must select a date and time in the future.");jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hid").hide()}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...");jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hid").hide()}},null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledPublish] save click"});jQuery(".tb-go-live-video-save").text("Schedule Publish");jQuery(".tb-go-live-video-save").attr("disabled",false)}};const d=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(a){const e=`${TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledAction}?videoId=${a}&type=1`;TBExtension.Get(e,(e,r,o)=>{try{if(e){const e=jQuery.parseJSON(o);jQuery("#tb-go-live-video-loading").addClass("tb-hid").hide();jQuery("#tb-go-live-video-loaded").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").removeClass("tb-hid").show();const r=document.getElementById("tb-go-live-video-datepicker-mv3");r.onchange=function(){try{const e=24*60*60*1e3;const t=Math.abs((new Date(date).getTime()-(new Date).getTime())/e);if(t<=1){document.querySelector("#tb-go-live-video-emailreminder").checked=false;document.querySelector("#tb-go-live-video-emailreminder").disabled=true}else{document.querySelector("#tb-go-live-video-emailreminder").disabled=false}}catch(e){TBUtilities.Log(e)}};TBUtilities.DatePickerSetTomorrow("#tb-go-live-video-datepicker-mv3");const n=jQuery("#tb-go-live-video-timezone-select");n.empty();jQuery(e.TimeZones).each(function(){n.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});try{const t=TBUtilities.GetTimeZoneOffSetInHours();const i=TBUtilities.GetUserTimeZone(e.TimeZones);if(i){n.val(i.Id)}else{jQuery.each(e.TimeZones,(e,i)=>{if(i.DisplayName.indexOf(t)>0){n.val(i.Id)}})}}catch(e){TBUtilities.Log(e)}jQuery("#tb-go-live-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-go-live-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-go-live-video-input-ids").prop("disabled",true);const s=u(e.LocalTime);if(e.LocalDate!=null&&e.VideoId==a){if(e.CompletedDate==null){m(e);jQuery(".tb-go-live-video-edit-scheduled").removeClass("tb-hidden").show()}else{t=null;i=null;setTimeout(b,100)}}else{i=null;jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hidden").hide();setTimeout(b,100)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledPublish] getScheduledAction get"})}})}}else{TBGlobal.ShowUpgradePage("",TBGlobal.limitation.schedulegolive);jQuery("#tb-go-live-video-container").addClass("tb-hid").hide();jQuery("#tb-go-live-video-loading").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide()}};var b=function(){TBExtension.GetDbValue(`tb-go-live-recent-${TBGlobal.CurrentChannelId()}`,(e,t)=>{TBUtilities.Log("Got TBGoLiveGetRecent");TBUtilities.Log(t);TBUtilities.DatePickerSetMin("#tb-go-live-video-datepicker-mv3");TBUtilities.DatePickerReadOnly("#tb-go-live-video-datepicker-mv3");if(t){if(new Date(t.Date)<new Date)t.Date=new Date;jQuery("#tb-go-live-video-timezone-select").val(t.TimeZoneId);const e=new Date(t.Date);TBUtilities.DatePickerSetValue("tb-go-live-video-datepicker-mv3",e);const i=t.TimeRecent?`${t.TimeRecent.substring(0,2)}:${t.TimeRecent.substring(5,7)} ${t.TimeRecent.substring(10,12)}`:"09:30 AM";const a=`${t.Date} ${i}`;const r=h(a);if(r&&t.SendWarningEmail){jQuery("#tb-go-live-video-emailreminder").prop("checked",t.SendWarningEmail)}else{jQuery("#tb-go-live-video-emailreminder").prop("checked",false)}jQuery("#tb-go-live-video-emailreminder-now").prop("checked",t.SendWarningEmailNow);const o=jQuery(`.tb-go-live-video-privacy input[name="privacy"][value="${t.ActionType}"]`);if(o){o.prop("checked",true)}p();jQuery("#tb-go-live-timepicker").val(t.TimeRecent);jQuery("#tb-go-live-timepicker").timepicki({start_time:[t.TimeRecent.substring(0,2),t.TimeRecent.substring(5,7),t.TimeRecent.substring(10,12).toUpperCase()],increase_direction:"up"})}else{jQuery("#tb-go-live-timepicker").val("09 : 30 : AM");jQuery("#tb-go-live-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}})};var h=function(e){const t=24*60*60*1e3;const i=Math.abs((new Date(e).getTime()-(new Date).getTime())/t);if(isNaN(i)||i<=1){jQuery("#tb-go-live-video-emailreminder").attr("disabled",true);return false}jQuery("#tb-go-live-video-emailreminder").attr("disabled",false);return true};var p=function(){const e=jQuery("#tb-go-live-timepicker").parentsUntil(".tb-inline-block").length;if(e){jQuery("#tb-go-live-timepicker").removeData().removeAttr("data-timepicki-tim data-timepicki-mini data-timepicki-meri");jQuery("#tb-go-live-timepicker").next(".tp-timepicker_wrap").remove();jQuery("#tb-go-live-timepicker").unwrap();jQuery("#tb-go-live-timepicker").val("")}};var m=function(e){try{t=e.Id;i=e;jQuery("#tb-go-live-video-timezone-select").val(e.TimeZoneId);const a=jQuery("#tb-go-live-video-currentTemplate").html();let r="No playlist changes";if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo!=""){const t=e.PlaylistIdsToAddTo.split(",");if(e.PlaylistHtmlToAddTo&&e.PlaylistHtmlToAddTo!="(none)"){r=`<div style="display: inline-block;">${e.PlaylistHtmlToAddTo}</div>`}else{jQuery.each(t,(e,t)=>{r=`<strong style="font-size:13px;"><a target="_blank" href="https://www.youtube.com/playlist?list=${t}">${t}</a></strong><br>`})}}let o="We'll send you an email reminder the day before.";if(e.SendWarningEmail==false){o="No reminder"}const n=e.AddCommentUponPublish&&e.AddCommentUponPublish.length>0?e.AddCommentUponPublish:"No comment ";const s=a.formatTemplate(e.ActionLabel,e.LocalDate,u(e.LocalTime),jQuery("#tb-go-live-video-timezone-select option:selected").text(),r,o,n);jQuery("#tb-go-live-video-current").html(s);jQuery("#tb-go-live-video-current").removeClass("tb-hid").show();jQuery(".tb-go-live-video-cancel").removeClass("tb-hid").show();jQuery(".tb-go-live-video-edit-scheduled").removeClass("tb-hidden");jQuery("#tb-go-live-video-edit").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide();jQuery(".tb-go-live-video-close").text("Close")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledPublish] setScheduledAction"})}};var y=function(){let e=10;const t=setInterval(()=>{e--;if(jQuery("#tb-go-live-timepicker").val()!=""){clearInterval(t);TubeBuddyBestTimeToPublish.GetBestOverall().then(e=>{if(!e||e.bestDay.length==0||e.bestHour.length==0||e.localTimeZone.length==0||jQuery("#tb-best-time-to-publish button").length==0){return}jQuery("#tb-best-time-to-publish .tb-best-time-to-publish-copy span").html(`${e.bestDay}, ${e.bestHour}, ${e.localTimeZone}`);jQuery(document).on("click","#tb-best-time-to-publish button",t=>{const i=TBGlobal.GetToolById("besttimetopublish").name;TBUtilities.ReportProductEvent("Best Time to Publish Apply to Scheduled Publish",{tool:i,channel_id:TBGlobal.CurrentChannelId(),video_id:a,timestamp:(new Date).toISOString(),best_time:`${e.bestDay}, ${e.bestHour}, ${e.localTimeZone}`,applied:true});const r=(new Date).getTime();let o="";let n=e.bestHour.split(":")[0];n=n.length==1?`0${n}`:n;const s=e.bestHour.split(":")[1].substring(0,2);const l=e.bestHour.split(":")[1].substring(2,4).toUpperCase();const u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];const c=e=>{const t=new Date;t.setDate(t.getDate()+e);const i=new Date(t).getMonth();const a=new Date(t).getDate();const r=new Date(t).getFullYear();const o=r.toString();const n=i<10?`0${i+1}`:i+1;const s=a<10?`0${a}`:a;return`${o}-${n}-${s}`};let d=0;while(e.bestDay!==u[d]){d++}const b=(new Date).getDay();if(b<d){o=c(d-b)}else if(b>d){o=c(7-(b-d))}else if(b==d){const e=c(0);if(new Date(e).getTime()>r){o=e;jQuery("#tb-go-live-video-emailreminder").prop("checked",false)}else{o=c(7)}}TBUtilities.DatePickerSetValue("#tb-go-live-video-datepicker-mv3",new Date(o));jQuery("#tb-go-live-timepicker").val(`${n} : ${s} : ${l}`);jQuery("#tb-go-live-timepicker").attr("data-timepicki-tim",n).attr("data-timepicki-mini",s).attr("data-timepicki-meri",l);jQuery("#tb-go-live-timepicker").timepicki({start_time:[n,s,l],increase_direction:"up"});const h=e.localTimeZone.includes("Daylight")?e.localTimeZone.replace("Daylight","Standard"):e.localTimeZone;jQuery("#tb-go-live-video-timezone-select").val(h)});jQuery("#tb-best-time-to-publish").show()}).catch(()=>{console.log("Error fetching TubeBuddyBestTimeToPublish GetBestOverall()")})}else if(e==0){clearInterval(t)}},1e3)};var f=function(){jQuery("#tb-go-live-video-container").show();jQuery("#tb-go-live-video-loading").removeClass("tb-hid").show();jQuery("#tb-go-live-video-loaded").addClass("tb-hid").hide();jQuery("#tb-go-live-video-current").addClass("tb-hid").hide();jQuery(".tb-go-live-video-cancel").addClass("tb-hid").hide();jQuery(".tb-go-live-video-edit-scheduled").addClass("tb-hidden");jQuery(".tb-go-live-video-upgrade").addClass("tb-hid").hide();jQuery(".tb-go-live-video-save").removeClass("tb-hid").text("Schedule Publish").show();jQuery("#tb-go-live-video-edit").removeClass("tb-hid").show();jQuery(".tb-go-live-video-save").addClass("tb-hid").hide();jQuery("#tb-go-live-video-emailreminder").attr("disabled",false);jQuery("#tb-go-live-video-input-ids").val("");jQuery("#tb-go-live-video-thumbnail").attr("src",o);jQuery("#tb-go-live-video-title").text(r);jQuery("#tb-go-live-video-title").attr("href",`https://www.youtube.com/watch?v=${a}`);jQuery(".tb-go-live-video-close").text("Cancel");jQuery("#tb-go-live-video-playlist-ids").playlistSelect({tbMaterial:true});g();d()};var g=function(){jQuery("#tb-go-live-video-addCommentUponPublish").prop("checked",false);jQuery(".tb-go-live-video-comment-textarea").val("");jQuery(".tb-go-live-comment-text-container").addClass("tb-hidden");jQuery(".tb-go-live-video-comment-char-count").text("0");jQuery(".tb-go-live-video-comment-char-count-container").removeClass("tb-font-color-red");jQuery(".tb-go-live-video-comment-char-count-error-text").addClass("tb-hidden");jQuery(".tb-go-live-video-comment-error").removeClass("tb-go-live-video-comment-error")};return{Show(t,i,l){if(TBGlobal.IsAuthenticated()){a=t;r=i;o=l||`https://img.youtube.com/vi/${a}/mqdefault.jpg`;if(!e){n();s();e=true}else{f()}}}}}();var TubeBuddyCardsVideo=function(){var e=false;var t=null;var i=null;var a=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEditVideoCardsLoadVideo",null)};var r=function(e,t){if(jQuery(".creator-editor-content").find(".tb-edit-video-cards-container").length==0){jQuery(".creator-editor-content").after(jQuery(".tb-edit-video-cards-container:last")[0].outerHTML);if(t)jQuery(".tb-video-cards-title-input").val(t);else jQuery(".tb-video-cards-title-input").val(jQuery("#creator-editor-title-link").attr("title"));if(e){jQuery(".tb-edit-video-cards-template").prop("checked",true);jQuery(".tb-video-cards-title-input").prop("disabled",false)}else{jQuery(".tb-edit-video-cards-template").prop("checked",false);jQuery(".tb-video-cards-title-input").prop("disabled",true)}}jQuery(".annotator-learn-more-container").after(jQuery(".tb-edit-video-cards-options-container:first")[0].outerHTML)};var o=function(){var e=TBGlobal.host+"/ModuleManager/CardsVideo/CardsVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/cardsvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/cardsvideo.html"}TBExtension.Get(e,"CRTBLoadCardsVideoTemplate")};var n=function(){jQuery(document).on("click",".tb-edit-video-cards-apply-cards-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyCardTemplatesStudio.Show(e,t,i)});jQuery(document).on("click",".tb-edit-video-cards-clear-cards",function(){if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all Cards from this video?"))s()}else{TBUtilities.Confirm("Are you sure you want to remove all Cards from this video?",s,null)}});jQuery(document).on("change",".tb-edit-video-cards-template",function(){var e=jQuery(this).is(":checked");var t=TBUtilities.GetUrlParameter("v");var i=jQuery("#creator-editor-title-link").attr("title");var a=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var r={Id:t,Enabled:e,Title:i};TBExtension.Post(a,JSON.stringify(r),"CRTBLoadEditVideoCardsTemplateToggle",null,{contentType:"application/json"});if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")});jQuery(document).on("change",".tb-edit-video-cards-template",function(){l()});jQuery(document).on("change",".tb-video-cards-title-input",function(){l()});jQuery(document).on("keyup",".tb-video-cards-title-input",function(e){if(e.keyCode==13){l()}})};var s=function(){jQuery(".tb-edit-video-cards-working").show();if(i==null){i=TBUtilities.GetSessionToken(document.documentElement.innerHTML)}TBUtilities.Log("Session token ="+i);TubeBuddyYouTubeActions.DeleteAllCards(TBUtilities.GetUrlParameter("v"),i,TubeBuddyCardsVideo.DeleteAllCardsCallBack)};var l=function(){try{TBUtilities.Log("TubeBuddyCardsVideo - saveTemplateChanges");var e=jQuery(".tb-edit-video-cards-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-cards-title-input").val())jQuery(".tb-video-cards-title-input").val(jQuery("#creator-editor-title-link").attr("title"));var i=jQuery(".tb-video-cards-title-input").val();var a=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleCardTemplate;var r={Id:t,Enabled:e,Title:i};TBUtilities.Log(r);TBExtension.Post(a,JSON.stringify(r),"CRTBLoadEditVideoCardTemplateToggle",null,{contentType:"application/json"});jQuery(".tb-video-cards-title-input").prop("disabled",!e);jQuery(".tb-video-cards-changes-saved").hide();jQuery(".tb-video-cards-changes-saved").show().delay(2e3).fadeOut();if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.CardTemplates_Apply,"cardtemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] saveTemplateChanges"})}};var u=function(){jQuery(document.body).on("CRTBLoadCardsVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);a()}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBLoadCardsVideoTemplate"})}});jQuery(document.body).on("CRTBEditVideoCardsLoadVideo",function(e,i){try{if(i.success){t=jQuery.parseJSON(i.response);r(t.IsCardTemplate,t.CardTemplateName)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBEditVideoCardsLoadVideo"})}});jQuery(document.body).on("CRTBLoadEditVideoCardTemplateToggle",function(e,t){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBLoadEditVideoCardsTemplateToggle"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();o();n();e=true}}},DeleteAllCardsCallBack:function(){jQuery(".tb-edit-video-cards-working").hide();TBUtilities.Alert("Cards successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}}}();var TubeBuddyBackup=function(){var e=false;var t="";var i=0;var a;var r;var o;var n=function(){var e=TBGlobal.host+"/ModuleManager/backup/backup?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/backup.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/backup.html"}TBExtension.Get(e,"CRTBLoadBackupTemplate")};var s=function(){jQuery(document).on("click","#tb-backup-start-button",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("initiate a channel backup","channelbackup");return}var e=false;if($("input[name=tb-backupType]:checked").val()==1)e=true;var t=TBGlobal.host+TBGlobal.apiUrls.youtubeChannelKickOffExport+"?partial="+e;TBExtension.Post(t,null,"CRTBBackupKickoffComplete",null)});jQuery(document).on("click",".tb-backup-download",function(){if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("download your backup to CSV","channelbackup");return false}});jQuery(document).on("click",".tb-backup-download",function(){var e=document.createElement("form");e.target="_blank";e.method="POST";e.action=TBGlobal.host+"/youtubechannel/downloadbackup";var t=document.createElement("input");t.type="hidden";t.name="ChannelId";t.value=TBGlobal.CurrentChannelId();var i=document.createElement("input");i.type="hidden";i.name="Token";i.value=TBGlobal.GetToken();e.appendChild(t);e.appendChild(i);document.body.appendChild(e);e.submit()})};var l=function(e){jQuery("#tb-backup-thumbnail").attr("src",e.Snippet.Thumbnails.ThumbnailDefault);jQuery("#tb-backup-name").text(e.Snippet.Title);jQuery("#tb-backup-loading-count-total").text(TBUtilities.FormatNumberWithCommas(e.Statistics.VideoCount));t=e.id;i=e.Statistics.VideoCount;jQuery("#tb-backup-loading-channel").hide();jQuery("#tb-backup-loaded-channel").show()};var u=function(e){jQuery("#tb-backup-videos-count").text(TBUtilities.FormatNumberWithCommas(e.length)+" Videos")};var c=function(){TBYouTubeApi.GetChannelDetails(TBGlobal.CurrentChannelId(),null,l)};var d=function(){TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,u)};var b=function(){jQuery("#tb-backup-container").show();jQuery("#tb-backup-loading-channel").show();jQuery("#tb-backup-loaded-channel").hide();c();d()};var h=function(){};var p=function(){jQuery(document.body).on("CRTBLoadBackupTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);b()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBackup] CRTBLoadBackupTemplate"})}});jQuery(document.body).on("CRTBBackupKickoffComplete",function(e,t){try{if(t.success){if(t.response.length=='"493E38C7-75D6-4786-841B-1AD9C5E7F4F1"'.length){jQuery("#tb-backup-before-start").hide();jQuery("#tb-channel-info").addClass("tb-margin-top-40").removeClass("tb-margin-top-10");jQuery("#tb-backup-status").fadeIn("5000");jQuery("#tb-backup-status-link").attr("href",TBGlobal.host+"/channel/backup/"+TBGlobal.CurrentChannelId());jQuery("#tb-backup-status-link").text(TBGlobal.host+"/channel/backup/"+TBGlobal.CurrentChannelId())}else{TBUtilities.Alert("ERROR<br><Br> "+t.response)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBackup] CRTBBackupKickoffComplete"})}})};return{Show:function(t,i,l){if(TBGlobal.IsAuthenticated()){o=l;a=t;r=i;if(!e){p();n();s();e=true}else{b(a,r,o)}}}}}();var TubeBuddyClickMagnet=function(){var e=false;var t="All";var i="";var a="";var r="";var o="Lifetime";var n="All";var s=0;var l="";var u=[];var c;var d;var b;var h="";var p=0;var m=0;var y=["#F40000","#F87E00","#FDED01","#7FD500","#00AE00"];var f=1;var g=true;var v={Videos:[],numVideosToExamine:150,daysToAnalyze:7,ChannelId:TBGlobal.CurrentChannelId()};var T=function(){var e=TBGlobal.host+"/ModuleManager/clickmagnet/clickmagnet?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/clickmagnet.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/clickmagnet.html"}TBExtension.Get(e,"CRTBLoadCTRCenterTemplate")};var j=function(e){m++;r+=m+") "+e+"\n\n";jQuery("#tb-ctr-error-msg").val(r)};var Q=function(e){jQuery(".tb-op-sort-Views").css("font-weight","normal");jQuery(".tb-op-sort-Video").css("font-weight","normal");jQuery(".tb-op-sort-Clicks").css("font-weight","normal");jQuery(".tb-op-sort-Ctr").css("font-weight","normal");jQuery(".tb-op-sort-WTPI").css("font-weight","normal");jQuery(".tb-op-sort-Performance").css("font-weight","normal");jQuery(".tb-op-sort-Opp").css("font-weight","normal");jQuery(".tb-op-sort-"+e).css("font-weight","bold");jQuery(".tb-op-sort-item").hide();if(i==e+"Asc")i=e+"Desc";else i=e+"Asc";jQuery("#tb-op-"+i).show();k()};var k=function(){try{j("buildOpporunitiesTable");u=[];var e=[];var t=0;var i=0;var a=0;var r=0;jQuery.each(v.Videos,function(e,i){var o={Id:i.Id,Thumbnail:i.Thumbnail,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(i.Title),OriginalTitle:i.OriginalTitle,Impressions:0,Clicks:0,CTR:0,Views:0,WatchPercentage:0,WatchTime:0,TotalWatchTime:0,DatePublished:i.DatePublished,YTFactor:0,WTpI:0,ROI:0};if(!i.LifetimeAnalytics)return;o.Impressions=i.LifetimeAnalytics.Impressions;o.CTR=i.LifetimeAnalytics.CTR;o.Clicks=i.LifetimeAnalytics.Clicks;o.Views=i.LifetimeAnalytics.Views;o.WatchPercentage=i.LifetimeAnalytics.WatchPercentage;o.WatchTime=i.LifetimeAnalytics.WatchTime;o.YTViews=i.LifetimeAnalytics.Clicks;o.TotalWatchTime=i.LifetimeAnalytics.TotalWatchTime;if(o.Impressions>0)o.WTpI=o.TotalWatchTime/o.Impressions;if(o.Views>0)o.YTFactor=o.YTViews/o.Views;o.ROI=o.CTR*o.CTR*o.Impressions*o.TotalWatchTime/o.Views;o.ROI=Math.cbrt(o.ROI);o.ROINoCtr=Math.cbrt(o.Impressions*o.TotalWatchTime/o.Views);if(o.ROI>t)t=o.ROI;u.push(o);a+=o.Impressions;r+=o.Clicks});var o=0;if(a>0)o=r/a*100;var n=0;jQuery.each(u,function(e,i){i.RelativeROI=(Math.sqrt(i.ROI)/Math.sqrt(t)).toFixed(2);var a=i.CTR-o;var r=1;a=Math.min(5,a);a=Math.max(-5,a);if(a>=.15)r=1/(Math.sqrt(a*250)/25+.8);else if(a<=-.15)r=Math.sqrt(-a*250)/25+.8;i.OpportunityScore=i.RelativeROI*r;i.CTRDif=a;if(i.OpportunityScore>n){n=i.OpportunityScore}});jQuery.each(u,function(e,t){t.RelativeOpportunityScore=(t.OpportunityScore/n).toFixed(2);jQuery.each(u,function(e,i){if(t.CTR>=i.CTR){if(!t.CTRBetter)t.CTRBetter=0;t.CTRBetter++}if(t.ROINoCtr>=i.ROINoCtr){if(!t.ROINoCtrBetter)t.ROINoCtrBetter=0;t.ROINoCtrBetter++}})});jQuery("#tb-ctr-op-data").html('<tr id="tb-ctr-op-tr"></tr>');TBUtilities.SortArray(u,"RelativeOpportunityScore",true,true);var s="";jQuery.each(u,function(e,t){var i=t.CTR-o;var a="";if(i>=0)a="+"+i.toFixed(2);else a="-"+Math.abs(i.toFixed(2));try{s+='<tr style="height:77px;">';s+='<td valign="top" style="border-bottom:solid 1px #ddd; width:500px; position:relative; padding-right:15px;">';s+='    <img src="'+t.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:3px; left:5px;" />';s+='<span style="position: absolute; left: 135px; font-size:11px; top: 58px; color:#666;">Published: '+TBUtilities.ToShortDateString(t.DatePublished)+' <a href="https://studio.youtube.com/video/'+t.Id+'/analytics/tab-overview/period-default" target="_blank"><i class="material-icons" style="font-size: 18px;line-height: 5px;position: relative;top: 2px; opacity:.75;">link</i></a> </span>';s+='    <div style="padding-left:135px; height:46px; overflow:hidden; padding-top:6px; font-size:14px; line-height:16px;">'+t.OriginalTitle+"</div></td>";s+='<td style="border-bottom:solid 1px #ddd; width:140px; text-align:left; padding-left:5px; font-size:17px;">';s+='<div style="margin-top:5px;"><span class="tb-move-up2">'+x(parseInt(100*t.ROINoCtrBetter/(1*u.length)))+"</span> Performance</div>";s+='<div><span class="tb-move-up2">'+x(parseInt(100*t.CTRBetter/(1*u.length)))+"</span> CTR: "+t.CTR.toFixed(2)+"%</div>";s+="</td>";s+='<td style="border-bottom:solid 1px #ddd; width:130px; text-align:center;font-size:17px;">';s+=w(t.RelativeOpportunityScore*100);s+='   <div style="height:20px; width: 100px; margin:0px auto 0;" id="tb-tag-'+t.Id+'"></div>';s+='<div><a style="font-size:10px; position:relative; top:-2px;"  target="_blank" href="https://www.tubebuddy.com/channel/abtestcreate/'+TBGlobal.CurrentChannelId()+"?videoId="+t.Id+"&videotitle="+encodeURI(t.Title)+"&videothumbnail="+t.Thumbnail+'">Create A/B Test</a></div>';s+="</td>";s+="</tr>"}catch(e){console.log("ERR!");console.log(e)}});jQuery("#tb-ctr-op-tr").before(s);jQuery("#tb-avg-ctr-analyzed").text("Avg CTR: "+o.toFixed(2)+"%");d=[];jQuery.each(u,function(e,t){G(t.Id,t.RelativeOpportunityScore*t.RelativeOpportunityScore*100);d.push(t)})}catch(e){j("EX: buildOpportnitiesTable >>"+e);F()}jQuery('[data-tbtooltip-ctr!=""]').qtip({content:{attr:"data-tbtooltip-ctr"},style:{classes:"qtip-youtube-tubebuddy",tip:false},position:{at:"bottom left",adjust:{x:-130}}})};var B=function(){try{j("buildOpporunitiesTable");u=[];var e=[];var t=0;var i=0;var a=0;var r=0;l=jQuery("#tb-bw-ts-select").val();jQuery.each(v.Videos,function(e,i){var o={Id:i.Id,Thumbnail:i.Thumbnail,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(i.Title),OriginalTitle:i.OriginalTitle,Impressions:0,Clicks:0,CTR:0,Views:0,WatchPercentage:0,WatchTime:0,TotalWatchTime:0,DatePublished:i.DatePublished,YTFactor:0,WTpI:0,ROI:0};if(l=="All"){if(!i.LifetimeAnalytics)return;o.Impressions=i.LifetimeAnalytics.Impressions;o.CTR=i.LifetimeAnalytics.CTR;o.Clicks=i.LifetimeAnalytics.Clicks;o.Views=i.LifetimeAnalytics.Views;o.WatchPercentage=i.LifetimeAnalytics.WatchPercentage;o.WatchTime=i.LifetimeAnalytics.WatchTime;o.YTViews=i.LifetimeAnalytics.Clicks;o.TotalWatchTime=i.LifetimeAnalytics.TotalWatchTime;if(o.Impressions>0)o.WTpI=o.TotalWatchTime/o.Impressions;if(o.Views>0)o.YTFactor=o.YTViews/o.Views}else{var n=TBUtilities.GetInArray(i.TrafficSourceAnalytics,"TrafficSource",l);o.Impressions=n.Impressions;o.Clicks=n.Clicks;o.Views=n.Views;o.WatchPercentage=n.WatchPercentage;o.WatchTime=n.WatchTime;o.TotalWatchTime=n.TotalWatchTime;o.WTpI=o.Impressions>0?o.TotalWatchTime/o.Impressions:0;o.YTFactor=o.Views>0?o.Clicks/o.Views:0;if(o.Impressions>0)o.CTR=100*(o.Clicks/o.Impressions);else o.CTR=0}o.ROI=o.CTR*o.CTR*o.Impressions*o.TotalWatchTime/o.Views;o.ROI=Math.cbrt(o.ROI);if(o.ROI>t)t=o.ROI;u.push(o);a+=o.Impressions;r+=o.Clicks});var o=0;if(a>0)o=r/a*100;jQuery.each(u,function(e,i){i.RelativeROI=(.9*(Math.sqrt(i.ROI)/Math.sqrt(t))).toFixed(2);jQuery.each(u,function(e,t){if(i.CTR>=t.CTR){if(!i.CTRBetter)i.CTRBetter=0;i.CTRBetter++}if(i.TotalWatchTime>=t.TotalWatchTime){if(!i.TotalWatchTimeBetter)i.TotalWatchTimeBetter=0;i.TotalWatchTimeBetter++}if(i.Clicks>=t.Clicks){if(!i.ClicksBetter)i.ClicksBetter=0;i.ClicksBetter++}})});jQuery("#tb-ctr-tp-data").html('<tr id="tb-ctr-tp-tr"></tr>');jQuery("#tb-ctr-bp-data").html('<tr id="tb-ctr-bp-tr"></tr>');TBUtilities.SortArray(u,"RelativeROI",true,true);var n="";var s=0;jQuery.each(u,function(e,t){s++;try{n+='<tr style="height:77px;">';n+='<td valign="top" style="border-bottom:solid 1px #ddd;  position:relative; padding-right:15px; padding-left:20px;">';n+=' <span style="background:black;border:solid 1px white;font-size:18px;font-weight:bold;color:white;height:25px; width:25px; text-align:center;border-radius: 50%;position:absolute;z-index: 99;left: 7px; top:5px;line-height:25px;">'+s+"</span>";n+='    <img src="'+t.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:3px; left:45px;" />';n+='    <span style="position: absolute; left: 175px; font-size:11px; top: 58px; color:#666;">Published: '+TBUtilities.ToShortDateString(t.DatePublished)+' <a href="https://studio.youtube.com/video/'+t.Id+'/analytics/tab-overview/period-default" target="_blank"><i class="material-icons" style="font-size: 18px;line-height: 5px;position: relative;top: 2px; opacity:.75;">link</i></a> </span>';n+='    <div style="padding-left:155px; height:46px; overflow:hidden; padding-top:6px; font-size:14px; line-height:16px;">'+t.OriginalTitle+"</div></td>";n+='<td style="border-bottom:solid 1px #ddd; text-align:left;font-size:15px;  width: 130px;">';n+='<div style="padding-left:15px;">';n+='<div><span class="tb-move-up2">'+x(parseInt(100*t.CTRBetter/(1*u.length)))+"</span> CTR: "+t.CTR.toFixed(2)+"%</div>";n+='<div><span class="tb-move-up2">'+x(parseInt(100*t.TotalWatchTimeBetter/(1*u.length)))+"</span> WT: "+TBUtilities.MilliSecondsToTime(t.TotalWatchTime,true)+"</div>";n+='<div><span class="tb-move-up2">'+x(parseInt(100*t.ClicksBetter/(1*u.length)))+"</span> Clicks: "+TBUtilities.FormatNumberAbbreviated(parseInt(t.Clicks))+"</div>";n+="</div>";n+="</td>";n+='<td style="border-bottom:solid 1px #ddd; text-align:center;font-size:17px; width: 130px;">';n+=C(t.RelativeROI*100);n+='   <div style="height:20px; width: 80px; margin:5px auto 0;" id="tb-tag-perf-'+t.Id+'"></div>';n+="</td>";n+="</tr>"}catch(e){console.log("ERR!");console.log(e)}});jQuery("#tb-ctr-tp-tr").before(n);TBUtilities.SortArray(u,"RelativeROI",false,true);n="";s=0;jQuery.each(u,function(e,t){s++;if(s>10)return;try{n+='<tr style="height:77px;">';n+='<td valign="top" style="border-bottom:solid 1px #ddd; width:520px; position:relative; padding-right:15px;">';n+='    <img src="'+t.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:3px; left:5px;" />';n+='    <span style="position: absolute; left: 135px; font-size:11px; top: 58px; color:#666;">Published: '+TBUtilities.ToShortDateString(t.DatePublished)+"</span>";n+='    <div style="padding-left:135px; height:46px; overflow:hidden; padding-top:6px; font-size:14px; line-height:16px;">'+t.OriginalTitle+"</div></td>";n+='<td style="border-bottom:solid 1px #ddd; width:115px; text-align:center;font-size:17px;">';n+=C(t.RelativeROI*100);n+='   <div style="height:20px; width: 80px; margin:5px auto 0;" id="tb-tag-perf-'+t.Id+'"></div>';n+="</td>";n+="</tr>"}catch(e){console.log("ERR!");console.log(e)}});jQuery("#tb-ctr-bp-tr").before(n);jQuery.each(u,function(e,t){E(t.Id,t.RelativeROI*100)})}catch(e){j("EX: buildPerformanceTable >>"+e);F()}};var C=function(e){var t="";var i="";if(e<20){t="Very Low";i="tb-ctr-clr-vl"}else if(e<40){t="Low";i="tb-ctr-clr-l"}else if(e<60){t="Average";i="tb-ctr-clr-a"}else if(e<80){t="High";i="tb-ctr-clr-h"}else{t="Very High";i="tb-ctr-clr-vh"}var a='<div class="'+i+'" style="font-weight:bold; font-size:15px; position:relative;">';a+=t;a+="</div>";return a};var w=function(e){var t="";var i="";if(e<50){t="Very Low";i="tb-ctr-clr-vl"}else if(e<70){t="Low";i="tb-ctr-clr-l"}else if(e<80){t="Average";i="tb-ctr-clr-a"}else if(e<90){t="High";i="tb-ctr-clr-h"}else{t="Very High";i="tb-ctr-clr-vh"}var a='<div class="'+i+'" style="font-weight:bold; font-size:15px; position:relative;">';a+=t;a+="</div>";return a};var x=function(e){var t="";if(e<60){t="tb-ctr-pc-vl"}else if(e<70){t="tb-ctr-pc-l"}else if(e<80){t="tb-ctr-pc-a"}else if(e<90){t="tb-ctr-pc-h"}else{t="tb-ctr-pc-vh"}var i='<div class="tb-ctr-pc-g '+t+'"></div>';return i};var I=function(e){return new Promise(function(t,i){try{O("Loading Recent Uploads");TubeBuddyYouTubeActions.GetVideosListStudio(e.numVideosToExamine,true).then(function(i){j("Videos Retrieved: "+i.videosList.length);let a=i.videosList.filter(e=>e.remix.remixSourceShorts!=="REMIX_SOURCE_SHORTS_IS_SHORT");if(a.length===0){j(`getVideosList A: No long-form content was found in this channel's most recent ${e.numVideosToExamine} videos.`);F(true)}TBUtilities.ReportProductEvent("Click Magnet Processing Recent Uploads",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet",long_form_video_count:a.length,total_video_count:i.videosList.length});const r=50;jQuery.each(a,function(t,i){if(t<r){e.Videos.push({Id:i.videoId,DatePublished:new Date(moment.unix(i.timePublishedSeconds)),OriginalTitle:i.title,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(i.title),Thumbnail:i.thumbnailDetails.thumbnails[1].url,Views:i.metrics.viewCount,IsShort:i.remix.remixSourceShorts!=="REMIX_SOURCE_SHORTS_NOT_SHORT"})}});t(e)},function(e){j("getVideosList B: "+e);F()}).catch(function(e){j("getVideosList C: "+e);F()})}catch(e){j("getVideosList D: "+e);F()}})};const A=async function(e){return new Promise(function(t,i){try{var a=0;O("Loading Lifetime Video Analytics");jQuery.each(e.Videos,async function(i,r){var o=moment(r.DatePublished).clone().add(0,"days");var n=moment(new Date).clone().add(2,"days");var s=[TBApiMetrics.VIEWS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.WATCH_TIME,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE];if(i===24){TBUtilities.Log("[Click Magnet | getLifetimeAnalytics] Analytics gathered for first 25 videos. Pausing for 60s to avoid rate limiting.");await new Promise(e=>setTimeout(e,3e4));D("Loading Lifetime Video Analytics - This may take some time");await new Promise(e=>setTimeout(e,3e4));TBUtilities.Log("[Click Magnet | getLifetimeAnalytics] Proceeding to capture analytics for remaining videos.")}TubeBuddyYouTubeActions.AnalyticsGetSummaryVideoTotals(r.Id,o,n,s).then(function(i){a++;var o=i.resultData;if(!o.VIDEO_THUMBNAIL_IMPRESSIONS)o.VIDEO_THUMBNAIL_IMPRESSIONS=0;if(!o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR=0;r.LifetimeAnalytics={Views:o.VIEWS,SubscribersNet:o.SUBSCRIBERS_NET_CHANGE,Earnings:o.TOTAL_ESTIMATED_EARNINGS,Likes:o.RATINGS_LIKES,Comments:o.COMMENTS,WatchPercentage:o.AVERAGE_WATCH_PERCENTAGE,WatchTime:o.AVERAGE_WATCH_TIME,TotalWatchTime:o.WATCH_TIME,Impressions:o.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(o.VIDEO_THUMBNAIL_IMPRESSIONS*o.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};j("videoLifetimeAnalytics: "+r.Id+": "+JSON.stringify(r.LifetimeAnalytics));if(a==e.Videos.length){t(e)}},function(i){j("getLifetimeAnalytics A: "+a+" "+i);F();a++;if(a==e.Videos.length){t(e)}}).catch(function(e){j("getLifetimeAnalytics B: "+e);F()})})}catch(e){j("getLifetimeAnalytics C: "+e);F()}}).catch(function(e){A("getLifetimeAnalytics D: "+e);F()})};var S=function(e){return new Promise(function(t,i){try{O("Loading Daily Video Analytics");var a=0;jQuery.each(e.Videos,function(i,r){var o=[TBApiMetrics.VIEWS,TBApiMetrics.SUBSCRIBERS_NET_CHANGE,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.WATCH_TIME,TBApiMetrics.RATINGS_LIKES,TBApiMetrics.COMMENTS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR];var n=moment(r.DatePublished).clone().add(0,"days");var s=moment(r.DatePublished).clone().add(35,"days");TubeBuddyYouTubeActions.AnalyticsGetDailyVideoTotals(r.Id,n,s,o).then(function(i){a++;r.DailyAnalytics=[];var o=i.resultData;jQuery.each(o,function(e,t){if(!t.VIDEO_THUMBNAIL_IMPRESSIONS)t.VIDEO_THUMBNAIL_IMPRESSIONS=0;if(!t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR=0;var i={Date:new Date(t.Date),Views:t.VIEWS,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,Likes:t.RATINGS_LIKES,Comments:t.COMMENTS,WatchPercentage:t.AVERAGE_WATCH_PERCENTAGE,WatchTime:t.AVERAGE_WATCH_TIME,TotalWatchTime:t.WATCH_TIME,Ctr:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};j("videoDailyAnalytics: "+r.Id+": "+JSON.stringify(i));if(i.Impressions>0||i.Views>0||i.WatchTime>0)r.DailyAnalytics.push(i)});if(a==e.Videos.length){t(e)}},function(i){a++;if(a==e.Videos.length){t(e)}}).catch(function(e){j("getVideosFirst30DaysAnalytics B: "+e);F()})})}catch(e){j("getVideosFirst30DaysAnalytics C: "+e);F()}}).catch(function(e){A("getVideosFirst30DaysAnalytics D: "+e);F()})};var U=function(e){return new Promise(function(t,i){try{var a=0;O("Loading Traffic Source Video Analytics");jQuery.each(e.Videos,function(i,r){try{var o=[TBApiMetrics.VIEWS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS,TBApiMetrics.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,TBApiMetrics.AVERAGE_WATCH_PERCENTAGE,TBApiMetrics.AVERAGE_WATCH_TIME,TBApiMetrics.WATCH_TIME];a++;var n=moment(r.DatePublished).clone().add(0,"days");var s=moment(new Date).clone().add(2,"days");TubeBuddyYouTubeActions.AnalyticsGetSummaryVideoTrafficSourcesTotals(r.Id,n,s,o).then(function(i){r.TrafficSourceAnalytics=[];jQuery.each(i.resultData,function(e,t){if(!t.VIDEO_THUMBNAIL_IMPRESSIONS)t.VIDEO_THUMBNAIL_IMPRESSIONS=0;if(!t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR=0;var i={VideoId:r.Id,Views:t.VIEWS,WatchPercentage:t.AVERAGE_WATCH_PERCENTAGE,WatchTime:t.AVERAGE_WATCH_TIME,TotalWatchTime:t.WATCH_TIME,TrafficSource:t.TrafficSource,Impressions:t.VIDEO_THUMBNAIL_IMPRESSIONS,CTR:100*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR,Clicks:parseInt(t.VIDEO_THUMBNAIL_IMPRESSIONS*t.VIDEO_THUMBNAIL_IMPRESSIONS_VTR)};r.TrafficSourceAnalytics.push(i)});if(a==e.Videos.length){t(e)}},function(i){a++;if(a==e.Videos.length){t(e)}}).catch(function(e){j("getTrafficSourcesAnalytics B: "+e);F()})}catch(i){j("getTrafficSourcesAnalytics C: "+i);F();a++;if(a==e.Videos.length){t(e)}}})}catch(e){j("getTrafficSourcesAnalytics D: "+e);F()}}).catch(function(e){j("getTrafficSourcesAnalytics E: "+e);F()})};var L=function(){try{j("buildAnalyticsTable");u=[];var e=[];var t=0;jQuery.each(v.Videos,function(e,i){var a={Id:i.Id,Thumbnail:i.Thumbnail,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(i.Title),OriginalTitle:i.OriginalTitle,DatePublished:i.DatePublished,Clicks:0,Impressions:0,Views:0,YTFactor:0,WatchTime:0,WatchPercentage:0,WTpI:0,TotalWatchTime:0,CTR:0};if(o=="Lifetime"){if(n=="All"){if(!i.LifetimeAnalytics)return;a.Impressions=i.LifetimeAnalytics.Impressions;a.CTR=i.LifetimeAnalytics.CTR;a.Clicks=i.LifetimeAnalytics.Clicks;a.Views=i.LifetimeAnalytics.Views;a.WatchPercentage=i.LifetimeAnalytics.WatchPercentage;a.WatchTime=i.LifetimeAnalytics.WatchTime;a.TotalWatchTime=i.LifetimeAnalytics.TotalWatchTime;a.WTpI=a.Impressions>0?a.TotalWatchTime/a.Impressions:0;a.YTFactor=a.Views>0?a.Clicks/a.Views:0}else{var r=TBUtilities.GetInArray(i.TrafficSourceAnalytics,"TrafficSource",n);a.Impressions=r.Impressions;a.Clicks=r.Clicks;a.Views=r.Views;a.WatchPercentage=r.WatchPercentage;a.WatchTime=r.WatchTime;a.TotalWatchTime=r.TotalWatchTime;a.WTpI=a.Impressions>0?a.TotalWatchTime/a.Impressions:0;a.YTFactor=a.Views>0?a.Clicks/a.Views:0;if(a.Impressions>0)a.CTR=100*(a.Clicks/a.Impressions);else a.CTR=0}}else{try{var l=parseInt(o);if(i.DailyAnalytics.length<l){return}for(var c=0;c<l;c++){a.Impressions+=i.DailyAnalytics[c].Impressions;a.Clicks+=i.DailyAnalytics[c].Clicks;a.Views+=i.DailyAnalytics[c].Views;a.WatchPercentage+=isNaN(i.DailyAnalytics[c].WatchPercentage)?0:i.DailyAnalytics[c].WatchPercentage;a.WatchTime+=isNaN(i.DailyAnalytics[c].WatchTime)?0:i.DailyAnalytics[c].WatchTime;a.TotalWatchTime+=i.DailyAnalytics[c].TotalWatchTime}a.CTR=a.Impressions>0?100*(a.Clicks/a.Impressions):0;a.WatchTime=a.WatchTime/l;a.WatchPercentage=a.WatchPercentage/l;a.WTpI=a.Impressions>0?a.TotalWatchTime/a.Impressions:0;a.YTFactor=a.Views>0?a.Clicks/a.Views:0}catch(e){console.log("ERR > "+e)}}if(a.WatchTime>0)a.WatchTimeMinutes=(a.WatchTime/1e3/60).toFixed(2);a.ROI=a.CTR*a.CTR*a.Impressions*a.TotalWatchTime/a.Views;a.ROI=Math.sqrt(a.ROI);if(a.ROI>t)t=a.ROI;if(a.Impressions>s)u.push(a)});jQuery.each(u,function(e,i){i.RelativeROI=parseInt(100*Math.sqrt(i.ROI)/Math.sqrt(t));i.Rank=1;jQuery.each(u,function(e,t){if(t.ROI>i.ROI){if(!t.Views||isNaN(t.Views))return;if(!i.Rank)i.Rank=1;i.Rank++}})});var r="";TBUtilities.SortArray(u,i,a=="Desc",true);jQuery("#tb-ctr-wl-data").html('<tr id="tb-ctr-wl-tr"></tr>');var l="";jQuery.each(u,function(e,t){if(!t.Views||isNaN(t.Views))return;try{l+='<tr style="height:77px;">';l+='<td valign="top" style="border-bottom:solid 1px #ddd; width:340px; position:relative;">';l+='    <img src="'+t.Thumbnail+'" style="width: 120px; height:68px; position:absolute; top:3px; left:5px;" />';l+='<span style="position: absolute; left: 135px; font-size:11px; top: 58px; color:#666;">Published: '+TBUtilities.ToShortDateString(t.DatePublished)+' <a href="https://studio.youtube.com/video/'+t.Id+'/analytics/tab-overview/period-default" target="_blank"><i class="material-icons" style="font-size: 18px;line-height: 5px;position: relative;top: 2px; opacity:.75;">link</i></a> </span>';l+='    <div style="padding-left:135px; height:46px; overflow:hidden; padding-top:6px; font-size:14px; line-height:16px;">'+t.OriginalTitle+"</div></td>";l+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:17px;">'+TBUtilities.FormatNumberAbbreviated(t.Clicks)+'<br><span style="font-size:.85em; opacity:.87">'+TBUtilities.FormatNumberAbbreviated(t.Impressions)+"</span></td>";l+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:17px;">'+TBUtilities.FormatNumberAbbreviated(t.Views)+'<br><span style="font-size:.85em; opacity:.87">'+(100*t.YTFactor).toFixed(1)+"%</span></td>";l+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:17px;">'+Y(t.WatchTime)+'<br><span style="font-size:.85em; opacity:.87">'+(100*t.WatchPercentage).toFixed(1)+"%</span></td>";l+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:17px;">'+TBUtilities.MilliSecondsToTimeShort(parseInt(t.WTpI))+'<br><span style="font-size:.85em; opacity:.87">'+TBUtilities.MilliSecondsToTime(t.TotalWatchTime,true)+"</span></td>";l+='<td style="border-bottom:solid 1px #ddd; width:85px; text-align:center; font-size:18px;">'+t.CTR.toFixed(2)+"%</td>";l+='<td style="border-bottom:solid 1px #ddd; width:65px; text-align:center; font-size:20px;">'+t.Rank+"</td>";l+="</tr>"}catch(e){console.log("ERR!");console.log(e)}});jQuery("#tb-ctr-wl-tr").before(l);c=[];jQuery.each(u,function(e,t){var i={};i.VideoId=t.Id;i.ThumbnailUrl=t.Thumbnail;i.Title=t.OriginalTitle;i.DatePublished=t.DatePublished.toISOString().substring(0,10);i.Views=t.Views;i.Clicks=t.Clicks;i.Impressions=t.Impressions;i.AvgViewPercentage=(t.WatchPercentage*100).toFixed(1);i.AvgViewDurationsSeconds=parseInt(t.WatchTime/1e3);i.TotalWatchTimeHours=(t.TotalWatchTime/60/6e4).toFixed(2);i.CTR=t.CTR.toFixed(2);c.push(i)});$("#tb-ctr-distribution").highcharts({credits:{enabled:false},title:{text:null},xAxis:[{title:{text:""},alignTicks:false,visible:false},{alignTicks:false,opposite:true,visible:false}],yAxis:[{title:{text:""}},{title:{text:""},opposite:true,visible:false}],tooltip:{useHTML:true,formatter:function(){if(this.series.name=="a")return mull;else{return'<div style="width:100px; overflow:hidden !important;">'+this.y+r+'<div style="font-size:10px; line-height:11px; width:100px; max-width:100px; overfow:hidden !important;"><img src="'+u[this.x].Thumbnail+'" style="height:50px; width:90px; margin-bottom:2px;" /><br>'+u[this.x].OriginalTitle+"</div></div>"}}},series:[{title:"",name:null,type:"scatter",data:e,color:"#222",marker:{radius:2,symbol:"diamond"},showInLegend:false}]})}catch(e){j("EX: buildAnalyticsTable >>"+e);F()}jQuery("#loadingtest").hide()};var G=function(e,t){var i=TBUtilities.FixLocalHtml("url({PLUGIN_FILE_ROOT}/images/icons/caret-left.png)");jQuery("#tb-tag-"+e).highcharts({chart:{inverted:true,type:"scatter",margin:[4,4,4,4]},title:{text:null},tooltip:{enabled:false},credits:{enabled:false},yAxis:{gridLineColor:"transparent",min:0,max:100,opposite:true,labels:{enabled:false},title:{text:null},plotBands:[{from:0,to:20,color:y[0]},{from:20,to:40,color:y[1]},{from:40,to:60,color:y[2]},{from:60,to:80,color:y[3]},{from:80,to:100,color:y[4]}]},xAxis:{labels:{enabled:false},tickLength:0,min:0,max:1,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},series:[{data:[t],animation:true,showInLegend:false,color:"#000000",dataLabels:{enabled:false,style:{color:"black"}},marker:{symbol:i},states:{hover:{enabled:false}}}]})};var E=function(e,t){var i=TBUtilities.FixLocalHtml("url({PLUGIN_FILE_ROOT}/images/icons/caret-left.png)");jQuery("#tb-tag-perf-"+e).highcharts({chart:{inverted:true,type:"scatter",margin:[4,4,4,4]},title:{text:null},tooltip:{enabled:false},credits:{enabled:false},yAxis:{gridLineColor:"transparent",min:0,max:100,opposite:true,labels:{enabled:false},title:{text:null},plotBands:[{from:0,to:20,color:y[0]},{from:20,to:40,color:y[1]},{from:40,to:60,color:y[2]},{from:60,to:80,color:y[3]},{from:80,to:100,color:y[4]}]},xAxis:{labels:{enabled:false},tickLength:0,min:0,max:1,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},series:[{data:[t],animation:true,showInLegend:false,color:"#000000",dataLabels:{enabled:false,style:{color:"black"}},marker:{symbol:i},states:{hover:{enabled:false}}}]})};var R=function(){j("analyzeVideoElements");return new Promise(function(e,t){try{O("Analyzing Thumbnail Elements");var i=TBGlobal.host+"/api/clickmagnet/AnalyzeVideoElements";var a={ChannelId:TBGlobal.CurrentChannelId(),Videos:[]};jQuery.each(v.Videos,function(e,t){var i={Id:t.Id,DatePublished:t.DatePublished,Thumbnail:t.Thumbnail,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(t.Title),OriginalTitle:t.OriginalTitle};a.Videos.push(i)});TBExtension.Post(i,JSON.stringify(a),function(t,i,a){e(v)},null,{contentType:"application/json"})}catch(e){j("analyzeVideoElements A: "+e);F()}}).catch(function(e){j("analyzeVideoElements B: "+e);F()})};var P=function(){j("calculateElementAnalysis");return new Promise(function(e,t){try{var i=TBGlobal.host+"/api/clickmagnet/CalculateElementAnalysis";var a={ChannelId:TBGlobal.CurrentChannelId(),Videos:[]};jQuery.each(v.Videos,function(e,t){var i={Id:t.Id,DatePublished:t.DatePublished,Thumbnail:t.Thumbnail,Title:TBUtilities.RemoveEmojiAndSpecialCharacters(t.Title),OriginalTitle:t.OriginalTitle,Clicks:t.LifetimeAnalytics?t.LifetimeAnalytics.Clicks:0,Impressions:t.LifetimeAnalytics?t.LifetimeAnalytics.Impressions:0};a.Videos.push(i)});TBExtension.Post(i,JSON.stringify(a),function(t,i,a){if(t===true){try{v.ElementData=JSON.parse(a).Data}catch(e){console.log(e)}}e(v)},null,{contentType:"application/json"})}catch(e){j("calculateElementAnalysis A: "+e);F()}}).catch(function(e){j("calculateElementAnalysis B: "+e);F()})};var M=function(){j("buildElementInspectorCharts");return new Promise(function(e,t){try{var i=v.ElementData;i=i.map(e=>{e.VideoIds=e.VideoIds||[];return e});_(i);Highcharts.chart("tb-ctr-grid-face-counts",{chart:{type:"column",marginTop:35},title:{text:null},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">Has Face(s)<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/12.png" style="height:25px;" /></p>','<p style="text-align:center">No Faces<br><img src="https://i.imgur.com/B8NDaq1.png" style="height:25px;" /></p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false}},yAxis:{min:0,format:"{value:.1f}%",title:{text:null}},tooltip:{shared:true,useHTML:true,style:{pointerEvents:"auto"},formatter:function(){return z(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return W(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").CTR,type:"FaceCount5",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount5").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").CTR,type:"FaceCount0",vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceCount0").VideoIds.length/(1*v.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-face-emotions",{chart:{type:"column",marginTop:35},title:{text:null},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">Happy<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/1.png" style="height:25px;" /></p>','<p style="text-align:center">Sad<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/35.png" style="height:25px;" /></p>','<p style="text-align:center">Surprised<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/53.png" style="height:25px;" /></p>','<p style="text-align:center">Calm<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/47.png" style="height:25px;" /></p>','<p style="text-align:center">Angry<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/45.png" style="height:25px;" /></p>','<p style="text-align:center">Confused<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/67.png" style="height:25px;" /></p>','<p style="text-align:center">Disgusted<br><img src="https://d9dw7sz5wx7ta.cloudfront.net/emoji/people/40.png" style="height:25px;" /></p>','<p style="text-align:center">Mixed<br><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnsX00B9UECvbeBQYm8nU3xBeW3qfUxgMjZ6D8xqEdKDK6Jx0s&s" style="height:25px;" /></p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false},formatter:function(){return this.value+"%"}},yAxis:{min:0,title:{text:null}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return z(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return W(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").CTR,type:"EmotionHappy",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionHappy").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").CTR,type:"EmotionSad",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionSad").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").CTR,type:"EmotionSurprised",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionSurprised").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").CTR,type:"EmotionCalm",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionCalm").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").CTR,type:"EmotionAngry",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionAngry").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").CTR,type:"EmotionConfused",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionConfused").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").CTR,type:"EmotionDisgusted",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionDisgusted").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").CTR,type:"EmotionMixed",vidCount:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").Clicks,pointWidth:TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","EmotionMixed").VideoIds.length/(1*v.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-face-attributes",{chart:{type:"column",marginTop:35},title:{text:null},credits:{enabled:false},xAxis:{categories:['<p style="text-align:center">Long<br>Shot<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:11px;" /></p>','<p style="text-align:center">Med<br>Shot<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:18px;" /></p>','<p style="text-align:center">Close<br>Up<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:27px;" /></p>','<p style="text-align:center">Mixed Size<br>Faces<br><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:11px;" /><img src="https://www.tubebuddy.com/images/modules/clickmagnet/female.png" style="height:22px;" /></p>'],position:"center",align:"center",labels:{useHTML:true},crosshair:true,title:{enabled:false}},yAxis:{min:0,format:"{value:.1f}%",title:{text:null}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return z(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return W(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeSmall").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMedium").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeLarge").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","FaceSizeMixed").VideoIds.length/(1*v.numVideosToExamine)))}]}]});Highcharts.chart("tb-ctr-grid-text-analysis",{chart:{type:"column",marginTop:35},title:{text:null},credits:{enabled:false},xAxis:{categories:["Has Text","No Text"],crosshair:true,title:{enabled:false}},yAxis:{min:0,format:"{value:.1f}%",title:{text:null}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return z(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return W(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:[{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount1").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount1").VideoIds.length/(1*v.numVideosToExamine)))},{y:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").CTR,vidCount:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length,vids:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds,impressions:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").Impressions,clicks:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").Clicks,color:"#4f9ce6",pointWidth:TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length==0?12:15+Math.min(30,45*(TBUtilities.GetInArray(i,"AnalysisType","wordCount0").VideoIds.length/(1*v.numVideosToExamine)))}]}]});var a=[];var r=[];for(var o=1;o<20;o++){var n=TBUtilities.GetInArray(i,"AnalysisType","Words"+o);if(n){a.push(n.Key);r.push({y:n.CTR,vidCount:n.VideoIds.length,impressions:n.Impressions,vids:n.VideoIds,clicks:n.Clicks,color:"#4f9ce6",pointWidth:15+Math.min(20,75*(n.VideoIds.length/(1*v.numVideosToExamine)))})}}Highcharts.chart("tb-ctr-grid-word-analysis",{chart:{type:"column",marginTop:35},title:{text:null},credits:{enabled:false},xAxis:{categories:a,crosshair:true,title:{enabled:false},labels:{rotation:-90},scrollbar:{enabled:true}},scrollbar:{enabled:true},yAxis:{min:0,format:"{value:.1f}%",title:{text:null}},tooltip:{shared:true,useHTML:true,align:"center",style:{pointerEvents:"auto"},formatter:function(){return H(this)}},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{dataLabels:{enabled:true},minPointLength:3}},series:[{dataLabels:[{enabled:true,align:"center",formatter:function(){return W(this)},useHtml:true,crop:false,overflow:"none"}],showInLegend:false,data:r,scrollbar:{enabled:true}}]});jQuery("#tb-ctr-faces-option").trigger("click");e(v)}catch(e){j("buildElementInspectorCharts A: "+e);F()}}).catch(function(e){j("buildElementInspectorCharts B: "+e);F()})};var V=function(){j("gatherAndProcessAllData");new Promise(function(e,t){try{I(v).then(A).then(S).then(U).then(L).then(R).then(P).then(M).then(function(t){jQuery("#tb-ctr-gathering").hide();jQuery("#tb-ctr-gathered").show();e(t)}).catch(function(e){t(e)})}catch(e){j("EX: gatherAndProcessAllData >>"+e);F()}})};var O=function(e){j(e);jQuery(".tb-ctr-status-label").html("Step "+f+" of 5<br><br>"+e);f++};const D=function(e){jQuery(".tb-ctr-status-label").html("Step "+f+" of 5<br><br>"+e)};const F=function(e=false){jQuery("#tb-ctr-gathering").hide();if(e){jQuery("#tb-ctr-gathering-failed-only-shorts").show()}else{jQuery("#tb-ctr-gathering-failed").show()}};var _=function(e){try{var t=TBUtilities.GetInArray(e,"AnalysisType","FaceCount5");var i=TBUtilities.GetInArray(e,"AnalysisType","FaceCount0");if(t.VideoIds.length==0){var a="Of your most recent "+v.numVideosToExamine+' uploads, none of the thumbnails contained faces so we are unable to provide any analysis vs thumbnails with faces. Consider an <a href="https://www.tubebuddy.com/tools#videoabtests" target="_blank">A/B Test</a> to see how a thumbnail with a face performs.';jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cm-consider-face").hide()}else if(i.VideoIds.length==0){var a="Of your most recent "+v.numVideosToExamine+' uploads, all of the thumbnails contained faces so we are unable to provide any analysis vs thumbnails without faces. Consider an <a href="https://www.tubebuddy.com/tools#videoabtests" target="_blank">A/B Test</a> to see how a thumbnail without a face performs.';jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cm-consider-face").hide()}else{var r="";var o=Math.abs(t.CTR-i.CTR);if(o==0)digAdj="the same";else if(o<1)r="slightly better";else if(o<3)r="noticeably better";else r="significantly better";if(t.CTR>i.CTR){var a="Your <b>thumbnails that contained a face performed "+r+"</b> compared to videos without a face ("+t.CTR.toFixed(2)+"% vs "+i.CTR.toFixed(2)+"% CTR)";jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}else{var a="Your <b>thumbnails that did not contain a face performed "+r+"</b> compared to videos with a face ("+t.CTR.toFixed(2)+"% vs "+i.CTR.toFixed(2)+"% CTR)";jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}if(t.VideoIds.length<=5){var a=jQuery("#tb-clickmagnet-face-analysis").html()+'<div style="padding-top:4px; color:red;">Note: Your sample size is on the low end with only '+t.VideoIds.length+" thumbnail"+(t.VideoIds.length==1?"":"s")+" containing a face.</div>";jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}else if(i.VideoIds.length<=5){var a=jQuery("#tb-clickmagnet-face-analysis").html()+'<div style="padding-top:4px; color:red;">Note: Your sample size is on the low end with only '+i.VideoIds.length+" thumbnail"+(i.VideoIds.length==1?"":"s")+" not containing a face.</div>";jQuery("#tb-clickmagnet-face-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}}var n=TBUtilities.GetInArray(e,"AnalysisType","wordCount1");var s=TBUtilities.GetInArray(e,"AnalysisType","wordCount0");if(n.VideoIds.length==0){var a="Of your most recent "+v.numVideosToExamine+' uploads, none of the thumbnails contained text so we are unable to provide any analysis vs thumbnails with text. Consider an <a href="https://www.tubebuddy.com/tools#videoabtests" target="_blank">A/B Test</a> to see how a thumbnail with text performs.';jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cm-consider-text").hide()}else if(s.VideoIds.length==0){var a="Of your most recent "+v.numVideosToExamine+' uploads, all of the thumbnails contained text so we are unable to provide any analysis vs thumbnails without text. Consider an <a href="https://www.tubebuddy.com/tools#videoabtests" target="_blank">A/B Test</a> to see how a thumbnail without text performs.';jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cm-consider-text").hide()}else{var r="";var o=Math.abs(n.CTR-s.CTR);if(o==0)digAdj="the same";else if(o<1)r="slightly better";else if(o<3)r="noticeably better";else r="significantly better";if(n.CTR>s.CTR){var a="Your <b>thumbnails that contained text performed "+r+"</b> compared to videos without text ("+n.CTR.toFixed(2)+"% vs "+s.CTR.toFixed(2)+"% CTR)";jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}else{var a="Your <b>thumbnails that did not contain text performed "+r+"</b> compared to videos with text ("+n.CTR.toFixed(2)+"% vs "+s.CTR.toFixed(2)+"% CTR)";jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}if(n.VideoIds.length<=5){var a=jQuery("#tb-clickmagnet-text-analysis").html()+'<div style="padding-top:4px; color:red;">Note: Your sample size is on the low end with only '+n.VideoIds.length+" thumbnail"+(n.VideoIds.length==1?"":"s")+" containing text.</div>";jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}else if(s.VideoIds.length<=5){var a=jQuery("#tb-clickmagnet-text-analysis").html()+'<div style="padding-top:4px; color:red;">Note: Your sample size is on the low end with only '+s.VideoIds.length+" thumbnail"+(s.VideoIds.length==1?"":"s")+" not containing text.</div>";jQuery("#tb-clickmagnet-text-analysis").html(DOMPurify.sanitize(a,DOMPurifyConfig))}}}catch(e){}};var N=function(){jQuery(document).on("click","#tb-ctr-gather-all-data",function(){TBUtilities.ReportProductEvent("Click Magnet Get Started Clicked",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"});if(TBGlobal.CanAccessLevel3Tools()){jQuery("#tb-ctr-description").fadeOut();jQuery("#tb-ctr-start").fadeOut(function(){jQuery("#tb-ctr-gathering").slideDown()});V()}else{TBUtilities.ReportProductEvent("Subscription Paywall",{ChannelId:TBGlobal.CurrentChannelId(),LicenseName:TBGlobal.Profile().LicenseName,Tool:TBGlobal.GetToolById("clickmagnet").name,Platform:"extension"});TBGlobal.ShowUpgradePage(null,TBGlobal.limitation.clickmagnet,false,TBGlobal.Enums.PaywallAction.CLICK)}});jQuery(document).on("change","#tb-ctr-tf-select, #tb-ctr-ts-select, #tb-ctr-mi-select",function(){o=jQuery("#tb-ctr-tf-select").val();n=jQuery("#tb-ctr-ts-select").val();s=jQuery("#tb-ctr-mi-select").val();if(o!="Lifetime"){jQuery("#tb-ctr-ts-na").show();jQuery("#tb-ctr-ts-select").hide();jQuery("#tb-ctr-ts-select").val("All")}else{jQuery("#tb-ctr-ts-na").hide();jQuery("#tb-ctr-ts-select").show()}L()});jQuery(document).on("change","#tb-bw-ts-select",function(){l=jQuery("#tb-bw-ts-select").val();if(l=="All"){jQuery("#tb-ctr-power-description").html("Top performing videos in <b>All Traffic Sources</b>.<br><br>If you want to grow your channel faster, focus on making videos similar to the top ranking videos.")}else if(l=="YT_SEARCH"){jQuery("#tb-ctr-power-description").html("Top performing videos in <b>Search Results</b>.<br><br>If you are trying to do better in YouTube Search, focus on making videos similar to  the top ranking videos.")}else if(l=="YT_RELATED"){jQuery("#tb-ctr-power-description").html("Top performing videos in <b>Suggested Videos</b>.<br><br>If you are trying to better the Suggested Videos, focus on making videos similar to  the top ranking videos.")}else if(l=="SUBSCRIBER"){jQuery("#tb-ctr-power-description").html("Top performing videos in <b>Browse Features</b>.<br><br>If you are trying to improve videos for your Subscribers, focus on making videos similar to  the top ranking videos.")}B()});jQuery(document).on("click","#tb-ctr-analytics-button",function(){jQuery("#tb-crt-title").text("Click Magnet - Advanced Analytics");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ClickMagnet_AdvancedAnalytics,"clickmagnet")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyClickMagnet] #tb-ctr-analytics-button"})}jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-analytics-container").show();TBUtilities.ReportProductEvent("Click Magnet Advanced Analytics Viewed",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"});jQuery("#tb-ctrcenter-export").show();jQuery("#tb-ctrcenter-export-opportunity").hide();jQuery("#tb-ctr-footer").show();jQuery("#tb-ctr-back").show();L();if(g){jQuery(".tb-ctr-sort-CTR").find(".tb-ctr-sort").trigger("click");g=false}});jQuery(document).on("click","#tb-ctr-element-inspector-button",function(){jQuery("#tb-crt-title").text("Click Magnet - Element Inspector");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ClickMagnet_ElementInspector,"clickmagnet")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyClickMagnet] #tb-ctr-element-inspector-button"})}jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-element-inspector-container").show();TBUtilities.ReportProductEvent("Click Magnet Element Inspector Viewed",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"});$("#tb-ctrcenter-export").hide();$("#tb-ctrcenter-export-opportunity").hide();$("#tb-ctr-footer").show();$("#tb-ctr-back").show()});jQuery(document).on("click","#tb-ctr-opportunity-finder-button",function(){jQuery("#tb-crt-title").text("Click Magnet - CTR Oppotunities");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ClickMagnet_CTROppotunitiesUse,"clickmagnet")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyClickMagnet] #tb-ctr-opportunity-finder-button"})}jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-opportunity-finder-container").show();TBUtilities.ReportProductEvent("Click Magnet CTR Opportunities Viewed",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"});$("#tb-ctrcenter-export").hide();$("#tb-ctr-footer").show();$("#tb-ctr-back").show();k()});jQuery(document).on("click","#tb-ctr-top-performers-button",function(){jQuery("#tb-crt-title").text("Click Magnet - Power Rankings");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ClickMagnet_PowerRankings,"clickmagnet")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyClickMagnet] #tb-ctr-top-performers-button"})}jQuery("#tb-ctr-options").hide();jQuery("#tb-ctr-top-performers-container").show();TBUtilities.ReportProductEvent("Click Magnet Power Rankings Viewed",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"});$("#tb-ctrcenter-export").hide();$("#tb-ctr-footer").show();$("#tb-ctr-back").show();B()});jQuery(document).on("click",".tb-ctr-back-home",function(){jQuery("#tb-ctr-options").show();jQuery("#tb-ctr-analytics-container").hide();jQuery("#tb-ctr-element-inspector-container").hide();jQuery("#tb-ctr-opportunity-finder-container").hide();jQuery("#tb-ctr-top-performers-container").hide();jQuery("#tb-crt-title").text("Click Magnet");$("#tb-ctr-footer").hide()});jQuery(document).on("change","#tb-ctr-mi-select",function(){_filterImpressions=parseInt(jQuery(this).val());L()});jQuery(document).on("change","#tb-ctr-opportunity-potential",function(){k()});jQuery(document).on("change","#tb-ctr-opportunity-duration",function(){k()});jQuery(document).on("change","#tb-ctr-ts-select",function(){L();if(jQuery(this).children("option:selected").val()=="SUBSCRIBERS"){jQuery("#tb-ctr-traffic-source-label").text("CTR of your videos from your Subscribers.")}else if(jQuery(this).children("option:selected").val()=="YT_SEARCH"){jQuery("#tb-ctr-traffic-source-label").text("CTR of your videos in the YouTube Search results.")}});jQuery(document).on("click","#tb-ctrcenter-export",function(){var e=n;if(n==="YT_RELATED"){e="Suggested"}else if(n==="YT_SEARCH"){e="Search"}else if(n==="SUBSCRIBER"){e="Browse"}else if(n==="PLAYLIST"){e="Playlists"}var t="TubeBuddy - "+TBGlobal.CurrentChannelId()+" - ";t+="Time Frame ("+o+") Traffic Source ("+e+") Min Impressions ("+s+")";t+=" Date("+(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDay()+")";TBUtilities.DownloadArrayToCSV(c,t+".csv");TBUtilities.ReportProductEvent("Click Magnet Advanced Analytics Export to CSV",{channel_id:TBGlobal.CurrentChannelId(),timestamp:(new Date).toISOString(),tool:"click magnet"})});jQuery(document).on("click","#tb-ctrcenter-export-opportunity",function(){var e="TubeBuddy - Video Scores and Opportunities - "+TBGlobal.CurrentChannelId()+" - ";e+=" Date("+(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDay()+")";TBUtilities.DownloadArrayToCSV(d,e+".csv")});jQuery(document).on("click",".tb-op-sort-Title",function(){Q("Title")});jQuery(document).on("click",".tb-op-sort-Views",function(){Q("Views")});jQuery(document).on("click",".tb-op-sort-Clicks",function(){Q("Clicks")});jQuery(document).on("click",".tb-op-sort-WTpI",function(){Q("WTpI")});jQuery(document).on("click",".tb-op-sort-CTR",function(){Q("CTR")});jQuery(document).on("click",".tb-op-sort-RelativeROI",function(){Q("RelativeROI")});jQuery(document).on("click",".tb-op-sort-RelativeOpportunityScore",function(){Q("RelativeOpportunityScore")});jQuery(document).on("click",".tb-ctr-sort",function(){jQuery(".tb-ctr-sort").css("font-weight","normal");jQuery(this).css("font-weight","bold");var e=jQuery(this).attr("data-ctr-sort");a=e==i?a=="Asc"?"Desc":"Asc":"Desc";i=e;jQuery(".tb-ctr-sort-arrow").remove();if(a=="Desc"){jQuery(this).append('<i class="material-icons tb-ctr-sort-arrow tb-ctr-sort-arrow-down" style="font-size:14px; position:absolute;">keyboard_arrow_down</i>')}else{jQuery(this).append('<i class="material-icons tb-ctr-sort-arrow tb-ctr-sort-arrow-up" style="font-size:14px; position:absolute;">keyboard_arrow_up</i>')}jQuery("#loadingtest").show();setTimeout(L(),1)});jQuery(document).on("click",".tb-ctr-sort-opp",function(){jQuery(".tb-ctr-sort-last-30").css("font-weight","normal");jQuery(".tb-ctr-sort-opp").css("font-weight","bold");jQuery(".tb-ctr-sort-item").hide();if(i=="OppAsc")i="OppDesc";else i="OppAsc";jQuery("#tb-ctr-"+i).show();k()});jQuery(document).on("click",".tb-ctr-tab-option",function(){t=jQuery(this).attr("data-cr-option");jQuery(".tb-ctr-tab-option-selected").removeClass("tb-ctr-tab-option-selected");jQuery(".tb-ctr-tab-option-body-show").removeClass("tb-ctr-tab-option-body-show");jQuery(this).addClass("tb-ctr-tab-option-selected");jQuery(".tb-ctr-tab-option-body").hide();jQuery(this).find(".tb-ctr-tab-option-body").addClass("tb-ctr-tab-option-body-show");jQuery(".tb-cr-element-section").hide();jQuery("[data-tab-name="+t+"]").show();if(h=="Winners and Losers"){L()}})};var W=function(e){var t="";if(e.point.vidCount==0){t='<p style="text-align:center;"><span style="font-weight:100; color:#777;">none</span></p>'}else{t='<p style="text-align:center;"><span style="text-align:center; font-size:1.45em; line-height:1.5em;">'+e.y.toFixed(2)+'%</span><br><span style="font-weight:100; color:#777;">'+e.point.vidCount+" Video"+(e.point.vidCount==1?"":"s")+"</span></p>"}return t};var z=function(e){var t='<div style="font-size:1.3em; font-weight:800; max-width:400px; background:white;">'+e.y.toFixed(2)+"% CTR</div>";t+='<div style="margin-top:10px;">'+e.points[0].point.vidCount+" Matching Videos</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.impressions)+" Combined Impressions</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.clicks)+" Combined Clicks</div>";var i="";jQuery.each(e.points[0].point.vids,function(e,t){i+=t+","});if(e.points[0].point.vidCount>0)t+='<div style="background:white; margin-bottom:-5px; border-top:solid 1px #aaa;"><div style="font-weight:500; font-size:.9em; margin-top:5px; margin-bottom:5px;">Examples &nbsp; &nbsp; <a style="text-decoration:underline" target="_blank" href="https://www.tubebuddy.com/channel/CtrElementAnalysis?id='+TBGlobal.CurrentChannelId()+"&type="+e.points[0].point.type+"&ti="+e.points[0].point.impressions+"&tc="+e.points[0].point.clicks+"&ctr="+e.y.toFixed(2)+"&videos="+i+'">View All ('+e.points[0].point.vidCount+")</a></div>";jQuery.each(e.points[0].point.vids,function(e,i){if(e<4)t+='<img src="https://img.youtube.com/vi/'+i+'/mqdefault.jpg" style="margin-right:5px; margin-bottom:0px; height: 45px;" />';if(e==1)t+="<br />"});t+="</div>";return t};var H=function(e){var t='<div style="font-size:1.3em; font-weight:800; max-width:400px; background:white;">'+e.y.toFixed(2)+"% CTR</div>";t+='<div style="margin-top:10px;">'+e.points[0].point.vidCount+" Matching Videos</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.impressions)+" Combined Impressions</div>";t+="<div>"+TBUtilities.FormatNumberWithCommas(e.points[0].point.clicks)+" Combined Clicks</div>";var i="";jQuery.each(e.points[0].point.vids,function(e,t){i+=t+","});if(e.points[0].point.vidCount>0)t+='<div style="background:white; margin-bottom:-5px; border-top:solid 1px #aaa;"><div style="font-weight:500; font-size:.9em; margin-top:5px; margin-bottom:5px;">Examples &nbsp; &nbsp; <a style="text-decoration:underline" target="_blank" href="https://www.tubebuddy.com/channel/CtrElementAnalysis?id='+TBGlobal.CurrentChannelId()+"&type="+e.points[0].point.type+"&ti="+e.points[0].point.impressions+"&tc="+e.points[0].point.clicks+"&ctr="+e.y.toFixed(2)+"&videos="+i+'">View All ('+e.points[0].point.vidCount+")</a></div>";jQuery.each(e.points[0].point.vids,function(e,i){var a=TBUtilities.GetInArray(v.Videos,"Id",i);if(e<7)t+='<div class="tb-cm-title-tt">&middot; '+a.OriginalTitle+"</div>"});t+="</div>";return t};var Y=function(e){var t=Math.floor(e/1e3%60);var i=Math.floor(e/(1e3*60)%60);var a=Math.floor(e/(1e3*60*60)%24);a=a<10?"0"+a:a;i=i<10?"0"+i:i;t=t<10?"0"+t:t;if(a>0)return a+":"+i+":"+t;else return i+":"+t};var q=function(){jQuery(".tb-clickmagnet-channel").attr("src",TBGlobal.Profile().ThumbnailUrl);jQuery("#tb-ctrcenter-container").show();j("prepareDialog")};var J=function(){jQuery(document.body).on("CRTBLoadCTRCenterTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(t.response);jQuery("body").append(t.response);j("__ CTR DEBUG __");q()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyClickMagnet] CRTBLoadCTRCenterTemplate"})}})};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){if(TBExtension.GetType()==="firefox"){window.requestAnimationFrame=window.requestAnimationFrame.bind(window)}J();T();N();e=true}else{q()}}}}}();const TubeBuddyCardsUpdateStudio=function(){const t={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",selectedVideo:{},currentVideo:null,isStopped:false,failedVideos:[],step:1,videosWithFoundCards:[],destinationVideos:[],hasFinished:false,errorCount:0,successCount:0,totalDestinationVideos:0,actionCardCount:0,imageConversionDic:{},searchQueue:[]};let i=false;const a=function(){const e=chrome.extension.getURL("modules/cardsupdatestudio.html");TBExtension.Get(e,(e,t,i)=>{try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);B()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] loadHtml"})}})};const r=function(){jQuery(document).on("click","#tb-cards-update-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(()=>{jQuery("#tb-cards-update-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-cards-update-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change",".tb-cards-update-target-select",()=>{const e=jQuery(".tb-cards-update-target-select").val();switch(e){case"url":{break}default:{break}}});jQuery(document).on("change",".tb-cards-update-cardtype-select",()=>{try{const e=jQuery(".tb-cards-update-cardtype-select").val();switch(e){case"video":{jQuery(".tb-cards-update-cardtype-video").show();jQuery(".tb-cards-update-cardtype-link").hide();jQuery(".tb-cards-update-target-select").val("videoUrl");break}case"link":{break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-cards-update-imagefile"})}});jQuery(document).on("change",".tb-cards-update-imagefile",()=>{try{const e=jQuery(".tb-cards-update-imagefile").val().split(".").pop().toLowerCase();if(jQuery.inArray(e,["gif","png","jpg","jpeg"])==-1){TBUtilities.Alert("Invalid image file type.  Only .gif, .png, and .jpg are allowed");jQuery(".tb-cards-update-imagefile").val("");return}jQuery("#tb-cards-update-uploaded-file").text(jQuery(".tb-cards-update-imagefile").val().split("\\")[2]).show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-cards-update-imagefile"})}});jQuery(document).on("change",".tb-cards-update-filter",function(){jQuery(".tb-cards-update-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-cards-update-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-cards-update-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-cards-update-destination-row[data-privacy="public"]').hide();break}jQuery(".tb-cards-update-destination-selected-count").text(jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length);jQuery(".tb-cards-update-destination-total-count").text(jQuery(".tb-cards-update-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-cards-update-destination-row",function(){try{if(!jQuery(this).hasClass("tb-cards-update-destination-row--selected")){jQuery(this).addClass("tb-cards-update-destination-row--selected");if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length>1){jQuery(this).removeClass("tb-cards-update-destination-row--selected");TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}}else{jQuery(this).removeClass("tb-cards-update-destination-row--selected")}const e=h();t.actionCardCount=e;jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery("tb-cards-update-destination-total-count").text(jQuery(".tb-cards-update-destination-row").filter(":visible").length);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [click] tb-cards-update-checkbox-include"})}});jQuery(document).on("click",".tb-cards-update-select-all-checkboxes",()=>{if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}jQuery(".tb-cards-update-destination-row").addClass("tb-cards-update-destination-row--selected");const e=h();jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()});jQuery(document).on("click",".tb-cards-update-select-no-checkboxes",()=>{jQuery(".tb-cards-update-destination-row").removeClass("tb-cards-update-destination-row--selected");const e=h();jQuery(".tb-cards-update-destination-selected-count").text(e);jQuery(".tb-cards-update-count").text(e);if(jQuery(".tb-cards-update-count").text()=="1")jQuery(".tb-cards-update-count-s").hide();else jQuery(".tb-cards-update-count-s").show()});jQuery(document).on("click","input[name=tb-cards-update-target-option]",function(){jQuery(".tb-cards-update-target-input").prop("disabled",true);jQuery(".tb-cards-update-target-input").val("");jQuery(this).siblings(".tb-cards-update-target-input:first").prop("disabled",false)});jQuery(document).on("click",".tb-cards-update-action-option",function(){const e=jQuery(this).is(":checked");if(e){if(jQuery(this).hasClass("tb-cards-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").prop("disabled",false)}else{jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").prop("disabled",false);jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").val("")}}else{if(jQuery(this).hasClass("tb-cards-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-cards-update-imagefile:first").val("");jQuery("#tb-cards-update-uploaded-file").text("").hide()}else{jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-cards-update-action-input:first").val("")}}});jQuery(document).on("click","#tb-cards-update-close, #tb-cards-update-cancel, .tb-cards-update-closex",()=>{try{TubeBuddyMenu.HideBackground();jQuery("#tb-cards-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [click] tb-cards-close"})}});jQuery("body").on("TBCloseCardUpdateStudio",()=>{try{TubeBuddyMenu.HideBackground();jQuery("#tb-cards-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [click] tb-cards-close"})}});jQuery(document).on("click",".tb-cards-update-continue",()=>{try{switch(t.step){case 1:{if(jQuery(".tb-cards-update-target-input-field").val()==""){TBUtilities.Alert("Enter your search criteria");return}const e=jQuery(".tb-cards-update-cardtype-select").val();const t=o();switch(e){case"video":{try{if(t.find(".tb-cards-update-action-video").is(":checked")==false&&t.find(".tb-cards-update-action-custom-message").is(":checked")==false&&t.find(".tb-cards-update-action-teaser-text").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}let e;let i;if(t.find(".tb-cards-update-action-video").is(":checked")){const a=t.find(".tb-cards-update-action-video-input").val();i=w(a);if(!i){e=C(a)}if(!e&&i==false){TBUtilities.Alert("Invalid video id or playlist id to set to.  Make sure you have a valid YouTube URL");return}}if(t.find(".tb-cards-update-action-teaser").is(":checked")&&t.find(".tb-cards-update-action-teaser-input").val()==""){TBUtilities.Alert("Enter a TEASER TEXT");return}if(t.find(".tb-cards-update-action-custom-message").is(":checked")&&t.find(".tb-cards-update-action-custom-message-input").val()==""){TBUtilities.Alert("Enter a CUSTOM MESSAGE");return}const a=jQuery(".tb-cards-update-target-input-field").val();const r=w(a);let o;if(!r){o=C(a)}if(!o&&r==false){TBUtilities.Alert("Invalid video id or playlist id to search for.  Make sure you have a valid YouTube URL");return}n(2)}catch(e){TBUtilities.Alert("Invalid video id or playlist id.  Make sure you have a valid YouTube URL")}break}case"link":{if(t.find(".tb-cards-update-action-title").is(":checked")==false&&t.find(".tb-cards-update-action-teaser-text").is(":checked")==false&&t.find(".tb-cards-update-action-call").is(":checked")==false&&t.find(".tb-cards-update-action-url").is(":checked")==false&&t.find(".tb-cards-update-action-image").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}if(t.find(".tb-cards-update-action-title").is(":checked")&&t.find(".tb-cards-update-action-title-input").val()==""){TBUtilities.Alert("Enter a TITLE");return}if(t.find(".tb-cards-update-action-teaser").is(":checked")&&t.find(".tb-cards-update-action-teaser-input").val()==""){TBUtilities.Alert("Enter a TEASER TEXT");return}if(t.find(".tb-cards-update-action-call").is(":checked")&&t.find(".tb-cards-update-action-call-input").val()==""){TBUtilities.Alert("Enter a CALL TO ACTION");return}if(t.find(".tb-cards-update-action-url").is(":checked")&&t.find(".tb-cards-update-action-url-input").val()==""){TBUtilities.Alert("Enter a URL");return}if(t.find(".tb-cards-update-action-image").is(":checked")&&t.find(".tb-cards-update-imagefile").val()==""){TBUtilities.Alert("Select an image to upload");return}n(2);break}}break}case 2:{switch(parseInt(t.method)){case 0:if(t.specificVideoIds.length==0){jQuery("#tb-cards-input-ids-status").css("color","red");jQuery("#tb-cards-input-ids-status").text("No videos detected");jQuery("#tb-cards-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&t.specificVideoIds.length>1){TBGlobal.ShowUpgradePage("update cards in bulk (more than 1 video at a time)","bulkupdatecards");return}TBGlobal.AddUserDebugInfo(`Video Selection Method: Video IDs ${JSON.stringify(t.specificVideoIds)}`);T();break;case 1:var e=jQuery("#tb-cards-update-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var i=e.getSelectedPlaylistIds();if(!i||i.length==0){TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)",()=>{});return}if(i.length>=2){TBUtilities.Alert("Please select only one playlist",()=>{});return}if(i.length==1){const a=jQuery("#tb-cards-update-input-playlist").find(".playlistSelectTypeList").is(":checked");if(t.validPlaylistIds.indexOf(i[0])>-1||a&&i.length>0){t.playlistId=i.join(",")}else{e.showValidationWarning();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)",()=>{});return}}TBGlobal.AddUserDebugInfo(`Video Selection Method: Playlist [${t.playlistId}]`);TBYouTubeApi.GetPlaylistVideos(t.playlistId,null,p,k);break;case 2:if(t.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo(`Video Selection Method: Search [${t.search}]`);jQuery("#tb-cards-destination").show();TBYouTubeApi.GetChannelVideosSearch(t.search,null,p,k);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var a=null;if(jQuery("#tb-cards-update-onlyLoadFirstPage").is(":checked")){const e=/^\+?\d+$/.test(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val());if(e==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}a=parseInt(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val());if(a<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,p,k,a,null,t.selectedVideo.id);break}jQuery(".tb-cards-update-loading-count").text("0");jQuery(".tb-cards-update-loading-count-total").text("?");jQuery(".tb-cards-update-loading-text").text("Loading your videos...");jQuery(".tb-cards-update-loading-text-search").text("");jQuery(".tb-cards-loading-count-container").show();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-no-videos").hide();n(3);break}case 3:{if(jQuery(".tb-cards-update-destination-row--selected").filter(":visible").length==0){TBUtilities.Alert("Please select at least 1 video to update cards.");return}t.destinationVideos=[];jQuery(".tb-cards-update-destination-row--selected").filter(":visible").each(function(){const e=jQuery(this).attr("data-video-id");jQuery.each(t.videosWithFoundCards,(i,a)=>{if(a.id==e){const i=TBUtilities.GetInArray(t.destinationVideos,"id",e);if(!i){t.destinationVideos.push(a)}}})});jQuery("#tb-cards-update-queue-list").empty();jQuery("#tb-cards-update-completed-list").empty();if(t.destinationVideos.length>=2e3){jQuery("#tb-cards-update-2k-warning").show()}else{jQuery("#tb-cards-update-2k-warning").hide()}n(4);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [click] #tb-cards-continue, #tb-cards-kickoff"})}});jQuery(document).on("click",".tb-cards-update-kickoff",()=>{const e=TBGlobal.Profile().LicenseName;if(!jQuery(".tb-cards-update-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to update the cards");return}TBUtilities.ReportProductEvent("Bulk Processing Confirm And Apply",{timestamp:(new Date).toISOString(),channel_id:TBGlobal.CurrentChannelId(),tool:"bulkupdatecards",content_type:"cards",content_processing_action:"update",count_of_videos:t.videosWithFoundCards.length});try{TBUtilities.AddAction({VideoCount:t.videosWithFoundCards.length,CardCount:t.actionCardCount,Data:`method = ${t.method}`},TBUtilities.ActionTypes.BulkUpdateCards_Update,"bulkupdatecards")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [addAction]"})}jQuery(".tb-cards-update-status").show();jQuery(".tb-cards-update-confirm").hide();jQuery("#tb-cards-update-stop").show();jQuery(".tb-cards-update-cancel").hide();jQuery(".tb-cards-update-back").hide();jQuery(".tb-cards-update-kickoff").hide();jQuery(".tb-cards-update-continue").hide();jQuery("#tb-cards-update-close").hide();jQuery(".tb-cards-update-step-number").text("- Processing");s().then(()=>{l();u();if(TBGlobal.IsExperimentEnabled("tba-bulk-tools-gating")){if(e!=="Enterprise"){TBUtilities.IncrementFeatureUse("bulkcards")}}}).catch(e=>{TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [tb-cards-update-kickoff]"});TBUtilities.Alert("There was an error updating cards")})});jQuery(document).on("click",".tb-cards-update-back",()=>{if(t.step>1){const e=t.step;t.step-=1;n(t.step,e)}});jQuery(document).on("click","#tb-cards-update-method-ids, #tb-cards-update-method-playlist, #tb-cards-update-method-search, #tb-cards-update-method-full",function(e){t.method=parseInt(jQuery(this).attr("data-method"));const i=jQuery("#tb-cards-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect(e){t.playlistId=e}}).data("plugin_playlistSelect");switch(t.method){case 0:jQuery("#tb-cards-update-input-ids").removeAttr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.disable();break;case 1:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.enable();i.showDropDown();break;case 2:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").removeAttr("disabled","disabled");i.disable();break;case 3:jQuery("#tb-cards-update-input-ids").attr("disabled","disabled");jQuery("#tb-cards-update-input-playlist").attr("disabled","disabled");jQuery("#tb-cards-update-input-search").attr("disabled","disabled");i.disable();break}});jQuery(document).on("click",".playlistSelectTypeManual",function(){const e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").find("input");e.each((e,i)=>{t.validPlaylistIds.push(jQuery(i).val())})});jQuery(document).on("change keypress keyup paste keydown blur",".playlistSelectManualIds",function(){const e=jQuery(this).val();if(t.validPlaylistIds.indexOf(e)==-1){jQuery("#tb-playlist-select-manual-id-invalid").show()}else{jQuery("#tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",()=>{jQuery("#tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-cards-update-input-search",function(e){t.search=jQuery(this).val().trim()});jQuery(document).on("click","#tb-cards-update-stop",()=>{t.isStopped=true;jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-close").show();jQuery("#tb-cards-update-working").hide();jQuery("#tb-cards-update-stopped").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-cards-update-input-ids",function(e){let i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-cards-update-input-ids-status").hide();return}jQuery("#tb-cards-update-input-ids-status").show();t.specificVideoIds=[];if(i.indexOf(",")>-1){t.specificVideoIds=i.split(",")}else{t.specificVideoIds=i.split(" ")}for(let e=0;e<t.specificVideoIds.length;e++){t.specificVideoIds[e]=t.specificVideoIds[e].trim();t.specificVideoIds[e]=t.specificVideoIds[e].replace("https://www.youtube.com/watch?v=","");t.specificVideoIds[e]=t.specificVideoIds[e].replace("https://youtu.be/","");if(t.specificVideoIds[e].length!=11){t.specificVideoIds.splice(e,1);e--}}if(t.specificVideoIds.length==0){jQuery("#tb-cards-update-input-ids-status").text("No videos detected");jQuery("#tb-cards-update-input-ids-status").css("color","red")}else if(t.specificVideoIds.length==1){jQuery("#tb-cards-update-input-ids-status").text("1 video detected");jQuery("#tb-cards-update-input-ids-status").css("color","green");jQuery("#tb-cards-update-method-ids").prop("checked",true);jQuery("#tb-cards-update-method-ids").trigger("click")}else{jQuery("#tb-cards-update-input-ids-status").text(`${t.specificVideoIds.length} videos detected`);jQuery("#tb-cards-update-input-ids-status").css("color","green");jQuery("#tb-cards-update-method-ids").prop("checked",true);jQuery("#tb-cards-update-method-ids").trigger("click")}})};var o=function(){const e=jQuery(".tb-cards-update-cardtype-select").val();let t=null;switch(e){case"video":{t=jQuery(".tb-cards-update-cardtype-video");break}case"link":{t=jQuery(".tb-cards-update-cardtype-link");break}}return t};var n=function(e,i){try{jQuery(".tb-cards-update-step1").hide();jQuery(".tb-cards-update-step2").hide();jQuery(".tb-cards-update-step3").hide();jQuery(".tb-cards-update-step4").hide();jQuery(".tb-cards-update-kickoff").hide();jQuery(".tb-cards-update-continue").hide();jQuery(".tb-cards-update-back").hide();jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-done-close").hide();jQuery(".tb-cards-update-step-number").text(`- Step ${e}`);switch(e){case 1:{jQuery(".tb-cards-update-step1").show();jQuery(".tb-cards-update-continue").show();t.step=1;break}case 2:{t.specificVideoIds=[];t.specificVideos=[];t.playlistId="";t.search="";jQuery(".tb-cards-update-step2").show();jQuery(".tb-cards-update-continue").show();jQuery(".tb-cards-update-back").show();jQuery("#tb-cards-update-input-ids").val("");jQuery("#tb-cards-update-input-playlist").val("");jQuery("#tb-cards-update-input-search").val("");jQuery("#tb-cards-update-input-ids-status").empty();jQuery("#tb-cards-update-input-playlist-status").empty();const e=jQuery("#tb-cards-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect(e){t.playlistId=e}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-cards-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-cards-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");t.method&&t.method==1?e.enable():e.disable();t.step=2;break}case 3:{jQuery(".tb-cards-update-step3").show();jQuery(".tb-cards-update-continue").show();jQuery(".tb-cards-update-back").show();if(i&&i==4){}else{jQuery(".tb-cards-update-destination-list").empty();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-destination-selected-count").text("0");jQuery(".tb-cards-update-destination-total-count").text("0");jQuery(".tb-cards-update-count").text("0")}t.step=3;break}case 4:{jQuery(".tb-cards-update-step4").show();jQuery(".tb-cards-update-continue").hide();jQuery(".tb-cards-update-kickoff").show();jQuery(".tb-cards-update-back").show();jQuery(".tb-cards-update-confirm").show();jQuery(".tb-cards-update-status").hide();jQuery(".tb-cards-update-continue").hide();t.step=4;break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] showstep "})}};var s=function(){return new Promise((e,i)=>{const a=jQuery(".tb-cards-update-cardtype-select").val();const r=jQuery(".tb-cards-update-target-select").val();let n;if(a=="video"){n=jQuery(".tb-cards-update-action-video-input").val()}const s=o();let l=0;let u=0;jQuery.each(t.destinationVideos,(t,i)=>{jQuery.each(i.foundCards,(t,i)=>{if(i){switch(a){case"video":{switch(r){case"videoUrl":{const e=C(n);if(s.find(".tb-cards-update-action-video").is(":checked")){i.videoInfoCard.videoId=e}break}case"playlistUrl":{const e=w(n);if(s.find(".tb-cards-update-action-video").is(":checked")){i.playlistInfoCard.fullPlaylistId=e}break}}if(s.find(".tb-cards-update-action-teaser-text").is(":checked")){i.teaserText=s.find(".tb-cards-update-action-teaser-input").val()}if(s.find(".tb-cards-update-action-custom-message").is(":checked")){i.customMessage=s.find(".tb-cards-update-action-custom-message-input").val()}break}case"link":{if(i.type.toLowerCase()=="fund"||i.type.toLowerCase()=="associated"||i.type.toLowerCase()=="product"){if(s.find(".tb-cards-update-action-url").is(":checked")&&s.find(".tb-cards-update-action-url-input").val()!=""){const e=s.find(".tb-cards-update-action-url-input").val();switch(i.type){case"fund":{i.fundraisingInfoCard.targetUrl=e;if(s.find(".tb-cards-update-action-title").is(":checked")&&s.find(".tb-cards-update-action-title-input").val()!=""){if(i.fundraisingInfoCard.title){i.fundraisingInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}}break}case"product":{i.productInfoCard.targetUrl=e;if(s.find(".tb-cards-update-action-title").is(":checked")&&s.find(".tb-cards-update-action-title-input").val()!=""){if(i.productInfoCard.title){i.productInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}}break}case"associated":{i.associatedWebsiteInfoCard.targetUrl=e;if(s.find(".tb-cards-update-action-title").is(":checked")&&s.find(".tb-cards-update-action-title-input").val()!=""){if(i.associatedWebsiteInfoCard.title){i.associatedWebsiteInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}}break}case"merch":{i.merchInfoCard.targetUrl=e;if(s.find(".tb-cards-update-action-title").is(":checked")&&s.find(".tb-cards-update-action-title-input").val()!=""){if(i.merchInfoCard.title){i.merchInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}}break}}}if(s.find(".tb-cards-update-action-title").is(":checked")&&s.find(".tb-cards-update-action-title-input").val()!=""){switch(i.type){case"fund":{if(i.fundraisingInfoCard.title){i.fundraisingInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}break}case"product":{if(i.productInfoCard.title){i.productInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}break}case"associated":{if(i.associatedWebsiteInfoCard.title){i.associatedWebsiteInfoCard.title=s.find(".tb-cards-update-action-title-input").val()}break}}}if(s.find(".tb-cards-update-action-teaser-text").is(":checked")&&s.find(".tb-cards-update-action-teaser-input").val()!=""){i.teaserText=s.find(".tb-cards-update-action-teaser-input").val()}if(s.find(".tb-cards-update-action-call").is(":checked")&&s.find(".tb-cards-update-action-call-input").val()!=""){i.customMessage=s.find(".tb-cards-update-action-call-input").val()}if(s.find(".tb-cards-update-action-image").is(":checked")&&s.find(".tb-cards-update-imagefile").val()!=""){l++;const t=new FileReader;const a=s.find(".tb-cards-update-imagefile")[0].files[0];t.addEventListener("load",()=>{u++;i.imageDataUrl=t.result.split(",")[1];if(i.customUploadedImage){delete i.customUploadedImage}if(u===l){e()}},false);if(a){t.readAsDataURL(a)}}}break}}}})});if(l===0){e()}})};var l=function(){TBUtilities.Log("startProcessing");try{t.totalDestinationVideos=t.destinationVideos.length;t.hasFinished=false;t.errorCount=0;t.successCount=0;jQuery("#tb-cards-update-update-queue-list").empty();jQuery("#tb-cards-update-completed-list").empty();jQuery("#tb-cards-update-queue-list2").empty();jQuery("#tb-cards-update-completed-list2").empty();jQuery("#tb-cards-update-error-list2").empty();jQuery("#tb-cards-update-error-list2").hide();jQuery("#tb-cards-update-error-none-list2").show();jQuery("#tb-cards-update-working").show();jQuery("#tb-cards-update-done").hide();jQuery("#tb-cards-update-done-close").hide();jQuery("#tb-cards-update-stopped").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [startProcessing]"})}};var u=function(){TBUtilities.Log("processNextVideo");try{jQuery("#tb-cards-update-progress-container").html("Start &rarr;");if(t.isStopped)return;if(t.destinationVideos.length==0&&t.hasFinished==false){t.hasFinished=true;jQuery("#tb-cards-update-status-count").html(`<b>${t.totalDestinationVideos}</b> of <b>${t.totalDestinationVideos}</b> videos complete`);jQuery("#tb-cards-update-progress-container").hide();if(t.currentVideo){if(!t.currentVideo.error)d(t.currentVideo.video);else b(t.currentVideo.video)}c();jQuery("#tb-cards-update-working").hide();jQuery("#tb-cards-update-done").show();jQuery("#tb-cards-update-done-close").show();jQuery("#tb-cards-update-stop").hide();jQuery("#tb-cards-update-close").show();const e=t.errorCount+t.successCount;const i=t.errorCount/e;TBUtilities.ReportProductEvent("Bulk Processing Review Results And Close",{timestamp:(new Date).toISOString(),channel_id:TBGlobal.CurrentChannelId(),tool:"bulkupdatecards",content_type:"cards",content_processing_action:"update",count_of_videos:e,failure_rate:i});return}const{id:e}=t.destinationVideos[0];if(t.currentVideo){if(!t.currentVideo.error)d(t.currentVideo.video);else b(t.currentVideo.video)}const i=TBUtilities.RemoveFromArray(t.destinationVideos,"id",e);t.currentVideo=i[0];const a=`<b>${parseInt(t.totalDestinationVideos-t.destinationVideos.length)}</b> of <b>${t.totalDestinationVideos}</b> videos complete`;jQuery("#tb-cards-update-status-count").html(DOMPurify.sanitize(a,DOMPurifyConfig));const r=`${jQuery("#tb-cards-update-progress-container").html()} Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v=${e}">${e}</a> &rarr;`;jQuery("#tb-cards-update-progress-container").html(DOMPurify.sanitize(r,DOMPurifyConfig));c();TBGlobal.AddUserDebugInfo(`Updating cards for video: ${t.currentVideo.id}`);TubeBuddyYouTubeActions.CopyCardsStudio(t.currentVideo.id,t.currentVideo.cards).then(()=>{TBUtilities.Log("cardUpdateCallback");u()}).catch(e=>{if(e)t.currentVideo.error=e;else{e="Error updating cards";t.currentVideo.error=e}u()})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [processNextVideo]"});jQuery("#tb-cards-update-progress-container").html(`${jQuery("#tb-cards-update-progress-container").html()}Error: ${e.message}`);TBUtilities.Alert(`Sorry, there was an error: "${e.message}"`);jQuery("#tb-cards-update-stop").trigger("click");jQuery("#tb-cards-update-stop").trigger("click")}};var c=function(){TBUtilities.Log("showNextToBeProcessed");jQuery("#tb-cards-update-queue-list2").empty();jQuery("#tb-cards-update-queue-complete-list2").hide();let e=0;jQuery.each(t.destinationVideos,(t,i)=>{const a=i.video.snippet.thumbnails.thumbnailMedium?i.video.snippet.thumbnails.thumbnailMedium:i.video.snippet.thumbnails.default.url;let r=jQuery(".tb-cards-update-processing-template2:last")[0].outerHTML;r=r.replace("#THUMBNAILURL#",a);r=TBUtilities.ReplaceAll(r,"#VIDEOID#",i.id);r=r.replace("#VIDEOTITLE#",i.video.snippet.title);r=r.replace("#HREF#",`https://www.youtube.com/watch?v=${i.id}`);r=r.replace("display: none","display:flex");jQuery("#tb-cards-update-queue-list2").prepend(DOMPurify.sanitize(r,DOMPurifyConfig));e++;if(e==3)return false});if(e==0){jQuery("#tb-cards-update-queue-complete-list2").show();jQuery("#tb-cards-update-queue-list2").hide()}else{jQuery("#tb-cards-update-queue-list2").show()}};var d=function(e){TBUtilities.Log("addCompletedSuccess");const i=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;let a=jQuery(".tb-cards-update-processed-success:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",i);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",e.id);a=a.replace("#VIDEOTITLE#",e.snippet.title);a=a.replace("#HREF#",`https://studio.youtube.com/video/${e.id}/edit`);a=a.replace("display:none","display:flex");jQuery("#tb-cards-update-completed-list2").prepend(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cards-update-completed-none-list2").hide();jQuery("#tb-cards-update-completed-list2").show();t.successCount++;jQuery("#tb-cards-update-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(t.successCount))};var b=function(e){try{jQuery("#tb-cards-update-error-copy-container").show();const t=jQuery("#tb-cards-update-error-copy").attr("data-clipboard-text");let i=[];if(t!=""){i=t.split(",");if(i.indexOf(e.id)==-1){i.push(e.id)}}else{i.push(e.id)}jQuery("#tb-cards-update-error-copy").attr("data-clipboard-text",i.join(","))}catch(e){console.log(e)}TBUtilities.Log("addCompletedError");const i=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;let a=jQuery(".tb-cards-update-processed-error:last")[0].outerHTML;a=a.replace("#THUMBNAILURL#",i);a=TBUtilities.ReplaceAll(a,"#VIDEOID#",e.id);a=a.replace("#VIDEOTITLE#",e.snippet.title);a=a.replace("#ERROR#",e.error);a=a.replace("#HREF#",`https://studio.youtube.com/video/${e.id}/edit`);a=a.replace("display:none","display:flex");jQuery("#tb-cards-update-error-list2").prepend(DOMPurify.sanitize(a,DOMPurifyConfig));jQuery("#tb-cards-update-error-list2").show();jQuery("#tb-cards-update-error-none-list2").hide();t.errorCount++;jQuery("#tb-cards-update-error-list2-count").text(TBUtilities.FormatNumberWithCommas(t.errorCount))};var h=function(){let e=0;jQuery(".tb-cards-update-destination-row").filter(":visible").each(function(){if(jQuery(this).hasClass("tb-cards-update-destination-row--selected")){const i=jQuery(this).attr("data-video-id");jQuery.each(t.videosWithFoundCards,(t,a)=>{if(a.id==i){e+=a.foundCards.length}})}});return e};var p=function(e){try{if(e==null){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-cards-update-back").trigger("click");return}if(e.length==0){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-cards-update-update-back").trigger("click");return}jQuery(".tb-cards-update-destination-list").empty();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-no-videos").hide();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-loading-text").html("Hang Tight!<br /><br />We are currently looking through the videos you selected to find Cards that match your search criteria. This generally takes a couple seconds per video meaning it may take up to 30 minutes per 1,000 videos you have.");jQuery(".tb-cards-loading-count-container").hide();jQuery("tb-cards-update-loading-text-search").text("");t.videosWithFoundCards=[];t.searchQueue=[];jQuery.each(e,(e,i)=>{if(i.id.videoId!=null){i.id=i.id.videoId}if(i.snippet.resourceId!=null)i.id=i.snippet.resourceId.videoId;if(i.snippet!==null&&i.snippet.title==="Deleted video"&&i.snippet.thumbnails===null)return;t.searchQueue.push(i)});m()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] [gotVideoList]"})}};var m=function(){if(t.searchQueue.length>0){const e=t.searchQueue.shift();TubeBuddyYouTubeActions.GetCardsListStudio(e.id).then(i=>{if(i&&i.length>0){var a=`Searching cards for video https://youtube.com/watch?v=${e.id}`;jQuery(".tb-cards-update-loading-text-search").html(DOMPurify.sanitize(a,DOMPurifyConfig));const r=f(i);if(r.length>0){const a=TBUtilities.GetInArray(t.videosWithFoundCards,"id",e.id);if(!a){t.videosWithFoundCards.push({video:e,cards:i,id:e.id,error:"",foundCards:r});const a=jQuery("#tb-cards-update-destination-template").html();const o=e.snippet.thumbnails.thumbnailMedium?e.snippet.thumbnails.thumbnailMedium:e.snippet.thumbnails.default.url;let n="matches";if(r.length==1){n="match"}const s=a.formatTemplate(e.id,o,`https://studio.youtube.com/video/${e.id}/edit`,e.snippet.title,r.length,n,e.status.privacy);jQuery(".tb-cards-update-destination-list").prepend(DOMPurify.sanitize(s,DOMPurifyConfig))}}}else{var a=`Searching cards for video https://youtube.com/watch?v=${e.id}`;jQuery(".tb-cards-update-loading-text-search").html(DOMPurify.sanitize(a,DOMPurifyConfig))}if(t.searchQueue.length===0){y()}else{m()}}).catch(e=>{TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] GetCardsListStudio"})})}else{y()}};var y=function(){jQuery(".tb-cards-update-loading-videos").hide();if(t.videosWithFoundCards.length==0){jQuery(".tb-cards-update-no-videos").show();jQuery(".tb-cards-update-destination-list").hide();jQuery(".tb-cards-update-continue").hide()}else{jQuery(".tb-cards-update-destination-total-count").text(t.videosWithFoundCards.length);jQuery(".tb-cards-update-destination-list").show();jQuery(".tb-cards-update-continue").show();if(TBGlobal.CanAccessLevel2Tools()&&(t.method==0||t.method==1))jQuery("#tb-cards-update-select-all-checkboxes").trigger("click")}};var f=function(t){const i=jQuery(".tb-cards-update-target-select").val();const a=jQuery(".tb-cards-update-target-input-field").val().toUpperCase();const r=jQuery(".tb-cards-update-cardtype-select").val();console.log(`searchField=${i}`);console.log(`searchValue=${a}`);console.log(`selectedCardType=${r}`);let o;let n;let s;if(r=="video"){s=jQuery(".tb-cards-update-target-select").val();o=w(jQuery(".tb-cards-update-target-input-field").val());n=C(jQuery(".tb-cards-update-target-input-field").val())}console.log(`listIdToSearch=${o}`);console.log(`videoIdToSearch=${n}`);console.log(`searchType=${s}`);console.log(`selectedCardType=${r}`);const l=new Array;try{jQuery.each(t,(e,t)=>{console.log(t);switch(r){case"video":{if(t.type=="playlist"||t.type=="video"){switch(s){case"videoUrl":{if(t.type=="video"&&t.videoInfoCard.videoId==n){l.push(t);return true}break}case"playlistUrl":{if(t.type=="playlist"&&t.playlistInfoCard.fullPlaylistId==o){l.push(t);return true}break}}}else{return true}break}case"link":{if(t.type=="product"||t.type=="associated"||t.type=="fund"||t.type=="merch"){switch(t.type){case"product":{if(i=="url"){if(g(t.productInfoCard.targetUrl,a)==true){l.push(t);return true}}if(i=="title"){if(t.productInfoCard.title&&t.productInfoCard.title.toUpperCase()===a){l.push(t);return true}}if(i=="teaser"){if(t.teaserText&&t.teaserText.toUpperCase()===a){l.push(t);return true}}if(i=="call"){if(t.customMessage&&iitem.customMessage.toUpperCase()===a){l.push(t);return true}}break}case"associated":{if(i=="url"){if(g(t.associatedWebsiteInfoCard.targetUrl,a)==true){l.push(t);return true}}if(i=="title"){if(t.associatedWebsiteInfoCard.title&&t.associatedWebsiteInfoCard.title.toUpperCase()===a){l.push(t);return true}}if(i=="teaser"){if(t.teaserText&&t.teaserText.toUpperCase()===a){l.push(t);return true}}if(i=="call"){if(t.customMessage&&iitem.customMessage.toUpperCase()===a){l.push(t);return true}}break}case"fund":{if(i=="url"){if(g(t.fundraisingInfoCard.targetUrl,a)==true){l.push(t);return true}}if(i=="title"){if(t.fundraisingInfoCard.title&&t.fundraisingInfoCard.title.toUpperCase()===a){l.push(t);return true}}if(i=="teaser"){if(t.teaserText&&t.teaserText.toUpperCase()===a){l.push(t);return true}}if(i=="call"){if(t.customMessage&&iitem.customMessage.toUpperCase()===a){l.push(t);return true}}break}case"merch":{if(i=="url"){if(g(t.merchInfoCard.targetUrl,a)==true){l.push(t);return true}}if(i=="title"){if(t.merchInfoCard.title&&t.merchInfoCard.title.toUpperCase()===a){l.push(t);return true}}if(i=="teaser"){if(t.teaserText&&t.teaserText.toUpperCase()===a){l.push(t);return true}}if(i=="call"){if(t.customMessage&&iitem.customMessage.toUpperCase()===a){l.push(t);return true}}break}}}else{return true}break}}})}catch(t){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] searchCards"})}return l};var g=function(e,t){let i=false;TBUtilities.Log("doesUrlMatch");try{if(e&&t){if(jQuery(".tb-cards-update-http-options-input").is(":checked")){e=e.replace(/^http:\/\//i,"https://");t=t.replace(/^http:\/\//i,"https://");e=v(e);t=v(t);if(e.toUpperCase()===t.toUpperCase()){i=true}}else if(e.toUpperCase()===t.toUpperCase()){i=true}}}catch(e){TBUtilities.LogError(e)}TBUtilities.Log(`doesUrlMatch - ${i}`);return i};var v=function(e){if(e.charAt(e.length-1)=="/"){e=e.substr(0,e.length-1)}return e};var T=function(){const e=t.specificVideoIds[0];t.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails,snippet,id,status",j)};var j=function(e){if(e!=null)t.specificVideos.push(e);if(t.specificVideoIds.length>0){T()}else{p(t.specificVideos)}};const Q=function(){jQuery(document.body).on("CRTBLoadCardsUpdateTemplate",(e,t)=>{try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);B()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] CRTBLoadCardsTemplate"})}})};var k=function(e){if(e.totalCount-e.loaded>50){jQuery(".tb-cards-update-loading-count").attr("data-auto-count",e.loaded);let{totalCount:t}=e;if(jQuery("#tb-cards-update-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-cards-update-onlyLoadFirstPage-number").val())}jQuery(".tb-cards-update-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery(".tb-cards-update-loading-count"))}else{jQuery(".tb-cards-update-rendering").show();jQuery(".tb-cards-update-loading-count-container").hide()}};var B=function(){try{jQuery("#tb-cards-update-error-copy-container").hide();jQuery("#tb-cards-update-error-copy").prop("data-clipboard-text","");jQuery("#tb-cards-update-uploaded-file").text("").hide();const e=new ClipboardJS("#tb-cards-update-error-copy");jQuery(".tb-cards-update-cardtype-link").hide();jQuery("#tb-cards-update-target-select").val("videoUrl");jQuery(".tb-cards-update-cardtype-video").show();t.destinationVideos=[];t.videosWithFoundCards=[];t.specificVideos=[];t.currentVideo=null;t.imageConversionDic={};t.is=false;t.searchQueue=[];jQuery('input[type="radio"][value="url"]').prop("checked",true);jQuery(".tb-cards-update-target-input").prop("disabled",true);jQuery(".tb-cards-update-target-url").prop("disabled",false);jQuery(".tb-cards-update-target-input").val("");jQuery(".tb-cards-update-action-input").val("");jQuery(".tb-cards-update-filter").val("all");jQuery(".tb-cards-update-action-input").prop("disabled",true);jQuery(".tb-cards-update-imagefile").val("");jQuery(".tb-cards-update-imagefile").prop("disabled",true);jQuery(".tb-cards-update-action-option").prop("checked","");jQuery(".tb-cards-kickoff").hide();jQuery(".tb-cards-update-confirm-checkbox").prop("checked","");jQuery(".tb-cards-update-no-videos").hide();jQuery(".tb-cards-update-loading-videos").show();jQuery(".tb-cards-update-loading-count").text("0");jQuery(".tb-cards-update-loading-count-total").text("?");jQuery(".tb-cards-update-loading-text-search").text("");jQuery(".tb-cards-update-loading-text").text("Loading your videos...");jQuery(".tb-cards-loading-count-container").show();jQuery(".tb-cards-update-target-input-field").val("");jQuery(".tb-cards-update-action-video-input").val("");jQuery("#tb-cards-update-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-cards-update-onlyLoadFirstPage").prop("checked",false);t.step=1;n(t.step);jQuery("#tb-cards-update-container").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsUpdateStudio] prepareDialog"})}};var C=function(e){const t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;const i=e.match(t);return i&&i[7].length==11?i[7]:false};var w=function(e){const t=/list=([a-zA-Z0-9\-\_]+)&?/;const i=e.match(t);const a=i?i[1]:false;return a};return{Show(){if(TBGlobal.IsAuthenticated()){if(!i){Q();a();r();i=true}else{B()}}}}}();